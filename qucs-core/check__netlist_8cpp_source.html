<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Qucs-core: check_netlist.cpp Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />



</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">Qucs-core
   &#160;<span id="projectnumber">0.0.19</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">check_netlist.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="check__netlist_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * check_netlist.cpp - checker for the Qucs netlist</span>
<a name="l00003"></a>00003 <span class="comment"> *</span>
<a name="l00004"></a>00004 <span class="comment"> * Copyright (C) 2003-2009 Stefan Jahn &lt;stefan@lkcc.org&gt;</span>
<a name="l00005"></a>00005 <span class="comment"> *</span>
<a name="l00006"></a>00006 <span class="comment"> * This is free software; you can redistribute it and/or modify</span>
<a name="l00007"></a>00007 <span class="comment"> * it under the terms of the GNU General Public License as published by</span>
<a name="l00008"></a>00008 <span class="comment"> * the Free Software Foundation; either version 2, or (at your option)</span>
<a name="l00009"></a>00009 <span class="comment"> * any later version.</span>
<a name="l00010"></a>00010 <span class="comment"> *</span>
<a name="l00011"></a>00011 <span class="comment"> * This software is distributed in the hope that it will be useful,</span>
<a name="l00012"></a>00012 <span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00013"></a>00013 <span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l00014"></a>00014 <span class="comment"> * GNU General Public License for more details.</span>
<a name="l00015"></a>00015 <span class="comment"> *</span>
<a name="l00016"></a>00016 <span class="comment"> * You should have received a copy of the GNU General Public License</span>
<a name="l00017"></a>00017 <span class="comment"> * along with this package; see the file COPYING.  If not, write to</span>
<a name="l00018"></a>00018 <span class="comment"> * the Free Software Foundation, Inc., 51 Franklin Street - Fifth Floor,</span>
<a name="l00019"></a>00019 <span class="comment"> * Boston, MA 02110-1301, USA.</span>
<a name="l00020"></a>00020 <span class="comment"> *</span>
<a name="l00021"></a>00021 <span class="comment"> * $Id$</span>
<a name="l00022"></a>00022 <span class="comment"> *</span>
<a name="l00023"></a>00023 <span class="comment"> */</span>
<a name="l00024"></a>00024 
<a name="l00025"></a>00025 <span class="preprocessor">#if HAVE_CONFIG_H</span>
<a name="l00026"></a>00026 <span class="preprocessor"></span><span class="preprocessor"># include &lt;<a class="code" href="config_8h.html">config.h</a>&gt;</span>
<a name="l00027"></a>00027 <span class="preprocessor">#endif</span>
<a name="l00028"></a>00028 <span class="preprocessor"></span>
<a name="l00029"></a>00029 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
<a name="l00030"></a>00030 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<a name="l00031"></a>00031 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00032"></a>00032 <span class="preprocessor">#include &lt;cmath&gt;</span>
<a name="l00033"></a>00033 <span class="preprocessor">#include &lt;assert.h&gt;</span>
<a name="l00034"></a>00034 <span class="preprocessor">#include &lt;float.h&gt;</span>
<a name="l00035"></a>00035 
<a name="l00036"></a>00036 <span class="preprocessor">#include &quot;<a class="code" href="logging_8h.html">logging.h</a>&quot;</span>
<a name="l00037"></a>00037 <span class="preprocessor">#include &quot;<a class="code" href="strlist_8h.html">strlist.h</a>&quot;</span>
<a name="l00038"></a>00038 <span class="preprocessor">#include &quot;<a class="code" href="netdefs_8h.html">netdefs.h</a>&quot;</span>
<a name="l00039"></a>00039 <span class="preprocessor">#include &quot;<a class="code" href="equation_8h.html">equation.h</a>&quot;</span>
<a name="l00040"></a>00040 <span class="preprocessor">#include &quot;<a class="code" href="check__netlist_8h.html">check_netlist.h</a>&quot;</span>
<a name="l00041"></a>00041 <span class="preprocessor">#include &quot;<a class="code" href="constants_8h.html" title="Global physical constants header file.">constants.h</a>&quot;</span>
<a name="l00042"></a>00042 <span class="preprocessor">#include &quot;<a class="code" href="environment_8h.html" title="The environment class definition.">environment.h</a>&quot;</span>
<a name="l00043"></a>00043 <span class="preprocessor">#include &quot;<a class="code" href="variable_8h.html">variable.h</a>&quot;</span>
<a name="l00044"></a>00044 <span class="preprocessor">#include &quot;<a class="code" href="module_8h.html">module.h</a>&quot;</span>
<a name="l00045"></a>00045 
<a name="l00046"></a>00046 <span class="keyword">using namespace </span><a class="code" href="structqucs.html">qucs</a>;
<a name="l00047"></a>00047 <span class="keyword">using namespace </span>qucs::eqn;
<a name="l00048"></a>00048 
<a name="l00049"></a>00049 <span class="comment">/* Global definitions for parser and checker. */</span>
<a name="l00050"></a><a class="code" href="check__netlist_8h.html#af9f2457a510affce0dcc0a47f2115251">00050</a> <span class="keyword">struct </span><a class="code" href="structdefinition__t.html">definition_t</a> * <a class="code" href="check__netlist_8cpp.html#a743ab6f836d53fd6b166066585882b8c">definition_root</a> = NULL;
<a name="l00051"></a><a class="code" href="check__netlist_8cpp.html#a8443096178b6c84a10f0da689c81ee44">00051</a> <span class="keyword">struct </span><a class="code" href="structdefinition__t.html">definition_t</a> * <a class="code" href="check__netlist_8cpp.html#a8443096178b6c84a10f0da689c81ee44">subcircuit_root</a> = NULL;
<a name="l00052"></a><a class="code" href="check__netlist_8cpp.html#a48cff5ac2e09a83a3ac15628009a4b3f">00052</a> environment * <a class="code" href="check__netlist_8cpp.html#a48cff5ac2e09a83a3ac15628009a4b3f">env_root</a> = NULL;
<a name="l00053"></a>00053 
<a name="l00054"></a>00054 <span class="comment">/* The function counts the nodes in a definition line. */</span>
<a name="l00055"></a><a class="code" href="check__netlist_8cpp.html#a4d43ae45dea6ff18c123be678afeb8f5">00055</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="check__netlist_8cpp.html#a4d43ae45dea6ff18c123be678afeb8f5">checker_count_nodes</a> (<span class="keyword">struct</span> <a class="code" href="structdefinition__t.html">definition_t</a> * def)
<a name="l00056"></a>00056 {
<a name="l00057"></a>00057     <span class="keywordtype">int</span> count = 0;
<a name="l00058"></a>00058     <span class="keywordflow">for</span> (<span class="keyword">struct</span> <a class="code" href="structnode__t.html">node_t</a> * <a class="code" href="classqucs_1_1eqn_1_1node.html">node</a> = def-&gt;<a class="code" href="structdefinition__t.html#a2e38921eeafd06f6329859b847db874c">nodes</a>; <a class="code" href="classqucs_1_1eqn_1_1node.html">node</a> != NULL; <a class="code" href="classqucs_1_1eqn_1_1node.html">node</a> = <a class="code" href="classqucs_1_1eqn_1_1node.html">node</a>-&gt;<a class="code" href="classqucs_1_1eqn_1_1node.html#a1089d2982a12bcd1ad60fa12dcf11c71">next</a>)
<a name="l00059"></a>00059         count++;
<a name="l00060"></a>00060     <span class="keywordflow">return</span> count;
<a name="l00061"></a>00061 }
<a name="l00062"></a>00062 
<a name="l00063"></a>00063 <span class="comment">/* The function returns an available definition line for the given</span>
<a name="l00064"></a>00064 <span class="comment">   type.  If there is no such definition type the function returns</span>
<a name="l00065"></a>00065 <span class="comment">   NULL. */</span>
<a name="l00066"></a><a class="code" href="check__netlist_8cpp.html#a536357be17cb4d2181217ad01eae2117">00066</a> <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structdefine__t.html">define_t</a> * <a class="code" href="check__netlist_8cpp.html#a536357be17cb4d2181217ad01eae2117">checker_find_definition</a> (<span class="keywordtype">char</span> * <a class="code" href="parse__vcd_8y.html#ae0bd5e8ec17b2aad3338041991eb1056">type</a>, <span class="keywordtype">int</span> <a class="code" href="parse__netlist_8y.html#aac060c4e468c0d6757ec5326be2fa395">action</a>)
<a name="l00067"></a>00067 {
<a name="l00068"></a>00068     <span class="keyword">struct </span><a class="code" href="structdefine__t.html">define_t</a> * def = module::getModule (type);
<a name="l00069"></a>00069     <span class="keywordflow">if</span> (def != NULL &amp;&amp; action == def-&gt;<a class="code" href="structdefine__t.html#aa8588915d5ac240ab7a76da29cca674b">action</a>) <span class="keywordflow">return</span> def;
<a name="l00070"></a>00070     <span class="keywordflow">return</span> NULL;
<a name="l00071"></a>00071 }
<a name="l00072"></a>00072 
<a name="l00073"></a>00073 <span class="comment">/* The function returns the number of properties in a definition line</span>
<a name="l00074"></a>00074 <span class="comment">   specified by the given key. */</span>
<a name="l00075"></a><a class="code" href="check__netlist_8cpp.html#a2d22357edbb7c3690b57adfce214071e">00075</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="check__netlist_8cpp.html#a2d22357edbb7c3690b57adfce214071e">checker_find_property</a> (<span class="keyword">const</span> <span class="keywordtype">char</span> * key, <span class="keyword">struct</span> <a class="code" href="structpair__t.html">pair_t</a> * pp)
<a name="l00076"></a>00076 {
<a name="l00077"></a>00077     <span class="keywordtype">int</span> count = 0;
<a name="l00078"></a>00078     <span class="keywordflow">while</span> (pp != NULL)
<a name="l00079"></a>00079     {
<a name="l00080"></a>00080         <span class="keywordflow">if</span> (!strcmp (pp-&gt;<a class="code" href="structpair__t.html#a528541470063ea3e6ef340122e6f946a">key</a>, key))
<a name="l00081"></a>00081             count++;
<a name="l00082"></a>00082         pp = pp-&gt;<a class="code" href="structpair__t.html#a77bd04da2c79936e50deb20d72070384">next</a>;
<a name="l00083"></a>00083     }
<a name="l00084"></a>00084     <span class="keywordflow">return</span> count;
<a name="l00085"></a>00085 }
<a name="l00086"></a>00086 
<a name="l00087"></a>00087 <span class="comment">/* Checks if the given property key is either optional or required for</span>
<a name="l00088"></a>00088 <span class="comment">   the given definition type and returns the type of the property. */</span>
<a name="l00089"></a><a class="code" href="check__netlist_8cpp.html#a595c10bfd2a816b09dccf63a49609788">00089</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="check__netlist_8cpp.html#a595c10bfd2a816b09dccf63a49609788">checker_is_property</a> (<span class="keyword">struct</span> <a class="code" href="structdefine__t.html">define_t</a> * available,
<a name="l00090"></a>00090                                 <span class="keyword">const</span> <span class="keywordtype">char</span> * key)
<a name="l00091"></a>00091 {
<a name="l00092"></a>00092     <span class="keywordtype">int</span> <a class="code" href="parse__mdl_8y.html#a7e98b8a17c0aad30ba64d47b74e2a6c1">i</a>;
<a name="l00093"></a>00093     <span class="keywordflow">for</span> (i = 0; <a class="code" href="netdefs_8h.html#a415e94a0e012e5307675d9f9bd98251a">PROP_IS_PROP</a> (available-&gt;<a class="code" href="structdefine__t.html#a22221cc9f714cf2989f88178f49d8cd4">required</a>[i]); i++)
<a name="l00094"></a>00094     {
<a name="l00095"></a>00095         <span class="keywordflow">if</span> (!strcmp (available-&gt;<a class="code" href="structdefine__t.html#a22221cc9f714cf2989f88178f49d8cd4">required</a>[i].<a class="code" href="structproperty__t.html#ae0177f56720b1a0e3f212878887faa94">key</a>, key))
<a name="l00096"></a>00096             <span class="keywordflow">return</span> available-&gt;<a class="code" href="structdefine__t.html#a22221cc9f714cf2989f88178f49d8cd4">required</a>[i].<a class="code" href="structproperty__t.html#afe85c2a743a4136c5dd454d06676c9d7">type</a>;
<a name="l00097"></a>00097     }
<a name="l00098"></a>00098     <span class="keywordflow">for</span> (i = 0; <a class="code" href="netdefs_8h.html#a415e94a0e012e5307675d9f9bd98251a">PROP_IS_PROP</a> (available-&gt;<a class="code" href="structdefine__t.html#a7641b0acfd3b1744e70cdfc20d7802bd">optional</a>[i]); i++)
<a name="l00099"></a>00099     {
<a name="l00100"></a>00100         <span class="keywordflow">if</span> (!strcmp (available-&gt;<a class="code" href="structdefine__t.html#a7641b0acfd3b1744e70cdfc20d7802bd">optional</a>[i].<a class="code" href="structproperty__t.html#ae0177f56720b1a0e3f212878887faa94">key</a>, key))
<a name="l00101"></a>00101             <span class="keywordflow">return</span> available-&gt;<a class="code" href="structdefine__t.html#a7641b0acfd3b1744e70cdfc20d7802bd">optional</a>[i].<a class="code" href="structproperty__t.html#afe85c2a743a4136c5dd454d06676c9d7">type</a>;
<a name="l00102"></a>00102     }
<a name="l00103"></a>00103     <span class="keywordflow">return</span> <a class="code" href="netdefs_8h.html#a144fb2630882537a29dd547c3b25b616">PROP_NONE</a>;
<a name="l00104"></a>00104 }
<a name="l00105"></a>00105 
<a name="l00106"></a>00106 <span class="comment">/* Counts the number of definitions given by the specified type and</span>
<a name="l00107"></a>00107 <span class="comment">   instance name in the definition list. */</span>
<a name="l00108"></a><a class="code" href="check__netlist_8cpp.html#a5685c01b42b33e166beb47265bb4fa88">00108</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="check__netlist_8cpp.html#a5685c01b42b33e166beb47265bb4fa88">checker_count_definition</a> (<span class="keyword">struct</span> <a class="code" href="structdefinition__t.html">definition_t</a> * root,
<a name="l00109"></a>00109                                      <span class="keyword">const</span> <span class="keywordtype">char</span> * <a class="code" href="parse__vcd_8y.html#ae0bd5e8ec17b2aad3338041991eb1056">type</a>, <span class="keywordtype">char</span> * <a class="code" href="parse__netlist_8y.html#a5ffaf17e178b3a6fa2012fe3050ede22">instance</a>)
<a name="l00110"></a>00110 {
<a name="l00111"></a>00111     <span class="keywordtype">int</span> count = 0;
<a name="l00112"></a>00112     <span class="keywordflow">for</span> (<span class="keyword">struct</span> <a class="code" href="structdefinition__t.html">definition_t</a> * def = root; def != NULL; def = def-&gt;<a class="code" href="structdefinition__t.html#ac6f2d42a0105ff6e699938fcd36bd12b">next</a>)
<a name="l00113"></a>00113     {
<a name="l00114"></a>00114         <span class="keywordflow">if</span> (!strcmp (def-&gt;type, type) &amp;&amp; !strcmp (def-&gt;instance, instance))
<a name="l00115"></a>00115         {
<a name="l00116"></a>00116             <span class="keywordflow">if</span> (++count &gt; 1)
<a name="l00117"></a>00117                 def-&gt;duplicate = 1;
<a name="l00118"></a>00118         }
<a name="l00119"></a>00119     }
<a name="l00120"></a>00120     <span class="keywordflow">return</span> count;
<a name="l00121"></a>00121 }
<a name="l00122"></a>00122 
<a name="l00123"></a>00123 <span class="comment">/* Returns the value for a given definition type, key and variable</span>
<a name="l00124"></a>00124 <span class="comment">   identifier if it is in the list of definitions.  Otherwise the</span>
<a name="l00125"></a>00125 <span class="comment">   function returns NULL. */</span>
<a name="l00126"></a><a class="code" href="check__netlist_8cpp.html#a3c10f19e8afd5bdd576eaf751d62b80d">00126</a> <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structvalue__t.html">value_t</a> * <a class="code" href="check__netlist_8cpp.html#a3c10f19e8afd5bdd576eaf751d62b80d">checker_find_variable</a> (<span class="keyword">struct</span> <a class="code" href="structdefinition__t.html">definition_t</a> * root,
<a name="l00127"></a>00127         <span class="keyword">const</span> <span class="keywordtype">char</span> * <a class="code" href="parse__vcd_8y.html#ae0bd5e8ec17b2aad3338041991eb1056">type</a>,
<a name="l00128"></a>00128         <span class="keyword">const</span> <span class="keywordtype">char</span> * key,
<a name="l00129"></a>00129         <span class="keywordtype">char</span> * <a class="code" href="parse__spice_8y.html#a25164f805d9af841d8063fe86f5e1da4">ident</a>)
<a name="l00130"></a>00130 {
<a name="l00131"></a>00131     <span class="keyword">struct </span><a class="code" href="structpair__t.html">pair_t</a> * pair;
<a name="l00132"></a>00132     <span class="keywordflow">for</span> (<span class="keyword">struct</span> <a class="code" href="structdefinition__t.html">definition_t</a> * def = root; def != NULL; def = def-&gt;<a class="code" href="structdefinition__t.html#ac6f2d42a0105ff6e699938fcd36bd12b">next</a>)
<a name="l00133"></a>00133     {
<a name="l00134"></a>00134         <span class="keywordflow">if</span> (!strcmp (def-&gt;type, type))
<a name="l00135"></a>00135         {
<a name="l00136"></a>00136             <span class="keywordflow">for</span> (pair = def-&gt;pairs; pair != NULL; pair = pair-&gt;<a class="code" href="structpair__t.html#a77bd04da2c79936e50deb20d72070384">next</a>)
<a name="l00137"></a>00137             {
<a name="l00138"></a>00138                 <span class="keywordflow">if</span> (!strcmp (pair-&gt;<a class="code" href="structpair__t.html#a528541470063ea3e6ef340122e6f946a">key</a>, key))
<a name="l00139"></a>00139                     <span class="keywordflow">if</span> (pair-&gt;<a class="code" href="structpair__t.html#a4971c332851244bac4916d04e6db3b7c">value</a>-&gt;<a class="code" href="structvalue__t.html#ad442091764df35b6ff5dbfd7f5bd965b">ident</a> != NULL &amp;&amp; ident != NULL &amp;&amp;
<a name="l00140"></a>00140                             strcmp (pair-&gt;<a class="code" href="structpair__t.html#a4971c332851244bac4916d04e6db3b7c">value</a>-&gt;<a class="code" href="structvalue__t.html#ad442091764df35b6ff5dbfd7f5bd965b">ident</a>, ident) == 0)
<a name="l00141"></a>00141                         <span class="keywordflow">return</span> pair-&gt;<a class="code" href="structpair__t.html#a4971c332851244bac4916d04e6db3b7c">value</a>;
<a name="l00142"></a>00142             }
<a name="l00143"></a>00143         }
<a name="l00144"></a>00144     }
<a name="l00145"></a>00145     <span class="keywordflow">return</span> NULL;
<a name="l00146"></a>00146 }
<a name="l00147"></a>00147 
<a name="l00148"></a>00148 <span class="comment">/* The function returns the appropriate value for a given key within</span>
<a name="l00149"></a>00149 <span class="comment">   the given netlist definition if the value is a reference (a</span>
<a name="l00150"></a>00150 <span class="comment">   string).  If there is no such key value pair the function returns</span>
<a name="l00151"></a>00151 <span class="comment">   NULL. */</span>
<a name="l00152"></a><a class="code" href="check__netlist_8cpp.html#ad9167af3b9466ee85d15c808f41741c5">00152</a> <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structvalue__t.html">value_t</a> * <a class="code" href="check__netlist_8cpp.html#ad9167af3b9466ee85d15c808f41741c5">checker_find_reference</a> (<span class="keyword">struct</span> <a class="code" href="structdefinition__t.html">definition_t</a> * def,
<a name="l00153"></a>00153         <span class="keyword">const</span> <span class="keywordtype">char</span> * key)
<a name="l00154"></a>00154 {
<a name="l00155"></a>00155     <span class="keyword">struct </span><a class="code" href="structpair__t.html">pair_t</a> * pair;
<a name="l00156"></a>00156     <span class="keywordflow">for</span> (pair = def-&gt;<a class="code" href="structdefinition__t.html#af1c52c3c0e0d2e5764a992e28084ed99">pairs</a>; pair != NULL; pair = pair-&gt;<a class="code" href="structpair__t.html#a77bd04da2c79936e50deb20d72070384">next</a>)
<a name="l00157"></a>00157     {
<a name="l00158"></a>00158         <span class="keywordflow">if</span> (!strcmp (pair-&gt;<a class="code" href="structpair__t.html#a528541470063ea3e6ef340122e6f946a">key</a>, key))
<a name="l00159"></a>00159             <span class="keywordflow">if</span> (pair-&gt;<a class="code" href="structpair__t.html#a4971c332851244bac4916d04e6db3b7c">value</a>-&gt;<a class="code" href="structvalue__t.html#ad442091764df35b6ff5dbfd7f5bd965b">ident</a> != NULL)
<a name="l00160"></a>00160                 <span class="keywordflow">return</span> pair-&gt;<a class="code" href="structpair__t.html#a4971c332851244bac4916d04e6db3b7c">value</a>;
<a name="l00161"></a>00161     }
<a name="l00162"></a>00162     <span class="keywordflow">return</span> NULL;
<a name="l00163"></a>00163 }
<a name="l00164"></a>00164 
<a name="l00165"></a>00165 <span class="comment">/* The function looks for the given property key within the properties</span>
<a name="l00166"></a>00166 <span class="comment">   of the given definition line and returns its value if the property</span>
<a name="l00167"></a>00167 <span class="comment">   is not an identifier.  Otherwise the function returns NULL. */</span>
<a name="l00168"></a><a class="code" href="check__netlist_8cpp.html#abae464b0dd770d52d4ab3a5bb94ccba9">00168</a> <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structvalue__t.html">value_t</a> * <a class="code" href="check__netlist_8cpp.html#abae464b0dd770d52d4ab3a5bb94ccba9">checker_find_prop_value</a> (<span class="keyword">struct</span> <a class="code" href="structdefinition__t.html">definition_t</a> * def,
<a name="l00169"></a>00169         <span class="keyword">const</span> <span class="keywordtype">char</span> * key)
<a name="l00170"></a>00170 {
<a name="l00171"></a>00171     <span class="keyword">struct </span><a class="code" href="structpair__t.html">pair_t</a> * pair;
<a name="l00172"></a>00172     <span class="keywordflow">for</span> (pair = def-&gt;<a class="code" href="structdefinition__t.html#af1c52c3c0e0d2e5764a992e28084ed99">pairs</a>; pair != NULL; pair = pair-&gt;<a class="code" href="structpair__t.html#a77bd04da2c79936e50deb20d72070384">next</a>)
<a name="l00173"></a>00173     {
<a name="l00174"></a>00174         <span class="keywordflow">if</span> (!strcmp (pair-&gt;<a class="code" href="structpair__t.html#a528541470063ea3e6ef340122e6f946a">key</a>, key))
<a name="l00175"></a>00175             <span class="keywordflow">if</span> (pair-&gt;<a class="code" href="structpair__t.html#a4971c332851244bac4916d04e6db3b7c">value</a>-&gt;<a class="code" href="structvalue__t.html#ad442091764df35b6ff5dbfd7f5bd965b">ident</a> == NULL)
<a name="l00176"></a>00176                 <span class="keywordflow">return</span> pair-&gt;<a class="code" href="structpair__t.html#a4971c332851244bac4916d04e6db3b7c">value</a>;
<a name="l00177"></a>00177     }
<a name="l00178"></a>00178     <span class="keywordflow">return</span> NULL;
<a name="l00179"></a>00179 }
<a name="l00180"></a>00180 
<a name="l00181"></a>00181 <span class="comment">/* The function returns the number of properties in a definition line</span>
<a name="l00182"></a>00182 <span class="comment">   specified by the given key. */</span>
<a name="l00183"></a><a class="code" href="check__netlist_8cpp.html#affb921eabb1bc62976dd0b2212e3ae58">00183</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="check__netlist_8cpp.html#a2d22357edbb7c3690b57adfce214071e">checker_find_property</a> (<span class="keyword">struct</span> <a class="code" href="structdefinition__t.html">definition_t</a> * def,
<a name="l00184"></a>00184                                   <span class="keyword">const</span> <span class="keywordtype">char</span> * <a class="code" href="structpair__t.html#a528541470063ea3e6ef340122e6f946a">key</a>)
<a name="l00185"></a>00185 {
<a name="l00186"></a>00186     <span class="keywordflow">return</span> <a class="code" href="check__netlist_8cpp.html#a2d22357edbb7c3690b57adfce214071e">checker_find_property</a> (key, def-&gt;<a class="code" href="structdefinition__t.html#af1c52c3c0e0d2e5764a992e28084ed99">pairs</a>);
<a name="l00187"></a>00187 }
<a name="l00188"></a>00188 
<a name="l00189"></a>00189 <span class="comment">/* This function looks for the specified property &#39;key&#39; in the given</span>
<a name="l00190"></a>00190 <span class="comment">   definition and return its value (a string reference) if it is a</span>
<a name="l00191"></a>00191 <span class="comment">   reference.  Otherwise the function returns NULL and emits an</span>
<a name="l00192"></a>00192 <span class="comment">   appropriate error message. */</span>
<a name="l00193"></a><a class="code" href="check__netlist_8cpp.html#af95a777fed63643cdf6ce80c9fb1d319">00193</a> <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structvalue__t.html">value_t</a> * <a class="code" href="check__netlist_8cpp.html#af95a777fed63643cdf6ce80c9fb1d319">checker_validate_reference</a> (<span class="keyword">struct</span> <a class="code" href="structdefinition__t.html">definition_t</a> * def,
<a name="l00194"></a>00194         <span class="keyword">const</span> <span class="keywordtype">char</span> * key)
<a name="l00195"></a>00195 {
<a name="l00196"></a>00196     <span class="keyword">struct </span><a class="code" href="structvalue__t.html">value_t</a> * val;
<a name="l00197"></a>00197     <span class="keywordflow">if</span> ((val = <a class="code" href="check__netlist_8cpp.html#ad9167af3b9466ee85d15c808f41741c5">checker_find_reference</a> (def, key)) == NULL)
<a name="l00198"></a>00198     {
<a name="l00199"></a>00199         <a class="code" href="logging_8c.html#abe06a8732a47a291606edcfac5e5146e">logprint</a> (<a class="code" href="logging_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;line %d: checker error, not a valid `%s&#39; property &quot;</span>
<a name="l00200"></a>00200                   <span class="stringliteral">&quot;found in `%s:%s&#39;\n&quot;</span>, def-&gt;<a class="code" href="structdefinition__t.html#aad308f4ecd35503badc78adb3e578d8b">line</a>, key, def-&gt;<a class="code" href="structdefinition__t.html#adbc03f56abf1631614d1cc4946961300">type</a>, def-&gt;<a class="code" href="structdefinition__t.html#a594dd31d0446b3364e5875eaced950eb">instance</a>);
<a name="l00201"></a>00201     }
<a name="l00202"></a>00202     <span class="keywordflow">return</span> val;
<a name="l00203"></a>00203 }
<a name="l00204"></a>00204 
<a name="l00205"></a>00205 <span class="comment">/* This function checks whether the given definition is a known</span>
<a name="l00206"></a>00206 <span class="comment">   microstrip component with a substrate definition.  If the given</span>
<a name="l00207"></a>00207 <span class="comment">   identifier equals this substrate definition then the function</span>
<a name="l00208"></a>00208 <span class="comment">   returns the appropriate value.  Otherwise it returns NULL. */</span>
<a name="l00209"></a><a class="code" href="check__netlist_8cpp.html#ab47c82d97862efe51bacb2f4bc31e69d">00209</a> <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structvalue__t.html">value_t</a> * <a class="code" href="check__netlist_8cpp.html#ab47c82d97862efe51bacb2f4bc31e69d">checker_find_substrate</a> (<span class="keyword">struct</span> <a class="code" href="structdefinition__t.html">definition_t</a> * def,
<a name="l00210"></a>00210         <span class="keywordtype">char</span> * <a class="code" href="parse__spice_8y.html#a25164f805d9af841d8063fe86f5e1da4">ident</a>)
<a name="l00211"></a>00211 {
<a name="l00212"></a>00212     <span class="keyword">struct </span><a class="code" href="structvalue__t.html">value_t</a> * val;
<a name="l00213"></a>00213     <span class="keywordflow">if</span> (<a class="code" href="check__netlist_8cpp.html#a595c10bfd2a816b09dccf63a49609788">checker_is_property</a> (def-&gt;<a class="code" href="structdefinition__t.html#a21de30d2de21345df94b44c63f1d5ffd">define</a>, <span class="stringliteral">&quot;Subst&quot;</span>) == <a class="code" href="netdefs_8h.html#a552766d94553aab12e7876b233745eba">PROP_STR</a>)
<a name="l00214"></a>00214     {
<a name="l00215"></a>00215         <span class="keywordflow">if</span> ((val = <a class="code" href="check__netlist_8cpp.html#ad9167af3b9466ee85d15c808f41741c5">checker_find_reference</a> (def, <span class="stringliteral">&quot;Subst&quot;</span>)) != NULL)
<a name="l00216"></a>00216         {
<a name="l00217"></a>00217             <span class="keywordflow">if</span> (ident != NULL &amp;&amp; !strcmp (val-&gt;<a class="code" href="structvalue__t.html#ad442091764df35b6ff5dbfd7f5bd965b">ident</a>, ident))
<a name="l00218"></a>00218                 <span class="keywordflow">return</span> val;
<a name="l00219"></a>00219         }
<a name="l00220"></a>00220     }
<a name="l00221"></a>00221     <span class="keywordflow">return</span> NULL;
<a name="l00222"></a>00222 }
<a name="l00223"></a>00223 
<a name="l00224"></a>00224 <span class="comment">/* Puts the given double value variable into an environment. */</span>
<a name="l00225"></a><a class="code" href="check__netlist_8cpp.html#ac3dc55ce1dfdaf488e9a1cfefd890154">00225</a> <span class="keyword">static</span> variable * <a class="code" href="check__netlist_8cpp.html#ac3dc55ce1dfdaf488e9a1cfefd890154">checker_add_variable</a> (environment * env,
<a name="l00226"></a>00226                                         <span class="keywordtype">char</span> * <a class="code" href="structvalue__t.html#a73164dc97373afce1086bc970da5d211">var</a>, <span class="keywordtype">int</span> <a class="code" href="parse__vcd_8y.html#ae0bd5e8ec17b2aad3338041991eb1056">type</a>, <span class="keywordtype">bool</span> pass)
<a name="l00227"></a>00227 {
<a name="l00228"></a>00228     variable * <a class="code" href="parse__zvr_8y.html#ac4055e3a20b6b3af3d10590ea446ef6c">v</a> = <span class="keyword">new</span> variable (var);
<a name="l00229"></a>00229     eqn::constant * <a class="code" href="parse__netlist_8y.html#a519cf159c27abd2374c9f649b9e9946d">c</a> = <span class="keyword">new</span> eqn::constant (type);
<a name="l00230"></a>00230     <span class="keywordflow">switch</span> (type)
<a name="l00231"></a>00231     {
<a name="l00232"></a>00232     <span class="keywordflow">case</span> <a class="code" href="namespacequcs_1_1eqn.html#a6d6a4e1bab3f5e23f5d898059f98c134aee3cae1f3216c92000dfd770eca19bfe">TAG_DOUBLE</a>:
<a name="l00233"></a>00233         c-&gt;d = 0.0; <span class="comment">// initialize the variable</span>
<a name="l00234"></a>00234         <span class="keywordflow">break</span>;
<a name="l00235"></a>00235     <span class="keywordflow">case</span> <a class="code" href="namespacequcs_1_1eqn.html#a6d6a4e1bab3f5e23f5d898059f98c134a22e4d6b45b88b80f7d3ef518f52f5546">TAG_VECTOR</a>:
<a name="l00236"></a>00236           c-&gt;v = <span class="keyword">new</span> qucs::vector ();
<a name="l00237"></a>00237         <span class="keywordflow">break</span>;
<a name="l00238"></a>00238     }
<a name="l00239"></a>00239     v-&gt;setConstant (c);
<a name="l00240"></a>00240     env-&gt;addVariable (v, pass);
<a name="l00241"></a>00241     <span class="keywordflow">return</span> <a class="code" href="parse__zvr_8y.html#ac4055e3a20b6b3af3d10590ea446ef6c">v</a>;
<a name="l00242"></a>00242 }
<a name="l00243"></a>00243 
<a name="l00244"></a>00244 <span class="comment">/* Resolves the variable of a property value.  Returns non-zero on</span>
<a name="l00245"></a>00245 <span class="comment">   success, otherwise zero. */</span>
<a name="l00246"></a><a class="code" href="check__netlist_8cpp.html#a7c00fdc0496a603b7ee24f368b30db11">00246</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="check__netlist_8cpp.html#a7c00fdc0496a603b7ee24f368b30db11">checker_resolve_variable</a> (<span class="keyword">struct</span> <a class="code" href="structdefinition__t.html">definition_t</a> * root,
<a name="l00247"></a>00247                                      <span class="keyword">struct</span> <a class="code" href="structdefinition__t.html">definition_t</a> * def,
<a name="l00248"></a>00248                                      <span class="keyword">struct</span> <a class="code" href="structpair__t.html">pair_t</a> * pair, <span class="keywordtype">int</span> <a class="code" href="parse__vcd_8y.html#ae0bd5e8ec17b2aad3338041991eb1056">type</a>)
<a name="l00249"></a>00249 {
<a name="l00250"></a>00250     <span class="keyword">struct </span><a class="code" href="structvalue__t.html">value_t</a> * val;
<a name="l00251"></a>00251     <span class="keyword">struct </span><a class="code" href="structvalue__t.html">value_t</a> * <a class="code" href="parse__spice_8y.html#a3ee038386001fa5178eacfd04dcdb7a0">value</a> = pair-&gt;<a class="code" href="structpair__t.html#a4971c332851244bac4916d04e6db3b7c">value</a>;
<a name="l00252"></a>00252     <span class="keywordflow">if</span> (value-&gt;<a class="code" href="structvalue__t.html#ad442091764df35b6ff5dbfd7f5bd965b">ident</a> != NULL)
<a name="l00253"></a>00253     {
<a name="l00254"></a>00254         <span class="keywordtype">int</span> found = 0;
<a name="l00255"></a>00255         <span class="comment">/* 1. find variable in parameter sweeps */</span>
<a name="l00256"></a>00256         <span class="keywordflow">if</span> ((val = <a class="code" href="check__netlist_8cpp.html#a3c10f19e8afd5bdd576eaf751d62b80d">checker_find_variable</a> (root, <span class="stringliteral">&quot;SW&quot;</span>, <span class="stringliteral">&quot;Param&quot;</span>, value-&gt;<a class="code" href="structvalue__t.html#ad442091764df35b6ff5dbfd7f5bd965b">ident</a>)))
<a name="l00257"></a>00257         {
<a name="l00258"></a>00258             <span class="comment">/* add parameter sweep variable to environment */</span>
<a name="l00259"></a>00259             <span class="keywordflow">if</span> (!strcmp (def-&gt;<a class="code" href="structdefinition__t.html#adbc03f56abf1631614d1cc4946961300">type</a>, <span class="stringliteral">&quot;SW&quot;</span>) &amp;&amp; !strcmp (pair-&gt;<a class="code" href="structpair__t.html#a528541470063ea3e6ef340122e6f946a">key</a>, <span class="stringliteral">&quot;Param&quot;</span>))
<a name="l00260"></a>00260             {
<a name="l00261"></a>00261                 <a class="code" href="check__netlist_8cpp.html#ac3dc55ce1dfdaf488e9a1cfefd890154">checker_add_variable</a> (root-&gt;<a class="code" href="structdefinition__t.html#ac790455379f14759e49ec75d5187c85a">env</a>, value-&gt;<a class="code" href="structvalue__t.html#ad442091764df35b6ff5dbfd7f5bd965b">ident</a>, <a class="code" href="namespacequcs_1_1eqn.html#a6d6a4e1bab3f5e23f5d898059f98c134aee3cae1f3216c92000dfd770eca19bfe">TAG_DOUBLE</a>, <span class="keyword">true</span>);
<a name="l00262"></a>00262             }
<a name="l00263"></a>00263             <span class="comment">/* mark both the variable identifier and the parameter sweep</span>
<a name="l00264"></a>00264 <span class="comment">            variable to be actually variables */</span>
<a name="l00265"></a>00265             val-&gt;<a class="code" href="structvalue__t.html#a73164dc97373afce1086bc970da5d211">var</a> = <a class="code" href="namespacequcs_1_1eqn.html#a6d6a4e1bab3f5e23f5d898059f98c134aee3cae1f3216c92000dfd770eca19bfe">TAG_DOUBLE</a>;
<a name="l00266"></a>00266             value-&gt;<a class="code" href="structvalue__t.html#a73164dc97373afce1086bc970da5d211">var</a> = <a class="code" href="namespacequcs_1_1eqn.html#a6d6a4e1bab3f5e23f5d898059f98c134aee3cae1f3216c92000dfd770eca19bfe">TAG_DOUBLE</a>;
<a name="l00267"></a>00267             found++;
<a name="l00268"></a>00268         }
<a name="l00269"></a>00269         <span class="comment">/* 2. find analysis in parameter sweeps */</span>
<a name="l00270"></a>00270         <span class="keywordflow">if</span> ((val = <a class="code" href="check__netlist_8cpp.html#a3c10f19e8afd5bdd576eaf751d62b80d">checker_find_variable</a> (root, <span class="stringliteral">&quot;SW&quot;</span>, <span class="stringliteral">&quot;Sim&quot;</span>, value-&gt;<a class="code" href="structvalue__t.html#ad442091764df35b6ff5dbfd7f5bd965b">ident</a>)))
<a name="l00271"></a>00271         {
<a name="l00272"></a>00272             found++;
<a name="l00273"></a>00273         }
<a name="l00274"></a>00274         <span class="comment">/* 3. find substrate in microstrip components */</span>
<a name="l00275"></a>00275         <span class="keywordflow">if</span> ((val = <a class="code" href="check__netlist_8cpp.html#ab47c82d97862efe51bacb2f4bc31e69d">checker_find_substrate</a> (def, value-&gt;<a class="code" href="structvalue__t.html#ad442091764df35b6ff5dbfd7f5bd965b">ident</a>)))
<a name="l00276"></a>00276         {
<a name="l00277"></a>00277             value-&gt;<a class="code" href="structvalue__t.html#a19734e458d3cb41219a31b3e2d277dbf">subst</a> = 1;
<a name="l00278"></a>00278             found++;
<a name="l00279"></a>00279         }
<a name="l00280"></a>00280         <span class="comment">/* 4. find subcircuit definition in subcircuit components */</span>
<a name="l00281"></a>00281         <span class="keywordflow">if</span> ((val = <a class="code" href="check__netlist_8cpp.html#a3c10f19e8afd5bdd576eaf751d62b80d">checker_find_variable</a> (root, <span class="stringliteral">&quot;Sub&quot;</span>, <span class="stringliteral">&quot;Type&quot;</span>, value-&gt;<a class="code" href="structvalue__t.html#ad442091764df35b6ff5dbfd7f5bd965b">ident</a>)))
<a name="l00282"></a>00282         {
<a name="l00283"></a>00283             found++;
<a name="l00284"></a>00284         }
<a name="l00285"></a>00285         <span class="comment">/* 5. find special identifiers in certain properties */</span>
<a name="l00286"></a>00286         <span class="keywordflow">if</span> (value-&gt;<a class="code" href="structvalue__t.html#a7f2c579b786f94e080025f18d16dc461">range</a>)
<a name="l00287"></a>00287         {
<a name="l00288"></a>00288             found++;
<a name="l00289"></a>00289         }
<a name="l00290"></a>00290         <span class="comment">/* 6. find file reference in S-parameter file components */</span>
<a name="l00291"></a>00291         <span class="keywordflow">if</span> ((val = <a class="code" href="check__netlist_8cpp.html#a3c10f19e8afd5bdd576eaf751d62b80d">checker_find_variable</a> (root, <span class="stringliteral">&quot;SPfile&quot;</span>, <span class="stringliteral">&quot;File&quot;</span>, value-&gt;<a class="code" href="structvalue__t.html#ad442091764df35b6ff5dbfd7f5bd965b">ident</a>)))
<a name="l00292"></a>00292         {
<a name="l00293"></a>00293             found++;
<a name="l00294"></a>00294         }
<a name="l00295"></a>00295         <span class="comment">/* 7. find variable in equation */</span>
<a name="l00296"></a>00296         <span class="keywordflow">if</span> (root-&gt;<a class="code" href="structdefinition__t.html#ac790455379f14759e49ec75d5187c85a">env</a>)
<a name="l00297"></a>00297         {
<a name="l00298"></a>00298             <span class="keywordflow">if</span> (root-&gt;<a class="code" href="structdefinition__t.html#ac790455379f14759e49ec75d5187c85a">env</a>-&gt;getChecker()-&gt;containsVariable (value-&gt;<a class="code" href="structvalue__t.html#ad442091764df35b6ff5dbfd7f5bd965b">ident</a>))
<a name="l00299"></a>00299             {
<a name="l00300"></a>00300                 variable * <a class="code" href="parse__zvr_8y.html#ac4055e3a20b6b3af3d10590ea446ef6c">v</a>;
<a name="l00301"></a>00301                 value-&gt;<a class="code" href="structvalue__t.html#a73164dc97373afce1086bc970da5d211">var</a> = (type == <a class="code" href="netdefs_8h.html#aa98b1758ffaa509c0d79a7cbc3b3c61a">PROP_LIST</a>) ? <a class="code" href="namespacequcs_1_1eqn.html#a6d6a4e1bab3f5e23f5d898059f98c134a22e4d6b45b88b80f7d3ef518f52f5546">TAG_VECTOR</a> : <a class="code" href="namespacequcs_1_1eqn.html#a6d6a4e1bab3f5e23f5d898059f98c134aee3cae1f3216c92000dfd770eca19bfe">TAG_DOUBLE</a>;
<a name="l00302"></a>00302                 <span class="keywordflow">if</span> ((v = root-&gt;<a class="code" href="structdefinition__t.html#ac790455379f14759e49ec75d5187c85a">env</a>-&gt;getVariable (value-&gt;<a class="code" href="structvalue__t.html#ad442091764df35b6ff5dbfd7f5bd965b">ident</a>)) == NULL)
<a name="l00303"></a>00303                 {
<a name="l00304"></a>00304                     <span class="comment">// put variable into the environment</span>
<a name="l00305"></a>00305                     <a class="code" href="check__netlist_8cpp.html#ac3dc55ce1dfdaf488e9a1cfefd890154">checker_add_variable</a> (root-&gt;<a class="code" href="structdefinition__t.html#ac790455379f14759e49ec75d5187c85a">env</a>, value-&gt;<a class="code" href="structvalue__t.html#ad442091764df35b6ff5dbfd7f5bd965b">ident</a>, value-&gt;<a class="code" href="structvalue__t.html#a73164dc97373afce1086bc970da5d211">var</a>, <span class="keyword">false</span>);
<a name="l00306"></a>00306                 }
<a name="l00307"></a>00307                 found++;
<a name="l00308"></a>00308             }
<a name="l00309"></a>00309         }
<a name="l00310"></a>00310         <span class="comment">/* 8. find file reference in file based sources */</span>
<a name="l00311"></a>00311         <span class="keywordflow">if</span> ((val = <a class="code" href="check__netlist_8cpp.html#a3c10f19e8afd5bdd576eaf751d62b80d">checker_find_variable</a> (root, <span class="stringliteral">&quot;Vfile&quot;</span>, <span class="stringliteral">&quot;File&quot;</span>, value-&gt;<a class="code" href="structvalue__t.html#ad442091764df35b6ff5dbfd7f5bd965b">ident</a>)))
<a name="l00312"></a>00312         {
<a name="l00313"></a>00313             found++;
<a name="l00314"></a>00314         }
<a name="l00315"></a>00315         <span class="keywordflow">if</span> ((val = <a class="code" href="check__netlist_8cpp.html#a3c10f19e8afd5bdd576eaf751d62b80d">checker_find_variable</a> (root, <span class="stringliteral">&quot;Ifile&quot;</span>, <span class="stringliteral">&quot;File&quot;</span>, value-&gt;<a class="code" href="structvalue__t.html#ad442091764df35b6ff5dbfd7f5bd965b">ident</a>)))
<a name="l00316"></a>00316         {
<a name="l00317"></a>00317             found++;
<a name="l00318"></a>00318         }
<a name="l00319"></a>00319         <span class="comment">/* 9. find property reference in the instance */</span>
<a name="l00320"></a>00320         <span class="keywordflow">if</span> (!found &amp;&amp;
<a name="l00321"></a>00321                 <a class="code" href="check__netlist_8cpp.html#a595c10bfd2a816b09dccf63a49609788">checker_is_property</a> (def-&gt;<a class="code" href="structdefinition__t.html#a21de30d2de21345df94b44c63f1d5ffd">define</a>, value-&gt;<a class="code" href="structvalue__t.html#ad442091764df35b6ff5dbfd7f5bd965b">ident</a>) != <a class="code" href="netdefs_8h.html#a144fb2630882537a29dd547c3b25b616">PROP_NONE</a>)
<a name="l00322"></a>00322         {
<a name="l00323"></a>00323             <span class="keywordflow">if</span> (root-&gt;<a class="code" href="structdefinition__t.html#ac790455379f14759e49ec75d5187c85a">env</a>)
<a name="l00324"></a>00324             {
<a name="l00325"></a>00325 
<a name="l00326"></a>00326                 <span class="comment">// create reference variable names</span>
<a name="l00327"></a>00327                 <span class="keywordtype">char</span> * txt = (<span class="keywordtype">char</span> *)
<a name="l00328"></a>00328                              malloc (strlen (def-&gt;<a class="code" href="structdefinition__t.html#a594dd31d0446b3364e5875eaced950eb">instance</a>) + 1 + strlen (value-&gt;<a class="code" href="structvalue__t.html#ad442091764df35b6ff5dbfd7f5bd965b">ident</a>) + 1);
<a name="l00329"></a>00329                 sprintf (txt, <span class="stringliteral">&quot;%s.%s&quot;</span>, def-&gt;<a class="code" href="structdefinition__t.html#a594dd31d0446b3364e5875eaced950eb">instance</a>, value-&gt;<a class="code" href="structvalue__t.html#ad442091764df35b6ff5dbfd7f5bd965b">ident</a>);
<a name="l00330"></a>00330                 <span class="keywordtype">char</span> * ref = (<span class="keywordtype">char</span> *)
<a name="l00331"></a>00331                              malloc (strlen (def-&gt;<a class="code" href="structdefinition__t.html#a594dd31d0446b3364e5875eaced950eb">instance</a>) + 5 + strlen (value-&gt;<a class="code" href="structvalue__t.html#ad442091764df35b6ff5dbfd7f5bd965b">ident</a>) + 1);
<a name="l00332"></a>00332                 sprintf (ref, <span class="stringliteral">&quot;%s.%s.ref&quot;</span>, def-&gt;<a class="code" href="structdefinition__t.html#a594dd31d0446b3364e5875eaced950eb">instance</a>, value-&gt;<a class="code" href="structvalue__t.html#ad442091764df35b6ff5dbfd7f5bd965b">ident</a>);
<a name="l00333"></a>00333 
<a name="l00334"></a>00334                 <span class="comment">// replace property string</span>
<a name="l00335"></a>00335                 <a class="code" href="parse__dataset_8y.html#aca85a6c1a76f5805917a20a5efec7664">free</a> (value-&gt;<a class="code" href="structvalue__t.html#ad442091764df35b6ff5dbfd7f5bd965b">ident</a>);
<a name="l00336"></a>00336                 value-&gt;<a class="code" href="structvalue__t.html#ad442091764df35b6ff5dbfd7f5bd965b">ident</a> = strdup (ref);
<a name="l00337"></a>00337                 value-&gt;<a class="code" href="structvalue__t.html#a73164dc97373afce1086bc970da5d211">var</a> = <a class="code" href="namespacequcs_1_1eqn.html#a6d6a4e1bab3f5e23f5d898059f98c134aee3cae1f3216c92000dfd770eca19bfe">TAG_DOUBLE</a>;
<a name="l00338"></a>00338 
<a name="l00339"></a>00339                 <span class="comment">// already done previously?</span>
<a name="l00340"></a>00340                 variable * <a class="code" href="parse__zvr_8y.html#ac4055e3a20b6b3af3d10590ea446ef6c">v</a>;
<a name="l00341"></a>00341                 <span class="keywordflow">if</span> ((v = root-&gt;<a class="code" href="structdefinition__t.html#ac790455379f14759e49ec75d5187c85a">env</a>-&gt;getVariable (ref)) == NULL)
<a name="l00342"></a>00342                 {
<a name="l00343"></a>00343                     <span class="comment">// put variable into the environment</span>
<a name="l00344"></a>00344                     <a class="code" href="check__netlist_8cpp.html#ac3dc55ce1dfdaf488e9a1cfefd890154">checker_add_variable</a> (root-&gt;<a class="code" href="structdefinition__t.html#ac790455379f14759e49ec75d5187c85a">env</a>, ref, <a class="code" href="namespacequcs_1_1eqn.html#a6d6a4e1bab3f5e23f5d898059f98c134aee3cae1f3216c92000dfd770eca19bfe">TAG_DOUBLE</a>, <span class="keyword">false</span>);
<a name="l00345"></a>00345                     <span class="comment">// also add reference equation into environment</span>
<a name="l00346"></a>00346                     root-&gt;<a class="code" href="structdefinition__t.html#ac790455379f14759e49ec75d5187c85a">env</a>-&gt;getChecker()-&gt;addReference (<span class="stringliteral">&quot;#propref&quot;</span>, ref, txt);
<a name="l00347"></a>00347                 }
<a name="l00348"></a>00348 
<a name="l00349"></a>00349                 <span class="comment">// done</span>
<a name="l00350"></a>00350                 <a class="code" href="parse__dataset_8y.html#aca85a6c1a76f5805917a20a5efec7664">free</a> (txt);
<a name="l00351"></a>00351                 <a class="code" href="parse__dataset_8y.html#aca85a6c1a76f5805917a20a5efec7664">free</a> (ref);
<a name="l00352"></a>00352                 found++;
<a name="l00353"></a>00353             }
<a name="l00354"></a>00354         }
<a name="l00355"></a>00355         <span class="comment">/* not found */</span>
<a name="l00356"></a>00356         <span class="keywordflow">if</span> (!found)
<a name="l00357"></a>00357         {
<a name="l00358"></a>00358             <a class="code" href="logging_8c.html#abe06a8732a47a291606edcfac5e5146e">logprint</a> (<a class="code" href="logging_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;line %d: checker error, no such variable `%s&#39; &quot;</span>
<a name="l00359"></a>00359                       <span class="stringliteral">&quot;used in a `%s:%s&#39; property\n&quot;</span>, def-&gt;<a class="code" href="structdefinition__t.html#aad308f4ecd35503badc78adb3e578d8b">line</a>, value-&gt;<a class="code" href="structvalue__t.html#ad442091764df35b6ff5dbfd7f5bd965b">ident</a>,
<a name="l00360"></a>00360                       def-&gt;<a class="code" href="structdefinition__t.html#adbc03f56abf1631614d1cc4946961300">type</a>, def-&gt;<a class="code" href="structdefinition__t.html#a594dd31d0446b3364e5875eaced950eb">instance</a>);
<a name="l00361"></a>00361             <span class="keywordflow">return</span> 0;
<a name="l00362"></a>00362         }
<a name="l00363"></a>00363     }
<a name="l00364"></a>00364     <span class="keywordflow">return</span> 1;
<a name="l00365"></a>00365 }
<a name="l00366"></a>00366 
<a name="l00367"></a>00367 <span class="comment">/* Evaluates the unit scale in a property value.  It adjusts the</span>
<a name="l00368"></a>00368 <span class="comment">   actual value and omits the scale.  The function returns non-zero</span>
<a name="l00369"></a>00369 <span class="comment">   on success and zero otherwise. */</span>
<a name="l00370"></a><a class="code" href="check__netlist_8cpp.html#a37c6b4e02257688a7b7980cad8797c05">00370</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="check__netlist_8cpp.html#a37c6b4e02257688a7b7980cad8797c05">checker_evaluate_scale</a> (<span class="keyword">struct</span> <a class="code" href="structvalue__t.html">value_t</a> * <a class="code" href="parse__spice_8y.html#a3ee038386001fa5178eacfd04dcdb7a0">value</a>)
<a name="l00371"></a>00371 {
<a name="l00372"></a>00372     <span class="keywordtype">double</span> val = value-&gt;<a class="code" href="structvalue__t.html#a00344d940adac2e92047e60efde51a36">value</a>, factor = 1.0;
<a name="l00373"></a>00373     <span class="keywordtype">char</span> * <a class="code" href="parse__vcd_8y.html#a6422a1819e071183f11d44c7e4df4e59">scale</a>;
<a name="l00374"></a>00374     <span class="keywordflow">if</span> (value-&gt;<a class="code" href="structvalue__t.html#a461a42371c5d4bfffbbddcbcaa1dace9">scale</a> != NULL)
<a name="l00375"></a>00375     {
<a name="l00376"></a>00376         scale = value-&gt;<a class="code" href="structvalue__t.html#a461a42371c5d4bfffbbddcbcaa1dace9">scale</a>;
<a name="l00377"></a>00377         <span class="keywordflow">switch</span> (*scale)
<a name="l00378"></a>00378         {
<a name="l00379"></a>00379         <span class="keywordflow">case</span> <span class="charliteral">&#39;E&#39;</span>:
<a name="l00380"></a>00380             scale++;
<a name="l00381"></a>00381             factor = 1e18;
<a name="l00382"></a>00382             <span class="keywordflow">break</span>;
<a name="l00383"></a>00383         <span class="keywordflow">case</span> <span class="charliteral">&#39;P&#39;</span>:
<a name="l00384"></a>00384             scale++;
<a name="l00385"></a>00385             factor = 1e15;
<a name="l00386"></a>00386             <span class="keywordflow">break</span>;
<a name="l00387"></a>00387         <span class="keywordflow">case</span> <span class="charliteral">&#39;T&#39;</span>:
<a name="l00388"></a>00388             scale++;
<a name="l00389"></a>00389             factor = 1e12;
<a name="l00390"></a>00390             <span class="keywordflow">break</span>;
<a name="l00391"></a>00391         <span class="keywordflow">case</span> <span class="charliteral">&#39;G&#39;</span>:
<a name="l00392"></a>00392             scale++;
<a name="l00393"></a>00393             factor = 1e9;
<a name="l00394"></a>00394             <span class="keywordflow">break</span>;
<a name="l00395"></a>00395         <span class="keywordflow">case</span> <span class="charliteral">&#39;M&#39;</span>:
<a name="l00396"></a>00396             scale++;
<a name="l00397"></a>00397             factor = 1e6;
<a name="l00398"></a>00398             <span class="keywordflow">break</span>;
<a name="l00399"></a>00399         <span class="keywordflow">case</span> <span class="charliteral">&#39;k&#39;</span>:
<a name="l00400"></a>00400             scale++;
<a name="l00401"></a>00401             factor = 1e3;
<a name="l00402"></a>00402             <span class="keywordflow">break</span>;
<a name="l00403"></a>00403         <span class="keywordflow">case</span> <span class="charliteral">&#39;m&#39;</span>:
<a name="l00404"></a>00404             scale++;
<a name="l00405"></a>00405             <span class="keywordflow">if</span> (*scale == <span class="charliteral">&#39;i&#39;</span>)
<a name="l00406"></a>00406             {
<a name="l00407"></a>00407                 scale++;
<a name="l00408"></a>00408                 <span class="keywordflow">if</span> (*scale == <span class="charliteral">&#39;l&#39;</span>)
<a name="l00409"></a>00409                 {
<a name="l00410"></a>00410                     scale++;
<a name="l00411"></a>00411                     factor = 2.54e-5;
<a name="l00412"></a>00412                 }
<a name="l00413"></a>00413             }
<a name="l00414"></a>00414             <span class="keywordflow">else</span>
<a name="l00415"></a>00415                 factor = 1<a class="code" href="group__qucsMathConstants.html#gae162651ba6f0c9b150cf9bd8c41113c8" title="Euler&#39;s constant ( )">e</a>-3;
<a name="l00416"></a>00416             <span class="keywordflow">break</span>;
<a name="l00417"></a>00417         <span class="keywordflow">case</span> <span class="charliteral">&#39;u&#39;</span>:
<a name="l00418"></a>00418             scale++;
<a name="l00419"></a>00419             factor = 1<a class="code" href="group__qucsMathConstants.html#gae162651ba6f0c9b150cf9bd8c41113c8" title="Euler&#39;s constant ( )">e</a>-6;
<a name="l00420"></a>00420             <span class="keywordflow">break</span>;
<a name="l00421"></a>00421         <span class="keywordflow">case</span> <span class="charliteral">&#39;n&#39;</span>:
<a name="l00422"></a>00422             scale++;
<a name="l00423"></a>00423             factor = 1<a class="code" href="group__qucsMathConstants.html#gae162651ba6f0c9b150cf9bd8c41113c8" title="Euler&#39;s constant ( )">e</a>-9;
<a name="l00424"></a>00424             <span class="keywordflow">break</span>;
<a name="l00425"></a>00425         <span class="keywordflow">case</span> <span class="charliteral">&#39;p&#39;</span>:
<a name="l00426"></a>00426             scale++;
<a name="l00427"></a>00427             factor = 1<a class="code" href="group__qucsMathConstants.html#gae162651ba6f0c9b150cf9bd8c41113c8" title="Euler&#39;s constant ( )">e</a>-12;
<a name="l00428"></a>00428             <span class="keywordflow">break</span>;
<a name="l00429"></a>00429         <span class="keywordflow">case</span> <span class="charliteral">&#39;f&#39;</span>:
<a name="l00430"></a>00430             scale++;
<a name="l00431"></a>00431             <span class="keywordflow">if</span> (*scale == <span class="charliteral">&#39;t&#39;</span>)
<a name="l00432"></a>00432             {
<a name="l00433"></a>00433                 scale++;
<a name="l00434"></a>00434                 factor = 0.3048;
<a name="l00435"></a>00435             }
<a name="l00436"></a>00436             <span class="keywordflow">else</span>
<a name="l00437"></a>00437                 factor = 1<a class="code" href="group__qucsMathConstants.html#gae162651ba6f0c9b150cf9bd8c41113c8" title="Euler&#39;s constant ( )">e</a>-15;
<a name="l00438"></a>00438             <span class="keywordflow">break</span>;
<a name="l00439"></a>00439         <span class="keywordflow">case</span> <span class="charliteral">&#39;a&#39;</span>:
<a name="l00440"></a>00440             scale++;
<a name="l00441"></a>00441             factor = 1<a class="code" href="group__qucsMathConstants.html#gae162651ba6f0c9b150cf9bd8c41113c8" title="Euler&#39;s constant ( )">e</a>-18;
<a name="l00442"></a>00442             <span class="keywordflow">break</span>;
<a name="l00443"></a>00443         <span class="keywordflow">case</span> <span class="charliteral">&#39;d&#39;</span>:
<a name="l00444"></a>00444             scale++;
<a name="l00445"></a>00445             <span class="keywordflow">if</span> (*scale == <span class="charliteral">&#39;B&#39;</span>)
<a name="l00446"></a>00446             {
<a name="l00447"></a>00447                 scale++;
<a name="l00448"></a>00448                 val = <a class="code" href="namespacequcs.html#a5c65d8443158735d370ba859da6fa43d" title="Compute power function with real exponent.">std::pow</a> (10.0, val / 10.0);
<a name="l00449"></a>00449                 <span class="keywordflow">if</span> (*scale == <span class="charliteral">&#39;m&#39;</span>)
<a name="l00450"></a>00450                 {
<a name="l00451"></a>00451                     scale++;
<a name="l00452"></a>00452                     factor = 1<a class="code" href="group__qucsMathConstants.html#gae162651ba6f0c9b150cf9bd8c41113c8" title="Euler&#39;s constant ( )">e</a>-3;
<a name="l00453"></a>00453                 }
<a name="l00454"></a>00454                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (*scale == <span class="charliteral">&#39;u&#39;</span>)
<a name="l00455"></a>00455                 {
<a name="l00456"></a>00456                     scale++;
<a name="l00457"></a>00457                     factor = 1<a class="code" href="group__qucsMathConstants.html#gae162651ba6f0c9b150cf9bd8c41113c8" title="Euler&#39;s constant ( )">e</a>-6;
<a name="l00458"></a>00458                 }
<a name="l00459"></a>00459             }
<a name="l00460"></a>00460             <span class="keywordflow">break</span>;
<a name="l00461"></a>00461         <span class="keywordflow">case</span> <span class="charliteral">&#39;i&#39;</span>:
<a name="l00462"></a>00462             scale++;
<a name="l00463"></a>00463             <span class="keywordflow">if</span> (*scale == <span class="charliteral">&#39;n&#39;</span>)
<a name="l00464"></a>00464             {
<a name="l00465"></a>00465                 scale++;
<a name="l00466"></a>00466                 factor = 2.54e-2;
<a name="l00467"></a>00467             }
<a name="l00468"></a>00468             <span class="keywordflow">break</span>;
<a name="l00469"></a>00469         <span class="keywordflow">case</span> <span class="charliteral">&#39;y&#39;</span>:
<a name="l00470"></a>00470             scale++;
<a name="l00471"></a>00471             <span class="keywordflow">if</span> (*scale == <span class="charliteral">&#39;d&#39;</span>)
<a name="l00472"></a>00472             {
<a name="l00473"></a>00473                 scale++;
<a name="l00474"></a>00474                 factor = 0.9144;
<a name="l00475"></a>00475             }
<a name="l00476"></a>00476             <span class="keywordflow">break</span>;
<a name="l00477"></a>00477         }
<a name="l00478"></a>00478         <span class="keywordflow">if</span> (*scale != <span class="charliteral">&#39;\0&#39;</span>)
<a name="l00479"></a>00479         {
<a name="l00480"></a>00480             value-&gt;<a class="code" href="structvalue__t.html#a65816b15264dd82405c127899810d3d3">unit</a> = strdup (scale);
<a name="l00481"></a>00481         }
<a name="l00482"></a>00482         <a class="code" href="parse__dataset_8y.html#aca85a6c1a76f5805917a20a5efec7664">free</a> (value-&gt;<a class="code" href="structvalue__t.html#a461a42371c5d4bfffbbddcbcaa1dace9">scale</a>);
<a name="l00483"></a>00483         value-&gt;<a class="code" href="structvalue__t.html#a461a42371c5d4bfffbbddcbcaa1dace9">scale</a> = NULL;
<a name="l00484"></a>00484     }
<a name="l00485"></a>00485     value-&gt;<a class="code" href="structvalue__t.html#a00344d940adac2e92047e60efde51a36">value</a> = val * factor;
<a name="l00486"></a>00486     <span class="keywordflow">return</span> 1;
<a name="l00487"></a>00487 }
<a name="l00488"></a>00488 
<a name="l00489"></a>00489 <span class="comment">/* The function returns the number of instances of the given type within</span>
<a name="l00490"></a>00490 <span class="comment">   the list of definitions. */</span>
<a name="l00491"></a><a class="code" href="check__netlist_8cpp.html#ad5673d406838dfa184cbb9885229db2c">00491</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="check__netlist_8cpp.html#ad5673d406838dfa184cbb9885229db2c">checker_count_definitions</a> (<span class="keyword">struct</span> <a class="code" href="structdefinition__t.html">definition_t</a> * root,
<a name="l00492"></a>00492                                       <span class="keyword">const</span> <span class="keywordtype">char</span> * <a class="code" href="parse__vcd_8y.html#ae0bd5e8ec17b2aad3338041991eb1056">type</a>, <span class="keywordtype">int</span> <a class="code" href="parse__netlist_8y.html#aac060c4e468c0d6757ec5326be2fa395">action</a>)
<a name="l00493"></a>00493 {
<a name="l00494"></a>00494     <span class="keywordtype">int</span> count = 0;
<a name="l00495"></a>00495     <span class="keywordflow">for</span> (<span class="keyword">struct</span> <a class="code" href="structdefinition__t.html">definition_t</a> * def = root; def != NULL; def = def-&gt;<a class="code" href="structdefinition__t.html#ac6f2d42a0105ff6e699938fcd36bd12b">next</a>)
<a name="l00496"></a>00496     {
<a name="l00497"></a>00497         <span class="keywordflow">if</span> (def-&gt;action == action)
<a name="l00498"></a>00498         {
<a name="l00499"></a>00499             <span class="keywordflow">if</span> (type == NULL)
<a name="l00500"></a>00500                 count++;
<a name="l00501"></a>00501             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp (def-&gt;type, type))
<a name="l00502"></a>00502                 count++;
<a name="l00503"></a>00503         }
<a name="l00504"></a>00504     }
<a name="l00505"></a>00505     <span class="keywordflow">return</span> count;
<a name="l00506"></a>00506 }
<a name="l00507"></a>00507 
<a name="l00508"></a>00508 <span class="comment">/* This function looks for the specified subcircuit type in the list</span>
<a name="l00509"></a>00509 <span class="comment">   of available subcircuits and returns its definition.  If there is</span>
<a name="l00510"></a>00510 <span class="comment">   no such subcircuit the function returns NULL: */</span>
<a name="l00511"></a><a class="code" href="check__netlist_8cpp.html#a9cc06be034979cdc144a47bfb08bd408">00511</a> <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structdefinition__t.html">definition_t</a> * <a class="code" href="check__netlist_8cpp.html#a9cc06be034979cdc144a47bfb08bd408">checker_find_subcircuit</a> (<span class="keywordtype">char</span> * <a class="code" href="parse__mdl_8y.html#aecba4cab5e52994730d1e21424997b33">n</a>)
<a name="l00512"></a>00512 {
<a name="l00513"></a>00513     <span class="keyword">struct </span><a class="code" href="structdefinition__t.html">definition_t</a> * def;
<a name="l00514"></a>00514     <span class="keywordflow">for</span> (def = <a class="code" href="check__netlist_8cpp.html#a8443096178b6c84a10f0da689c81ee44">subcircuit_root</a>; def != NULL; def = def-&gt;<a class="code" href="structdefinition__t.html#ac6f2d42a0105ff6e699938fcd36bd12b">next</a>)
<a name="l00515"></a>00515         <span class="keywordflow">if</span> (n != NULL &amp;&amp; !strcmp (def-&gt;<a class="code" href="structdefinition__t.html#a594dd31d0446b3364e5875eaced950eb">instance</a>, n)) <span class="keywordflow">return</span> def;
<a name="l00516"></a>00516     <span class="keywordflow">return</span> NULL;
<a name="l00517"></a>00517 }
<a name="l00518"></a>00518 
<a name="l00519"></a>00519 <span class="comment">/* The function returns the subcircuit definition for the given</span>
<a name="l00520"></a>00520 <span class="comment">   subcircuit instance. */</span>
<a name="l00521"></a>00521 <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structdefinition__t.html">definition_t</a> *
<a name="l00522"></a><a class="code" href="check__netlist_8cpp.html#a18fe2b0a499140c7c287fdfa4b47687d">00522</a> <a class="code" href="check__netlist_8cpp.html#a18fe2b0a499140c7c287fdfa4b47687d">checker_get_subcircuit</a> (<span class="keyword">struct</span> <a class="code" href="structdefinition__t.html">definition_t</a> * def)
<a name="l00523"></a>00523 {
<a name="l00524"></a>00524     <span class="keyword">struct </span><a class="code" href="structvalue__t.html">value_t</a> * val;
<a name="l00525"></a>00525     <span class="keyword">struct </span><a class="code" href="structdefinition__t.html">definition_t</a> * <a class="code" href="structdefinition__t.html#adbac069b30fc5f0544f09e77e56fa26c">sub</a> = NULL;
<a name="l00526"></a>00526     <span class="keywordflow">if</span> ((val = <a class="code" href="check__netlist_8cpp.html#ad9167af3b9466ee85d15c808f41741c5">checker_find_reference</a> (def, <span class="stringliteral">&quot;Type&quot;</span>)) != NULL)
<a name="l00527"></a>00527         sub = <a class="code" href="check__netlist_8cpp.html#a9cc06be034979cdc144a47bfb08bd408">checker_find_subcircuit</a> (val-&gt;<a class="code" href="structvalue__t.html#ad442091764df35b6ff5dbfd7f5bd965b">ident</a>);
<a name="l00528"></a>00528     <span class="keywordflow">return</span> <a class="code" href="structdefinition__t.html#adbac069b30fc5f0544f09e77e56fa26c">sub</a>;
<a name="l00529"></a>00529 }
<a name="l00530"></a>00530 
<a name="l00531"></a>00531 <span class="comment">// Global variable indicating cycles in subcircuit definitions.</span>
<a name="l00532"></a><a class="code" href="check__netlist_8cpp.html#aa7243817e540c171f4821990ef6334af">00532</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="check__netlist_8cpp.html#aa7243817e540c171f4821990ef6334af">checker_sub_cycles</a> = 0;
<a name="l00533"></a>00533 
<a name="l00534"></a>00534 <span class="comment">/* The following function returns the number of circuit instances</span>
<a name="l00535"></a>00535 <span class="comment">   requiring a DC analysis (being nonlinear) in the list of definitions. */</span>
<a name="l00536"></a><a class="code" href="check__netlist_8cpp.html#af25ebb4936c9ab8e798e468fde0fc160">00536</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="check__netlist_8cpp.html#af25ebb4936c9ab8e798e468fde0fc160">checker_count_nonlinearities</a> (<span class="keyword">struct</span> <a class="code" href="structdefinition__t.html">definition_t</a> * root)
<a name="l00537"></a>00537 {
<a name="l00538"></a>00538     <span class="keywordtype">int</span> count = 0;
<a name="l00539"></a>00539     <span class="keyword">struct </span><a class="code" href="structdefinition__t.html">definition_t</a> * <a class="code" href="structdefinition__t.html#adbac069b30fc5f0544f09e77e56fa26c">sub</a>;
<a name="l00540"></a>00540     <span class="keywordflow">for</span> (<span class="keyword">struct</span> <a class="code" href="structdefinition__t.html">definition_t</a> * def = root; def != NULL; def = def-&gt;<a class="code" href="structdefinition__t.html#ac6f2d42a0105ff6e699938fcd36bd12b">next</a>)
<a name="l00541"></a>00541     {
<a name="l00542"></a>00542         <span class="keywordflow">if</span> (def-&gt;nonlinear != 0) count++;
<a name="l00543"></a>00543         <span class="comment">// also recurse into subcircuits if possible</span>
<a name="l00544"></a>00544         <span class="keywordflow">if</span> (<a class="code" href="check__netlist_8cpp.html#aa7243817e540c171f4821990ef6334af">checker_sub_cycles</a> &lt;= 0)
<a name="l00545"></a>00545         {
<a name="l00546"></a>00546             <span class="keywordflow">if</span> (!strcmp (def-&gt;type, <span class="stringliteral">&quot;Sub&quot;</span>))
<a name="l00547"></a>00547             {
<a name="l00548"></a>00548                 <span class="keywordflow">if</span> ((sub = <a class="code" href="check__netlist_8cpp.html#a18fe2b0a499140c7c287fdfa4b47687d">checker_get_subcircuit</a> (def)) != NULL)
<a name="l00549"></a>00549                 {
<a name="l00550"></a>00550                     count += <a class="code" href="check__netlist_8cpp.html#af25ebb4936c9ab8e798e468fde0fc160">checker_count_nonlinearities</a> (sub-&gt;<a class="code" href="structdefinition__t.html#adbac069b30fc5f0544f09e77e56fa26c">sub</a>);
<a name="l00551"></a>00551                 }
<a name="l00552"></a>00552             }
<a name="l00553"></a>00553         }
<a name="l00554"></a>00554     }
<a name="l00555"></a>00555     <span class="keywordflow">return</span> count;
<a name="l00556"></a>00556 }
<a name="l00557"></a>00557 
<a name="l00558"></a>00558 <span class="comment">/* This function returns the number of action definitions with the</span>
<a name="l00559"></a>00559 <span class="comment">   given instance name. */</span>
<a name="l00560"></a><a class="code" href="check__netlist_8cpp.html#a35f3125bb242a747e99f2f9dbe032177">00560</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="check__netlist_8cpp.html#a35f3125bb242a747e99f2f9dbe032177">checker_count_action</a> (<span class="keyword">struct</span> <a class="code" href="structdefinition__t.html">definition_t</a> * root, <span class="keywordtype">char</span> * <a class="code" href="parse__netlist_8y.html#a5ffaf17e178b3a6fa2012fe3050ede22">instance</a>)
<a name="l00561"></a>00561 {
<a name="l00562"></a>00562     <span class="keywordtype">int</span> count = 0;
<a name="l00563"></a>00563     <span class="keywordflow">for</span> (<span class="keyword">struct</span> <a class="code" href="structdefinition__t.html">definition_t</a> * def = root; def != NULL; def = def-&gt;<a class="code" href="structdefinition__t.html#ac6f2d42a0105ff6e699938fcd36bd12b">next</a>)
<a name="l00564"></a>00564     {
<a name="l00565"></a>00565         <span class="keywordflow">if</span> (def-&gt;action == 1 &amp;&amp; !strcmp (def-&gt;instance, instance))
<a name="l00566"></a>00566             count++;
<a name="l00567"></a>00567     }
<a name="l00568"></a>00568     <span class="keywordflow">return</span> count;
<a name="l00569"></a>00569 }
<a name="l00570"></a>00570 
<a name="l00571"></a>00571 <span class="comment">/* This (recursive) function detects any kind of cyclic definitions of</span>
<a name="l00572"></a>00572 <span class="comment">   parameter sweeps for the given instance name.  The string list</span>
<a name="l00573"></a>00573 <span class="comment">   argument is used to pass the dependencies.  The function returns</span>
<a name="l00574"></a>00574 <span class="comment">   zero if the parameter sweep in non-cyclic. */</span>
<a name="l00575"></a><a class="code" href="check__netlist_8cpp.html#afbd878fa5ec479a33510b05aadf8744d">00575</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="check__netlist_8cpp.html#afbd878fa5ec479a33510b05aadf8744d">checker_validate_para_cycles</a> (<span class="keyword">struct</span> <a class="code" href="structdefinition__t.html">definition_t</a> * root,
<a name="l00576"></a>00576         <span class="keywordtype">char</span> * <a class="code" href="parse__netlist_8y.html#a5ffaf17e178b3a6fa2012fe3050ede22">instance</a>, strlist * deps)
<a name="l00577"></a>00577 {
<a name="l00578"></a>00578     <span class="keywordtype">int</span> errors = 0;
<a name="l00579"></a>00579     <span class="keyword">struct </span><a class="code" href="structvalue__t.html">value_t</a> * val;
<a name="l00580"></a>00580     <span class="keywordflow">for</span> (<span class="keyword">struct</span> <a class="code" href="structdefinition__t.html">definition_t</a> * def = root; def != NULL; def = def-&gt;<a class="code" href="structdefinition__t.html#ac6f2d42a0105ff6e699938fcd36bd12b">next</a>)
<a name="l00581"></a>00581     {
<a name="l00582"></a>00582         <span class="comment">/* find the appropriate definition for the given instance */</span>
<a name="l00583"></a>00583         <span class="keywordflow">if</span> (def-&gt;action == 1 &amp;&amp; !strcmp (def-&gt;instance, instance))
<a name="l00584"></a>00584         {
<a name="l00585"></a>00585             <span class="comment">/* emit error message if the instance is already in the dependencies */</span>
<a name="l00586"></a>00586             <span class="keywordflow">if</span> (deps-&gt;contains (instance))
<a name="l00587"></a>00587             {
<a name="l00588"></a>00588                 <a class="code" href="logging_8c.html#abe06a8732a47a291606edcfac5e5146e">logprint</a> (<a class="code" href="logging_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;checker error, cyclic definition of `%s&#39; &quot;</span>
<a name="l00589"></a>00589                           <span class="stringliteral">&quot;detected, involves: %s\n&quot;</span>, instance, deps-&gt;toString ());
<a name="l00590"></a>00590                 <span class="keywordflow">return</span> ++errors;
<a name="l00591"></a>00591             }
<a name="l00592"></a>00592             deps-&gt;append (instance);
<a name="l00593"></a>00593             <span class="comment">/* recurse into parameter sweeps */</span>
<a name="l00594"></a>00594             <span class="keywordflow">if</span> (!strcmp (def-&gt;type, <span class="stringliteral">&quot;SW&quot;</span>))
<a name="l00595"></a>00595             {
<a name="l00596"></a>00596                 <span class="keywordflow">if</span> ((val = <a class="code" href="check__netlist_8cpp.html#ad9167af3b9466ee85d15c808f41741c5">checker_find_reference</a> (def, <span class="stringliteral">&quot;Sim&quot;</span>)) != NULL)
<a name="l00597"></a>00597                 {
<a name="l00598"></a>00598                     <span class="keywordflow">return</span> <a class="code" href="check__netlist_8cpp.html#afbd878fa5ec479a33510b05aadf8744d">checker_validate_para_cycles</a> (root, val-&gt;<a class="code" href="structvalue__t.html#ad442091764df35b6ff5dbfd7f5bd965b">ident</a>, deps);
<a name="l00599"></a>00599                 }
<a name="l00600"></a>00600             }
<a name="l00601"></a>00601         }
<a name="l00602"></a>00602     }
<a name="l00603"></a>00603     <span class="keywordflow">return</span> errors;
<a name="l00604"></a>00604 }
<a name="l00605"></a>00605 
<a name="l00606"></a>00606 <span class="comment">/* This function validates each parameter sweep within the list of</span>
<a name="l00607"></a>00607 <span class="comment">   definitions and return non-zero on errors.  Emits appropriate error</span>
<a name="l00608"></a>00608 <span class="comment">   messages. */</span>
<a name="l00609"></a><a class="code" href="check__netlist_8cpp.html#af054860e3ffcf31d90ade55cd9e6523f">00609</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="check__netlist_8cpp.html#af054860e3ffcf31d90ade55cd9e6523f">checker_validate_para</a> (<span class="keyword">struct</span> <a class="code" href="structdefinition__t.html">definition_t</a> * root)
<a name="l00610"></a>00610 {
<a name="l00611"></a>00611     <span class="keywordtype">int</span> errors = 0;
<a name="l00612"></a>00612     <span class="keyword">struct </span><a class="code" href="structvalue__t.html">value_t</a> * val;
<a name="l00613"></a>00613     <span class="keywordflow">for</span> (<span class="keyword">struct</span> <a class="code" href="structdefinition__t.html">definition_t</a> * def = root; def != NULL; def = def-&gt;<a class="code" href="structdefinition__t.html#ac6f2d42a0105ff6e699938fcd36bd12b">next</a>)
<a name="l00614"></a>00614     {
<a name="l00615"></a>00615         <span class="comment">/* find parameter sweep */</span>
<a name="l00616"></a>00616         <span class="keywordflow">if</span> (def-&gt;action == 1 &amp;&amp; !strcmp (def-&gt;type, <span class="stringliteral">&quot;SW&quot;</span>))
<a name="l00617"></a>00617         {
<a name="l00618"></a>00618             <span class="comment">/* the &#39;Sim&#39; property must be an identifier */</span>
<a name="l00619"></a>00619             <span class="keywordflow">if</span> ((val = <a class="code" href="check__netlist_8cpp.html#af95a777fed63643cdf6ce80c9fb1d319">checker_validate_reference</a> (def, <span class="stringliteral">&quot;Sim&quot;</span>)) == NULL)
<a name="l00620"></a>00620             {
<a name="l00621"></a>00621                 errors++;
<a name="l00622"></a>00622             }
<a name="l00623"></a>00623             <span class="keywordflow">else</span>
<a name="l00624"></a>00624             {
<a name="l00625"></a>00625                 <span class="comment">/* check for self-referring sweeps */</span>
<a name="l00626"></a>00626                 <span class="keywordflow">if</span> (!strcmp (def-&gt;instance, val-&gt;<a class="code" href="structvalue__t.html#ad442091764df35b6ff5dbfd7f5bd965b">ident</a>))
<a name="l00627"></a>00627                 {
<a name="l00628"></a>00628                     <a class="code" href="logging_8c.html#abe06a8732a47a291606edcfac5e5146e">logprint</a> (<a class="code" href="logging_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;line %d: checker error, definition `%s:%s&#39; &quot;</span>
<a name="l00629"></a>00629                               <span class="stringliteral">&quot;refers to itself\n&quot;</span>, def-&gt;line, def-&gt;type, def-&gt;instance);
<a name="l00630"></a>00630                     errors++;
<a name="l00631"></a>00631                 }
<a name="l00632"></a>00632                 <span class="comment">/* look for the referred analysis action definition */</span>
<a name="l00633"></a>00633                 <span class="keywordflow">if</span> (<a class="code" href="check__netlist_8cpp.html#a35f3125bb242a747e99f2f9dbe032177">checker_count_action</a> (root, val-&gt;<a class="code" href="structvalue__t.html#ad442091764df35b6ff5dbfd7f5bd965b">ident</a>) != 1)
<a name="l00634"></a>00634                 {
<a name="l00635"></a>00635                     <a class="code" href="logging_8c.html#abe06a8732a47a291606edcfac5e5146e">logprint</a> (<a class="code" href="logging_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;line %d: checker error, no such action `%s&#39; &quot;</span>
<a name="l00636"></a>00636                               <span class="stringliteral">&quot;found as referred in `%s:%s&#39;\n&quot;</span>, def-&gt;line, val-&gt;<a class="code" href="structvalue__t.html#ad442091764df35b6ff5dbfd7f5bd965b">ident</a>,
<a name="l00637"></a>00637                               def-&gt;type, def-&gt;instance);
<a name="l00638"></a>00638                     errors++;
<a name="l00639"></a>00639                 }
<a name="l00640"></a>00640                 <span class="comment">/* finally detect cyclic definitions */</span>
<a name="l00641"></a>00641                 strlist * deps = <span class="keyword">new</span> strlist ();
<a name="l00642"></a>00642                 errors += <a class="code" href="check__netlist_8cpp.html#afbd878fa5ec479a33510b05aadf8744d">checker_validate_para_cycles</a> (root, val-&gt;<a class="code" href="structvalue__t.html#ad442091764df35b6ff5dbfd7f5bd965b">ident</a>, deps);
<a name="l00643"></a>00643                 <span class="keyword">delete</span> deps;
<a name="l00644"></a>00644             }
<a name="l00645"></a>00645         }
<a name="l00646"></a>00646     }
<a name="l00647"></a>00647     <span class="keywordflow">return</span> errors;
<a name="l00648"></a>00648 }
<a name="l00649"></a>00649 
<a name="l00650"></a>00650 <span class="comment">/* This function returns the next port definition in the given list of</span>
<a name="l00651"></a>00651 <span class="comment">   definitions or NULL if there is no such definition. */</span>
<a name="l00652"></a><a class="code" href="check__netlist_8cpp.html#aec0c06458fb819391689aff79e3ab5da">00652</a> <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structdefinition__t.html">definition_t</a> * <a class="code" href="check__netlist_8cpp.html#aec0c06458fb819391689aff79e3ab5da">checker_find_port</a> (<span class="keyword">struct</span> <a class="code" href="structdefinition__t.html">definition_t</a> * root)
<a name="l00653"></a>00653 {
<a name="l00654"></a>00654     <span class="keywordflow">for</span> (<span class="keyword">struct</span> <a class="code" href="structdefinition__t.html">definition_t</a> * def = root; def != NULL; def = def-&gt;<a class="code" href="structdefinition__t.html#ac6f2d42a0105ff6e699938fcd36bd12b">next</a>)
<a name="l00655"></a>00655     {
<a name="l00656"></a>00656         <span class="keywordflow">if</span> (def-&gt;action == <a class="code" href="netdefs_8h.html#a702804b0460e38665dab9ae3a6c3cbf6">PROP_COMPONENT</a> &amp;&amp; !strcmp (def-&gt;type, <span class="stringliteral">&quot;Pac&quot;</span>))
<a name="l00657"></a>00657         {
<a name="l00658"></a>00658             <span class="keywordflow">return</span> def;
<a name="l00659"></a>00659         }
<a name="l00660"></a>00660     }
<a name="l00661"></a>00661     <span class="keywordflow">return</span> NULL;
<a name="l00662"></a>00662 }
<a name="l00663"></a>00663 
<a name="l00664"></a>00664 <span class="comment">/* This function checks whether the port numbers for the S-parameter</span>
<a name="l00665"></a>00665 <span class="comment">   analysis are unique or not.  It returns zero on success and</span>
<a name="l00666"></a>00666 <span class="comment">   non-zero if it detected duplicate entries. */</span>
<a name="l00667"></a><a class="code" href="check__netlist_8cpp.html#a7f2489ed403bdf589eff2e8c4a01cb38">00667</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="check__netlist_8cpp.html#a7f2489ed403bdf589eff2e8c4a01cb38">checker_validate_ports</a> (<span class="keyword">struct</span> <a class="code" href="structdefinition__t.html">definition_t</a> * root)
<a name="l00668"></a>00668 {
<a name="l00669"></a>00669     <span class="keywordtype">int</span> p, errors = 0;
<a name="l00670"></a>00670     <span class="keyword">struct </span><a class="code" href="structvalue__t.html">value_t</a> * val;
<a name="l00671"></a>00671     <span class="keyword">struct </span><a class="code" href="structdefinition__t.html">definition_t</a> * port, * def = root;
<a name="l00672"></a>00672     <span class="keyword">const</span> <span class="keywordtype">char</span> * prop = <span class="stringliteral">&quot;Num&quot;</span>;
<a name="l00673"></a>00673     <span class="keywordflow">while</span> ((def = <a class="code" href="check__netlist_8cpp.html#aec0c06458fb819391689aff79e3ab5da">checker_find_port</a> (def)) != NULL)
<a name="l00674"></a>00674     {
<a name="l00675"></a>00675         <span class="keywordflow">if</span> ((val = <a class="code" href="check__netlist_8cpp.html#abae464b0dd770d52d4ab3a5bb94ccba9">checker_find_prop_value</a> (def, prop)) != NULL)
<a name="l00676"></a>00676         {
<a name="l00677"></a>00677             p = (<a class="code" href="parse__citi_8y.html#a410a93b01e4266fc225a4c9cd6349be4">int</a>) val-&gt;<a class="code" href="structvalue__t.html#a00344d940adac2e92047e60efde51a36">value</a>;
<a name="l00678"></a>00678             port = root;
<a name="l00679"></a>00679             while ((port = <a class="code" href="check__netlist_8cpp.html#aec0c06458fb819391689aff79e3ab5da">checker_find_port</a> (port)) != NULL)
<a name="l00680"></a>00680             {
<a name="l00681"></a>00681                 <span class="keywordflow">if</span> (port != def)
<a name="l00682"></a>00682                 {
<a name="l00683"></a>00683                     <span class="keywordflow">if</span> ((val = <a class="code" href="check__netlist_8cpp.html#abae464b0dd770d52d4ab3a5bb94ccba9">checker_find_prop_value</a> (port, prop)) != NULL)
<a name="l00684"></a>00684                     {
<a name="l00685"></a>00685                         <span class="keywordflow">if</span> (p == (<span class="keywordtype">int</span>) val-&gt;<a class="code" href="structvalue__t.html#a00344d940adac2e92047e60efde51a36">value</a>)
<a name="l00686"></a>00686                         {
<a name="l00687"></a>00687                             <a class="code" href="logging_8c.html#abe06a8732a47a291606edcfac5e5146e">logprint</a> (<a class="code" href="logging_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;line %d: checker error, `%s&#39; definitions &quot;</span>
<a name="l00688"></a>00688                                       <span class="stringliteral">&quot;with duplicate `%s=%d&#39; property found: `%s:%s&#39; and &quot;</span>
<a name="l00689"></a>00689                                       <span class="stringliteral">&quot;`%s:%s&#39;\n&quot;</span>, def-&gt;<a class="code" href="structdefinition__t.html#aad308f4ecd35503badc78adb3e578d8b">line</a>, def-&gt;<a class="code" href="structdefinition__t.html#adbc03f56abf1631614d1cc4946961300">type</a>, prop, p, def-&gt;<a class="code" href="structdefinition__t.html#adbc03f56abf1631614d1cc4946961300">type</a>,
<a name="l00690"></a>00690                                       def-&gt;<a class="code" href="structdefinition__t.html#a594dd31d0446b3364e5875eaced950eb">instance</a>, port-&gt;<a class="code" href="structdefinition__t.html#adbc03f56abf1631614d1cc4946961300">type</a>, port-&gt;<a class="code" href="structdefinition__t.html#a594dd31d0446b3364e5875eaced950eb">instance</a>);
<a name="l00691"></a>00691                             errors++;
<a name="l00692"></a>00692                         }
<a name="l00693"></a>00693                     }
<a name="l00694"></a>00694                 }
<a name="l00695"></a>00695                 port = port-&gt;<a class="code" href="structdefinition__t.html#ac6f2d42a0105ff6e699938fcd36bd12b">next</a>;
<a name="l00696"></a>00696             }
<a name="l00697"></a>00697         }
<a name="l00698"></a>00698         def = def-&gt;<a class="code" href="structdefinition__t.html#ac6f2d42a0105ff6e699938fcd36bd12b">next</a>;
<a name="l00699"></a>00699     }
<a name="l00700"></a>00700     <span class="keywordflow">return</span> errors;
<a name="l00701"></a>00701 }
<a name="l00702"></a>00702 
<a name="l00703"></a>00703 <span class="comment">/* The following function checks whether the parametric sweeps in the</span>
<a name="l00704"></a>00704 <span class="comment">   netlist are valid or not.  It returns zero on success and non-zero</span>
<a name="l00705"></a>00705 <span class="comment">   otherwise. */</span>
<a name="l00706"></a><a class="code" href="check__netlist_8cpp.html#ac2613551a2631c195e91d6d8cc6b35a9">00706</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="check__netlist_8cpp.html#ac2613551a2631c195e91d6d8cc6b35a9">checker_validate_lists</a> (<span class="keyword">struct</span> <a class="code" href="structdefinition__t.html">definition_t</a> * root)
<a name="l00707"></a>00707 {
<a name="l00708"></a>00708     <span class="keywordtype">int</span> errors = 0;
<a name="l00709"></a>00709     <span class="comment">// go through each definition</span>
<a name="l00710"></a>00710     <span class="keywordflow">for</span> (<span class="keyword">struct</span> <a class="code" href="structdefinition__t.html">definition_t</a> * def = root; def != NULL; def = def-&gt;<a class="code" href="structdefinition__t.html#ac6f2d42a0105ff6e699938fcd36bd12b">next</a>)
<a name="l00711"></a>00711     {
<a name="l00712"></a>00712         <span class="comment">/* sweeps possible in parameter sweep, ac-analysis and</span>
<a name="l00713"></a>00713 <span class="comment">           s-parameter analysis */</span>
<a name="l00714"></a>00714         <span class="keywordflow">if</span> (def-&gt;action == 1 &amp;&amp; (!strcmp (def-&gt;type, <span class="stringliteral">&quot;SW&quot;</span>) ||
<a name="l00715"></a>00715                                  !strcmp (def-&gt;type, <span class="stringliteral">&quot;AC&quot;</span>) ||
<a name="l00716"></a>00716                                  !strcmp (def-&gt;type, <span class="stringliteral">&quot;SP&quot;</span>)))
<a name="l00717"></a>00717         {
<a name="l00718"></a>00718             <span class="keyword">struct </span><a class="code" href="structvalue__t.html">value_t</a> * val = <a class="code" href="check__netlist_8cpp.html#ad9167af3b9466ee85d15c808f41741c5">checker_find_reference</a> (def, <span class="stringliteral">&quot;Type&quot;</span>);
<a name="l00719"></a>00719             <span class="keywordtype">char</span> * <a class="code" href="parse__vcd_8y.html#ae0bd5e8ec17b2aad3338041991eb1056">type</a> = val-&gt;<a class="code" href="structvalue__t.html#ad442091764df35b6ff5dbfd7f5bd965b">ident</a>;
<a name="l00720"></a>00720             <span class="comment">// list of constant values and constant values</span>
<a name="l00721"></a>00721             <span class="keywordflow">if</span> (type &amp;&amp; (!strcmp (type, <span class="stringliteral">&quot;const&quot;</span>) || !strcmp (type, <span class="stringliteral">&quot;list&quot;</span>)))
<a name="l00722"></a>00722             {
<a name="l00723"></a>00723                 <span class="comment">// property &#39;Values&#39; is required</span>
<a name="l00724"></a>00724                 <span class="keywordflow">if</span> ((val = <a class="code" href="check__netlist_8cpp.html#abae464b0dd770d52d4ab3a5bb94ccba9">checker_find_prop_value</a> (def, <span class="stringliteral">&quot;Values&quot;</span>)) == NULL)
<a name="l00725"></a>00725                 {
<a name="l00726"></a>00726                     <span class="keywordflow">if</span> (!strcmp (type, <span class="stringliteral">&quot;const&quot;</span>))
<a name="l00727"></a>00727                     {
<a name="l00728"></a>00728                         <span class="keywordflow">if</span> ((val = <a class="code" href="check__netlist_8cpp.html#af95a777fed63643cdf6ce80c9fb1d319">checker_validate_reference</a> (def, <span class="stringliteral">&quot;Values&quot;</span>)) == NULL)
<a name="l00729"></a>00729                         {
<a name="l00730"></a>00730                             errors++;
<a name="l00731"></a>00731                         }
<a name="l00732"></a>00732                     }
<a name="l00733"></a>00733                     <span class="keywordflow">else</span>
<a name="l00734"></a>00734                     {
<a name="l00735"></a>00735                         <a class="code" href="logging_8c.html#abe06a8732a47a291606edcfac5e5146e">logprint</a> (<a class="code" href="logging_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;line %d: checker error, required property &quot;</span>
<a name="l00736"></a>00736                                   <span class="stringliteral">&quot;`%s&#39; not found in `%s:%s&#39;\n&quot;</span>, def-&gt;line, <span class="stringliteral">&quot;Values&quot;</span>,
<a name="l00737"></a>00737                                   def-&gt;type, def-&gt;instance);
<a name="l00738"></a>00738                         errors++;
<a name="l00739"></a>00739                     }
<a name="l00740"></a>00740                 }
<a name="l00741"></a>00741                 <span class="keywordflow">else</span>
<a name="l00742"></a>00742                 {
<a name="l00743"></a>00743                     <span class="keywordflow">if</span> (!strcmp (type, <span class="stringliteral">&quot;const&quot;</span>))
<a name="l00744"></a>00744                     {
<a name="l00745"></a>00745                         <span class="comment">// in constant sweeps only one value allowed</span>
<a name="l00746"></a>00746                         <span class="keywordflow">if</span> (val-&gt;<a class="code" href="structvalue__t.html#a51b2a2d3d5919849306c784f6271492c">next</a> != NULL)
<a name="l00747"></a>00747                         {
<a name="l00748"></a>00748                             <a class="code" href="logging_8c.html#abe06a8732a47a291606edcfac5e5146e">logprint</a> (<a class="code" href="logging_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;line %d: checker error, value of `%s&#39; &quot;</span>
<a name="l00749"></a>00749                                       <span class="stringliteral">&quot;needs to be a single constant value in `%s:%s&#39;, no &quot;</span>
<a name="l00750"></a>00750                                       <span class="stringliteral">&quot;lists possible\n&quot;</span>, def-&gt;line, <span class="stringliteral">&quot;Values&quot;</span>,
<a name="l00751"></a>00751                                       def-&gt;type, def-&gt;instance);
<a name="l00752"></a>00752                             errors++;
<a name="l00753"></a>00753                         }
<a name="l00754"></a>00754                         val-&gt;<a class="code" href="structvalue__t.html#a73164dc97373afce1086bc970da5d211">var</a> = <a class="code" href="namespacequcs_1_1eqn.html#a6d6a4e1bab3f5e23f5d898059f98c134a0f93b5f69ab54936d9d2eef74f25aecd">TAG_UNKNOWN</a>;
<a name="l00755"></a>00755                     }
<a name="l00756"></a>00756                     <span class="keywordflow">if</span> (!strcmp (type, <span class="stringliteral">&quot;list&quot;</span>))
<a name="l00757"></a>00757                     {
<a name="l00758"></a>00758                         val-&gt;<a class="code" href="structvalue__t.html#a73164dc97373afce1086bc970da5d211">var</a> = <a class="code" href="namespacequcs_1_1eqn.html#a6d6a4e1bab3f5e23f5d898059f98c134a22e4d6b45b88b80f7d3ef518f52f5546">TAG_VECTOR</a>;
<a name="l00759"></a>00759                     }
<a name="l00760"></a>00760                     <span class="comment">// check and evaluate the unit scale in a value list</span>
<a name="l00761"></a>00761                     <span class="keywordflow">for</span> (; val != NULL; val = val-&gt;<a class="code" href="structvalue__t.html#a51b2a2d3d5919849306c784f6271492c">next</a>)
<a name="l00762"></a>00762                     {
<a name="l00763"></a>00763                         <span class="keywordflow">if</span> (!<a class="code" href="check__netlist_8cpp.html#a37c6b4e02257688a7b7980cad8797c05">checker_evaluate_scale</a> (val))
<a name="l00764"></a>00764                             errors++;
<a name="l00765"></a>00765                     }
<a name="l00766"></a>00766                 }
<a name="l00767"></a>00767                 <span class="comment">// property &#39;Start&#39; is invalid</span>
<a name="l00768"></a>00768                 <span class="keywordflow">if</span> (<a class="code" href="check__netlist_8cpp.html#a2d22357edbb7c3690b57adfce214071e">checker_find_property</a> (def, <span class="stringliteral">&quot;Start&quot;</span>) &gt; 0)
<a name="l00769"></a>00769                 {
<a name="l00770"></a>00770                     <a class="code" href="logging_8c.html#abe06a8732a47a291606edcfac5e5146e">logprint</a> (<a class="code" href="logging_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;line %d: checker error, extraneous property &quot;</span>
<a name="l00771"></a>00771                               <span class="stringliteral">&quot;`%s&#39; is invalid in `%s:%s&#39;\n&quot;</span>, def-&gt;line, <span class="stringliteral">&quot;Start&quot;</span>,
<a name="l00772"></a>00772                               def-&gt;type, def-&gt;instance);
<a name="l00773"></a>00773                     errors++;
<a name="l00774"></a>00774                 }
<a name="l00775"></a>00775                 <span class="comment">// property &#39;Stop&#39; is invalid</span>
<a name="l00776"></a>00776                 <span class="keywordflow">if</span> (<a class="code" href="check__netlist_8cpp.html#a2d22357edbb7c3690b57adfce214071e">checker_find_property</a> (def, <span class="stringliteral">&quot;Stop&quot;</span>) &gt; 0)
<a name="l00777"></a>00777                 {
<a name="l00778"></a>00778                     <a class="code" href="logging_8c.html#abe06a8732a47a291606edcfac5e5146e">logprint</a> (<a class="code" href="logging_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;line %d: checker error, extraneous property &quot;</span>
<a name="l00779"></a>00779                               <span class="stringliteral">&quot;`%s&#39; is invalid in `%s:%s&#39;\n&quot;</span>, def-&gt;line, <span class="stringliteral">&quot;Stop&quot;</span>,
<a name="l00780"></a>00780                               def-&gt;type, def-&gt;instance);
<a name="l00781"></a>00781                     errors++;
<a name="l00782"></a>00782                 }
<a name="l00783"></a>00783                 <span class="comment">// property &#39;Points&#39; is also invalid</span>
<a name="l00784"></a>00784                 <span class="keywordflow">if</span> (<a class="code" href="check__netlist_8cpp.html#a2d22357edbb7c3690b57adfce214071e">checker_find_property</a> (def, <span class="stringliteral">&quot;Points&quot;</span>) &gt; 0)
<a name="l00785"></a>00785                 {
<a name="l00786"></a>00786                     <a class="code" href="logging_8c.html#abe06a8732a47a291606edcfac5e5146e">logprint</a> (<a class="code" href="logging_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;line %d: checker error, extraneous property &quot;</span>
<a name="l00787"></a>00787                               <span class="stringliteral">&quot;`%s&#39; is invalid in `%s:%s&#39;\n&quot;</span>, def-&gt;line, <span class="stringliteral">&quot;Points&quot;</span>,
<a name="l00788"></a>00788                               def-&gt;type, def-&gt;instance);
<a name="l00789"></a>00789                     errors++;
<a name="l00790"></a>00790                 }
<a name="l00791"></a>00791             }
<a name="l00792"></a>00792             <span class="comment">// linearly and logarithmically stepped sweeps</span>
<a name="l00793"></a>00793             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (type &amp;&amp; (!strcmp (type, <span class="stringliteral">&quot;lin&quot;</span>) || !strcmp (type, <span class="stringliteral">&quot;log&quot;</span>)))
<a name="l00794"></a>00794             {
<a name="l00795"></a>00795                 <span class="comment">// property &#39;Start&#39; required</span>
<a name="l00796"></a>00796                 <span class="keywordflow">if</span> (<a class="code" href="check__netlist_8cpp.html#a2d22357edbb7c3690b57adfce214071e">checker_find_property</a> (def, <span class="stringliteral">&quot;Start&quot;</span>) &lt;= 0)
<a name="l00797"></a>00797                 {
<a name="l00798"></a>00798                     <a class="code" href="logging_8c.html#abe06a8732a47a291606edcfac5e5146e">logprint</a> (<a class="code" href="logging_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;line %d: checker error, required property &quot;</span>
<a name="l00799"></a>00799                               <span class="stringliteral">&quot;`%s&#39; not found in `%s:%s&#39;\n&quot;</span>, def-&gt;line, <span class="stringliteral">&quot;Start&quot;</span>,
<a name="l00800"></a>00800                               def-&gt;type, def-&gt;instance);
<a name="l00801"></a>00801                     errors++;
<a name="l00802"></a>00802                 }
<a name="l00803"></a>00803                 <span class="comment">// property &#39;Stop&#39; required</span>
<a name="l00804"></a>00804                 <span class="keywordflow">if</span> (<a class="code" href="check__netlist_8cpp.html#a2d22357edbb7c3690b57adfce214071e">checker_find_property</a> (def, <span class="stringliteral">&quot;Stop&quot;</span>) &lt;= 0)
<a name="l00805"></a>00805                 {
<a name="l00806"></a>00806                     <a class="code" href="logging_8c.html#abe06a8732a47a291606edcfac5e5146e">logprint</a> (<a class="code" href="logging_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;line %d: checker error, required property &quot;</span>
<a name="l00807"></a>00807                               <span class="stringliteral">&quot;`%s&#39; not found in `%s:%s&#39;\n&quot;</span>, def-&gt;line, <span class="stringliteral">&quot;Stop&quot;</span>,
<a name="l00808"></a>00808                               def-&gt;type, def-&gt;instance);
<a name="l00809"></a>00809                     errors++;
<a name="l00810"></a>00810                 }
<a name="l00811"></a>00811                 <span class="comment">// property &#39;Points&#39; is also required</span>
<a name="l00812"></a>00812                 <span class="keywordflow">if</span> (<a class="code" href="check__netlist_8cpp.html#a2d22357edbb7c3690b57adfce214071e">checker_find_property</a> (def, <span class="stringliteral">&quot;Points&quot;</span>) &lt;= 0)
<a name="l00813"></a>00813                 {
<a name="l00814"></a>00814                     <a class="code" href="logging_8c.html#abe06a8732a47a291606edcfac5e5146e">logprint</a> (<a class="code" href="logging_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;line %d: checker error, required property &quot;</span>
<a name="l00815"></a>00815                               <span class="stringliteral">&quot;`%s&#39; not found in `%s:%s&#39;\n&quot;</span>, def-&gt;line, <span class="stringliteral">&quot;Points&quot;</span>,
<a name="l00816"></a>00816                               def-&gt;type, def-&gt;instance);
<a name="l00817"></a>00817                     errors++;
<a name="l00818"></a>00818                 }
<a name="l00819"></a>00819                 <span class="comment">// property &#39;Values&#39; is invalid</span>
<a name="l00820"></a>00820                 <span class="keywordflow">if</span> (<a class="code" href="check__netlist_8cpp.html#a2d22357edbb7c3690b57adfce214071e">checker_find_property</a> (def, <span class="stringliteral">&quot;Values&quot;</span>) &gt; 0)
<a name="l00821"></a>00821                 {
<a name="l00822"></a>00822                     <a class="code" href="logging_8c.html#abe06a8732a47a291606edcfac5e5146e">logprint</a> (<a class="code" href="logging_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;line %d: checker error, extraneous property &quot;</span>
<a name="l00823"></a>00823                               <span class="stringliteral">&quot;`%s&#39; is invalid in `%s:%s&#39;\n&quot;</span>, def-&gt;line, <span class="stringliteral">&quot;Values&quot;</span>,
<a name="l00824"></a>00824                               def-&gt;type, def-&gt;instance);
<a name="l00825"></a>00825                     errors++;
<a name="l00826"></a>00826                 }
<a name="l00827"></a>00827             }
<a name="l00828"></a>00828         }
<a name="l00829"></a>00829     }
<a name="l00830"></a>00830     <span class="keywordflow">return</span> errors;
<a name="l00831"></a>00831 }
<a name="l00832"></a>00832 
<a name="l00833"></a>00833 <span class="comment">/* This function checks the actions to be taken in the netlist.  It</span>
<a name="l00834"></a>00834 <span class="comment">   returns zero on success, non-zero otherwise. */</span>
<a name="l00835"></a><a class="code" href="check__netlist_8cpp.html#a1023d56dc59a12d7d94f1f64062d799a">00835</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="check__netlist_8cpp.html#a1023d56dc59a12d7d94f1f64062d799a">checker_validate_actions</a> (<span class="keyword">struct</span> <a class="code" href="structdefinition__t.html">definition_t</a> * root)
<a name="l00836"></a>00836 {
<a name="l00837"></a>00837     <span class="keywordtype">int</span> a, <a class="code" href="parse__netlist_8y.html#a519cf159c27abd2374c9f649b9e9946d">c</a>, <a class="code" href="parse__mdl_8y.html#aecba4cab5e52994730d1e21424997b33">n</a>, errors = 0;
<a name="l00838"></a>00838     <span class="keywordflow">if</span> ((n = <a class="code" href="check__netlist_8cpp.html#ad5673d406838dfa184cbb9885229db2c">checker_count_definitions</a> (root, NULL, 1)) &lt; 1)
<a name="l00839"></a>00839     {
<a name="l00840"></a>00840         <a class="code" href="logging_8c.html#abe06a8732a47a291606edcfac5e5146e">logprint</a> (<a class="code" href="logging_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;checker error, no actions defined: nothing to do\n&quot;</span>);
<a name="l00841"></a>00841         errors++;
<a name="l00842"></a>00842     }
<a name="l00843"></a>00843     <span class="keywordflow">else</span>
<a name="l00844"></a>00844     {
<a name="l00845"></a>00845         <span class="comment">// check requirements for s-parameter analysis</span>
<a name="l00846"></a>00846         <span class="keywordflow">if</span> ((a = <a class="code" href="check__netlist_8cpp.html#ad5673d406838dfa184cbb9885229db2c">checker_count_definitions</a> (root, <span class="stringliteral">&quot;SP&quot;</span>, 1)) &gt;= 1)
<a name="l00847"></a>00847         {
<a name="l00848"></a>00848             <span class="keywordflow">if</span> ((n = <a class="code" href="check__netlist_8cpp.html#ad5673d406838dfa184cbb9885229db2c">checker_count_definitions</a> (root, <span class="stringliteral">&quot;Pac&quot;</span>, 0)) &lt; 1)
<a name="l00849"></a>00849             {
<a name="l00850"></a>00850                 <a class="code" href="logging_8c.html#abe06a8732a47a291606edcfac5e5146e">logprint</a> (<a class="code" href="logging_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;checker error, %d `Pac&#39; definitions found, at &quot;</span>
<a name="l00851"></a>00851                           <span class="stringliteral">&quot;least 1 required\n&quot;</span>, n);
<a name="l00852"></a>00852                 errors++;
<a name="l00853"></a>00853             }
<a name="l00854"></a>00854         }
<a name="l00855"></a>00855         <span class="comment">// count analyses requiring a DC solution</span>
<a name="l00856"></a>00856         a += <a class="code" href="check__netlist_8cpp.html#ad5673d406838dfa184cbb9885229db2c">checker_count_definitions</a> (root, <span class="stringliteral">&quot;AC&quot;</span>, 1);
<a name="l00857"></a>00857         <span class="comment">// check dc-analysis requirements</span>
<a name="l00858"></a>00858         c = <a class="code" href="check__netlist_8cpp.html#af25ebb4936c9ab8e798e468fde0fc160">checker_count_nonlinearities</a> (root);
<a name="l00859"></a>00859         n = <a class="code" href="check__netlist_8cpp.html#ad5673d406838dfa184cbb9885229db2c">checker_count_definitions</a> (root, <span class="stringliteral">&quot;DC&quot;</span>, 1);
<a name="l00860"></a>00860         <span class="keywordflow">if</span> (n &gt; 1)
<a name="l00861"></a>00861         {
<a name="l00862"></a>00862             <a class="code" href="logging_8c.html#abe06a8732a47a291606edcfac5e5146e">logprint</a> (<a class="code" href="logging_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;checker error, the .DC action is defined %dx, &quot;</span>
<a name="l00863"></a>00863                       <span class="stringliteral">&quot;single or none required\n&quot;</span>, n);
<a name="l00864"></a>00864             errors++;
<a name="l00865"></a>00865         }
<a name="l00866"></a>00866         <span class="keywordflow">if</span> (a &gt;= 1 &amp;&amp; c &gt;= 1 &amp;&amp; n &lt; 1)
<a name="l00867"></a>00867         {
<a name="l00868"></a>00868             <a class="code" href="logging_8c.html#abe06a8732a47a291606edcfac5e5146e">logprint</a> (<a class="code" href="logging_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;checker error, a .DC action is required for this &quot;</span>
<a name="l00869"></a>00869                       <span class="stringliteral">&quot;circuit definition (accounted %d non-linearities)\n&quot;</span>, c);
<a name="l00870"></a>00870             errors++;
<a name="l00871"></a>00871         }
<a name="l00872"></a>00872     }
<a name="l00873"></a>00873     errors += <a class="code" href="check__netlist_8cpp.html#af054860e3ffcf31d90ade55cd9e6523f">checker_validate_para</a> (root);
<a name="l00874"></a>00874     errors += <a class="code" href="check__netlist_8cpp.html#a7f2489ed403bdf589eff2e8c4a01cb38">checker_validate_ports</a> (root);
<a name="l00875"></a>00875     errors += <a class="code" href="check__netlist_8cpp.html#ac2613551a2631c195e91d6d8cc6b35a9">checker_validate_lists</a> (root);
<a name="l00876"></a>00876     <span class="keywordflow">return</span> errors;
<a name="l00877"></a>00877 }
<a name="l00878"></a>00878 
<a name="l00879"></a>00879 <span class="comment">/* This function checks the validity of each microstrip component and</span>
<a name="l00880"></a>00880 <span class="comment">   its substrate and model references.  It returns zero on success,</span>
<a name="l00881"></a>00881 <span class="comment">   emit error messages if necessary and returns non-zero on errors. */</span>
<a name="l00882"></a><a class="code" href="check__netlist_8cpp.html#a597d7e241f334e9deb92ecb5528f032f">00882</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="check__netlist_8cpp.html#a597d7e241f334e9deb92ecb5528f032f">checker_validate_strips</a> (<span class="keyword">struct</span> <a class="code" href="structdefinition__t.html">definition_t</a> * root)
<a name="l00883"></a>00883 {
<a name="l00884"></a>00884     <span class="keywordtype">int</span> errors = 0;
<a name="l00885"></a>00885     <span class="keyword">struct </span><a class="code" href="structvalue__t.html">value_t</a> * val;
<a name="l00886"></a>00886     <span class="keywordflow">for</span> (<span class="keyword">struct</span> <a class="code" href="structdefinition__t.html">definition_t</a> * def = root; def != NULL; def = def-&gt;<a class="code" href="structdefinition__t.html#ac6f2d42a0105ff6e699938fcd36bd12b">next</a>)
<a name="l00887"></a>00887     {
<a name="l00888"></a>00888         <span class="keywordflow">if</span> (!def-&gt;action)
<a name="l00889"></a>00889         {
<a name="l00890"></a>00890             <span class="comment">/* find components with substrate property */</span>
<a name="l00891"></a>00891             <span class="keywordflow">if</span> (<a class="code" href="check__netlist_8cpp.html#a595c10bfd2a816b09dccf63a49609788">checker_is_property</a> (def-&gt;define, <span class="stringliteral">&quot;Subst&quot;</span>) == <a class="code" href="netdefs_8h.html#a552766d94553aab12e7876b233745eba">PROP_STR</a>)
<a name="l00892"></a>00892             {
<a name="l00893"></a>00893                 <span class="comment">/* check validity of &#39;Subst&#39; property */</span>
<a name="l00894"></a>00894                 <span class="keywordflow">if</span> ((val = <a class="code" href="check__netlist_8cpp.html#af95a777fed63643cdf6ce80c9fb1d319">checker_validate_reference</a> (def, <span class="stringliteral">&quot;Subst&quot;</span>)) == NULL)
<a name="l00895"></a>00895                 {
<a name="l00896"></a>00896                     errors++;
<a name="l00897"></a>00897                 }
<a name="l00898"></a>00898                 <span class="keywordflow">else</span>
<a name="l00899"></a>00899                 {
<a name="l00900"></a>00900                     <span class="keywordflow">if</span> (<a class="code" href="check__netlist_8cpp.html#a5685c01b42b33e166beb47265bb4fa88">checker_count_definition</a> (root, <span class="stringliteral">&quot;SUBST&quot;</span>, val-&gt;<a class="code" href="structvalue__t.html#ad442091764df35b6ff5dbfd7f5bd965b">ident</a>) != 1)
<a name="l00901"></a>00901                     {
<a name="l00902"></a>00902                         <a class="code" href="logging_8c.html#abe06a8732a47a291606edcfac5e5146e">logprint</a> (<a class="code" href="logging_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;line %d: checker error, no such substrate &quot;</span>
<a name="l00903"></a>00903                                   <span class="stringliteral">&quot;`%s&#39; found as specified in `%s:%s&#39;\n&quot;</span>, def-&gt;line,
<a name="l00904"></a>00904                                   val-&gt;<a class="code" href="structvalue__t.html#ad442091764df35b6ff5dbfd7f5bd965b">ident</a>, def-&gt;type, def-&gt;instance);
<a name="l00905"></a>00905                         errors++;
<a name="l00906"></a>00906                     }
<a name="l00907"></a>00907                 }
<a name="l00908"></a>00908                 <span class="comment">/* check validity of &#39;Model&#39; property */</span>
<a name="l00909"></a>00909 <span class="preprocessor">#if DISABLE_FOR_NOW </span><span class="comment">/* ThinkME!!! */</span>
<a name="l00910"></a>00910                 <span class="keywordflow">if</span> ((val = <a class="code" href="check__netlist_8cpp.html#af95a777fed63643cdf6ce80c9fb1d319">checker_validate_reference</a> (def, <span class="stringliteral">&quot;Model&quot;</span>)) == NULL)
<a name="l00911"></a>00911                 {
<a name="l00912"></a>00912                     errors++;
<a name="l00913"></a>00913                 }
<a name="l00914"></a>00914 <span class="preprocessor">#endif</span>
<a name="l00915"></a>00915 <span class="preprocessor"></span>            }
<a name="l00916"></a>00916         }
<a name="l00917"></a>00917     }
<a name="l00918"></a>00918     <span class="keywordflow">return</span> errors;
<a name="l00919"></a>00919 }
<a name="l00920"></a>00920 
<a name="l00921"></a>00921 <span class="comment">/* This function counts the number of occurrences of the given node</span>
<a name="l00922"></a>00922 <span class="comment">   name in the given netlist definition root. */</span>
<a name="l00923"></a><a class="code" href="check__netlist_8cpp.html#a0501640b8c401ded88d577d9dca92b1f">00923</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="check__netlist_8cpp.html#a4d43ae45dea6ff18c123be678afeb8f5">checker_count_nodes</a> (<span class="keyword">struct</span> <a class="code" href="structdefinition__t.html">definition_t</a> * root, <span class="keywordtype">char</span> * <a class="code" href="parse__mdl_8y.html#aecba4cab5e52994730d1e21424997b33">n</a>)
<a name="l00924"></a>00924 {
<a name="l00925"></a>00925     <span class="keywordtype">int</span> count = 0;
<a name="l00926"></a>00926     <span class="keyword">struct </span><a class="code" href="structnode__t.html">node_t</a> * <a class="code" href="structnode__t.html#aebaf9d60a7b2db52c00204c89a20e94d">node</a>;
<a name="l00927"></a>00927     <span class="keywordflow">for</span> (<span class="keyword">struct</span> <a class="code" href="structdefinition__t.html">definition_t</a> * def = root; def != NULL; def = def-&gt;<a class="code" href="structdefinition__t.html#ac6f2d42a0105ff6e699938fcd36bd12b">next</a>)
<a name="l00928"></a>00928     {
<a name="l00929"></a>00929         <span class="keywordflow">if</span> (!def-&gt;action &amp;&amp; !def-&gt;nodeset)
<a name="l00930"></a>00930         {
<a name="l00931"></a>00931             <span class="keywordflow">for</span> (node = def-&gt;nodes; node != NULL; node = node-&gt;<a class="code" href="structnode__t.html#aca548c9bafe54ba9db19d40a7a7f1cb3">next</a>)
<a name="l00932"></a>00932                 <span class="keywordflow">if</span> (!strcmp (node-&gt;<a class="code" href="structnode__t.html#aebaf9d60a7b2db52c00204c89a20e94d">node</a>, n)) count++;
<a name="l00933"></a>00933         }
<a name="l00934"></a>00934     }
<a name="l00935"></a>00935     <span class="keywordflow">return</span> count;
<a name="l00936"></a>00936 }
<a name="l00937"></a>00937 
<a name="l00938"></a>00938 <span class="comment">/* The function identifies duplicate nodesets for the same node which</span>
<a name="l00939"></a>00939 <span class="comment">   is not allowed.  It returns the number of duplications. */</span>
<a name="l00940"></a><a class="code" href="check__netlist_8cpp.html#a1378d10cb2805ce77a6d0595d1698bd6">00940</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="check__netlist_8cpp.html#a1378d10cb2805ce77a6d0595d1698bd6">checker_count_nodesets</a> (<span class="keyword">struct</span> <a class="code" href="structdefinition__t.html">definition_t</a> * root, <span class="keywordtype">char</span> * <a class="code" href="parse__mdl_8y.html#aecba4cab5e52994730d1e21424997b33">n</a>)
<a name="l00941"></a>00941 {
<a name="l00942"></a>00942     <span class="keywordtype">int</span> count = 0;
<a name="l00943"></a>00943     <span class="keywordflow">for</span> (<span class="keyword">struct</span> <a class="code" href="structdefinition__t.html">definition_t</a> * def = root; def != NULL; def = def-&gt;<a class="code" href="structdefinition__t.html#ac6f2d42a0105ff6e699938fcd36bd12b">next</a>)
<a name="l00944"></a>00944     {
<a name="l00945"></a>00945         <span class="keywordflow">if</span> (def-&gt;nodeset &amp;&amp; !def-&gt;duplicate)
<a name="l00946"></a>00946         {
<a name="l00947"></a>00947             <span class="keywordtype">char</span> * <a class="code" href="classqucs_1_1eqn_1_1node.html">node</a> = def-&gt;nodes-&gt;<a class="code" href="classqucs_1_1eqn_1_1node.html#af5b6d5b390fe631178d74c093b6b957c">node</a>;
<a name="l00948"></a>00948             <span class="keywordflow">if</span> (!strcmp (node, n))
<a name="l00949"></a>00949             {
<a name="l00950"></a>00950                 <span class="keywordflow">if</span> (++count &gt; 1) def-&gt;duplicate = 1;
<a name="l00951"></a>00951             }
<a name="l00952"></a>00952         }
<a name="l00953"></a>00953     }
<a name="l00954"></a>00954     <span class="keywordflow">return</span> count;
<a name="l00955"></a>00955 }
<a name="l00956"></a>00956 
<a name="l00957"></a>00957 <span class="comment">/* The following function checks whether the nodes specified by the</span>
<a name="l00958"></a>00958 <span class="comment">   nodeset functionality is valid in its current scope.  It does not</span>
<a name="l00959"></a>00959 <span class="comment">   check across subcircuit boundaries. */</span>
<a name="l00960"></a><a class="code" href="check__netlist_8cpp.html#a8533dcdf539ff82db43c1e577a354d30">00960</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="check__netlist_8cpp.html#a8533dcdf539ff82db43c1e577a354d30">checker_validate_nodesets</a> (<span class="keyword">struct</span> <a class="code" href="structdefinition__t.html">definition_t</a> * root)
<a name="l00961"></a>00961 {
<a name="l00962"></a>00962     <span class="keywordtype">int</span> errors = 0;
<a name="l00963"></a>00963     <span class="keywordflow">for</span> (<span class="keyword">struct</span> <a class="code" href="structdefinition__t.html">definition_t</a> * def = root; def != NULL; def = def-&gt;<a class="code" href="structdefinition__t.html#ac6f2d42a0105ff6e699938fcd36bd12b">next</a>)
<a name="l00964"></a>00964     {
<a name="l00965"></a>00965         <span class="keywordflow">if</span> (def-&gt;nodeset &amp;&amp; <a class="code" href="check__netlist_8cpp.html#a4d43ae45dea6ff18c123be678afeb8f5">checker_count_nodes</a> (def) == 1)
<a name="l00966"></a>00966         {
<a name="l00967"></a>00967             <span class="keywordtype">char</span> * <a class="code" href="classqucs_1_1eqn_1_1node.html">node</a> = def-&gt;nodes-&gt;<a class="code" href="classqucs_1_1eqn_1_1node.html#af5b6d5b390fe631178d74c093b6b957c">node</a>;
<a name="l00968"></a>00968             <span class="keywordflow">if</span> (<a class="code" href="check__netlist_8cpp.html#a4d43ae45dea6ff18c123be678afeb8f5">checker_count_nodes</a> (root, node) &lt;= 0)
<a name="l00969"></a>00969             {
<a name="l00970"></a>00970                 <a class="code" href="logging_8c.html#abe06a8732a47a291606edcfac5e5146e">logprint</a> (<a class="code" href="logging_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;line %d: checker error, no such node `%s&#39; found &quot;</span>
<a name="l00971"></a>00971                           <span class="stringliteral">&quot;as referenced by `%s:%s&#39;\n&quot;</span>, def-&gt;line, node, def-&gt;type,
<a name="l00972"></a>00972                           def-&gt;instance);
<a name="l00973"></a>00973                 errors++;
<a name="l00974"></a>00974             }
<a name="l00975"></a>00975             <span class="keywordflow">if</span> (<a class="code" href="check__netlist_8cpp.html#a1378d10cb2805ce77a6d0595d1698bd6">checker_count_nodesets</a> (root, node) &gt; 1)
<a name="l00976"></a>00976             {
<a name="l00977"></a>00977                 <a class="code" href="logging_8c.html#abe06a8732a47a291606edcfac5e5146e">logprint</a> (<a class="code" href="logging_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;line %d: checker error, the node `%s&#39; is not &quot;</span>
<a name="l00978"></a>00978                           <span class="stringliteral">&quot;uniquely defined by `%s:%s&#39;\n&quot;</span>, def-&gt;line, node, def-&gt;type,
<a name="l00979"></a>00979                           def-&gt;instance);
<a name="l00980"></a>00980                 errors++;
<a name="l00981"></a>00981             }
<a name="l00982"></a>00982         }
<a name="l00983"></a>00983     }
<a name="l00984"></a>00984     <span class="keywordflow">return</span> errors;
<a name="l00985"></a>00985 }
<a name="l00986"></a>00986 
<a name="l00987"></a>00987 <span class="comment">/* This function should be called after the netlist and the equation</span>
<a name="l00988"></a>00988 <span class="comment">   list have been checked.  It verifies that parameter sweep</span>
<a name="l00989"></a>00989 <span class="comment">   definitions and equation variable identifiers are unique.  The</span>
<a name="l00990"></a>00990 <span class="comment">   function returns zero on success and non-zero otherwise. */</span>
<a name="l00991"></a><a class="code" href="check__netlist_8cpp.html#a57dbb67062b58979e3e5aa0e43138a54">00991</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="check__netlist_8cpp.html#a57dbb67062b58979e3e5aa0e43138a54">netlist_checker_variables_intern</a> (<span class="keyword">struct</span> <a class="code" href="structdefinition__t.html">definition_t</a> * root,
<a name="l00992"></a>00992         environment * env)
<a name="l00993"></a>00993 {
<a name="l00994"></a>00994     <span class="keywordtype">int</span> errors = 0, pos;
<a name="l00995"></a>00995     <span class="keyword">struct </span><a class="code" href="structvalue__t.html">value_t</a> * para, * ref;
<a name="l00996"></a>00996     strlist * eqnvars = env-&gt;getChecker()-&gt;variables ();
<a name="l00997"></a>00997     strlist * instances = <span class="keyword">new</span> strlist ();
<a name="l00998"></a>00998     strlist * vars = <span class="keyword">new</span> strlist ();
<a name="l00999"></a>00999     strlist * refs = <span class="keyword">new</span> strlist ();
<a name="l01000"></a>01000     <span class="comment">// go through list of netlist definitions</span>
<a name="l01001"></a>01001     <span class="keywordflow">for</span> (<span class="keyword">struct</span> <a class="code" href="structdefinition__t.html">definition_t</a> * def = root; def != NULL; def = def-&gt;<a class="code" href="structdefinition__t.html#ac6f2d42a0105ff6e699938fcd36bd12b">next</a>)
<a name="l01002"></a>01002     {
<a name="l01003"></a>01003         <span class="comment">// find parameters sweeps</span>
<a name="l01004"></a>01004         <span class="keywordflow">if</span> (def-&gt;action == 1 &amp;&amp; !strcmp (def-&gt;type, <span class="stringliteral">&quot;SW&quot;</span>))
<a name="l01005"></a>01005         {
<a name="l01006"></a>01006             para = <a class="code" href="check__netlist_8cpp.html#ad9167af3b9466ee85d15c808f41741c5">checker_find_reference</a> (def, <span class="stringliteral">&quot;Param&quot;</span>);
<a name="l01007"></a>01007             ref = <a class="code" href="check__netlist_8cpp.html#ad9167af3b9466ee85d15c808f41741c5">checker_find_reference</a> (def, <span class="stringliteral">&quot;Sim&quot;</span>);
<a name="l01008"></a>01008             <span class="keywordflow">if</span> (para != NULL &amp;&amp; ref != NULL)
<a name="l01009"></a>01009             {
<a name="l01010"></a>01010                 <span class="comment">// check whether sweep variable collides with equations</span>
<a name="l01011"></a>01011                 <span class="keywordflow">if</span> (eqnvars &amp;&amp; eqnvars-&gt;contains (para-&gt;<a class="code" href="structvalue__t.html#ad442091764df35b6ff5dbfd7f5bd965b">ident</a>))
<a name="l01012"></a>01012                 {
<a name="l01013"></a>01013                     <a class="code" href="logging_8c.html#abe06a8732a47a291606edcfac5e5146e">logprint</a> (<a class="code" href="logging_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;checker error, equation variable `%s&#39; &quot;</span>
<a name="l01014"></a>01014                               <span class="stringliteral">&quot;already defined by `%s:%s&#39;\n&quot;</span>, para-&gt;<a class="code" href="structvalue__t.html#ad442091764df35b6ff5dbfd7f5bd965b">ident</a>,
<a name="l01015"></a>01015                               def-&gt;type, def-&gt;instance);
<a name="l01016"></a>01016                     errors++;
<a name="l01017"></a>01017                 }
<a name="l01018"></a>01018                 <span class="comment">// check for duplicate parameter names in parameter sweeps, but</span>
<a name="l01019"></a>01019                 <span class="comment">// allow them in same order sweeps</span>
<a name="l01020"></a>01020                 <span class="keywordflow">if</span> ((pos = vars-&gt;index (para-&gt;<a class="code" href="structvalue__t.html#ad442091764df35b6ff5dbfd7f5bd965b">ident</a>)) != -1)
<a name="l01021"></a>01021                 {
<a name="l01022"></a>01022                     <span class="keywordflow">if</span> (strcmp (ref-&gt;<a class="code" href="structvalue__t.html#ad442091764df35b6ff5dbfd7f5bd965b">ident</a>, refs-&gt;get (pos)))
<a name="l01023"></a>01023                     {
<a name="l01024"></a>01024                         <a class="code" href="logging_8c.html#abe06a8732a47a291606edcfac5e5146e">logprint</a> (<a class="code" href="logging_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;checker error, variable `%s&#39; in `%s:%s&#39; &quot;</span>
<a name="l01025"></a>01025                                   <span class="stringliteral">&quot;already defined by `%s:%s&#39;\n&quot;</span>, para-&gt;<a class="code" href="structvalue__t.html#ad442091764df35b6ff5dbfd7f5bd965b">ident</a>, def-&gt;type,
<a name="l01026"></a>01026                                   def-&gt;instance, def-&gt;type, instances-&gt;get (pos));
<a name="l01027"></a>01027                         errors++;
<a name="l01028"></a>01028                     }
<a name="l01029"></a>01029                 }
<a name="l01030"></a>01030                 <span class="comment">// check for duplicate simulations in parameter sweeps (same order</span>
<a name="l01031"></a>01031                 <span class="comment">// sweep) and allow same parameter name only</span>
<a name="l01032"></a>01032                 <span class="keywordflow">if</span> ((pos = refs-&gt;index (ref-&gt;<a class="code" href="structvalue__t.html#ad442091764df35b6ff5dbfd7f5bd965b">ident</a>)) != -1)
<a name="l01033"></a>01033                 {
<a name="l01034"></a>01034                     <span class="keywordflow">if</span> (strcmp (para-&gt;<a class="code" href="structvalue__t.html#ad442091764df35b6ff5dbfd7f5bd965b">ident</a>, vars-&gt;get (pos)))
<a name="l01035"></a>01035                     {
<a name="l01036"></a>01036                         <a class="code" href="logging_8c.html#abe06a8732a47a291606edcfac5e5146e">logprint</a> (<a class="code" href="logging_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;checker error, conflicting variables `%s&#39; &quot;</span>
<a name="l01037"></a>01037                                   <span class="stringliteral">&quot;in `%s:%s&#39; and `%s&#39; in `%s:%s&#39; for `%s&#39;\n&quot;</span>,
<a name="l01038"></a>01038                                   para-&gt;<a class="code" href="structvalue__t.html#ad442091764df35b6ff5dbfd7f5bd965b">ident</a>, def-&gt;type, def-&gt;instance,
<a name="l01039"></a>01039                                   vars-&gt;get (pos), def-&gt;type, instances-&gt;get (pos),
<a name="l01040"></a>01040                                   ref-&gt;<a class="code" href="structvalue__t.html#ad442091764df35b6ff5dbfd7f5bd965b">ident</a>);
<a name="l01041"></a>01041                         errors++;
<a name="l01042"></a>01042                     }
<a name="l01043"></a>01043                 }
<a name="l01044"></a>01044                 <span class="comment">// collect parameter sweep variables for the above two checks</span>
<a name="l01045"></a>01045                 instances-&gt;add (def-&gt;instance);
<a name="l01046"></a>01046                 vars-&gt;add (para-&gt;<a class="code" href="structvalue__t.html#ad442091764df35b6ff5dbfd7f5bd965b">ident</a>);
<a name="l01047"></a>01047                 refs-&gt;add (ref-&gt;<a class="code" href="structvalue__t.html#ad442091764df35b6ff5dbfd7f5bd965b">ident</a>);
<a name="l01048"></a>01048             }
<a name="l01049"></a>01049         }
<a name="l01050"></a>01050     }
<a name="l01051"></a>01051     <span class="keyword">delete</span> eqnvars;
<a name="l01052"></a>01052     <span class="keyword">delete</span> refs;
<a name="l01053"></a>01053     <span class="keyword">delete</span> vars;
<a name="l01054"></a>01054     <span class="keyword">delete</span> instances;
<a name="l01055"></a>01055     <span class="keywordflow">return</span> errors;
<a name="l01056"></a>01056 }
<a name="l01057"></a>01057 
<a name="l01058"></a>01058 <span class="comment">/* This is the overall variable checker for the parsed netlist.  See</span>
<a name="l01059"></a>01059 <span class="comment">   the above function for details. */</span>
<a name="l01060"></a><a class="code" href="check__netlist_8cpp.html#a019e9e6e06e848396d24f6631fb29e4e">01060</a> <span class="keywordtype">int</span> <a class="code" href="check__netlist_8cpp.html#a019e9e6e06e848396d24f6631fb29e4e">netlist_checker_variables</a> (environment * env)
<a name="l01061"></a>01061 {
<a name="l01062"></a>01062     <span class="keywordflow">return</span> <a class="code" href="check__netlist_8cpp.html#a57dbb67062b58979e3e5aa0e43138a54">netlist_checker_variables_intern</a> (<a class="code" href="check__netlist_8cpp.html#a743ab6f836d53fd6b166066585882b8c">definition_root</a>, env);
<a name="l01063"></a>01063 }
<a name="l01064"></a>01064 
<a name="l01065"></a>01065 <span class="comment">/* The function checks whether the given key-value combination is</span>
<a name="l01066"></a>01066 <span class="comment">   inside the allowed range defined by the given property definition</span>
<a name="l01067"></a>01067 <span class="comment">   and returns the number of error or zero otherwise. */</span>
<a name="l01068"></a><a class="code" href="check__netlist_8cpp.html#a7e176cbdb52b4c42ee517d80bcf7e9c1">01068</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="check__netlist_8cpp.html#a7e176cbdb52b4c42ee517d80bcf7e9c1">checker_value_in_prop_range</a> (<span class="keywordtype">char</span> * <a class="code" href="parse__netlist_8y.html#a5ffaf17e178b3a6fa2012fe3050ede22">instance</a>, <span class="keyword">struct</span> <a class="code" href="structdefine__t.html">define_t</a> * def,
<a name="l01069"></a>01069                                         <span class="keyword">struct</span> <a class="code" href="structpair__t.html">pair_t</a> * pp,
<a name="l01070"></a>01070                                         <span class="keyword">struct</span> <a class="code" href="structproperty__t.html">property_t</a> * prop)
<a name="l01071"></a>01071 {
<a name="l01072"></a>01072     <span class="keywordtype">int</span> errors = 0;
<a name="l01073"></a>01073     <span class="comment">// check values</span>
<a name="l01074"></a>01074     <span class="keywordflow">if</span> (<a class="code" href="netdefs_8h.html#aa0789bbfc8218667db962b8c0ec9bb3d">PROP_IS_VAL</a> (*prop))
<a name="l01075"></a>01075     {
<a name="l01076"></a>01076         <span class="keywordflow">if</span> (!<a class="code" href="netdefs_8h.html#afd72541dd4708ac6a7167004b9c157dd">PROP_IS_LST</a> (*prop))
<a name="l01077"></a>01077         {
<a name="l01078"></a>01078             <span class="comment">// lists of values possible?</span>
<a name="l01079"></a>01079             <span class="keywordflow">if</span> (pp-&gt;<a class="code" href="structpair__t.html#a4971c332851244bac4916d04e6db3b7c">value</a>-&gt;<a class="code" href="structvalue__t.html#a51b2a2d3d5919849306c784f6271492c">next</a> != NULL)
<a name="l01080"></a>01080             {
<a name="l01081"></a>01081                 <a class="code" href="logging_8c.html#abe06a8732a47a291606edcfac5e5146e">logprint</a> (<a class="code" href="logging_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>,
<a name="l01082"></a>01082                           <span class="stringliteral">&quot;checker error, value of `%s&#39; needs to be &quot;</span>
<a name="l01083"></a>01083                           <span class="stringliteral">&quot;a single value in `%s:%s&#39;, no lists possible\n&quot;</span>,
<a name="l01084"></a>01084                           pp-&gt;<a class="code" href="structpair__t.html#a528541470063ea3e6ef340122e6f946a">key</a>, def-&gt;<a class="code" href="structdefine__t.html#ab76187b8a25a53f4afd953a66162280c">type</a>, instance);
<a name="l01085"></a>01085                 errors++;
<a name="l01086"></a>01086             }
<a name="l01087"></a>01087         }
<a name="l01088"></a>01088         <span class="keywordflow">else</span>
<a name="l01089"></a>01089         {
<a name="l01090"></a>01090             <span class="comment">// a value list</span>
<a name="l01091"></a>01091             <span class="keyword">struct </span><a class="code" href="structvalue__t.html">value_t</a> * val = pp-&gt;<a class="code" href="structpair__t.html#a4971c332851244bac4916d04e6db3b7c">value</a>;
<a name="l01092"></a>01092             val-&gt;<a class="code" href="structvalue__t.html#a73164dc97373afce1086bc970da5d211">var</a> = <a class="code" href="namespacequcs_1_1eqn.html#a6d6a4e1bab3f5e23f5d898059f98c134a22e4d6b45b88b80f7d3ef518f52f5546">TAG_VECTOR</a>;
<a name="l01093"></a>01093             <span class="comment">// check and evaluate the unit scale in a value list</span>
<a name="l01094"></a>01094             <span class="keywordflow">for</span> (; val != NULL; val = val-&gt;<a class="code" href="structvalue__t.html#a51b2a2d3d5919849306c784f6271492c">next</a>)
<a name="l01095"></a>01095             {
<a name="l01096"></a>01096                 <span class="keywordflow">if</span> (!<a class="code" href="check__netlist_8cpp.html#a37c6b4e02257688a7b7980cad8797c05">checker_evaluate_scale</a> (val))
<a name="l01097"></a>01097                     errors++;
<a name="l01098"></a>01098             }
<a name="l01099"></a>01099         }
<a name="l01100"></a>01100         <span class="comment">// check range of all values</span>
<a name="l01101"></a>01101         <span class="keywordflow">if</span> (<a class="code" href="netdefs_8h.html#ac079291acbeeede2834f67ecb61d27a4">PROP_HAS_RANGE</a> (*prop))
<a name="l01102"></a>01102         {
<a name="l01103"></a>01103             <span class="keyword">struct </span><a class="code" href="structvalue__t.html">value_t</a> * val = pp-&gt;<a class="code" href="structpair__t.html#a4971c332851244bac4916d04e6db3b7c">value</a>;
<a name="l01104"></a>01104             <span class="keywordflow">if</span> (val-&gt;<a class="code" href="structvalue__t.html#ad442091764df35b6ff5dbfd7f5bd965b">ident</a>)
<a name="l01105"></a>01105             {
<a name="l01106"></a>01106                 <span class="comment">/* no range checking on variable identifier */</span>
<a name="l01107"></a>01107                 <a class="code" href="logging_8c.html#abe06a8732a47a291606edcfac5e5146e">logprint</a> (<a class="code" href="logging_8h.html#a9b52156aa5746cc612e2e3edea6d5dbd">LOG_STATUS</a>,
<a name="l01108"></a>01108                           <span class="stringliteral">&quot;checker notice, value of `%s&#39; (variable `%s&#39;) could be &quot;</span>
<a name="l01109"></a>01109                           <span class="stringliteral">&quot;out of range `%c%g,%g%c&#39; in `%s:%s&#39;\n&quot;</span>,
<a name="l01110"></a>01110                           pp-&gt;<a class="code" href="structpair__t.html#a528541470063ea3e6ef340122e6f946a">key</a>, val-&gt;<a class="code" href="structvalue__t.html#ad442091764df35b6ff5dbfd7f5bd965b">ident</a>, prop-&gt;<a class="code" href="structproperty__t.html#abe8c9e81a5036137fb9860f3bd6ef96e">range</a>.<a class="code" href="structproperty__t.html#a22d6417d8ee5b9a026dde817108cfb52">il</a>, prop-&gt;<a class="code" href="structproperty__t.html#abe8c9e81a5036137fb9860f3bd6ef96e">range</a>.<a class="code" href="structproperty__t.html#a1c580e017f0d37edf28802105c81789a">l</a>,
<a name="l01111"></a>01111                           prop-&gt;<a class="code" href="structproperty__t.html#abe8c9e81a5036137fb9860f3bd6ef96e">range</a>.<a class="code" href="structproperty__t.html#a44805795790f692948ba7c4d9902cd35">h</a>, prop-&gt;<a class="code" href="structproperty__t.html#abe8c9e81a5036137fb9860f3bd6ef96e">range</a>.<a class="code" href="structproperty__t.html#ae8f4babff6f6ec9901e5c16846e41ed1">ih</a>, def-&gt;<a class="code" href="structdefine__t.html#ab76187b8a25a53f4afd953a66162280c">type</a>, instance);
<a name="l01112"></a>01112                 val = NULL;
<a name="l01113"></a>01113             }
<a name="l01114"></a>01114             <span class="keywordflow">for</span> (; val != NULL; val = val-&gt;<a class="code" href="structvalue__t.html#a51b2a2d3d5919849306c784f6271492c">next</a>)
<a name="l01115"></a>01115             {
<a name="l01116"></a>01116                 <span class="keywordtype">int</span> rerror = 0;
<a name="l01117"></a>01117                 <span class="keywordflow">if</span> (prop-&gt;<a class="code" href="structproperty__t.html#abe8c9e81a5036137fb9860f3bd6ef96e">range</a>.<a class="code" href="structproperty__t.html#a22d6417d8ee5b9a026dde817108cfb52">il</a> == <span class="charliteral">&#39;[&#39;</span> &amp;&amp;  (val-&gt;<a class="code" href="structvalue__t.html#a00344d940adac2e92047e60efde51a36">value</a> &lt; prop-&gt;<a class="code" href="structproperty__t.html#abe8c9e81a5036137fb9860f3bd6ef96e">range</a>.<a class="code" href="structproperty__t.html#a1c580e017f0d37edf28802105c81789a">l</a>))
<a name="l01118"></a>01118                     rerror++;
<a name="l01119"></a>01119                 <span class="keywordflow">if</span> (prop-&gt;<a class="code" href="structproperty__t.html#abe8c9e81a5036137fb9860f3bd6ef96e">range</a>.<a class="code" href="structproperty__t.html#a22d6417d8ee5b9a026dde817108cfb52">il</a> == <span class="charliteral">&#39;]&#39;</span> &amp;&amp; !(val-&gt;<a class="code" href="structvalue__t.html#a00344d940adac2e92047e60efde51a36">value</a> &gt; prop-&gt;<a class="code" href="structproperty__t.html#abe8c9e81a5036137fb9860f3bd6ef96e">range</a>.<a class="code" href="structproperty__t.html#a1c580e017f0d37edf28802105c81789a">l</a>))
<a name="l01120"></a>01120                     rerror++;
<a name="l01121"></a>01121                 <span class="keywordflow">if</span> (prop-&gt;<a class="code" href="structproperty__t.html#abe8c9e81a5036137fb9860f3bd6ef96e">range</a>.<a class="code" href="structproperty__t.html#ae8f4babff6f6ec9901e5c16846e41ed1">ih</a> == <span class="charliteral">&#39;[&#39;</span> &amp;&amp; !(val-&gt;<a class="code" href="structvalue__t.html#a00344d940adac2e92047e60efde51a36">value</a> &lt; prop-&gt;<a class="code" href="structproperty__t.html#abe8c9e81a5036137fb9860f3bd6ef96e">range</a>.<a class="code" href="structproperty__t.html#a44805795790f692948ba7c4d9902cd35">h</a>))
<a name="l01122"></a>01122                     rerror++;
<a name="l01123"></a>01123                 <span class="keywordflow">if</span> (prop-&gt;<a class="code" href="structproperty__t.html#abe8c9e81a5036137fb9860f3bd6ef96e">range</a>.<a class="code" href="structproperty__t.html#ae8f4babff6f6ec9901e5c16846e41ed1">ih</a> == <span class="charliteral">&#39;]&#39;</span> &amp;&amp;  (val-&gt;<a class="code" href="structvalue__t.html#a00344d940adac2e92047e60efde51a36">value</a> &gt; prop-&gt;<a class="code" href="structproperty__t.html#abe8c9e81a5036137fb9860f3bd6ef96e">range</a>.<a class="code" href="structproperty__t.html#a44805795790f692948ba7c4d9902cd35">h</a>))
<a name="l01124"></a>01124                     rerror++;
<a name="l01125"></a>01125                 <span class="keywordflow">if</span> (rerror)
<a name="l01126"></a>01126                 {
<a name="l01127"></a>01127                     <a class="code" href="logging_8c.html#abe06a8732a47a291606edcfac5e5146e">logprint</a> (<a class="code" href="logging_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>,
<a name="l01128"></a>01128                               <span class="stringliteral">&quot;checker error, value of `%s&#39; (%g) is out of &quot;</span>
<a name="l01129"></a>01129                               <span class="stringliteral">&quot;range `%c%g,%g%c&#39; in `%s:%s&#39;\n&quot;</span>,
<a name="l01130"></a>01130                               pp-&gt;<a class="code" href="structpair__t.html#a528541470063ea3e6ef340122e6f946a">key</a>, val-&gt;<a class="code" href="structvalue__t.html#a00344d940adac2e92047e60efde51a36">value</a>, prop-&gt;<a class="code" href="structproperty__t.html#abe8c9e81a5036137fb9860f3bd6ef96e">range</a>.<a class="code" href="structproperty__t.html#a22d6417d8ee5b9a026dde817108cfb52">il</a>, prop-&gt;<a class="code" href="structproperty__t.html#abe8c9e81a5036137fb9860f3bd6ef96e">range</a>.<a class="code" href="structproperty__t.html#a1c580e017f0d37edf28802105c81789a">l</a>,
<a name="l01131"></a>01131                               prop-&gt;<a class="code" href="structproperty__t.html#abe8c9e81a5036137fb9860f3bd6ef96e">range</a>.<a class="code" href="structproperty__t.html#a44805795790f692948ba7c4d9902cd35">h</a>, prop-&gt;<a class="code" href="structproperty__t.html#abe8c9e81a5036137fb9860f3bd6ef96e">range</a>.<a class="code" href="structproperty__t.html#ae8f4babff6f6ec9901e5c16846e41ed1">ih</a>, def-&gt;<a class="code" href="structdefine__t.html#ab76187b8a25a53f4afd953a66162280c">type</a>, instance);
<a name="l01132"></a>01132                     errors++;
<a name="l01133"></a>01133                 }
<a name="l01134"></a>01134             }
<a name="l01135"></a>01135         }
<a name="l01136"></a>01136         <span class="comment">// check fraction of integers</span>
<a name="l01137"></a>01137         <span class="keywordflow">if</span> (<a class="code" href="netdefs_8h.html#ab4f105338be7a92ed98477481662f68c">PROP_IS_INT</a> (*prop))
<a name="l01138"></a>01138         {
<a name="l01139"></a>01139             <span class="keywordtype">double</span> integral;
<a name="l01140"></a>01140             <span class="keywordflow">if</span> (modf (pp-&gt;<a class="code" href="structpair__t.html#a4971c332851244bac4916d04e6db3b7c">value</a>-&gt;<a class="code" href="structvalue__t.html#a00344d940adac2e92047e60efde51a36">value</a>, &amp;integral) != 0)
<a name="l01141"></a>01141             {
<a name="l01142"></a>01142                 <a class="code" href="logging_8c.html#abe06a8732a47a291606edcfac5e5146e">logprint</a> (<a class="code" href="logging_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>,
<a name="l01143"></a>01143                           <span class="stringliteral">&quot;checker error, value of `%s&#39; (%g) needs to be &quot;</span>
<a name="l01144"></a>01144                           <span class="stringliteral">&quot;an integer in `%s:%s&#39;\n&quot;</span>,
<a name="l01145"></a>01145                           pp-&gt;<a class="code" href="structpair__t.html#a528541470063ea3e6ef340122e6f946a">key</a>, pp-&gt;<a class="code" href="structpair__t.html#a4971c332851244bac4916d04e6db3b7c">value</a>-&gt;<a class="code" href="structvalue__t.html#a00344d940adac2e92047e60efde51a36">value</a>, def-&gt;<a class="code" href="structdefine__t.html#ab76187b8a25a53f4afd953a66162280c">type</a>, instance);
<a name="l01146"></a>01146                 errors++;
<a name="l01147"></a>01147             }
<a name="l01148"></a>01148         }
<a name="l01149"></a>01149     }
<a name="l01150"></a>01150     <span class="comment">// check identifiers</span>
<a name="l01151"></a>01151     <span class="keywordflow">else</span>
<a name="l01152"></a>01152     {
<a name="l01153"></a>01153         <span class="comment">// no identifier given</span>
<a name="l01154"></a>01154         <span class="keywordflow">if</span> (pp-&gt;<a class="code" href="structpair__t.html#a4971c332851244bac4916d04e6db3b7c">value</a>-&gt;<a class="code" href="structvalue__t.html#ad442091764df35b6ff5dbfd7f5bd965b">ident</a> == NULL)
<a name="l01155"></a>01155         {
<a name="l01156"></a>01156             <a class="code" href="logging_8c.html#abe06a8732a47a291606edcfac5e5146e">logprint</a> (<a class="code" href="logging_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>,
<a name="l01157"></a>01157                       <span class="stringliteral">&quot;checker error, value of `%s&#39; (%g) needs to be &quot;</span>
<a name="l01158"></a>01158                       <span class="stringliteral">&quot;an identifier in `%s:%s&#39;\n&quot;</span>,
<a name="l01159"></a>01159                       pp-&gt;<a class="code" href="structpair__t.html#a528541470063ea3e6ef340122e6f946a">key</a>, pp-&gt;<a class="code" href="structpair__t.html#a4971c332851244bac4916d04e6db3b7c">value</a>-&gt;<a class="code" href="structvalue__t.html#a00344d940adac2e92047e60efde51a36">value</a>, def-&gt;<a class="code" href="structdefine__t.html#ab76187b8a25a53f4afd953a66162280c">type</a>, instance);
<a name="l01160"></a>01160             errors++;
<a name="l01161"></a>01161         }
<a name="l01162"></a>01162         <span class="comment">// check identifier range</span>
<a name="l01163"></a>01163         <span class="keywordflow">else</span>
<a name="l01164"></a>01164         {
<a name="l01165"></a>01165             <span class="keywordflow">if</span> (<a class="code" href="netdefs_8h.html#acc9a6cc01bf26c6b317be7ec113586ef">PROP_HAS_STR</a> (*prop))
<a name="l01166"></a>01166             {
<a name="l01167"></a>01167                 <span class="keywordtype">int</span> <a class="code" href="parse__mdl_8y.html#a7e98b8a17c0aad30ba64d47b74e2a6c1">i</a>, found = 0;
<a name="l01168"></a>01168                 <span class="keywordtype">char</span> <a class="code" href="parse__vcd_8y.html#a5a95c5aa27dc12b07af34405942b7849">range</a>[256];
<a name="l01169"></a>01169                 sprintf (range, <span class="stringliteral">&quot;[&quot;</span>);
<a name="l01170"></a>01170                 <span class="keywordflow">for</span> (i = 0; prop-&gt;<a class="code" href="structproperty__t.html#abe8c9e81a5036137fb9860f3bd6ef96e">range</a>.<a class="code" href="structproperty__t.html#a44e33446081f319d32c0c79c823feeea">str</a>[<a class="code" href="parse__mdl_8y.html#a7e98b8a17c0aad30ba64d47b74e2a6c1">i</a>]; i++)
<a name="l01171"></a>01171                 {
<a name="l01172"></a>01172                     strcat (range, prop-&gt;<a class="code" href="structproperty__t.html#abe8c9e81a5036137fb9860f3bd6ef96e">range</a>.<a class="code" href="structproperty__t.html#a44e33446081f319d32c0c79c823feeea">str</a>[i]);
<a name="l01173"></a>01173                     strcat (range, <span class="stringliteral">&quot;,&quot;</span>);
<a name="l01174"></a>01174                     <span class="keywordflow">if</span> (!strcmp (prop-&gt;<a class="code" href="structproperty__t.html#abe8c9e81a5036137fb9860f3bd6ef96e">range</a>.<a class="code" href="structproperty__t.html#a44e33446081f319d32c0c79c823feeea">str</a>[i], pp-&gt;<a class="code" href="structpair__t.html#a4971c332851244bac4916d04e6db3b7c">value</a>-&gt;<a class="code" href="structvalue__t.html#ad442091764df35b6ff5dbfd7f5bd965b">ident</a>)) found++;
<a name="l01175"></a>01175                 }
<a name="l01176"></a>01176                 <span class="keywordflow">if</span> (!found)
<a name="l01177"></a>01177                 {
<a name="l01178"></a>01178                     range[strlen (range) - 1] = <span class="charliteral">&#39;]&#39;</span>;
<a name="l01179"></a>01179                     <a class="code" href="logging_8c.html#abe06a8732a47a291606edcfac5e5146e">logprint</a> (<a class="code" href="logging_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>,
<a name="l01180"></a>01180                               <span class="stringliteral">&quot;checker error, value of `%s&#39; (%s) needs to be &quot;</span>
<a name="l01181"></a>01181                               <span class="stringliteral">&quot;in %s in `%s:%s&#39;\n&quot;</span>,
<a name="l01182"></a>01182                               pp-&gt;<a class="code" href="structpair__t.html#a528541470063ea3e6ef340122e6f946a">key</a>, pp-&gt;<a class="code" href="structpair__t.html#a4971c332851244bac4916d04e6db3b7c">value</a>-&gt;<a class="code" href="structvalue__t.html#ad442091764df35b6ff5dbfd7f5bd965b">ident</a>, range, def-&gt;<a class="code" href="structdefine__t.html#ab76187b8a25a53f4afd953a66162280c">type</a>, instance);
<a name="l01183"></a>01183                     errors++;
<a name="l01184"></a>01184                 }
<a name="l01185"></a>01185                 <span class="keywordflow">else</span> pp-&gt;<a class="code" href="structpair__t.html#a4971c332851244bac4916d04e6db3b7c">value</a>-&gt;<a class="code" href="structvalue__t.html#a7f2c579b786f94e080025f18d16dc461">range</a> = 1;
<a name="l01186"></a>01186             }
<a name="l01187"></a>01187         }
<a name="l01188"></a>01188     }
<a name="l01189"></a>01189     <span class="keywordflow">return</span> errors;
<a name="l01190"></a>01190 }
<a name="l01191"></a>01191 
<a name="l01192"></a>01192 <span class="comment">/* The function checks whether the given key-value combination being</span>
<a name="l01193"></a>01193 <span class="comment">   part of the available definition is inside the allowed range and</span>
<a name="l01194"></a>01194 <span class="comment">   returns zero if not.  Otherwise the function returns non-zero. */</span>
<a name="l01195"></a><a class="code" href="check__netlist_8cpp.html#a919120f7ef70259edacea578b802ef03">01195</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="check__netlist_8cpp.html#a919120f7ef70259edacea578b802ef03">checker_value_in_range</a> (<span class="keywordtype">char</span> * <a class="code" href="parse__netlist_8y.html#a5ffaf17e178b3a6fa2012fe3050ede22">instance</a>, <span class="keyword">struct</span> <a class="code" href="structdefine__t.html">define_t</a> * def,
<a name="l01196"></a>01196                                    <span class="keyword">struct</span> <a class="code" href="structpair__t.html">pair_t</a> * pp)
<a name="l01197"></a>01197 {
<a name="l01198"></a>01198     <span class="keywordtype">int</span> <a class="code" href="parse__mdl_8y.html#a7e98b8a17c0aad30ba64d47b74e2a6c1">i</a>, errors = 0;
<a name="l01199"></a>01199     <span class="comment">// go through required properties</span>
<a name="l01200"></a>01200     <span class="keywordflow">for</span> (i = 0; <a class="code" href="netdefs_8h.html#a415e94a0e012e5307675d9f9bd98251a">PROP_IS_PROP</a> (def-&gt;<a class="code" href="structdefine__t.html#a22221cc9f714cf2989f88178f49d8cd4">required</a>[i]); i++)
<a name="l01201"></a>01201     {
<a name="l01202"></a>01202         <span class="keywordflow">if</span> (!strcmp (def-&gt;<a class="code" href="structdefine__t.html#a22221cc9f714cf2989f88178f49d8cd4">required</a>[i].<a class="code" href="structproperty__t.html#ae0177f56720b1a0e3f212878887faa94">key</a>, pp-&gt;<a class="code" href="structpair__t.html#a528541470063ea3e6ef340122e6f946a">key</a>))
<a name="l01203"></a>01203         {
<a name="l01204"></a>01204             errors += <a class="code" href="check__netlist_8cpp.html#a7e176cbdb52b4c42ee517d80bcf7e9c1">checker_value_in_prop_range</a> (instance, def, pp,
<a name="l01205"></a>01205                                                    &amp;def-&gt;<a class="code" href="structdefine__t.html#a22221cc9f714cf2989f88178f49d8cd4">required</a>[i]);
<a name="l01206"></a>01206         }
<a name="l01207"></a>01207     }
<a name="l01208"></a>01208     <span class="comment">// go through optional properties</span>
<a name="l01209"></a>01209     <span class="keywordflow">for</span> (i = 0; <a class="code" href="netdefs_8h.html#a415e94a0e012e5307675d9f9bd98251a">PROP_IS_PROP</a> (def-&gt;<a class="code" href="structdefine__t.html#a7641b0acfd3b1744e70cdfc20d7802bd">optional</a>[i]); i++)
<a name="l01210"></a>01210     {
<a name="l01211"></a>01211         <span class="keywordflow">if</span> (!strcmp (def-&gt;<a class="code" href="structdefine__t.html#a7641b0acfd3b1744e70cdfc20d7802bd">optional</a>[i].<a class="code" href="structproperty__t.html#ae0177f56720b1a0e3f212878887faa94">key</a>, pp-&gt;<a class="code" href="structpair__t.html#a528541470063ea3e6ef340122e6f946a">key</a>))
<a name="l01212"></a>01212         {
<a name="l01213"></a>01213             errors += <a class="code" href="check__netlist_8cpp.html#a7e176cbdb52b4c42ee517d80bcf7e9c1">checker_value_in_prop_range</a> (instance, def, pp,
<a name="l01214"></a>01214                                                    &amp;def-&gt;<a class="code" href="structdefine__t.html#a7641b0acfd3b1744e70cdfc20d7802bd">optional</a>[i]);
<a name="l01215"></a>01215         }
<a name="l01216"></a>01216     }
<a name="l01217"></a>01217     <span class="keywordflow">return</span> errors ? 0 : 1;
<a name="l01218"></a>01218 }
<a name="l01219"></a>01219 
<a name="l01220"></a>01220 <span class="comment">/* The function determines the subcircuit definitions defined in the</span>
<a name="l01221"></a>01221 <span class="comment">   original netlist and builds an appropriate subcircuit definition</span>
<a name="l01222"></a>01222 <span class="comment">   list.  It returns the given definition list with the subcircuits</span>
<a name="l01223"></a>01223 <span class="comment">   removed. */</span>
<a name="l01224"></a>01224 <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structdefinition__t.html">definition_t</a> *
<a name="l01225"></a><a class="code" href="check__netlist_8cpp.html#a1da36b88f193c9e93c04e7bdd25a3ad5">01225</a> <a class="code" href="check__netlist_8cpp.html#a1da36b88f193c9e93c04e7bdd25a3ad5">checker_build_subcircuits</a> (<span class="keyword">struct</span> <a class="code" href="structdefinition__t.html">definition_t</a> * root)
<a name="l01226"></a>01226 {
<a name="l01227"></a>01227     <span class="keyword">struct </span><a class="code" href="structdefinition__t.html">definition_t</a> * def, * <a class="code" href="parse__spice_8y.html#acde7555eca71d1f823fbaf6f6a1f4670">next</a>, * prev;
<a name="l01228"></a>01228     <span class="keywordflow">for</span> (prev = NULL, def = root; def != NULL; def = <a class="code" href="parse__spice_8y.html#acde7555eca71d1f823fbaf6f6a1f4670">next</a>)
<a name="l01229"></a>01229     {
<a name="l01230"></a>01230         next = def-&gt;<a class="code" href="structdefinition__t.html#ac6f2d42a0105ff6e699938fcd36bd12b">next</a>;
<a name="l01231"></a>01231         <span class="keywordflow">if</span> (!strcmp (def-&gt;<a class="code" href="structdefinition__t.html#adbc03f56abf1631614d1cc4946961300">type</a>, <span class="stringliteral">&quot;Def&quot;</span>))
<a name="l01232"></a>01232         {
<a name="l01233"></a>01233             <span class="keywordflow">if</span> (prev)
<a name="l01234"></a>01234             {
<a name="l01235"></a>01235                 prev-&gt;<a class="code" href="structdefinition__t.html#ac6f2d42a0105ff6e699938fcd36bd12b">next</a> = <a class="code" href="parse__spice_8y.html#acde7555eca71d1f823fbaf6f6a1f4670">next</a>;
<a name="l01236"></a>01236             }
<a name="l01237"></a>01237             <span class="keywordflow">else</span>
<a name="l01238"></a>01238             {
<a name="l01239"></a>01239                 root = <a class="code" href="parse__spice_8y.html#acde7555eca71d1f823fbaf6f6a1f4670">next</a>;
<a name="l01240"></a>01240             }
<a name="l01241"></a>01241             def-&gt;<a class="code" href="structdefinition__t.html#adbac069b30fc5f0544f09e77e56fa26c">sub</a> = <a class="code" href="check__netlist_8cpp.html#a1da36b88f193c9e93c04e7bdd25a3ad5">checker_build_subcircuits</a> (def-&gt;<a class="code" href="structdefinition__t.html#adbac069b30fc5f0544f09e77e56fa26c">sub</a>);
<a name="l01242"></a>01242             def-&gt;<a class="code" href="structdefinition__t.html#ac6f2d42a0105ff6e699938fcd36bd12b">next</a> = <a class="code" href="check__netlist_8cpp.html#a8443096178b6c84a10f0da689c81ee44">subcircuit_root</a>;
<a name="l01243"></a>01243             <a class="code" href="check__netlist_8cpp.html#a8443096178b6c84a10f0da689c81ee44">subcircuit_root</a> = def;
<a name="l01244"></a>01244         }
<a name="l01245"></a>01245         <span class="keywordflow">else</span> prev = def;
<a name="l01246"></a>01246     }
<a name="l01247"></a>01247     <span class="keywordflow">return</span> root;
<a name="l01248"></a>01248 }
<a name="l01249"></a>01249 
<a name="l01250"></a>01250 <span class="comment">/* The function produces a copy of the given circuit definition and</span>
<a name="l01251"></a>01251 <span class="comment">   marks it as a copy.  The node definition are not included within</span>
<a name="l01252"></a>01252 <span class="comment">   the copy. */</span>
<a name="l01253"></a>01253 <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structdefinition__t.html">definition_t</a> *
<a name="l01254"></a><a class="code" href="check__netlist_8cpp.html#a498ad1e75818dc5cddfb3c8674f226e5">01254</a> <a class="code" href="check__netlist_8cpp.html#a498ad1e75818dc5cddfb3c8674f226e5">checker_copy_subcircuit</a> (<span class="keyword">struct</span> <a class="code" href="structdefinition__t.html">definition_t</a> * <a class="code" href="structdefinition__t.html#adbac069b30fc5f0544f09e77e56fa26c">sub</a>)
<a name="l01255"></a>01255 {
<a name="l01256"></a>01256     <span class="keyword">struct </span><a class="code" href="structdefinition__t.html">definition_t</a> * <a class="code" href="structdefinition__t.html#aa915ae9e6589a8da6ddbee95cc7306bb">copy</a>;
<a name="l01257"></a>01257     copy = (<span class="keyword">struct </span><a class="code" href="structdefinition__t.html">definition_t</a> *) calloc (<span class="keyword">sizeof</span> (<span class="keyword">struct</span> <a class="code" href="structdefinition__t.html">definition_t</a>), 1);
<a name="l01258"></a>01258     copy-&gt;<a class="code" href="structdefinition__t.html#a1416fa0ce6546e23f08ec6f578133bdb">action</a> = sub-&gt;<a class="code" href="structdefinition__t.html#a1416fa0ce6546e23f08ec6f578133bdb">action</a>;
<a name="l01259"></a>01259     copy-&gt;<a class="code" href="structdefinition__t.html#a45be771ba17644d5618c8d51760502d3">nonlinear</a> = sub-&gt;<a class="code" href="structdefinition__t.html#a45be771ba17644d5618c8d51760502d3">nonlinear</a>;
<a name="l01260"></a>01260     copy-&gt;<a class="code" href="structdefinition__t.html#a2c81e7f44a503af414eb06726423c136">substrate</a> = sub-&gt;<a class="code" href="structdefinition__t.html#a2c81e7f44a503af414eb06726423c136">substrate</a>;
<a name="l01261"></a>01261     copy-&gt;<a class="code" href="structdefinition__t.html#a8f9bd5dad355a813bfd439d00b80ec08">nodeset</a> = sub-&gt;<a class="code" href="structdefinition__t.html#a8f9bd5dad355a813bfd439d00b80ec08">nodeset</a>;
<a name="l01262"></a>01262     copy-&gt;<a class="code" href="structdefinition__t.html#a21de30d2de21345df94b44c63f1d5ffd">define</a> = sub-&gt;<a class="code" href="structdefinition__t.html#a21de30d2de21345df94b44c63f1d5ffd">define</a>;
<a name="l01263"></a>01263     copy-&gt;<a class="code" href="structdefinition__t.html#af1c52c3c0e0d2e5764a992e28084ed99">pairs</a> = sub-&gt;<a class="code" href="structdefinition__t.html#af1c52c3c0e0d2e5764a992e28084ed99">pairs</a>;
<a name="l01264"></a>01264     copy-&gt;<a class="code" href="structdefinition__t.html#a3e1b248cf06b4618817b8451a27590fd">ncount</a> = sub-&gt;<a class="code" href="structdefinition__t.html#a3e1b248cf06b4618817b8451a27590fd">ncount</a>;
<a name="l01265"></a>01265     copy-&gt;<a class="code" href="structdefinition__t.html#adbc03f56abf1631614d1cc4946961300">type</a> = strdup (sub-&gt;<a class="code" href="structdefinition__t.html#adbc03f56abf1631614d1cc4946961300">type</a>);
<a name="l01266"></a>01266     copy-&gt;<a class="code" href="structdefinition__t.html#aa915ae9e6589a8da6ddbee95cc7306bb">copy</a> = 1;
<a name="l01267"></a>01267     <span class="keywordflow">return</span> <a class="code" href="structdefinition__t.html#aa915ae9e6589a8da6ddbee95cc7306bb">copy</a>;
<a name="l01268"></a>01268 }
<a name="l01269"></a>01269 
<a name="l01270"></a>01270 <span class="comment">/* This function translates the node definitions of the given</span>
<a name="l01271"></a>01271 <span class="comment">   subcircuit element &#39;sub&#39;.  The translation is based upon the node</span>
<a name="l01272"></a>01272 <span class="comment">   definitions of the subcircuit &#39;type&#39; and the instance &#39;inst&#39; of</span>
<a name="l01273"></a>01273 <span class="comment">   such a subcircuit.  The translated nodes are saved in an extra</span>
<a name="l01274"></a>01274 <span class="comment">   &#39;xlate&#39; field of each node of the subcircuit element &#39;sub&#39;. */</span>
<a name="l01275"></a><a class="code" href="check__netlist_8cpp.html#a48e86c4c6cbe22af9faecb60b1a9bef4">01275</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="check__netlist_8cpp.html#a48e86c4c6cbe22af9faecb60b1a9bef4">checker_xlat_subcircuit_nodes</a> (<span class="keyword">struct</span> <a class="code" href="structdefinition__t.html">definition_t</a> * <a class="code" href="parse__vcd_8y.html#ae0bd5e8ec17b2aad3338041991eb1056">type</a>,
<a name="l01276"></a>01276         <span class="keyword">struct</span> <a class="code" href="structdefinition__t.html">definition_t</a> * inst,
<a name="l01277"></a>01277         <span class="keyword">struct</span> <a class="code" href="structdefinition__t.html">definition_t</a> * <a class="code" href="structdefinition__t.html#adbac069b30fc5f0544f09e77e56fa26c">sub</a>)
<a name="l01278"></a>01278 {
<a name="l01279"></a>01279     <span class="keyword">struct </span><a class="code" href="structnode__t.html">node_t</a> * <a class="code" href="parse__mdl_8y.html#aecba4cab5e52994730d1e21424997b33">n</a>, * ninst, * ntype;
<a name="l01280"></a>01280     <span class="keywordtype">int</span> <a class="code" href="parse__mdl_8y.html#a7e98b8a17c0aad30ba64d47b74e2a6c1">i</a>;
<a name="l01281"></a>01281     <span class="comment">// go through nodes of the subcircuit &#39;type&#39; and &#39;inst&#39;</span>
<a name="l01282"></a>01282     <span class="keywordflow">for</span> (i = 1, ntype = type-&gt;<a class="code" href="structdefinition__t.html#a2e38921eeafd06f6329859b847db874c">nodes</a>, ninst = inst-&gt;<a class="code" href="structdefinition__t.html#a2e38921eeafd06f6329859b847db874c">nodes</a>; ntype != NULL;
<a name="l01283"></a>01283             ntype = ntype-&gt;<a class="code" href="structnode__t.html#aca548c9bafe54ba9db19d40a7a7f1cb3">next</a>, ninst = ninst-&gt;<a class="code" href="structnode__t.html#aca548c9bafe54ba9db19d40a7a7f1cb3">next</a>, i++)
<a name="l01284"></a>01284     {
<a name="l01285"></a>01285         <span class="keywordflow">for</span> (n = sub-&gt;<a class="code" href="structdefinition__t.html#a2e38921eeafd06f6329859b847db874c">nodes</a>; n != NULL; n = n-&gt;<a class="code" href="structnode__t.html#aca548c9bafe54ba9db19d40a7a7f1cb3">next</a>)
<a name="l01286"></a>01286         {
<a name="l01287"></a>01287             <span class="comment">/* check whether a node in the subcircuit element &#39;sub&#39; corresponds</span>
<a name="l01288"></a>01288 <span class="comment">            with the &#39;type&#39;, then assign the &#39;inst&#39;s node name */</span>
<a name="l01289"></a>01289             <span class="keywordflow">if</span> (!strcmp (n-&gt;<a class="code" href="structnode__t.html#aebaf9d60a7b2db52c00204c89a20e94d">node</a>, ntype-&gt;<a class="code" href="structnode__t.html#aebaf9d60a7b2db52c00204c89a20e94d">node</a>))
<a name="l01290"></a>01290             {
<a name="l01291"></a>01291                 n-&gt;<a class="code" href="structnode__t.html#ae46bc59143574c5a24a9cfa1b9213870">xlate</a> = strdup (ninst-&gt;<a class="code" href="structnode__t.html#aebaf9d60a7b2db52c00204c89a20e94d">node</a>);
<a name="l01292"></a>01292                 n-&gt;<a class="code" href="structnode__t.html#a72cf955afe6cd6c66bc3d427598b42a3">xlatenr</a> = <a class="code" href="parse__mdl_8y.html#a7e98b8a17c0aad30ba64d47b74e2a6c1">i</a>;
<a name="l01293"></a>01293             }
<a name="l01294"></a>01294         }
<a name="l01295"></a>01295     }
<a name="l01296"></a>01296 }
<a name="l01297"></a>01297 
<a name="l01298"></a>01298 <span class="comment">/* The function creates a subcircuit node name consisting of the given</span>
<a name="l01299"></a>01299 <span class="comment">   arguments.  If the given &#39;instances&#39; is NULL it is left out.  The</span>
<a name="l01300"></a>01300 <span class="comment">   caller is responsible to free() the returned string. */</span>
<a name="l01301"></a><a class="code" href="check__netlist_8cpp.html#a644e9b8f6c70f257fc040f8dd522fbff">01301</a> <span class="keyword">static</span> <span class="keywordtype">char</span> * <a class="code" href="check__netlist_8cpp.html#a644e9b8f6c70f257fc040f8dd522fbff">checker_subcircuit_node</a> (<span class="keywordtype">char</span> * <a class="code" href="parse__vcd_8y.html#ae0bd5e8ec17b2aad3338041991eb1056">type</a>, <span class="keywordtype">char</span> * instances,
<a name="l01302"></a>01302                                        <span class="keywordtype">char</span> * <a class="code" href="parse__netlist_8y.html#a5ffaf17e178b3a6fa2012fe3050ede22">instance</a>, <span class="keywordtype">char</span> * <a class="code" href="classqucs_1_1eqn_1_1node.html">node</a>)
<a name="l01303"></a>01303 {
<a name="l01304"></a>01304     <span class="keywordtype">char</span> * txt = (<span class="keywordtype">char</span> *)
<a name="l01305"></a>01305                  calloc (1, strlen (type) + strlen (instance) + strlen (node) +
<a name="l01306"></a>01306                          (instances ? strlen (instances) : 0) + 4);
<a name="l01307"></a>01307     <span class="keywordflow">if</span> (instances)
<a name="l01308"></a>01308         sprintf (txt, <span class="stringliteral">&quot;%s.%s.%s.%s&quot;</span>, type, instances, instance, node);
<a name="l01309"></a>01309     <span class="keywordflow">else</span>
<a name="l01310"></a>01310         sprintf (txt, <span class="stringliteral">&quot;%s.%s.%s&quot;</span>, type, instance, node);
<a name="l01311"></a>01311     <span class="keywordflow">return</span> txt;
<a name="l01312"></a>01312 }
<a name="l01313"></a>01313 
<a name="l01314"></a>01314 <span class="comment">/* The function reverses the order of the given node list and returns</span>
<a name="l01315"></a>01315 <span class="comment">   the reversed list. */</span>
<a name="l01316"></a><a class="code" href="check__netlist_8cpp.html#a812d694e23fc4440162d048a381704ae">01316</a> <span class="keyword">struct </span><a class="code" href="structnode__t.html">node_t</a> * <a class="code" href="check__netlist_8cpp.html#a812d694e23fc4440162d048a381704ae">netlist_reverse_nodes</a> (<span class="keyword">struct</span> <a class="code" href="structnode__t.html">node_t</a> * <a class="code" href="parse__netlist_8y.html#a6da5270e48c8b5c2f0dbaa008af4df76">nodes</a>)
<a name="l01317"></a>01317 {
<a name="l01318"></a>01318     <span class="keyword">struct </span><a class="code" href="structnode__t.html">node_t</a> * root, * <a class="code" href="parse__spice_8y.html#acde7555eca71d1f823fbaf6f6a1f4670">next</a>;
<a name="l01319"></a>01319     <span class="keywordflow">for</span> (root = NULL; nodes != NULL; nodes = <a class="code" href="parse__spice_8y.html#acde7555eca71d1f823fbaf6f6a1f4670">next</a>)
<a name="l01320"></a>01320     {
<a name="l01321"></a>01321         next = nodes-&gt;<a class="code" href="structnode__t.html#aca548c9bafe54ba9db19d40a7a7f1cb3">next</a>;
<a name="l01322"></a>01322         nodes-&gt;<a class="code" href="structnode__t.html#aca548c9bafe54ba9db19d40a7a7f1cb3">next</a> = root;
<a name="l01323"></a>01323         root = <a class="code" href="parse__netlist_8y.html#a6da5270e48c8b5c2f0dbaa008af4df76">nodes</a>;
<a name="l01324"></a>01324     }
<a name="l01325"></a>01325     <span class="keywordflow">return</span> root;
<a name="l01326"></a>01326 }
<a name="l01327"></a>01327 
<a name="l01328"></a>01328 <span class="comment">/* This function assigns new node names to the subcircuit element</span>
<a name="l01329"></a>01329 <span class="comment">   &#39;copy&#39; based upon the previous node translation between the</span>
<a name="l01330"></a>01330 <span class="comment">   subcircuit &#39;type&#39; and the instance &#39;inst&#39; of this type.  The global</span>
<a name="l01331"></a>01331 <span class="comment">   &#39;gnd&#39; node is not touched. */</span>
<a name="l01332"></a>01332 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01333"></a><a class="code" href="check__netlist_8cpp.html#acbe6b21b3a4da139b7ec747315425c61">01333</a> <a class="code" href="check__netlist_8cpp.html#acbe6b21b3a4da139b7ec747315425c61">checker_copy_subcircuit_nodes</a> (<span class="keyword">struct</span> <a class="code" href="structdefinition__t.html">definition_t</a> * <a class="code" href="parse__vcd_8y.html#ae0bd5e8ec17b2aad3338041991eb1056">type</a>,
<a name="l01334"></a>01334                                <span class="keyword">struct</span> <a class="code" href="structdefinition__t.html">definition_t</a> * inst,
<a name="l01335"></a>01335                                <span class="keyword">struct</span> <a class="code" href="structdefinition__t.html">definition_t</a> * sub,
<a name="l01336"></a>01336                                <span class="keyword">struct</span> <a class="code" href="structdefinition__t.html">definition_t</a> * copy,
<a name="l01337"></a>01337                                <span class="keywordtype">char</span> * instances)
<a name="l01338"></a>01338 {
<a name="l01339"></a>01339     <span class="keyword">struct </span><a class="code" href="structnode__t.html">node_t</a> * <a class="code" href="parse__mdl_8y.html#aecba4cab5e52994730d1e21424997b33">n</a>, * ncopy, * root = NULL;
<a name="l01340"></a>01340 
<a name="l01341"></a>01341     <span class="comment">// go through the list of the subcircuit element&#39;s &#39;sub&#39; nodes</span>
<a name="l01342"></a>01342     <span class="keywordflow">for</span> (n = sub-&gt;<a class="code" href="structdefinition__t.html#a2e38921eeafd06f6329859b847db874c">nodes</a>; n != NULL; n = n-&gt;<a class="code" href="structnode__t.html#aca548c9bafe54ba9db19d40a7a7f1cb3">next</a>)
<a name="l01343"></a>01343     {
<a name="l01344"></a>01344 
<a name="l01345"></a>01345         <span class="comment">// create new node based upon the node translation</span>
<a name="l01346"></a>01346         ncopy = (<span class="keyword">struct </span><a class="code" href="structnode__t.html">node_t</a> *) calloc (<span class="keyword">sizeof</span> (<span class="keyword">struct</span> <a class="code" href="structnode__t.html">node_t</a>), 1);
<a name="l01347"></a>01347         ncopy-&gt;<a class="code" href="structnode__t.html#a72cf955afe6cd6c66bc3d427598b42a3">xlatenr</a> = n-&gt;<a class="code" href="structnode__t.html#a72cf955afe6cd6c66bc3d427598b42a3">xlatenr</a>;
<a name="l01348"></a>01348         <span class="keywordflow">if</span> (n-&gt;<a class="code" href="structnode__t.html#ae46bc59143574c5a24a9cfa1b9213870">xlate</a>)   <span class="comment">// translated node</span>
<a name="l01349"></a>01349         {
<a name="l01350"></a>01350             <span class="keywordflow">if</span> (instances == NULL)
<a name="l01351"></a>01351                 ncopy-&gt;<a class="code" href="structnode__t.html#aebaf9d60a7b2db52c00204c89a20e94d">node</a> = strdup (n-&gt;<a class="code" href="structnode__t.html#ae46bc59143574c5a24a9cfa1b9213870">xlate</a>);
<a name="l01352"></a>01352             <span class="keywordflow">else</span>
<a name="l01353"></a>01353                 ncopy-&gt;<a class="code" href="structnode__t.html#aebaf9d60a7b2db52c00204c89a20e94d">node</a> = NULL; <span class="comment">// leave it blank yet, indicates translation</span>
<a name="l01354"></a>01354         }
<a name="l01355"></a>01355         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp (n-&gt;<a class="code" href="structnode__t.html#aebaf9d60a7b2db52c00204c89a20e94d">node</a>, <span class="stringliteral">&quot;gnd&quot;</span>))   <span class="comment">// ground node</span>
<a name="l01356"></a>01356         {
<a name="l01357"></a>01357             ncopy-&gt;<a class="code" href="structnode__t.html#aebaf9d60a7b2db52c00204c89a20e94d">node</a> = strdup (n-&gt;<a class="code" href="structnode__t.html#aebaf9d60a7b2db52c00204c89a20e94d">node</a>);
<a name="l01358"></a>01358         }
<a name="l01359"></a>01359         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (n-&gt;<a class="code" href="structnode__t.html#aebaf9d60a7b2db52c00204c89a20e94d">node</a>[strlen (n-&gt;<a class="code" href="structnode__t.html#aebaf9d60a7b2db52c00204c89a20e94d">node</a>) - 1] == <span class="charliteral">&#39;!&#39;</span>)   <span class="comment">// global node</span>
<a name="l01360"></a>01360         {
<a name="l01361"></a>01361             ncopy-&gt;<a class="code" href="structnode__t.html#aebaf9d60a7b2db52c00204c89a20e94d">node</a> = strdup (n-&gt;<a class="code" href="structnode__t.html#aebaf9d60a7b2db52c00204c89a20e94d">node</a>);
<a name="l01362"></a>01362         }
<a name="l01363"></a>01363         <span class="keywordflow">else</span>   <span class="comment">// internal subcircuit element node</span>
<a name="l01364"></a>01364         {
<a name="l01365"></a>01365             ncopy-&gt;<a class="code" href="structnode__t.html#aebaf9d60a7b2db52c00204c89a20e94d">node</a> = <a class="code" href="check__netlist_8cpp.html#a644e9b8f6c70f257fc040f8dd522fbff">checker_subcircuit_node</a> (type-&gt;<a class="code" href="structdefinition__t.html#a594dd31d0446b3364e5875eaced950eb">instance</a>, instances,
<a name="l01366"></a>01366                                                    inst-&gt;<a class="code" href="structdefinition__t.html#a594dd31d0446b3364e5875eaced950eb">instance</a>, n-&gt;<a class="code" href="structnode__t.html#aebaf9d60a7b2db52c00204c89a20e94d">node</a>);
<a name="l01367"></a>01367         }
<a name="l01368"></a>01368         <span class="comment">// chain the new node list</span>
<a name="l01369"></a>01369         ncopy-&gt;<a class="code" href="structnode__t.html#aca548c9bafe54ba9db19d40a7a7f1cb3">next</a> = root;
<a name="l01370"></a>01370         root = ncopy;
<a name="l01371"></a>01371     }
<a name="l01372"></a>01372 
<a name="l01373"></a>01373     <span class="comment">/* and finally reverse the created node list and assign it to the</span>
<a name="l01374"></a>01374 <span class="comment">       subcircuit element&#39;s &#39;copy&#39; */</span>
<a name="l01375"></a>01375     copy-&gt;<a class="code" href="structdefinition__t.html#a2e38921eeafd06f6329859b847db874c">nodes</a> = <a class="code" href="check__netlist_8cpp.html#a812d694e23fc4440162d048a381704ae">netlist_reverse_nodes</a> (root);
<a name="l01376"></a>01376 }
<a name="l01377"></a>01377 
<a name="l01378"></a>01378 <span class="comment">// Returns the node at the given position.</span>
<a name="l01379"></a><a class="code" href="check__netlist_8cpp.html#ac246270093537da392d74ceeceb50887">01379</a> <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structnode__t.html">node_t</a> * <a class="code" href="check__netlist_8cpp.html#ac246270093537da392d74ceeceb50887">checker_get_circuit_node</a> (<span class="keyword">struct</span> <a class="code" href="structnode__t.html">node_t</a> * root, <span class="keywordtype">int</span> <a class="code" href="parse__mdl_8y.html#aecba4cab5e52994730d1e21424997b33">n</a>)
<a name="l01380"></a>01380 {
<a name="l01381"></a>01381     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="parse__mdl_8y.html#a7e98b8a17c0aad30ba64d47b74e2a6c1">i</a> = 1; <a class="code" href="parse__mdl_8y.html#a7e98b8a17c0aad30ba64d47b74e2a6c1">i</a> &lt; <a class="code" href="parse__mdl_8y.html#aecba4cab5e52994730d1e21424997b33">n</a>; <a class="code" href="parse__mdl_8y.html#a7e98b8a17c0aad30ba64d47b74e2a6c1">i</a>++)
<a name="l01382"></a>01382     {
<a name="l01383"></a>01383         root = root-&gt;<a class="code" href="structnode__t.html#aca548c9bafe54ba9db19d40a7a7f1cb3">next</a>;
<a name="l01384"></a>01384         assert (root != NULL);
<a name="l01385"></a>01385     }
<a name="l01386"></a>01386     <span class="keywordflow">return</span> root;
<a name="l01387"></a>01387 }
<a name="l01388"></a>01388 
<a name="l01389"></a>01389 <span class="comment">// The function cleans the translated nodes of a subcircuit template.</span>
<a name="l01390"></a><a class="code" href="check__netlist_8cpp.html#a3f10ebc99865691b675f860a9776ac22">01390</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="check__netlist_8cpp.html#a3f10ebc99865691b675f860a9776ac22">checker_cleanup_xlat_nodes</a> (<span class="keyword">struct</span> <a class="code" href="structdefinition__t.html">definition_t</a> * sub)
<a name="l01391"></a>01391 {
<a name="l01392"></a>01392     <span class="keywordflow">for</span> (<span class="keyword">struct</span> <a class="code" href="structnode__t.html">node_t</a> * <a class="code" href="parse__mdl_8y.html#aecba4cab5e52994730d1e21424997b33">n</a> = sub-&gt;<a class="code" href="structdefinition__t.html#a2e38921eeafd06f6329859b847db874c">nodes</a>; <a class="code" href="parse__mdl_8y.html#aecba4cab5e52994730d1e21424997b33">n</a> != NULL; <a class="code" href="parse__mdl_8y.html#aecba4cab5e52994730d1e21424997b33">n</a> = <a class="code" href="parse__mdl_8y.html#aecba4cab5e52994730d1e21424997b33">n</a>-&gt;next)
<a name="l01393"></a>01393     {
<a name="l01394"></a>01394         <span class="keywordflow">if</span> (<a class="code" href="parse__mdl_8y.html#aecba4cab5e52994730d1e21424997b33">n</a>-&gt;xlate) <a class="code" href="parse__dataset_8y.html#aca85a6c1a76f5805917a20a5efec7664">free</a> (<a class="code" href="parse__mdl_8y.html#aecba4cab5e52994730d1e21424997b33">n</a>-&gt;xlate);
<a name="l01395"></a>01395         <a class="code" href="parse__mdl_8y.html#aecba4cab5e52994730d1e21424997b33">n</a>-&gt;xlate = NULL;
<a name="l01396"></a>01396         <a class="code" href="parse__mdl_8y.html#aecba4cab5e52994730d1e21424997b33">n</a>-&gt;xlatenr = 0;
<a name="l01397"></a>01397     }
<a name="l01398"></a>01398 }
<a name="l01399"></a>01399 
<a name="l01400"></a>01400 <span class="comment">/* The function is used to assign the nodes of the &#39;copy&#39; subcircuit</span>
<a name="l01401"></a>01401 <span class="comment">   element which were left blank intentionally by the element copy in</span>
<a name="l01402"></a>01402 <span class="comment">   order to indicate that it is an external node.  Again, if the</span>
<a name="l01403"></a>01403 <span class="comment">   current node translation indicates an external node it is blanked</span>
<a name="l01404"></a>01404 <span class="comment">   again, otherwise the node gets a unique internal name.  If the</span>
<a name="l01405"></a>01405 <span class="comment">   &#39;instances&#39; list is NULL, then this indicates the root circuit list</span>
<a name="l01406"></a>01406 <span class="comment">   and node translations are done though they are &#39;external&#39;. */</span>
<a name="l01407"></a>01407 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01408"></a><a class="code" href="check__netlist_8cpp.html#a27b3e1c94fadd6c547b0dec3047882fd">01408</a> <a class="code" href="check__netlist_8cpp.html#a27b3e1c94fadd6c547b0dec3047882fd">checker_copy_circuit_nodes</a> (<span class="keyword">struct</span> <a class="code" href="structdefinition__t.html">definition_t</a> * <a class="code" href="parse__vcd_8y.html#ae0bd5e8ec17b2aad3338041991eb1056">type</a>,
<a name="l01409"></a>01409                             <span class="keyword">struct</span> <a class="code" href="structdefinition__t.html">definition_t</a> * inst,
<a name="l01410"></a>01410                             <span class="keyword">struct</span> <a class="code" href="structdefinition__t.html">definition_t</a> * sub,
<a name="l01411"></a>01411                             <span class="keyword">struct</span> <a class="code" href="structdefinition__t.html">definition_t</a> * copy,
<a name="l01412"></a>01412                             <span class="keywordtype">char</span> * instances)
<a name="l01413"></a>01413 {
<a name="l01414"></a>01414     <span class="keyword">struct </span><a class="code" href="structnode__t.html">node_t</a> * <a class="code" href="parse__mdl_8y.html#aecba4cab5e52994730d1e21424997b33">n</a>, * ncopy;
<a name="l01415"></a>01415 
<a name="l01416"></a>01416     <span class="comment">// go through the list of the subcircuit element&#39;s &#39;copy&#39; nodes</span>
<a name="l01417"></a>01417     <span class="keywordflow">for</span> (ncopy = copy-&gt;<a class="code" href="structdefinition__t.html#a2e38921eeafd06f6329859b847db874c">nodes</a>; ncopy != NULL; ncopy = ncopy-&gt;<a class="code" href="structnode__t.html#aca548c9bafe54ba9db19d40a7a7f1cb3">next</a>)
<a name="l01418"></a>01418     {
<a name="l01419"></a>01419         <span class="comment">// these NULL nodes have intentionally been blanked</span>
<a name="l01420"></a>01420         <span class="keywordflow">if</span> (ncopy-&gt;<a class="code" href="structnode__t.html#aebaf9d60a7b2db52c00204c89a20e94d">node</a> == NULL)
<a name="l01421"></a>01421         {
<a name="l01422"></a>01422             assert (ncopy-&gt;<a class="code" href="structnode__t.html#a72cf955afe6cd6c66bc3d427598b42a3">xlatenr</a> != 0);
<a name="l01423"></a>01423             <span class="comment">// get translated node</span>
<a name="l01424"></a>01424             n = <a class="code" href="check__netlist_8cpp.html#ac246270093537da392d74ceeceb50887">checker_get_circuit_node</a> (sub-&gt;<a class="code" href="structdefinition__t.html#a2e38921eeafd06f6329859b847db874c">nodes</a>, ncopy-&gt;<a class="code" href="structnode__t.html#a72cf955afe6cd6c66bc3d427598b42a3">xlatenr</a>);
<a name="l01425"></a>01425             ncopy-&gt;<a class="code" href="structnode__t.html#a72cf955afe6cd6c66bc3d427598b42a3">xlatenr</a> = n-&gt;<a class="code" href="structnode__t.html#a72cf955afe6cd6c66bc3d427598b42a3">xlatenr</a>;
<a name="l01426"></a>01426             <span class="keywordflow">if</span> (n-&gt;<a class="code" href="structnode__t.html#ae46bc59143574c5a24a9cfa1b9213870">xlate</a>)   <span class="comment">// translated node</span>
<a name="l01427"></a>01427             {
<a name="l01428"></a>01428                 <span class="keywordflow">if</span> (instances == NULL)
<a name="l01429"></a>01429                     <span class="comment">// external node indicated by no instances given</span>
<a name="l01430"></a>01430                     ncopy-&gt;<a class="code" href="structnode__t.html#aebaf9d60a7b2db52c00204c89a20e94d">node</a> = strdup (n-&gt;<a class="code" href="structnode__t.html#ae46bc59143574c5a24a9cfa1b9213870">xlate</a>);
<a name="l01431"></a>01431                 <span class="keywordflow">else</span>
<a name="l01432"></a>01432                     ncopy-&gt;<a class="code" href="structnode__t.html#aebaf9d60a7b2db52c00204c89a20e94d">node</a> = NULL; <span class="comment">// keep blank</span>
<a name="l01433"></a>01433             }
<a name="l01434"></a>01434             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp (n-&gt;<a class="code" href="structnode__t.html#aebaf9d60a7b2db52c00204c89a20e94d">node</a>, <span class="stringliteral">&quot;gnd&quot;</span>))   <span class="comment">// global ground node</span>
<a name="l01435"></a>01435             {
<a name="l01436"></a>01436                 ncopy-&gt;<a class="code" href="structnode__t.html#aebaf9d60a7b2db52c00204c89a20e94d">node</a> = strdup (n-&gt;<a class="code" href="structnode__t.html#aebaf9d60a7b2db52c00204c89a20e94d">node</a>);
<a name="l01437"></a>01437             }
<a name="l01438"></a>01438             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (n-&gt;<a class="code" href="structnode__t.html#aebaf9d60a7b2db52c00204c89a20e94d">node</a>[strlen (n-&gt;<a class="code" href="structnode__t.html#aebaf9d60a7b2db52c00204c89a20e94d">node</a>) - 1] == <span class="charliteral">&#39;!&#39;</span>)   <span class="comment">// other global node</span>
<a name="l01439"></a>01439             {
<a name="l01440"></a>01440                 ncopy-&gt;<a class="code" href="structnode__t.html#aebaf9d60a7b2db52c00204c89a20e94d">node</a> = strdup (n-&gt;<a class="code" href="structnode__t.html#aebaf9d60a7b2db52c00204c89a20e94d">node</a>);
<a name="l01441"></a>01441             }
<a name="l01442"></a>01442             <span class="keywordflow">else</span>   <span class="comment">// internal subcircuit element node</span>
<a name="l01443"></a>01443             {
<a name="l01444"></a>01444                 ncopy-&gt;<a class="code" href="structnode__t.html#aebaf9d60a7b2db52c00204c89a20e94d">node</a> = <a class="code" href="check__netlist_8cpp.html#a644e9b8f6c70f257fc040f8dd522fbff">checker_subcircuit_node</a> (type-&gt;<a class="code" href="structdefinition__t.html#a594dd31d0446b3364e5875eaced950eb">instance</a>, instances,
<a name="l01445"></a>01445                                                        inst-&gt;<a class="code" href="structdefinition__t.html#a594dd31d0446b3364e5875eaced950eb">instance</a>, n-&gt;<a class="code" href="structnode__t.html#aebaf9d60a7b2db52c00204c89a20e94d">node</a>);
<a name="l01446"></a>01446             }
<a name="l01447"></a>01447         }
<a name="l01448"></a>01448     }
<a name="l01449"></a>01449 }
<a name="l01450"></a>01450 
<a name="l01451"></a>01451 <span class="comment">/* This function returns the last entry of the given list of</span>
<a name="l01452"></a>01452 <span class="comment">   definitions or NULL if there is no such element. */</span>
<a name="l01453"></a>01453 <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structdefinition__t.html">definition_t</a> *
<a name="l01454"></a><a class="code" href="check__netlist_8cpp.html#a9d109a78790a10a48edeb8ddf4b0b2f3">01454</a> <a class="code" href="check__netlist_8cpp.html#a9d109a78790a10a48edeb8ddf4b0b2f3">checker_find_last_definition</a> (<span class="keyword">struct</span> <a class="code" href="structdefinition__t.html">definition_t</a> * root)
<a name="l01455"></a>01455 {
<a name="l01456"></a>01456     <span class="keywordflow">for</span> (<span class="keyword">struct</span> <a class="code" href="structdefinition__t.html">definition_t</a> * def = root; def != NULL; def = def-&gt;<a class="code" href="structdefinition__t.html#ac6f2d42a0105ff6e699938fcd36bd12b">next</a>)
<a name="l01457"></a>01457         <span class="keywordflow">if</span> (def-&gt;next == NULL) <span class="keywordflow">return</span> def;
<a name="l01458"></a>01458     <span class="keywordflow">return</span> NULL;
<a name="l01459"></a>01459 }
<a name="l01460"></a>01460 
<a name="l01461"></a>01461 <span class="comment">/* Based upon the the given subcircuit instance identifier list the</span>
<a name="l01462"></a>01462 <span class="comment">   function returns a &quot;.&quot; - concatenated string or NULL. */</span>
<a name="l01463"></a><a class="code" href="check__netlist_8cpp.html#a8d5542db83cd34d9406113f6494e131a">01463</a> <span class="keyword">static</span> <span class="keywordtype">char</span> * <a class="code" href="check__netlist_8cpp.html#a8d5542db83cd34d9406113f6494e131a">checker_subcircuit_instance_list</a> (strlist * instances)
<a name="l01464"></a>01464 {
<a name="l01465"></a>01465     <span class="keywordflow">if</span> (instances &amp;&amp; instances-&gt;length () &gt; 0)
<a name="l01466"></a>01466         <span class="keywordflow">return</span> instances-&gt;toString (<span class="stringliteral">&quot;.&quot;</span>);
<a name="l01467"></a>01467     <span class="keywordflow">return</span> NULL;
<a name="l01468"></a>01468 }
<a name="l01469"></a>01469 
<a name="l01470"></a>01470 <span class="comment">/* The function creates a subcircuit instance name consisting of the</span>
<a name="l01471"></a>01471 <span class="comment">   given arguments.  If the given &#39;instances&#39; is NULL it is left out.</span>
<a name="l01472"></a>01472 <span class="comment">   The caller is responsible to free() the returned string. */</span>
<a name="l01473"></a><a class="code" href="check__netlist_8cpp.html#a77556a05e32e23a5b15b08f99bbb31bc">01473</a> <span class="keyword">static</span> <span class="keywordtype">char</span> * <a class="code" href="check__netlist_8cpp.html#a77556a05e32e23a5b15b08f99bbb31bc">checker_subcircuit_instance</a> (<span class="keywordtype">char</span> * <a class="code" href="parse__vcd_8y.html#ae0bd5e8ec17b2aad3338041991eb1056">type</a>, <span class="keywordtype">char</span> * instances,
<a name="l01474"></a>01474         <span class="keywordtype">char</span> * <a class="code" href="parse__netlist_8y.html#a5ffaf17e178b3a6fa2012fe3050ede22">instance</a>, <span class="keywordtype">char</span> * base)
<a name="l01475"></a>01475 {
<a name="l01476"></a>01476     <span class="keywordtype">char</span> * txt = (<span class="keywordtype">char</span> *)
<a name="l01477"></a>01477                  calloc (1, strlen (type) + strlen (instance) + strlen (base) +
<a name="l01478"></a>01478                          (instances ? strlen (instances) : 0) + 4);
<a name="l01479"></a>01479     <span class="keywordflow">if</span> (instances)
<a name="l01480"></a>01480         sprintf (txt, <span class="stringliteral">&quot;%s.%s.%s.%s&quot;</span>, type, instances, instance, base);
<a name="l01481"></a>01481     <span class="keywordflow">else</span>
<a name="l01482"></a>01482         sprintf (txt, <span class="stringliteral">&quot;%s.%s.%s&quot;</span>, type, instance, base);
<a name="l01483"></a>01483     <span class="keywordflow">return</span> txt;
<a name="l01484"></a>01484 }
<a name="l01485"></a>01485 
<a name="l01486"></a>01486 <span class="comment">/* This function produces a copy of the given subcircuit &#39;type&#39;</span>
<a name="l01487"></a>01487 <span class="comment">   containing the subcircuit elements.  Based upon the instance &#39;inst&#39;</span>
<a name="l01488"></a>01488 <span class="comment">   definitions (node names and instance name) it assign new element</span>
<a name="l01489"></a>01489 <span class="comment">   instances and node names.  The function returns a NULL terminated</span>
<a name="l01490"></a>01490 <span class="comment">   circuit element list in reverse order. */</span>
<a name="l01491"></a>01491 <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structdefinition__t.html">definition_t</a> *
<a name="l01492"></a><a class="code" href="check__netlist_8cpp.html#a643d29a5658b0824d26dc59f07f49518">01492</a> <a class="code" href="check__netlist_8cpp.html#a643d29a5658b0824d26dc59f07f49518">checker_copy_subcircuits</a> (<span class="keyword">struct</span> <a class="code" href="structdefinition__t.html">definition_t</a> * <a class="code" href="parse__vcd_8y.html#ae0bd5e8ec17b2aad3338041991eb1056">type</a>,
<a name="l01493"></a>01493                           <span class="keyword">struct</span> <a class="code" href="structdefinition__t.html">definition_t</a> * inst, strlist * * instances,
<a name="l01494"></a>01494                           environment * <a class="code" href="parse__vcd_8y.html#a457d913bff1ebc8671c1eca1c9d5fc03">parent</a>)
<a name="l01495"></a>01495 {
<a name="l01496"></a>01496     <span class="keyword">struct </span><a class="code" href="structdefinition__t.html">definition_t</a> * def, * <a class="code" href="structdefinition__t.html#aa915ae9e6589a8da6ddbee95cc7306bb">copy</a>;
<a name="l01497"></a>01497     <span class="keyword">struct </span><a class="code" href="structdefinition__t.html">definition_t</a> * root = NULL;
<a name="l01498"></a>01498     strlist * instcopy;
<a name="l01499"></a>01499     <span class="keywordtype">char</span> * list;
<a name="l01500"></a>01500 
<a name="l01501"></a>01501     <span class="comment">// create environment for subcircuit instance</span>
<a name="l01502"></a>01502     environment * child = <span class="keyword">new</span> environment (*(type-&gt;<a class="code" href="structdefinition__t.html#ac790455379f14759e49ec75d5187c85a">env</a>));
<a name="l01503"></a>01503     parent-&gt;push_front_Child (child);
<a name="l01504"></a>01504 
<a name="l01505"></a>01505     <span class="comment">// put instance properties into subcircuit environment</span>
<a name="l01506"></a>01506     <span class="keywordflow">for</span> (<span class="keyword">struct</span> <a class="code" href="structpair__t.html">pair_t</a> * pair = inst-&gt;<a class="code" href="structdefinition__t.html#af1c52c3c0e0d2e5764a992e28084ed99">pairs</a>; pair != NULL; pair = pair-&gt;<a class="code" href="structpair__t.html#a77bd04da2c79936e50deb20d72070384">next</a>)
<a name="l01507"></a>01507     {
<a name="l01508"></a>01508         <span class="comment">// anything else than the &#39;Type&#39;</span>
<a name="l01509"></a>01509         <span class="keywordflow">if</span> (strcmp (pair-&gt;key, <span class="stringliteral">&quot;Type&quot;</span>))
<a name="l01510"></a>01510         {
<a name="l01511"></a>01511             <span class="keywordflow">if</span> (pair-&gt;value-&gt;ident == NULL)
<a name="l01512"></a>01512             {
<a name="l01513"></a>01513                 <span class="comment">// simple value</span>
<a name="l01514"></a>01514                 child-&gt;setDoubleConstant (pair-&gt;key, pair-&gt;value-&gt;value);
<a name="l01515"></a>01515                 child-&gt;setDouble (pair-&gt;key, pair-&gt;value-&gt;value);
<a name="l01516"></a>01516             }
<a name="l01517"></a>01517             <span class="keywordflow">else</span>
<a name="l01518"></a>01518             {
<a name="l01519"></a>01519                 <span class="comment">// reference to variable in upper environment</span>
<a name="l01520"></a>01520                 child-&gt;setDoubleReference (pair-&gt;key, pair-&gt;value-&gt;ident);
<a name="l01521"></a>01521             }
<a name="l01522"></a>01522         }
<a name="l01523"></a>01523     }
<a name="l01524"></a>01524 
<a name="l01525"></a>01525     <span class="comment">// go through element list of subcircuit</span>
<a name="l01526"></a>01526     <span class="keywordflow">for</span> (def = type-&gt;<a class="code" href="structdefinition__t.html#adbac069b30fc5f0544f09e77e56fa26c">sub</a>; def != NULL; def = def-&gt;<a class="code" href="structdefinition__t.html#ac6f2d42a0105ff6e699938fcd36bd12b">next</a>)
<a name="l01527"></a>01527     {
<a name="l01528"></a>01528 
<a name="l01529"></a>01529         <span class="comment">// translate the node list</span>
<a name="l01530"></a>01530         <a class="code" href="check__netlist_8cpp.html#a48e86c4c6cbe22af9faecb60b1a9bef4">checker_xlat_subcircuit_nodes</a> (type, inst, def);
<a name="l01531"></a>01531 
<a name="l01532"></a>01532         <span class="comment">// allow recursive subcircuits</span>
<a name="l01533"></a>01533         <span class="keywordflow">if</span> (!strcmp (def-&gt;<a class="code" href="structdefinition__t.html#adbc03f56abf1631614d1cc4946961300">type</a>, <span class="stringliteral">&quot;Sub&quot;</span>))
<a name="l01534"></a>01534         {
<a name="l01535"></a>01535             <span class="comment">// get subcircuit template definition</span>
<a name="l01536"></a>01536             <span class="keyword">struct </span><a class="code" href="structdefinition__t.html">definition_t</a> * <a class="code" href="structdefinition__t.html#adbac069b30fc5f0544f09e77e56fa26c">sub</a> = <a class="code" href="check__netlist_8cpp.html#a18fe2b0a499140c7c287fdfa4b47687d">checker_get_subcircuit</a> (def);
<a name="l01537"></a>01537             <span class="comment">// create a copy of the current subcircuit instance list</span>
<a name="l01538"></a>01538             <span class="keywordflow">if</span> ((*instances) == NULL) (*instances) = <span class="keyword">new</span> strlist ();
<a name="l01539"></a>01539             instcopy = <span class="keyword">new</span> strlist (*(*instances));
<a name="l01540"></a>01540             <span class="comment">// append instance name to recursive instance list</span>
<a name="l01541"></a>01541             (*instances)-&gt;append (inst-&gt;<a class="code" href="structdefinition__t.html#a594dd31d0446b3364e5875eaced950eb">instance</a>);
<a name="l01542"></a>01542             copy = <a class="code" href="check__netlist_8cpp.html#a643d29a5658b0824d26dc59f07f49518">checker_copy_subcircuits</a> (sub, def, instances, child);
<a name="l01543"></a>01543             <span class="comment">// put the expanded definitions into the sublist</span>
<a name="l01544"></a>01544             <span class="keywordflow">if</span> (copy)
<a name="l01545"></a>01545             {
<a name="l01546"></a>01546                 list = <a class="code" href="check__netlist_8cpp.html#a8d5542db83cd34d9406113f6494e131a">checker_subcircuit_instance_list</a> (instcopy);
<a name="l01547"></a>01547                 <span class="comment">// assign blanked node names to each subcircuit</span>
<a name="l01548"></a>01548                 <span class="keywordflow">for</span> (<span class="keyword">struct</span> <a class="code" href="structdefinition__t.html">definition_t</a> * <a class="code" href="parse__netlist_8y.html#a519cf159c27abd2374c9f649b9e9946d">c</a> = copy; <a class="code" href="parse__netlist_8y.html#a519cf159c27abd2374c9f649b9e9946d">c</a> != NULL; <a class="code" href="parse__netlist_8y.html#a519cf159c27abd2374c9f649b9e9946d">c</a> = <a class="code" href="parse__netlist_8y.html#a519cf159c27abd2374c9f649b9e9946d">c</a>-&gt;next)
<a name="l01549"></a>01549                 {
<a name="l01550"></a>01550                     <a class="code" href="check__netlist_8cpp.html#a27b3e1c94fadd6c547b0dec3047882fd">checker_copy_circuit_nodes</a> (type, inst, def, <a class="code" href="parse__netlist_8y.html#a519cf159c27abd2374c9f649b9e9946d">c</a>, list);
<a name="l01551"></a>01551                 }
<a name="l01552"></a>01552                 <span class="comment">// append the copies to the subcircuit list</span>
<a name="l01553"></a>01553                 <span class="keyword">struct </span><a class="code" href="structdefinition__t.html">definition_t</a> * last = <a class="code" href="check__netlist_8cpp.html#a9d109a78790a10a48edeb8ddf4b0b2f3">checker_find_last_definition</a> (copy);
<a name="l01554"></a>01554                 last-&gt;<a class="code" href="structdefinition__t.html#ac6f2d42a0105ff6e699938fcd36bd12b">next</a> = root;
<a name="l01555"></a>01555                 root = <a class="code" href="structdefinition__t.html#aa915ae9e6589a8da6ddbee95cc7306bb">copy</a>;
<a name="l01556"></a>01556             }
<a name="l01557"></a>01557             <span class="comment">// restore original instance list</span>
<a name="l01558"></a>01558             <span class="keyword">delete</span> *instances;
<a name="l01559"></a>01559             *instances = instcopy;
<a name="l01560"></a>01560         }
<a name="l01561"></a>01561         <span class="keywordflow">else</span>
<a name="l01562"></a>01562         {
<a name="l01563"></a>01563             <span class="comment">// element copy</span>
<a name="l01564"></a>01564             copy = <a class="code" href="check__netlist_8cpp.html#a498ad1e75818dc5cddfb3c8674f226e5">checker_copy_subcircuit</a> (def);
<a name="l01565"></a>01565             <span class="comment">// assign new instance name to the element</span>
<a name="l01566"></a>01566             list = <a class="code" href="check__netlist_8cpp.html#a8d5542db83cd34d9406113f6494e131a">checker_subcircuit_instance_list</a> (*instances);
<a name="l01567"></a>01567             copy-&gt;<a class="code" href="structdefinition__t.html#a594dd31d0446b3364e5875eaced950eb">instance</a> =
<a name="l01568"></a>01568                 <a class="code" href="check__netlist_8cpp.html#a77556a05e32e23a5b15b08f99bbb31bc">checker_subcircuit_instance</a> (type-&gt;<a class="code" href="structdefinition__t.html#a594dd31d0446b3364e5875eaced950eb">instance</a>, list,
<a name="l01569"></a>01569                                              inst-&gt;<a class="code" href="structdefinition__t.html#a594dd31d0446b3364e5875eaced950eb">instance</a>, def-&gt;<a class="code" href="structdefinition__t.html#a594dd31d0446b3364e5875eaced950eb">instance</a>);
<a name="l01570"></a>01570             copy-&gt;<a class="code" href="structdefinition__t.html#a07921c58da758f35353821f646c9ebe4">subcircuit</a> = strdup (type-&gt;<a class="code" href="structdefinition__t.html#a594dd31d0446b3364e5875eaced950eb">instance</a>);
<a name="l01571"></a>01571             <span class="comment">// assign node list</span>
<a name="l01572"></a>01572             <a class="code" href="check__netlist_8cpp.html#acbe6b21b3a4da139b7ec747315425c61">checker_copy_subcircuit_nodes</a> (type, inst, def, copy, list);
<a name="l01573"></a>01573             <span class="comment">// apply environment</span>
<a name="l01574"></a>01574             copy-&gt;<a class="code" href="structdefinition__t.html#ac790455379f14759e49ec75d5187c85a">env</a> = child;
<a name="l01575"></a>01575             <span class="comment">// chain definition (circuit) list</span>
<a name="l01576"></a>01576             copy-&gt;<a class="code" href="structdefinition__t.html#ac6f2d42a0105ff6e699938fcd36bd12b">next</a> = root;
<a name="l01577"></a>01577             root = <a class="code" href="structdefinition__t.html#aa915ae9e6589a8da6ddbee95cc7306bb">copy</a>;
<a name="l01578"></a>01578         }
<a name="l01579"></a>01579 
<a name="l01580"></a>01580         <span class="comment">// cleanup translated nodes</span>
<a name="l01581"></a>01581         <a class="code" href="check__netlist_8cpp.html#a3f10ebc99865691b675f860a9776ac22">checker_cleanup_xlat_nodes</a> (def);
<a name="l01582"></a>01582     }
<a name="l01583"></a>01583 
<a name="l01584"></a>01584     <span class="comment">// try giving child environment a unique name</span>
<a name="l01585"></a>01585     strlist * icopy = <span class="keyword">new</span> strlist ();
<a name="l01586"></a>01586     icopy-&gt;append (type-&gt;<a class="code" href="structdefinition__t.html#a594dd31d0446b3364e5875eaced950eb">instance</a>);
<a name="l01587"></a>01587     icopy-&gt;append (*(instances));
<a name="l01588"></a>01588     icopy-&gt;append (inst-&gt;<a class="code" href="structdefinition__t.html#a594dd31d0446b3364e5875eaced950eb">instance</a>);
<a name="l01589"></a>01589     child-&gt;setName (std::string(icopy-&gt;toString (<span class="stringliteral">&quot;.&quot;</span>)));
<a name="l01590"></a>01590     <span class="keyword">delete</span> icopy;
<a name="l01591"></a>01591 
<a name="l01592"></a>01592     <span class="keywordflow">return</span> root;
<a name="l01593"></a>01593 }
<a name="l01594"></a>01594 
<a name="l01595"></a>01595 <span class="comment">/* The function checks whether the subcircuit &#39;instance&#39; with the</span>
<a name="l01596"></a>01596 <span class="comment">   subcircuit &#39;type&#39; is defined in cycles.  It recursively goes</span>
<a name="l01597"></a>01597 <span class="comment">   through the definitions and emits an appropriate error message if</span>
<a name="l01598"></a>01598 <span class="comment">   necessary.  The function returns zero if there are no cycles</span>
<a name="l01599"></a>01599 <span class="comment">   detected and non-zero with cycles found. */</span>
<a name="l01600"></a><a class="code" href="check__netlist_8cpp.html#a3aac9c948914486e0d5bd625add176f0">01600</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="check__netlist_8cpp.html#a3aac9c948914486e0d5bd625add176f0">checker_validate_sub_cycles</a> (<span class="keyword">struct</span> <a class="code" href="structdefinition__t.html">definition_t</a> * root,
<a name="l01601"></a>01601                                         <span class="keywordtype">char</span> * <a class="code" href="parse__vcd_8y.html#ae0bd5e8ec17b2aad3338041991eb1056">type</a>, <span class="keywordtype">char</span> * <a class="code" href="parse__netlist_8y.html#a5ffaf17e178b3a6fa2012fe3050ede22">instance</a>,
<a name="l01602"></a>01602                                         strlist * * deps)
<a name="l01603"></a>01603 {
<a name="l01604"></a>01604     <span class="keywordtype">int</span> errors = 0, error;
<a name="l01605"></a>01605     <span class="keyword">struct </span><a class="code" href="structvalue__t.html">value_t</a> * val;
<a name="l01606"></a>01606 
<a name="l01607"></a>01607     <span class="comment">/* emit an appropriate error message if the subcircuit type is already</span>
<a name="l01608"></a>01608 <span class="comment">       in the dependencies */</span>
<a name="l01609"></a>01609     <span class="keywordflow">if</span> ((*deps)-&gt;contains (type))
<a name="l01610"></a>01610     {
<a name="l01611"></a>01611         <a class="code" href="logging_8c.html#abe06a8732a47a291606edcfac5e5146e">logprint</a> (<a class="code" href="logging_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;checker error, cyclic definition of `%s:%s&#39; &quot;</span>
<a name="l01612"></a>01612                   <span class="stringliteral">&quot;detected, involves: %s\n&quot;</span>,
<a name="l01613"></a>01613                   type, instance, (*deps)-&gt;toString ());
<a name="l01614"></a>01614         <span class="keywordflow">return</span> ++errors;
<a name="l01615"></a>01615     }
<a name="l01616"></a>01616     (*deps)-&gt;append (type);
<a name="l01617"></a>01617 
<a name="l01618"></a>01618     <span class="comment">// create temporary list of subcircuit types already tested</span>
<a name="l01619"></a>01619     strlist * checked = <span class="keyword">new</span> strlist ();
<a name="l01620"></a>01620     <span class="comment">// go through the list of circuit elements of the subcircuit</span>
<a name="l01621"></a>01621     <span class="keywordflow">for</span> (<span class="keyword">struct</span> <a class="code" href="structdefinition__t.html">definition_t</a> * def = root-&gt;<a class="code" href="structdefinition__t.html#adbac069b30fc5f0544f09e77e56fa26c">sub</a>; def != NULL; def = def-&gt;<a class="code" href="structdefinition__t.html#ac6f2d42a0105ff6e699938fcd36bd12b">next</a>)
<a name="l01622"></a>01622     {
<a name="l01623"></a>01623         <span class="comment">// find the appropriate definitions</span>
<a name="l01624"></a>01624         <span class="keywordflow">if</span> (!strcmp (def-&gt;type, <span class="stringliteral">&quot;Sub&quot;</span>))
<a name="l01625"></a>01625         {
<a name="l01626"></a>01626             <span class="comment">// recurse into subcircuit instances</span>
<a name="l01627"></a>01627             <span class="keywordflow">if</span> ((val = <a class="code" href="check__netlist_8cpp.html#ad9167af3b9466ee85d15c808f41741c5">checker_find_reference</a> (def, <span class="stringliteral">&quot;Type&quot;</span>)) != NULL)
<a name="l01628"></a>01628             {
<a name="l01629"></a>01629                 <span class="keywordflow">if</span> (!checked-&gt;contains (val-&gt;<a class="code" href="structvalue__t.html#ad442091764df35b6ff5dbfd7f5bd965b">ident</a>))   <span class="comment">// only if not already checked</span>
<a name="l01630"></a>01630                 {
<a name="l01631"></a>01631                     <span class="keyword">struct </span><a class="code" href="structdefinition__t.html">definition_t</a> * <a class="code" href="structdefinition__t.html#adbac069b30fc5f0544f09e77e56fa26c">sub</a>;
<a name="l01632"></a>01632                     checked-&gt;append (val-&gt;<a class="code" href="structvalue__t.html#ad442091764df35b6ff5dbfd7f5bd965b">ident</a>);
<a name="l01633"></a>01633                     <span class="comment">// copy current dependencies</span>
<a name="l01634"></a>01634                     strlist * <a class="code" href="structdefinition__t.html#aa915ae9e6589a8da6ddbee95cc7306bb">copy</a> = <span class="keyword">new</span> strlist (*(*deps));
<a name="l01635"></a>01635                     <span class="comment">// validate subcircuit</span>
<a name="l01636"></a>01636                     sub = <a class="code" href="check__netlist_8cpp.html#a9cc06be034979cdc144a47bfb08bd408">checker_find_subcircuit</a> (val-&gt;<a class="code" href="structvalue__t.html#ad442091764df35b6ff5dbfd7f5bd965b">ident</a>);
<a name="l01637"></a>01637                     <span class="keywordflow">if</span> (sub != NULL) <span class="comment">// if possible</span>
<a name="l01638"></a>01638                         error = <a class="code" href="check__netlist_8cpp.html#a3aac9c948914486e0d5bd625add176f0">checker_validate_sub_cycles</a> (sub, sub-&gt;<a class="code" href="structdefinition__t.html#a594dd31d0446b3364e5875eaced950eb">instance</a>,
<a name="l01639"></a>01639                                                              instance, deps);
<a name="l01640"></a>01640                     <span class="keywordflow">else</span>
<a name="l01641"></a>01641                         error = 1;
<a name="l01642"></a>01642                     <span class="comment">// on errors: go on</span>
<a name="l01643"></a>01643                     <span class="keywordflow">if</span> (error)
<a name="l01644"></a>01644                     {
<a name="l01645"></a>01645                         errors += error;
<a name="l01646"></a>01646                         <span class="keyword">delete</span> <a class="code" href="structdefinition__t.html#aa915ae9e6589a8da6ddbee95cc7306bb">copy</a>;
<a name="l01647"></a>01647                     }
<a name="l01648"></a>01648                     <span class="comment">// no errors: restore original dependencies</span>
<a name="l01649"></a>01649                     <span class="keywordflow">else</span>
<a name="l01650"></a>01650                     {
<a name="l01651"></a>01651                         <span class="keyword">delete</span> *deps;
<a name="l01652"></a>01652                         *deps = <a class="code" href="structdefinition__t.html#aa915ae9e6589a8da6ddbee95cc7306bb">copy</a>;
<a name="l01653"></a>01653                     }
<a name="l01654"></a>01654                 }
<a name="l01655"></a>01655             }
<a name="l01656"></a>01656         }
<a name="l01657"></a>01657     }
<a name="l01658"></a>01658     <span class="keyword">delete</span> checked;
<a name="l01659"></a>01659     <span class="keywordflow">return</span> errors;
<a name="l01660"></a>01660 }
<a name="l01661"></a>01661 
<a name="l01662"></a>01662 <span class="comment">/* This function dynamically creates a circuit definition based on a</span>
<a name="l01663"></a>01663 <span class="comment">   given subcircuit definition including type, number of nodes and the</span>
<a name="l01664"></a>01664 <span class="comment">   properties. */</span>
<a name="l01665"></a><a class="code" href="check__netlist_8cpp.html#a9d71d72557674c7db1553ef42200ea79">01665</a> <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structdefine__t.html">define_t</a> * <a class="code" href="check__netlist_8cpp.html#a9d71d72557674c7db1553ef42200ea79">netlist_create_define</a> (<span class="keyword">struct</span> <a class="code" href="structdefinition__t.html">definition_t</a> * def)
<a name="l01666"></a>01666 {
<a name="l01667"></a>01667     <span class="keywordtype">int</span> o, <a class="code" href="parse__mdl_8y.html#a514f1b439f404f86f77090fa9edc96ce">r</a>;
<a name="l01668"></a>01668     <span class="keyword">struct </span><a class="code" href="structpair__t.html">pair_t</a> * p;
<a name="l01669"></a>01669     <span class="keyword">struct </span><a class="code" href="structdefine__t.html">define_t</a> * <a class="code" href="parse__spice_8y.html#a873684cefeb665f3d5e6b495de57fc0d">d</a> =
<a name="l01670"></a>01670         (<span class="keyword">struct </span><a class="code" href="structdefine__t.html">define_t</a> *) calloc (<span class="keyword">sizeof</span> (<span class="keyword">struct</span> <a class="code" href="structdefine__t.html">define_t</a>), 1);
<a name="l01671"></a>01671     d-&gt;<a class="code" href="structdefine__t.html#ab76187b8a25a53f4afd953a66162280c">type</a> = strdup (def-&gt;<a class="code" href="structdefinition__t.html#a594dd31d0446b3364e5875eaced950eb">instance</a>);
<a name="l01672"></a>01672     d-&gt;<a class="code" href="structdefine__t.html#a4fda7184a8c91e9beba7ef3244d0c215">nodes</a> = <a class="code" href="check__netlist_8cpp.html#a4d43ae45dea6ff18c123be678afeb8f5">checker_count_nodes</a> (def);
<a name="l01673"></a>01673     d-&gt;<a class="code" href="structdefine__t.html#aa8588915d5ac240ab7a76da29cca674b">action</a> = <a class="code" href="netdefs_8h.html#a702804b0460e38665dab9ae3a6c3cbf6">PROP_COMPONENT</a>;
<a name="l01674"></a>01674 
<a name="l01675"></a>01675     <span class="comment">// determine number of required and optional parameters</span>
<a name="l01676"></a>01676     <span class="keywordflow">for</span> (o = r = 0, p = def-&gt;<a class="code" href="structdefinition__t.html#af1c52c3c0e0d2e5764a992e28084ed99">pairs</a>; p != NULL; p = p-&gt;<a class="code" href="structpair__t.html#a77bd04da2c79936e50deb20d72070384">next</a>)
<a name="l01677"></a>01677     {
<a name="l01678"></a>01678         <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structpair__t.html#a4971c332851244bac4916d04e6db3b7c">value</a> == NULL)
<a name="l01679"></a>01679             r++;
<a name="l01680"></a>01680         <span class="keywordflow">else</span>
<a name="l01681"></a>01681             o++;
<a name="l01682"></a>01682     }
<a name="l01683"></a>01683     d-&gt;<a class="code" href="structdefine__t.html#a22221cc9f714cf2989f88178f49d8cd4">required</a> =
<a name="l01684"></a>01684         (<span class="keyword">struct </span><a class="code" href="structproperty__t.html">property_t</a> *) calloc (<span class="keyword">sizeof</span> (<span class="keyword">struct</span> <a class="code" href="structproperty__t.html">property_t</a>), r + 2);
<a name="l01685"></a>01685     d-&gt;<a class="code" href="structdefine__t.html#a7641b0acfd3b1744e70cdfc20d7802bd">optional</a> =
<a name="l01686"></a>01686         (<span class="keyword">struct </span><a class="code" href="structproperty__t.html">property_t</a> *) calloc (<span class="keyword">sizeof</span> (<span class="keyword">struct</span> <a class="code" href="structproperty__t.html">property_t</a>), o + 1);
<a name="l01687"></a>01687 
<a name="l01688"></a>01688     <span class="comment">// fill in parameters</span>
<a name="l01689"></a>01689     <span class="keywordflow">for</span> (o = r = 0, p = def-&gt;<a class="code" href="structdefinition__t.html#af1c52c3c0e0d2e5764a992e28084ed99">pairs</a>; p != NULL; p = p-&gt;<a class="code" href="structpair__t.html#a77bd04da2c79936e50deb20d72070384">next</a>)
<a name="l01690"></a>01690     {
<a name="l01691"></a>01691         <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structpair__t.html#a4971c332851244bac4916d04e6db3b7c">value</a> == NULL)
<a name="l01692"></a>01692         {
<a name="l01693"></a>01693             <span class="comment">// required</span>
<a name="l01694"></a>01694             d-&gt;<a class="code" href="structdefine__t.html#a22221cc9f714cf2989f88178f49d8cd4">required</a>[<a class="code" href="parse__mdl_8y.html#a514f1b439f404f86f77090fa9edc96ce">r</a>].<a class="code" href="structproperty__t.html#ae0177f56720b1a0e3f212878887faa94">key</a> = strdup (p-&gt;<a class="code" href="structpair__t.html#a528541470063ea3e6ef340122e6f946a">key</a>);
<a name="l01695"></a>01695             d-&gt;<a class="code" href="structdefine__t.html#a22221cc9f714cf2989f88178f49d8cd4">required</a>[<a class="code" href="parse__mdl_8y.html#a514f1b439f404f86f77090fa9edc96ce">r</a>].<a class="code" href="structproperty__t.html#afe85c2a743a4136c5dd454d06676c9d7">type</a> = <a class="code" href="netdefs_8h.html#affd5c5788fc34f8a0ab1b07b77604103">PROP_REAL</a>;
<a name="l01696"></a>01696             d-&gt;<a class="code" href="structdefine__t.html#a22221cc9f714cf2989f88178f49d8cd4">required</a>[<a class="code" href="parse__mdl_8y.html#a514f1b439f404f86f77090fa9edc96ce">r</a>].<a class="code" href="structproperty__t.html#a10d8cdab6801a947d31c0d65c7c734f2">defaultval</a>.<a class="code" href="structproperty__t.html#a044f3f51414e2c7ecf38fec2158ceeab">d</a> = <a class="code" href="netdefs_8h.html#afb940e1f3110901a9a494273b104f586">PROP_NO_VAL</a>;
<a name="l01697"></a>01697             d-&gt;<a class="code" href="structdefine__t.html#a22221cc9f714cf2989f88178f49d8cd4">required</a>[<a class="code" href="parse__mdl_8y.html#a514f1b439f404f86f77090fa9edc96ce">r</a>].<a class="code" href="structproperty__t.html#a10d8cdab6801a947d31c0d65c7c734f2">defaultval</a>.<a class="code" href="structproperty__t.html#a554e4ec1f3f5ff49cf11fda865cb57b8">s</a> = <a class="code" href="netdefs_8h.html#a4d0941b8422de2007248d250c7c5c9ed">PROP_NO_STR</a>;
<a name="l01698"></a>01698             d-&gt;<a class="code" href="structdefine__t.html#a22221cc9f714cf2989f88178f49d8cd4">required</a>[<a class="code" href="parse__mdl_8y.html#a514f1b439f404f86f77090fa9edc96ce">r</a>].<a class="code" href="structproperty__t.html#abe8c9e81a5036137fb9860f3bd6ef96e">range</a>.<a class="code" href="structproperty__t.html#a22d6417d8ee5b9a026dde817108cfb52">il</a> = <span class="charliteral">&#39;.&#39;</span>;
<a name="l01699"></a>01699             d-&gt;<a class="code" href="structdefine__t.html#a22221cc9f714cf2989f88178f49d8cd4">required</a>[<a class="code" href="parse__mdl_8y.html#a514f1b439f404f86f77090fa9edc96ce">r</a>].<a class="code" href="structproperty__t.html#abe8c9e81a5036137fb9860f3bd6ef96e">range</a>.<a class="code" href="structproperty__t.html#a1c580e017f0d37edf28802105c81789a">l</a> = 0;
<a name="l01700"></a>01700             d-&gt;<a class="code" href="structdefine__t.html#a22221cc9f714cf2989f88178f49d8cd4">required</a>[<a class="code" href="parse__mdl_8y.html#a514f1b439f404f86f77090fa9edc96ce">r</a>].<a class="code" href="structproperty__t.html#abe8c9e81a5036137fb9860f3bd6ef96e">range</a>.<a class="code" href="structproperty__t.html#a44805795790f692948ba7c4d9902cd35">h</a> = 0;
<a name="l01701"></a>01701             d-&gt;<a class="code" href="structdefine__t.html#a22221cc9f714cf2989f88178f49d8cd4">required</a>[<a class="code" href="parse__mdl_8y.html#a514f1b439f404f86f77090fa9edc96ce">r</a>].<a class="code" href="structproperty__t.html#abe8c9e81a5036137fb9860f3bd6ef96e">range</a>.<a class="code" href="structproperty__t.html#ae8f4babff6f6ec9901e5c16846e41ed1">ih</a> = <span class="charliteral">&#39;.&#39;</span>;
<a name="l01702"></a>01702             r++;
<a name="l01703"></a>01703         }
<a name="l01704"></a>01704         <span class="keywordflow">else</span>
<a name="l01705"></a>01705         {
<a name="l01706"></a>01706             <span class="comment">// optional</span>
<a name="l01707"></a>01707             d-&gt;<a class="code" href="structdefine__t.html#a7641b0acfd3b1744e70cdfc20d7802bd">optional</a>[o].<a class="code" href="structproperty__t.html#ae0177f56720b1a0e3f212878887faa94">key</a> = strdup (p-&gt;<a class="code" href="structpair__t.html#a528541470063ea3e6ef340122e6f946a">key</a>);
<a name="l01708"></a>01708             d-&gt;<a class="code" href="structdefine__t.html#a7641b0acfd3b1744e70cdfc20d7802bd">optional</a>[o].<a class="code" href="structproperty__t.html#afe85c2a743a4136c5dd454d06676c9d7">type</a> = <a class="code" href="netdefs_8h.html#affd5c5788fc34f8a0ab1b07b77604103">PROP_REAL</a>;
<a name="l01709"></a>01709             d-&gt;<a class="code" href="structdefine__t.html#a7641b0acfd3b1744e70cdfc20d7802bd">optional</a>[o].<a class="code" href="structproperty__t.html#a10d8cdab6801a947d31c0d65c7c734f2">defaultval</a>.<a class="code" href="structproperty__t.html#a044f3f51414e2c7ecf38fec2158ceeab">d</a> = p-&gt;<a class="code" href="structpair__t.html#a4971c332851244bac4916d04e6db3b7c">value</a>-&gt;<a class="code" href="structvalue__t.html#a00344d940adac2e92047e60efde51a36">value</a>;
<a name="l01710"></a>01710             d-&gt;<a class="code" href="structdefine__t.html#a7641b0acfd3b1744e70cdfc20d7802bd">optional</a>[o].<a class="code" href="structproperty__t.html#a10d8cdab6801a947d31c0d65c7c734f2">defaultval</a>.<a class="code" href="structproperty__t.html#a554e4ec1f3f5ff49cf11fda865cb57b8">s</a> = <a class="code" href="netdefs_8h.html#a4d0941b8422de2007248d250c7c5c9ed">PROP_NO_STR</a>;
<a name="l01711"></a>01711             d-&gt;<a class="code" href="structdefine__t.html#a7641b0acfd3b1744e70cdfc20d7802bd">optional</a>[o].<a class="code" href="structproperty__t.html#abe8c9e81a5036137fb9860f3bd6ef96e">range</a>.<a class="code" href="structproperty__t.html#a22d6417d8ee5b9a026dde817108cfb52">il</a> = <span class="charliteral">&#39;.&#39;</span>;
<a name="l01712"></a>01712             d-&gt;<a class="code" href="structdefine__t.html#a7641b0acfd3b1744e70cdfc20d7802bd">optional</a>[o].<a class="code" href="structproperty__t.html#abe8c9e81a5036137fb9860f3bd6ef96e">range</a>.<a class="code" href="structproperty__t.html#a1c580e017f0d37edf28802105c81789a">l</a> = 0;
<a name="l01713"></a>01713             d-&gt;<a class="code" href="structdefine__t.html#a7641b0acfd3b1744e70cdfc20d7802bd">optional</a>[o].<a class="code" href="structproperty__t.html#abe8c9e81a5036137fb9860f3bd6ef96e">range</a>.<a class="code" href="structproperty__t.html#a44805795790f692948ba7c4d9902cd35">h</a> = 0;
<a name="l01714"></a>01714             d-&gt;<a class="code" href="structdefine__t.html#a7641b0acfd3b1744e70cdfc20d7802bd">optional</a>[o].<a class="code" href="structproperty__t.html#abe8c9e81a5036137fb9860f3bd6ef96e">range</a>.<a class="code" href="structproperty__t.html#ae8f4babff6f6ec9901e5c16846e41ed1">ih</a> = <span class="charliteral">&#39;.&#39;</span>;
<a name="l01715"></a>01715             o++;
<a name="l01716"></a>01716         }
<a name="l01717"></a>01717     }
<a name="l01718"></a>01718 
<a name="l01719"></a>01719     <span class="comment">// extra required</span>
<a name="l01720"></a>01720     d-&gt;<a class="code" href="structdefine__t.html#a22221cc9f714cf2989f88178f49d8cd4">required</a>[<a class="code" href="parse__mdl_8y.html#a514f1b439f404f86f77090fa9edc96ce">r</a>].<a class="code" href="structproperty__t.html#ae0177f56720b1a0e3f212878887faa94">key</a> = strdup (<span class="stringliteral">&quot;Type&quot;</span>);
<a name="l01721"></a>01721     d-&gt;<a class="code" href="structdefine__t.html#a22221cc9f714cf2989f88178f49d8cd4">required</a>[<a class="code" href="parse__mdl_8y.html#a514f1b439f404f86f77090fa9edc96ce">r</a>].<a class="code" href="structproperty__t.html#afe85c2a743a4136c5dd454d06676c9d7">type</a> = <a class="code" href="netdefs_8h.html#a552766d94553aab12e7876b233745eba">PROP_STR</a>;
<a name="l01722"></a>01722     d-&gt;<a class="code" href="structdefine__t.html#a22221cc9f714cf2989f88178f49d8cd4">required</a>[<a class="code" href="parse__mdl_8y.html#a514f1b439f404f86f77090fa9edc96ce">r</a>].<a class="code" href="structproperty__t.html#a10d8cdab6801a947d31c0d65c7c734f2">defaultval</a>.<a class="code" href="structproperty__t.html#a044f3f51414e2c7ecf38fec2158ceeab">d</a> = <a class="code" href="netdefs_8h.html#afb940e1f3110901a9a494273b104f586">PROP_NO_VAL</a>;
<a name="l01723"></a>01723     d-&gt;<a class="code" href="structdefine__t.html#a22221cc9f714cf2989f88178f49d8cd4">required</a>[<a class="code" href="parse__mdl_8y.html#a514f1b439f404f86f77090fa9edc96ce">r</a>].<a class="code" href="structproperty__t.html#a10d8cdab6801a947d31c0d65c7c734f2">defaultval</a>.<a class="code" href="structproperty__t.html#a554e4ec1f3f5ff49cf11fda865cb57b8">s</a> = <a class="code" href="netdefs_8h.html#a4d0941b8422de2007248d250c7c5c9ed">PROP_NO_STR</a>;
<a name="l01724"></a>01724     d-&gt;<a class="code" href="structdefine__t.html#a22221cc9f714cf2989f88178f49d8cd4">required</a>[<a class="code" href="parse__mdl_8y.html#a514f1b439f404f86f77090fa9edc96ce">r</a>].<a class="code" href="structproperty__t.html#abe8c9e81a5036137fb9860f3bd6ef96e">range</a>.<a class="code" href="structproperty__t.html#a22d6417d8ee5b9a026dde817108cfb52">il</a> = <span class="charliteral">&#39;.&#39;</span>;
<a name="l01725"></a>01725     d-&gt;<a class="code" href="structdefine__t.html#a22221cc9f714cf2989f88178f49d8cd4">required</a>[<a class="code" href="parse__mdl_8y.html#a514f1b439f404f86f77090fa9edc96ce">r</a>].<a class="code" href="structproperty__t.html#abe8c9e81a5036137fb9860f3bd6ef96e">range</a>.<a class="code" href="structproperty__t.html#a1c580e017f0d37edf28802105c81789a">l</a> = 0;
<a name="l01726"></a>01726     d-&gt;<a class="code" href="structdefine__t.html#a22221cc9f714cf2989f88178f49d8cd4">required</a>[<a class="code" href="parse__mdl_8y.html#a514f1b439f404f86f77090fa9edc96ce">r</a>].<a class="code" href="structproperty__t.html#abe8c9e81a5036137fb9860f3bd6ef96e">range</a>.<a class="code" href="structproperty__t.html#a44805795790f692948ba7c4d9902cd35">h</a> = 0;
<a name="l01727"></a>01727     d-&gt;<a class="code" href="structdefine__t.html#a22221cc9f714cf2989f88178f49d8cd4">required</a>[<a class="code" href="parse__mdl_8y.html#a514f1b439f404f86f77090fa9edc96ce">r</a>].<a class="code" href="structproperty__t.html#abe8c9e81a5036137fb9860f3bd6ef96e">range</a>.<a class="code" href="structproperty__t.html#ae8f4babff6f6ec9901e5c16846e41ed1">ih</a> = <span class="charliteral">&#39;.&#39;</span>;
<a name="l01728"></a>01728     <span class="keywordflow">return</span> <a class="code" href="parse__spice_8y.html#a873684cefeb665f3d5e6b495de57fc0d">d</a>;
<a name="l01729"></a>01729 }
<a name="l01730"></a>01730 
<a name="l01731"></a>01731 <span class="comment">/* The function destroys the given circuit definition which must have</span>
<a name="l01732"></a>01732 <span class="comment">   been dynamically created before. */</span>
<a name="l01733"></a><a class="code" href="check__netlist_8cpp.html#a8995935297eee5fd8a42aa137bf44679">01733</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="check__netlist_8cpp.html#a8995935297eee5fd8a42aa137bf44679">netlist_free_define</a> (<span class="keyword">struct</span> <a class="code" href="structdefine__t.html">define_t</a> * <a class="code" href="parse__spice_8y.html#a873684cefeb665f3d5e6b495de57fc0d">d</a>)
<a name="l01734"></a>01734 {
<a name="l01735"></a>01735     <span class="keywordtype">int</span> <a class="code" href="parse__mdl_8y.html#a7e98b8a17c0aad30ba64d47b74e2a6c1">i</a>;
<a name="l01736"></a>01736     <span class="keyword">struct </span><a class="code" href="structproperty__t.html">property_t</a> * p;
<a name="l01737"></a>01737     <a class="code" href="parse__dataset_8y.html#aca85a6c1a76f5805917a20a5efec7664">free</a> ((<span class="keywordtype">char</span> *) d-&gt;<a class="code" href="structdefine__t.html#ab76187b8a25a53f4afd953a66162280c">type</a>);
<a name="l01738"></a>01738     <span class="comment">// free required properties</span>
<a name="l01739"></a>01739     <span class="keywordflow">for</span> (i = 0, p = d-&gt;<a class="code" href="structdefine__t.html#a22221cc9f714cf2989f88178f49d8cd4">required</a>; p[i].<a class="code" href="structproperty__t.html#ae0177f56720b1a0e3f212878887faa94">key</a> != NULL; i++)
<a name="l01740"></a>01740     {
<a name="l01741"></a>01741         <a class="code" href="parse__dataset_8y.html#aca85a6c1a76f5805917a20a5efec7664">free</a> ((<span class="keywordtype">char</span> *) p[i].<a class="code" href="structproperty__t.html#ae0177f56720b1a0e3f212878887faa94">key</a>);
<a name="l01742"></a>01742     }
<a name="l01743"></a>01743     <a class="code" href="parse__dataset_8y.html#aca85a6c1a76f5805917a20a5efec7664">free</a> (d-&gt;<a class="code" href="structdefine__t.html#a22221cc9f714cf2989f88178f49d8cd4">required</a>);
<a name="l01744"></a>01744     <span class="comment">// free optional properties</span>
<a name="l01745"></a>01745     <span class="keywordflow">for</span> (i = 0, p = d-&gt;<a class="code" href="structdefine__t.html#a7641b0acfd3b1744e70cdfc20d7802bd">optional</a>; p[i].<a class="code" href="structproperty__t.html#ae0177f56720b1a0e3f212878887faa94">key</a> != NULL; i++)
<a name="l01746"></a>01746     {
<a name="l01747"></a>01747         <a class="code" href="parse__dataset_8y.html#aca85a6c1a76f5805917a20a5efec7664">free</a> ((<span class="keywordtype">char</span> *) p[i].<a class="code" href="structproperty__t.html#ae0177f56720b1a0e3f212878887faa94">key</a>);
<a name="l01748"></a>01748     }
<a name="l01749"></a>01749     <a class="code" href="parse__dataset_8y.html#aca85a6c1a76f5805917a20a5efec7664">free</a> (d-&gt;<a class="code" href="structdefine__t.html#a7641b0acfd3b1744e70cdfc20d7802bd">optional</a>);
<a name="l01750"></a>01750     <a class="code" href="parse__dataset_8y.html#aca85a6c1a76f5805917a20a5efec7664">free</a> (d);
<a name="l01751"></a>01751 }
<a name="l01752"></a>01752 
<a name="l01753"></a>01753 <span class="comment">/* The function checks the presence of required and optional</span>
<a name="l01754"></a>01754 <span class="comment">   properties as well as their content in the given definition.  It</span>
<a name="l01755"></a>01755 <span class="comment">   returns zero on success and non-zero otherwise. */</span>
<a name="l01756"></a><a class="code" href="check__netlist_8cpp.html#a7e32c4e0a609cfb8508e9a5dde11d1ca">01756</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="check__netlist_8cpp.html#a7e32c4e0a609cfb8508e9a5dde11d1ca">checker_validate_properties</a> (<span class="keyword">struct</span> <a class="code" href="structdefinition__t.html">definition_t</a> * root,
<a name="l01757"></a>01757                                         <span class="keyword">struct</span> <a class="code" href="structdefinition__t.html">definition_t</a> * def,
<a name="l01758"></a>01758                                         <span class="keyword">struct</span> <a class="code" href="structdefine__t.html">define_t</a> * available)
<a name="l01759"></a>01759 {
<a name="l01760"></a>01760     <span class="keyword">struct </span><a class="code" href="structpair__t.html">pair_t</a> * pair;
<a name="l01761"></a>01761     <span class="keywordtype">int</span> <a class="code" href="parse__mdl_8y.html#a7e98b8a17c0aad30ba64d47b74e2a6c1">i</a>, <a class="code" href="parse__mdl_8y.html#aecba4cab5e52994730d1e21424997b33">n</a>, errors = 0;
<a name="l01762"></a>01762 
<a name="l01763"></a>01763     <span class="comment">/* check whether the required properties are given */</span>
<a name="l01764"></a>01764     <span class="keywordflow">for</span> (i = 0; <a class="code" href="netdefs_8h.html#a415e94a0e012e5307675d9f9bd98251a">PROP_IS_PROP</a> (available-&gt;<a class="code" href="structdefine__t.html#a22221cc9f714cf2989f88178f49d8cd4">required</a>[i]); i++)
<a name="l01765"></a>01765     {
<a name="l01766"></a>01766         n = <a class="code" href="check__netlist_8cpp.html#a2d22357edbb7c3690b57adfce214071e">checker_find_property</a> (available-&gt;<a class="code" href="structdefine__t.html#a22221cc9f714cf2989f88178f49d8cd4">required</a>[i].<a class="code" href="structproperty__t.html#ae0177f56720b1a0e3f212878887faa94">key</a>, def-&gt;<a class="code" href="structdefinition__t.html#af1c52c3c0e0d2e5764a992e28084ed99">pairs</a>);
<a name="l01767"></a>01767         <span class="keywordflow">if</span> (n != 1)
<a name="l01768"></a>01768         {
<a name="l01769"></a>01769             <a class="code" href="logging_8c.html#abe06a8732a47a291606edcfac5e5146e">logprint</a> (<a class="code" href="logging_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;line %d: checker error, required property &quot;</span>
<a name="l01770"></a>01770                       <span class="stringliteral">&quot;`%s&#39; occurred %dx in `%s:%s&#39;\n&quot;</span>, def-&gt;<a class="code" href="structdefinition__t.html#aad308f4ecd35503badc78adb3e578d8b">line</a>,
<a name="l01771"></a>01771                       available-&gt;<a class="code" href="structdefine__t.html#a22221cc9f714cf2989f88178f49d8cd4">required</a>[i].<a class="code" href="structproperty__t.html#ae0177f56720b1a0e3f212878887faa94">key</a>, n, def-&gt;<a class="code" href="structdefinition__t.html#adbc03f56abf1631614d1cc4946961300">type</a>, def-&gt;<a class="code" href="structdefinition__t.html#a594dd31d0446b3364e5875eaced950eb">instance</a>);
<a name="l01772"></a>01772             errors++;
<a name="l01773"></a>01773         }
<a name="l01774"></a>01774     }
<a name="l01775"></a>01775     <span class="comment">/* check whether the optional properties are given zero/once */</span>
<a name="l01776"></a>01776     <span class="keywordflow">for</span> (i = 0; <a class="code" href="netdefs_8h.html#a415e94a0e012e5307675d9f9bd98251a">PROP_IS_PROP</a> (available-&gt;<a class="code" href="structdefine__t.html#a7641b0acfd3b1744e70cdfc20d7802bd">optional</a>[i]); i++)
<a name="l01777"></a>01777     {
<a name="l01778"></a>01778         n = <a class="code" href="check__netlist_8cpp.html#a2d22357edbb7c3690b57adfce214071e">checker_find_property</a> (available-&gt;<a class="code" href="structdefine__t.html#a7641b0acfd3b1744e70cdfc20d7802bd">optional</a>[i].<a class="code" href="structproperty__t.html#ae0177f56720b1a0e3f212878887faa94">key</a>, def-&gt;<a class="code" href="structdefinition__t.html#af1c52c3c0e0d2e5764a992e28084ed99">pairs</a>);
<a name="l01779"></a>01779         <span class="keywordflow">if</span> (n &gt;= 2)
<a name="l01780"></a>01780         {
<a name="l01781"></a>01781             <a class="code" href="logging_8c.html#abe06a8732a47a291606edcfac5e5146e">logprint</a> (<a class="code" href="logging_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;line %d: checker error, optional property &quot;</span>
<a name="l01782"></a>01782                       <span class="stringliteral">&quot;`%s&#39; occurred %dx in `%s:%s&#39;\n&quot;</span>, def-&gt;<a class="code" href="structdefinition__t.html#aad308f4ecd35503badc78adb3e578d8b">line</a>,
<a name="l01783"></a>01783                       available-&gt;<a class="code" href="structdefine__t.html#a7641b0acfd3b1744e70cdfc20d7802bd">optional</a>[i].<a class="code" href="structproperty__t.html#ae0177f56720b1a0e3f212878887faa94">key</a>, n, def-&gt;<a class="code" href="structdefinition__t.html#adbc03f56abf1631614d1cc4946961300">type</a>, def-&gt;<a class="code" href="structdefinition__t.html#a594dd31d0446b3364e5875eaced950eb">instance</a>);
<a name="l01784"></a>01784             errors++;
<a name="l01785"></a>01785         }
<a name="l01786"></a>01786     }
<a name="l01787"></a>01787 
<a name="l01788"></a>01788     <span class="comment">/* check the property content */</span>
<a name="l01789"></a>01789     <span class="keywordflow">for</span> (pair = def-&gt;<a class="code" href="structdefinition__t.html#af1c52c3c0e0d2e5764a992e28084ed99">pairs</a>; pair != NULL; pair = pair-&gt;<a class="code" href="structpair__t.html#a77bd04da2c79936e50deb20d72070384">next</a>)
<a name="l01790"></a>01790     {
<a name="l01791"></a>01791         <span class="comment">/* check whether properties are either required or optional */</span>
<a name="l01792"></a>01792         <span class="keywordtype">int</span> <a class="code" href="parse__vcd_8y.html#ae0bd5e8ec17b2aad3338041991eb1056">type</a> = <a class="code" href="check__netlist_8cpp.html#a595c10bfd2a816b09dccf63a49609788">checker_is_property</a> (available, pair-&gt;<a class="code" href="structpair__t.html#a528541470063ea3e6ef340122e6f946a">key</a>);
<a name="l01793"></a>01793         <span class="keywordflow">if</span> (type == <a class="code" href="netdefs_8h.html#a144fb2630882537a29dd547c3b25b616">PROP_NONE</a>)
<a name="l01794"></a>01794         {
<a name="l01795"></a>01795             <span class="keywordflow">if</span> (strcmp (def-&gt;<a class="code" href="structdefinition__t.html#adbc03f56abf1631614d1cc4946961300">type</a>, <span class="stringliteral">&quot;Def&quot;</span>))
<a name="l01796"></a>01796             {
<a name="l01797"></a>01797                 <a class="code" href="logging_8c.html#abe06a8732a47a291606edcfac5e5146e">logprint</a> (<a class="code" href="logging_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>,
<a name="l01798"></a>01798                           <span class="stringliteral">&quot;line %d: checker error, extraneous property `%s&#39; is &quot;</span>
<a name="l01799"></a>01799                           <span class="stringliteral">&quot;invalid in `%s:%s&#39;\n&quot;</span>, def-&gt;<a class="code" href="structdefinition__t.html#aad308f4ecd35503badc78adb3e578d8b">line</a>,
<a name="l01800"></a>01800                           pair-&gt;<a class="code" href="structpair__t.html#a528541470063ea3e6ef340122e6f946a">key</a>, def-&gt;<a class="code" href="structdefinition__t.html#adbc03f56abf1631614d1cc4946961300">type</a>, def-&gt;<a class="code" href="structdefinition__t.html#a594dd31d0446b3364e5875eaced950eb">instance</a>);
<a name="l01801"></a>01801                 errors++;
<a name="l01802"></a>01802             }
<a name="l01803"></a>01803         }
<a name="l01804"></a>01804         <span class="comment">// do not check zero-length lists</span>
<a name="l01805"></a>01805         <span class="keywordflow">if</span> (pair-&gt;<a class="code" href="structpair__t.html#a4971c332851244bac4916d04e6db3b7c">value</a> != NULL)
<a name="l01806"></a>01806         {
<a name="l01807"></a>01807             <span class="comment">/* check and evaluate the unit scale in a property */</span>
<a name="l01808"></a>01808             <span class="keywordflow">if</span> (!<a class="code" href="check__netlist_8cpp.html#a37c6b4e02257688a7b7980cad8797c05">checker_evaluate_scale</a> (pair-&gt;<a class="code" href="structpair__t.html#a4971c332851244bac4916d04e6db3b7c">value</a>))
<a name="l01809"></a>01809                 errors++;
<a name="l01810"></a>01810             <span class="comment">/* check whether properties are in range */</span>
<a name="l01811"></a>01811             <span class="keywordflow">if</span> (!<a class="code" href="check__netlist_8cpp.html#a919120f7ef70259edacea578b802ef03">checker_value_in_range</a> (def-&gt;<a class="code" href="structdefinition__t.html#a594dd31d0446b3364e5875eaced950eb">instance</a>, available, pair))
<a name="l01812"></a>01812             {
<a name="l01813"></a>01813                 errors++;
<a name="l01814"></a>01814             }
<a name="l01815"></a>01815             <span class="comment">/* check variables in properties */</span>
<a name="l01816"></a>01816             <span class="keywordflow">if</span> (!<a class="code" href="check__netlist_8cpp.html#a7c00fdc0496a603b7ee24f368b30db11">checker_resolve_variable</a> (root, def, pair, type))
<a name="l01817"></a>01817                 errors++;
<a name="l01818"></a>01818         }
<a name="l01819"></a>01819     }
<a name="l01820"></a>01820     <span class="keywordflow">return</span> errors;
<a name="l01821"></a>01821 }
<a name="l01822"></a>01822 
<a name="l01823"></a>01823 <span class="comment">/* This function is used by the netlist checker to validate the</span>
<a name="l01824"></a>01824 <span class="comment">   subcircuits.  It returns zero with no errors and non-zero on</span>
<a name="l01825"></a>01825 <span class="comment">   errors. */</span>
<a name="l01826"></a><a class="code" href="check__netlist_8cpp.html#a36c3829d220f8b3672970eba01895619">01826</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="check__netlist_8cpp.html#a36c3829d220f8b3672970eba01895619">checker_validate_subcircuits</a> (<span class="keyword">struct</span> <a class="code" href="structdefinition__t.html">definition_t</a> * root)
<a name="l01827"></a>01827 {
<a name="l01828"></a>01828     <span class="keywordtype">int</span> errors = 0;
<a name="l01829"></a>01829     <span class="comment">// go through list of definitions</span>
<a name="l01830"></a>01830     <span class="keywordflow">for</span> (<span class="keyword">struct</span> <a class="code" href="structdefinition__t.html">definition_t</a> * def = root; def != NULL; def = def-&gt;<a class="code" href="structdefinition__t.html#ac6f2d42a0105ff6e699938fcd36bd12b">next</a>)
<a name="l01831"></a>01831     {
<a name="l01832"></a>01832         <span class="comment">// check subcircuit instances</span>
<a name="l01833"></a>01833         <span class="keywordflow">if</span> (!strcmp (def-&gt;type, <span class="stringliteral">&quot;Sub&quot;</span>))
<a name="l01834"></a>01834         {
<a name="l01835"></a>01835             <span class="keyword">struct </span><a class="code" href="structvalue__t.html">value_t</a> * val;
<a name="l01836"></a>01836             <span class="comment">// validate the &#39;Type&#39; reference</span>
<a name="l01837"></a>01837             <span class="keywordflow">if</span> ((val = <a class="code" href="check__netlist_8cpp.html#af95a777fed63643cdf6ce80c9fb1d319">checker_validate_reference</a> (def, <span class="stringliteral">&quot;Type&quot;</span>)) == NULL)
<a name="l01838"></a>01838             {
<a name="l01839"></a>01839                 errors++;
<a name="l01840"></a>01840             }
<a name="l01841"></a>01841             <span class="keywordflow">else</span>
<a name="l01842"></a>01842             {
<a name="l01843"></a>01843                 <span class="comment">// find an appropriate subcircuit type</span>
<a name="l01844"></a>01844                 <span class="keyword">struct </span><a class="code" href="structdefinition__t.html">definition_t</a> * <a class="code" href="structdefinition__t.html#adbac069b30fc5f0544f09e77e56fa26c">sub</a> = <a class="code" href="check__netlist_8cpp.html#a9cc06be034979cdc144a47bfb08bd408">checker_find_subcircuit</a> (val-&gt;<a class="code" href="structvalue__t.html#ad442091764df35b6ff5dbfd7f5bd965b">ident</a>);
<a name="l01845"></a>01845                 <span class="keywordflow">if</span> (sub == NULL)
<a name="l01846"></a>01846                 {
<a name="l01847"></a>01847                     <a class="code" href="logging_8c.html#abe06a8732a47a291606edcfac5e5146e">logprint</a> (<a class="code" href="logging_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;line %d: checker error, no such subcircuit &quot;</span>
<a name="l01848"></a>01848                               <span class="stringliteral">&quot;`%s&#39; found as referred in `%s:%s&#39;\n&quot;</span>, def-&gt;line,
<a name="l01849"></a>01849                               val-&gt;<a class="code" href="structvalue__t.html#ad442091764df35b6ff5dbfd7f5bd965b">ident</a>, def-&gt;type, def-&gt;instance);
<a name="l01850"></a>01850                     errors++;
<a name="l01851"></a>01851                 }
<a name="l01852"></a>01852                 <span class="keywordflow">else</span>
<a name="l01853"></a>01853                 {
<a name="l01854"></a>01854                     <span class="comment">// check the number of nodes of the instance and the type</span>
<a name="l01855"></a>01855                     <span class="keywordtype">int</span> n1 = <a class="code" href="check__netlist_8cpp.html#a4d43ae45dea6ff18c123be678afeb8f5">checker_count_nodes</a> (def);
<a name="l01856"></a>01856                     <span class="keywordtype">int</span> n2 = <a class="code" href="check__netlist_8cpp.html#a4d43ae45dea6ff18c123be678afeb8f5">checker_count_nodes</a> (sub);
<a name="l01857"></a>01857                     <span class="keywordflow">if</span> (n1 != n2)
<a name="l01858"></a>01858                     {
<a name="l01859"></a>01859                         <a class="code" href="logging_8c.html#abe06a8732a47a291606edcfac5e5146e">logprint</a> (<a class="code" href="logging_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;line %d: checker error, subcircuit type &quot;</span>
<a name="l01860"></a>01860                                   <span class="stringliteral">&quot;`%s&#39; requires %d nodes in `%s:%s&#39;, found %d\n&quot;</span>,
<a name="l01861"></a>01861                                   def-&gt;line, sub-&gt;<a class="code" href="structdefinition__t.html#a594dd31d0446b3364e5875eaced950eb">instance</a>, n2,
<a name="l01862"></a>01862                                   def-&gt;type, def-&gt;instance, n1);
<a name="l01863"></a>01863                         errors++;
<a name="l01864"></a>01864                     }
<a name="l01865"></a>01865                     <span class="comment">// check the subcircuit instance properties</span>
<a name="l01866"></a>01866                     <span class="keyword">struct </span><a class="code" href="structdefine__t.html">define_t</a> * available = <a class="code" href="check__netlist_8cpp.html#a9d71d72557674c7db1553ef42200ea79">netlist_create_define</a> (sub);
<a name="l01867"></a>01867                     errors += <a class="code" href="check__netlist_8cpp.html#a7e32c4e0a609cfb8508e9a5dde11d1ca">checker_validate_properties</a> (root, def, available);
<a name="l01868"></a>01868                     <a class="code" href="check__netlist_8cpp.html#a8995935297eee5fd8a42aa137bf44679">netlist_free_define</a> (available);
<a name="l01869"></a>01869                     <span class="comment">// and finally check for cyclic definitions</span>
<a name="l01870"></a>01870                     strlist * deps = <span class="keyword">new</span> strlist ();
<a name="l01871"></a>01871                     <span class="keywordtype">int</span> err = <a class="code" href="check__netlist_8cpp.html#a3aac9c948914486e0d5bd625add176f0">checker_validate_sub_cycles</a> (sub, sub-&gt;<a class="code" href="structdefinition__t.html#a594dd31d0446b3364e5875eaced950eb">instance</a>,
<a name="l01872"></a>01872                                                            def-&gt;instance, &amp;deps);
<a name="l01873"></a>01873                     errors += err;
<a name="l01874"></a>01874                     <a class="code" href="check__netlist_8cpp.html#aa7243817e540c171f4821990ef6334af">checker_sub_cycles</a> = err;
<a name="l01875"></a>01875                     <span class="keyword">delete</span> deps;
<a name="l01876"></a>01876                 }
<a name="l01877"></a>01877             }
<a name="l01878"></a>01878         }
<a name="l01879"></a>01879     }
<a name="l01880"></a>01880     <span class="keywordflow">return</span> errors;
<a name="l01881"></a>01881 }
<a name="l01882"></a>01882 
<a name="l01883"></a>01883 <span class="comment">/* Deletes node list of a definition. */</span>
<a name="l01884"></a><a class="code" href="check__netlist_8cpp.html#ac6b5829570a8c862ff68dba60ec6dedb">01884</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="check__netlist_8cpp.html#ac6b5829570a8c862ff68dba60ec6dedb">netlist_free_nodes</a> (<span class="keyword">struct</span> <a class="code" href="structnode__t.html">node_t</a> * <a class="code" href="classqucs_1_1eqn_1_1node.html">node</a>)
<a name="l01885"></a>01885 {
<a name="l01886"></a>01886     <span class="keyword">struct </span><a class="code" href="structnode__t.html">node_t</a> * <a class="code" href="parse__mdl_8y.html#aecba4cab5e52994730d1e21424997b33">n</a>;
<a name="l01887"></a>01887     <span class="keywordflow">for</span> (; node != NULL; node = <a class="code" href="parse__mdl_8y.html#aecba4cab5e52994730d1e21424997b33">n</a>)
<a name="l01888"></a>01888     {
<a name="l01889"></a>01889         n = node-&gt;<a class="code" href="structnode__t.html#aca548c9bafe54ba9db19d40a7a7f1cb3">next</a>;
<a name="l01890"></a>01890         <a class="code" href="parse__dataset_8y.html#aca85a6c1a76f5805917a20a5efec7664">free</a> (node-&gt;<a class="code" href="structnode__t.html#aebaf9d60a7b2db52c00204c89a20e94d">node</a>);
<a name="l01891"></a>01891         <a class="code" href="parse__dataset_8y.html#aca85a6c1a76f5805917a20a5efec7664">free</a> (node);
<a name="l01892"></a>01892     }
<a name="l01893"></a>01893 }
<a name="l01894"></a>01894 
<a name="l01895"></a>01895 <span class="comment">/* The following function free()&#39;s the given value. */</span>
<a name="l01896"></a><a class="code" href="check__netlist_8cpp.html#a4a06b7d0f587ac3c728d0389e53d7513">01896</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="check__netlist_8cpp.html#a4a06b7d0f587ac3c728d0389e53d7513">netlist_free_value</a> (<span class="keyword">struct</span> <a class="code" href="structvalue__t.html">value_t</a> * <a class="code" href="parse__spice_8y.html#a3ee038386001fa5178eacfd04dcdb7a0">value</a>)
<a name="l01897"></a>01897 {
<a name="l01898"></a>01898     <span class="keywordflow">if</span> (value-&gt;<a class="code" href="structvalue__t.html#ad442091764df35b6ff5dbfd7f5bd965b">ident</a>) <a class="code" href="parse__dataset_8y.html#aca85a6c1a76f5805917a20a5efec7664">free</a> (value-&gt;<a class="code" href="structvalue__t.html#ad442091764df35b6ff5dbfd7f5bd965b">ident</a>);
<a name="l01899"></a>01899     <span class="keywordflow">if</span> (value-&gt;<a class="code" href="structvalue__t.html#a65816b15264dd82405c127899810d3d3">unit</a>)  <a class="code" href="parse__dataset_8y.html#aca85a6c1a76f5805917a20a5efec7664">free</a> (value-&gt;<a class="code" href="structvalue__t.html#a65816b15264dd82405c127899810d3d3">unit</a>);
<a name="l01900"></a>01900     <span class="keywordflow">if</span> (value-&gt;<a class="code" href="structvalue__t.html#a461a42371c5d4bfffbbddcbcaa1dace9">scale</a>) <a class="code" href="parse__dataset_8y.html#aca85a6c1a76f5805917a20a5efec7664">free</a> (value-&gt;<a class="code" href="structvalue__t.html#a461a42371c5d4bfffbbddcbcaa1dace9">scale</a>);
<a name="l01901"></a>01901     <a class="code" href="parse__dataset_8y.html#aca85a6c1a76f5805917a20a5efec7664">free</a> (value);
<a name="l01902"></a>01902 }
<a name="l01903"></a>01903 
<a name="l01904"></a>01904 <span class="comment">/* Deletes pair list of a definition. */</span>
<a name="l01905"></a><a class="code" href="check__netlist_8cpp.html#a88e9bcdb94ab2a4b32aa97ae29c0bcc3">01905</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="check__netlist_8cpp.html#a88e9bcdb94ab2a4b32aa97ae29c0bcc3">netlist_free_pairs</a> (<span class="keyword">struct</span> <a class="code" href="structpair__t.html">pair_t</a> * pp)
<a name="l01906"></a>01906 {
<a name="l01907"></a>01907     <span class="keyword">struct </span><a class="code" href="structpair__t.html">pair_t</a> * np;
<a name="l01908"></a>01908     <span class="keywordflow">for</span> (; pp != NULL; pp = np)
<a name="l01909"></a>01909     {
<a name="l01910"></a>01910         np = pp-&gt;<a class="code" href="structpair__t.html#a77bd04da2c79936e50deb20d72070384">next</a>;
<a name="l01911"></a>01911         <span class="keyword">struct </span><a class="code" href="structvalue__t.html">value_t</a> * nv, * <a class="code" href="parse__spice_8y.html#a3ee038386001fa5178eacfd04dcdb7a0">value</a>;
<a name="l01912"></a>01912         <span class="keywordflow">for</span> (value = pp-&gt;<a class="code" href="structpair__t.html#a4971c332851244bac4916d04e6db3b7c">value</a>; value != NULL; value = nv)
<a name="l01913"></a>01913         {
<a name="l01914"></a>01914             nv = value-&gt;<a class="code" href="structvalue__t.html#a51b2a2d3d5919849306c784f6271492c">next</a>;
<a name="l01915"></a>01915             <a class="code" href="check__netlist_8cpp.html#a4a06b7d0f587ac3c728d0389e53d7513">netlist_free_value</a> (value);
<a name="l01916"></a>01916         }
<a name="l01917"></a>01917         <a class="code" href="parse__dataset_8y.html#aca85a6c1a76f5805917a20a5efec7664">free</a> (pp-&gt;<a class="code" href="structpair__t.html#a528541470063ea3e6ef340122e6f946a">key</a>);
<a name="l01918"></a>01918         <a class="code" href="parse__dataset_8y.html#aca85a6c1a76f5805917a20a5efec7664">free</a> (pp);
<a name="l01919"></a>01919     }
<a name="l01920"></a>01920 }
<a name="l01921"></a>01921 
<a name="l01922"></a>01922 <span class="comment">/* Deletes the given definition. */</span>
<a name="l01923"></a><a class="code" href="check__netlist_8cpp.html#a45b2f9e76ddb150962e5935e10a50508">01923</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="check__netlist_8cpp.html#a45b2f9e76ddb150962e5935e10a50508">netlist_free_definition</a> (<span class="keyword">struct</span> <a class="code" href="structdefinition__t.html">definition_t</a> * def)
<a name="l01924"></a>01924 {
<a name="l01925"></a>01925     <a class="code" href="check__netlist_8cpp.html#ac6b5829570a8c862ff68dba60ec6dedb">netlist_free_nodes</a> (def-&gt;<a class="code" href="structdefinition__t.html#a2e38921eeafd06f6329859b847db874c">nodes</a>);
<a name="l01926"></a>01926     <span class="keywordflow">if</span> (!def-&gt;<a class="code" href="structdefinition__t.html#aa915ae9e6589a8da6ddbee95cc7306bb">copy</a>) <a class="code" href="check__netlist_8cpp.html#a88e9bcdb94ab2a4b32aa97ae29c0bcc3">netlist_free_pairs</a> (def-&gt;<a class="code" href="structdefinition__t.html#af1c52c3c0e0d2e5764a992e28084ed99">pairs</a>);
<a name="l01927"></a>01927     <span class="keywordflow">if</span> (def-&gt;<a class="code" href="structdefinition__t.html#a07921c58da758f35353821f646c9ebe4">subcircuit</a>) <a class="code" href="parse__dataset_8y.html#aca85a6c1a76f5805917a20a5efec7664">free</a> (def-&gt;<a class="code" href="structdefinition__t.html#a07921c58da758f35353821f646c9ebe4">subcircuit</a>);
<a name="l01928"></a>01928     <a class="code" href="parse__dataset_8y.html#aca85a6c1a76f5805917a20a5efec7664">free</a> (def-&gt;<a class="code" href="structdefinition__t.html#adbc03f56abf1631614d1cc4946961300">type</a>);
<a name="l01929"></a>01929     <a class="code" href="parse__dataset_8y.html#aca85a6c1a76f5805917a20a5efec7664">free</a> (def-&gt;<a class="code" href="structdefinition__t.html#a594dd31d0446b3364e5875eaced950eb">instance</a>);
<a name="l01930"></a>01930     <a class="code" href="parse__dataset_8y.html#aca85a6c1a76f5805917a20a5efec7664">free</a> (def);
<a name="l01931"></a>01931 }
<a name="l01932"></a>01932 
<a name="l01933"></a>01933 <span class="comment">/* The function removes the given definition &#39;cand&#39; from the</span>
<a name="l01934"></a>01934 <span class="comment">   definition root.  It returns the new definition root. */</span>
<a name="l01935"></a>01935 <span class="keyword">struct </span><a class="code" href="structdefinition__t.html">definition_t</a> *
<a name="l01936"></a><a class="code" href="check__netlist_8h.html#ab7dda795a2e712ea0c19a407c3898933">01936</a> <a class="code" href="check__netlist_8cpp.html#a6cfcdab2ec9c89322a78e49fb56a1b04">netlist_unchain_definition</a> (<span class="keyword">struct</span> <a class="code" href="structdefinition__t.html">definition_t</a> * root,
<a name="l01937"></a>01937                             <span class="keyword">struct</span> <a class="code" href="structdefinition__t.html">definition_t</a> * cand)
<a name="l01938"></a>01938 {
<a name="l01939"></a>01939     <span class="keyword">struct </span><a class="code" href="structdefinition__t.html">definition_t</a> * prev;
<a name="l01940"></a>01940     <span class="keywordflow">if</span> (cand == root)
<a name="l01941"></a>01941     {
<a name="l01942"></a>01942         root = cand-&gt;<a class="code" href="structdefinition__t.html#ac6f2d42a0105ff6e699938fcd36bd12b">next</a>;
<a name="l01943"></a>01943         <a class="code" href="check__netlist_8cpp.html#a45b2f9e76ddb150962e5935e10a50508">netlist_free_definition</a> (cand);
<a name="l01944"></a>01944     }
<a name="l01945"></a>01945     <span class="keywordflow">else</span>
<a name="l01946"></a>01946     {
<a name="l01947"></a>01947         <span class="comment">// find previous to the candidate to be deleted</span>
<a name="l01948"></a>01948         <span class="keywordflow">for</span> (prev = root; prev != NULL &amp;&amp; prev-&gt;<a class="code" href="structdefinition__t.html#ac6f2d42a0105ff6e699938fcd36bd12b">next</a> != cand; prev = prev-&gt;<a class="code" href="structdefinition__t.html#ac6f2d42a0105ff6e699938fcd36bd12b">next</a>) ;
<a name="l01949"></a>01949         <span class="keywordflow">if</span> (prev != NULL)
<a name="l01950"></a>01950         {
<a name="l01951"></a>01951             prev-&gt;<a class="code" href="structdefinition__t.html#ac6f2d42a0105ff6e699938fcd36bd12b">next</a> = cand-&gt;<a class="code" href="structdefinition__t.html#ac6f2d42a0105ff6e699938fcd36bd12b">next</a>;
<a name="l01952"></a>01952             <a class="code" href="check__netlist_8cpp.html#a45b2f9e76ddb150962e5935e10a50508">netlist_free_definition</a> (cand);
<a name="l01953"></a>01953         }
<a name="l01954"></a>01954     }
<a name="l01955"></a>01955     <span class="keywordflow">return</span> root;
<a name="l01956"></a>01956 }
<a name="l01957"></a>01957 
<a name="l01958"></a>01958 <span class="comment">/* The function expands the subcircuits within the given definition</span>
<a name="l01959"></a>01959 <span class="comment">   list and returns the expanded list with the subcircuit definitions</span>
<a name="l01960"></a>01960 <span class="comment">   removed. */</span>
<a name="l01961"></a>01961 <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structdefinition__t.html">definition_t</a> *
<a name="l01962"></a><a class="code" href="check__netlist_8cpp.html#ac3082374448f4725971ae9beaf9a4001">01962</a> <a class="code" href="check__netlist_8cpp.html#ac3082374448f4725971ae9beaf9a4001">checker_expand_subcircuits</a> (<span class="keyword">struct</span> <a class="code" href="structdefinition__t.html">definition_t</a> * root, environment * <a class="code" href="parse__vcd_8y.html#a457d913bff1ebc8671c1eca1c9d5fc03">parent</a>)
<a name="l01963"></a>01963 {
<a name="l01964"></a>01964     <span class="keyword">struct </span><a class="code" href="structdefinition__t.html">definition_t</a> * def, * <a class="code" href="structdefinition__t.html#adbac069b30fc5f0544f09e77e56fa26c">sub</a>, * <a class="code" href="structdefinition__t.html#aa915ae9e6589a8da6ddbee95cc7306bb">copy</a>, * <a class="code" href="parse__spice_8y.html#acde7555eca71d1f823fbaf6f6a1f4670">next</a>, * prev;
<a name="l01965"></a>01965     strlist * instances = NULL;
<a name="l01966"></a>01966 
<a name="l01967"></a>01967     <span class="comment">// go through the list of definitions</span>
<a name="l01968"></a>01968     <span class="keywordflow">for</span> (prev = NULL, def = root; def != NULL; def = <a class="code" href="parse__spice_8y.html#acde7555eca71d1f823fbaf6f6a1f4670">next</a>)
<a name="l01969"></a>01969     {
<a name="l01970"></a>01970         next = def-&gt;<a class="code" href="structdefinition__t.html#ac6f2d42a0105ff6e699938fcd36bd12b">next</a>;
<a name="l01971"></a>01971         <span class="comment">// is this a subcircuit instance definition ?</span>
<a name="l01972"></a>01972         <span class="keywordflow">if</span> (!strcmp (def-&gt;<a class="code" href="structdefinition__t.html#adbc03f56abf1631614d1cc4946961300">type</a>, <span class="stringliteral">&quot;Sub&quot;</span>))
<a name="l01973"></a>01973         {
<a name="l01974"></a>01974             <span class="comment">// get the subcircuit type definition</span>
<a name="l01975"></a>01975             sub = <a class="code" href="check__netlist_8cpp.html#a18fe2b0a499140c7c287fdfa4b47687d">checker_get_subcircuit</a> (def);
<a name="l01976"></a>01976             <span class="comment">// and make a copy of it</span>
<a name="l01977"></a>01977             copy = <a class="code" href="check__netlist_8cpp.html#a643d29a5658b0824d26dc59f07f49518">checker_copy_subcircuits</a> (sub, def, &amp;instances, parent);
<a name="l01978"></a>01978             <span class="keywordflow">if</span> (instances)
<a name="l01979"></a>01979             {
<a name="l01980"></a>01980                 <span class="keyword">delete</span> instances;
<a name="l01981"></a>01981                 instances = NULL;
<a name="l01982"></a>01982             }
<a name="l01983"></a>01983             <span class="comment">// remove the subcircuit instance from the original list</span>
<a name="l01984"></a>01984             <span class="keywordflow">if</span> (prev)
<a name="l01985"></a>01985             {
<a name="l01986"></a>01986                 prev-&gt;<a class="code" href="structdefinition__t.html#ac6f2d42a0105ff6e699938fcd36bd12b">next</a> = <a class="code" href="parse__spice_8y.html#acde7555eca71d1f823fbaf6f6a1f4670">next</a>;
<a name="l01987"></a>01987             }
<a name="l01988"></a>01988             <span class="keywordflow">else</span>
<a name="l01989"></a>01989             {
<a name="l01990"></a>01990                 root = <a class="code" href="parse__spice_8y.html#acde7555eca71d1f823fbaf6f6a1f4670">next</a>;
<a name="l01991"></a>01991             }
<a name="l01992"></a>01992             <a class="code" href="check__netlist_8cpp.html#a45b2f9e76ddb150962e5935e10a50508">netlist_free_definition</a> (def);
<a name="l01993"></a>01993             <span class="comment">// put the expanded definitions into the netlist</span>
<a name="l01994"></a>01994             <span class="keywordflow">if</span> (copy)
<a name="l01995"></a>01995             {
<a name="l01996"></a>01996                 <span class="keyword">struct </span><a class="code" href="structdefinition__t.html">definition_t</a> * last = <a class="code" href="check__netlist_8cpp.html#a9d109a78790a10a48edeb8ddf4b0b2f3">checker_find_last_definition</a> (copy);
<a name="l01997"></a>01997                 last-&gt;<a class="code" href="structdefinition__t.html#ac6f2d42a0105ff6e699938fcd36bd12b">next</a> = root;
<a name="l01998"></a>01998                 <span class="keywordflow">if</span> (!prev) prev = last;
<a name="l01999"></a>01999                 root = <a class="code" href="structdefinition__t.html#aa915ae9e6589a8da6ddbee95cc7306bb">copy</a>;
<a name="l02000"></a>02000             }
<a name="l02001"></a>02001         }
<a name="l02002"></a>02002         <span class="comment">// component in the root environment</span>
<a name="l02003"></a>02003         <span class="keywordflow">else</span>
<a name="l02004"></a>02004         {
<a name="l02005"></a>02005             prev = def;
<a name="l02006"></a>02006             def-&gt;<a class="code" href="structdefinition__t.html#ac790455379f14759e49ec75d5187c85a">env</a> = <a class="code" href="parse__vcd_8y.html#a457d913bff1ebc8671c1eca1c9d5fc03">parent</a>;
<a name="l02007"></a>02007         }
<a name="l02008"></a>02008     }
<a name="l02009"></a>02009     <span class="keywordflow">return</span> root;
<a name="l02010"></a>02010 }
<a name="l02011"></a>02011 
<a name="l02012"></a>02012 <span class="comment">/* This function is the checker routine for a parsed netlist.  It</span>
<a name="l02013"></a>02013 <span class="comment">   returns zero on success or non-zero if the parsed netlist contained</span>
<a name="l02014"></a>02014 <span class="comment">   errors. */</span>
<a name="l02015"></a><a class="code" href="check__netlist_8cpp.html#ac17a524127f28bce022c89bb61eb114a">02015</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="check__netlist_8cpp.html#ac17a524127f28bce022c89bb61eb114a">netlist_checker_intern</a> (<span class="keyword">struct</span> <a class="code" href="structdefinition__t.html">definition_t</a> * root)
<a name="l02016"></a>02016 {
<a name="l02017"></a>02017     <span class="keyword">struct </span><a class="code" href="structdefinition__t.html">definition_t</a> * def;
<a name="l02018"></a>02018     <span class="keyword">struct </span><a class="code" href="structdefine__t.html">define_t</a> * available;
<a name="l02019"></a>02019     <span class="keywordtype">int</span> <a class="code" href="parse__mdl_8y.html#aecba4cab5e52994730d1e21424997b33">n</a>, errors = 0;
<a name="l02020"></a>02020 
<a name="l02021"></a>02021     <span class="comment">/* go through all definitions */</span>
<a name="l02022"></a>02022     <span class="keywordflow">for</span> (def = root; def != NULL; def = def-&gt;<a class="code" href="structdefinition__t.html#ac6f2d42a0105ff6e699938fcd36bd12b">next</a>)
<a name="l02023"></a>02023     {
<a name="l02024"></a>02024 
<a name="l02025"></a>02025         <span class="comment">/* check whether the definition type is known */</span>
<a name="l02026"></a>02026         available = <a class="code" href="check__netlist_8cpp.html#a536357be17cb4d2181217ad01eae2117">checker_find_definition</a> (def-&gt;<a class="code" href="structdefinition__t.html#adbc03f56abf1631614d1cc4946961300">type</a>, def-&gt;<a class="code" href="structdefinition__t.html#a1416fa0ce6546e23f08ec6f578133bdb">action</a>);
<a name="l02027"></a>02027         <span class="keywordflow">if</span> (available == NULL)
<a name="l02028"></a>02028         {
<a name="l02029"></a>02029             <a class="code" href="logging_8c.html#abe06a8732a47a291606edcfac5e5146e">logprint</a> (<a class="code" href="logging_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;line %d: checker error, invalid definition type &quot;</span>
<a name="l02030"></a>02030                       <span class="stringliteral">&quot;`%s&#39;\n&quot;</span>, def-&gt;<a class="code" href="structdefinition__t.html#aad308f4ecd35503badc78adb3e578d8b">line</a>, def-&gt;<a class="code" href="structdefinition__t.html#adbc03f56abf1631614d1cc4946961300">type</a>);
<a name="l02031"></a>02031             errors++;
<a name="l02032"></a>02032         }
<a name="l02033"></a>02033         <span class="keywordflow">else</span>
<a name="l02034"></a>02034         {
<a name="l02035"></a>02035             <span class="comment">/* mark nodeset definitions */</span>
<a name="l02036"></a>02036             def-&gt;<a class="code" href="structdefinition__t.html#a8f9bd5dad355a813bfd439d00b80ec08">nodeset</a> = !strcmp (def-&gt;<a class="code" href="structdefinition__t.html#adbc03f56abf1631614d1cc4946961300">type</a>, <span class="stringliteral">&quot;NodeSet&quot;</span>) ? 1 : 0;
<a name="l02037"></a>02037             <span class="comment">/* mark nonlinear circuit definitions */</span>
<a name="l02038"></a>02038             def-&gt;<a class="code" href="structdefinition__t.html#a45be771ba17644d5618c8d51760502d3">nonlinear</a> = available-&gt;<a class="code" href="structdefine__t.html#ad6bd0304e39629135c2fe3481d8e4144">nonlinear</a>;
<a name="l02039"></a>02039             <span class="comment">/* mark substrate definitions */</span>
<a name="l02040"></a>02040             def-&gt;<a class="code" href="structdefinition__t.html#a2c81e7f44a503af414eb06726423c136">substrate</a> = available-&gt;<a class="code" href="structdefine__t.html#af826398427ff2d68906b766660b5f0fb">substrate</a>;
<a name="l02041"></a>02041             <span class="comment">/* save available definition */</span>
<a name="l02042"></a>02042             def-&gt;<a class="code" href="structdefinition__t.html#a21de30d2de21345df94b44c63f1d5ffd">define</a> = available;
<a name="l02043"></a>02043             <span class="comment">/* check whether the number of nodes is correct and save the</span>
<a name="l02044"></a>02044 <span class="comment">               number of given nodes */</span>
<a name="l02045"></a>02045             n = def-&gt;<a class="code" href="structdefinition__t.html#a3e1b248cf06b4618817b8451a27590fd">ncount</a> = <a class="code" href="check__netlist_8cpp.html#a4d43ae45dea6ff18c123be678afeb8f5">checker_count_nodes</a> (def);
<a name="l02046"></a>02046             <span class="keywordflow">if</span> (available-&gt;<a class="code" href="structdefine__t.html#a4fda7184a8c91e9beba7ef3244d0c215">nodes</a> == <a class="code" href="netdefs_8h.html#ae1ff6cf5a0fd2909dce8db38c008771c">PROP_NODES</a>)
<a name="l02047"></a>02047             {
<a name="l02048"></a>02048                 <span class="keywordflow">if</span> (n &lt; 1)
<a name="l02049"></a>02049                 {
<a name="l02050"></a>02050                     <a class="code" href="logging_8c.html#abe06a8732a47a291606edcfac5e5146e">logprint</a> (<a class="code" href="logging_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>,
<a name="l02051"></a>02051                               <span class="stringliteral">&quot;line %d: checker error, at least 1 node required in &quot;</span>
<a name="l02052"></a>02052                               <span class="stringliteral">&quot;`%s:%s&#39;, found %d\n&quot;</span>, def-&gt;<a class="code" href="structdefinition__t.html#aad308f4ecd35503badc78adb3e578d8b">line</a>, def-&gt;<a class="code" href="structdefinition__t.html#adbc03f56abf1631614d1cc4946961300">type</a>,
<a name="l02053"></a>02053                               def-&gt;<a class="code" href="structdefinition__t.html#a594dd31d0446b3364e5875eaced950eb">instance</a>, n);
<a name="l02054"></a>02054                     errors++;
<a name="l02055"></a>02055                 }
<a name="l02056"></a>02056             }
<a name="l02057"></a>02057             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (available-&gt;<a class="code" href="structdefine__t.html#a4fda7184a8c91e9beba7ef3244d0c215">nodes</a> != n)
<a name="l02058"></a>02058             {
<a name="l02059"></a>02059                 <a class="code" href="logging_8c.html#abe06a8732a47a291606edcfac5e5146e">logprint</a> (<a class="code" href="logging_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>,
<a name="l02060"></a>02060                           <span class="stringliteral">&quot;line %d: checker error, %d node(s) required in `%s:%s&#39;, &quot;</span>
<a name="l02061"></a>02061                           <span class="stringliteral">&quot;found %d\n&quot;</span>, def-&gt;<a class="code" href="structdefinition__t.html#aad308f4ecd35503badc78adb3e578d8b">line</a>,
<a name="l02062"></a>02062                           available-&gt;<a class="code" href="structdefine__t.html#a4fda7184a8c91e9beba7ef3244d0c215">nodes</a>, def-&gt;<a class="code" href="structdefinition__t.html#adbc03f56abf1631614d1cc4946961300">type</a>, def-&gt;<a class="code" href="structdefinition__t.html#a594dd31d0446b3364e5875eaced950eb">instance</a>, n);
<a name="l02063"></a>02063                 errors++;
<a name="l02064"></a>02064             }
<a name="l02065"></a>02065             <span class="comment">/* check the properties except for subcircuits */</span>
<a name="l02066"></a>02066             <span class="keywordflow">if</span> (strcmp (def-&gt;<a class="code" href="structdefinition__t.html#adbc03f56abf1631614d1cc4946961300">type</a>, <span class="stringliteral">&quot;Sub&quot;</span>))
<a name="l02067"></a>02067             {
<a name="l02068"></a>02068                 errors += <a class="code" href="check__netlist_8cpp.html#a7e32c4e0a609cfb8508e9a5dde11d1ca">checker_validate_properties</a> (root, def, available);
<a name="l02069"></a>02069             }
<a name="l02070"></a>02070         }
<a name="l02071"></a>02071         <span class="comment">/* check the number of definitions */</span>
<a name="l02072"></a>02072         n = <a class="code" href="check__netlist_8cpp.html#a5685c01b42b33e166beb47265bb4fa88">checker_count_definition</a> (root, def-&gt;<a class="code" href="structdefinition__t.html#adbc03f56abf1631614d1cc4946961300">type</a>, def-&gt;<a class="code" href="structdefinition__t.html#a594dd31d0446b3364e5875eaced950eb">instance</a>);
<a name="l02073"></a>02073         <span class="keywordflow">if</span> (n != 1 &amp;&amp; def-&gt;<a class="code" href="structdefinition__t.html#ad477d4a35840f474483d0b0882278cb6">duplicate</a> == 0)
<a name="l02074"></a>02074         {
<a name="l02075"></a>02075             <a class="code" href="logging_8c.html#abe06a8732a47a291606edcfac5e5146e">logprint</a> (<a class="code" href="logging_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;checker error, found %d definitions of `%s:%s&#39;\n&quot;</span>,
<a name="l02076"></a>02076                       n, def-&gt;<a class="code" href="structdefinition__t.html#adbc03f56abf1631614d1cc4946961300">type</a>, def-&gt;<a class="code" href="structdefinition__t.html#a594dd31d0446b3364e5875eaced950eb">instance</a>);
<a name="l02077"></a>02077             errors++;
<a name="l02078"></a>02078         }
<a name="l02079"></a>02079     }
<a name="l02080"></a>02080     <span class="comment">/* check microstrip definitions */</span>
<a name="l02081"></a>02081     errors += <a class="code" href="check__netlist_8cpp.html#a597d7e241f334e9deb92ecb5528f032f">checker_validate_strips</a> (root);
<a name="l02082"></a>02082     <span class="comment">/* check subcircuit definitions */</span>
<a name="l02083"></a>02083     errors += <a class="code" href="check__netlist_8cpp.html#a36c3829d220f8b3672970eba01895619">checker_validate_subcircuits</a> (root);
<a name="l02084"></a>02084     <span class="comment">/* check nodeset definitions */</span>
<a name="l02085"></a>02085     errors += <a class="code" href="check__netlist_8cpp.html#a8533dcdf539ff82db43c1e577a354d30">checker_validate_nodesets</a> (root);
<a name="l02086"></a>02086     <span class="keywordflow">return</span> errors;
<a name="l02087"></a>02087 }
<a name="l02088"></a>02088 
<a name="l02089"></a>02089 <span class="preprocessor">#if DEBUG</span>
<a name="l02090"></a>02090 <span class="preprocessor"></span><span class="comment">/* Debug function: Prints value representation. */</span>
<a name="l02091"></a>02091 <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="qucs__producer_8cpp.html#aa7c1ccfa2d441c06f347ef1bc9242527">netlist_list_value</a> (<span class="keyword">struct</span> <a class="code" href="structvalue__t.html">value_t</a> * <a class="code" href="parse__spice_8y.html#a3ee038386001fa5178eacfd04dcdb7a0">value</a>)
<a name="l02092"></a>02092 {
<a name="l02093"></a>02093     <span class="keywordflow">if</span> (value == NULL)
<a name="l02094"></a>02094         <a class="code" href="logging_8c.html#abe06a8732a47a291606edcfac5e5146e">logprint</a> (<a class="code" href="logging_8h.html#a9b52156aa5746cc612e2e3edea6d5dbd">LOG_STATUS</a>, <span class="stringliteral">&quot;[]&quot;</span>);
<a name="l02095"></a>02095     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (value-&gt;<a class="code" href="structvalue__t.html#ad442091764df35b6ff5dbfd7f5bd965b">ident</a>)
<a name="l02096"></a>02096         <a class="code" href="logging_8c.html#abe06a8732a47a291606edcfac5e5146e">logprint</a> (<a class="code" href="logging_8h.html#a9b52156aa5746cc612e2e3edea6d5dbd">LOG_STATUS</a>, <span class="stringliteral">&quot;%s&quot;</span>, value-&gt;<a class="code" href="structvalue__t.html#ad442091764df35b6ff5dbfd7f5bd965b">ident</a>);
<a name="l02097"></a>02097     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (value-&gt;<a class="code" href="structvalue__t.html#a51b2a2d3d5919849306c784f6271492c">next</a>)
<a name="l02098"></a>02098     {
<a name="l02099"></a>02099         <a class="code" href="logging_8c.html#abe06a8732a47a291606edcfac5e5146e">logprint</a> (<a class="code" href="logging_8h.html#a9b52156aa5746cc612e2e3edea6d5dbd">LOG_STATUS</a>, <span class="stringliteral">&quot;[&quot;</span>);
<a name="l02100"></a>02100         <span class="keywordflow">for</span> (; value != NULL; value = value-&gt;<a class="code" href="structvalue__t.html#a51b2a2d3d5919849306c784f6271492c">next</a>)
<a name="l02101"></a>02101             <a class="code" href="logging_8c.html#abe06a8732a47a291606edcfac5e5146e">logprint</a> (<a class="code" href="logging_8h.html#a9b52156aa5746cc612e2e3edea6d5dbd">LOG_STATUS</a>, <span class="stringliteral">&quot;%g%s&quot;</span>, value-&gt;<a class="code" href="structvalue__t.html#a00344d940adac2e92047e60efde51a36">value</a>, value-&gt;<a class="code" href="structvalue__t.html#a51b2a2d3d5919849306c784f6271492c">next</a> ? <span class="stringliteral">&quot;;&quot;</span> : <span class="stringliteral">&quot;&quot;</span>);
<a name="l02102"></a>02102         <a class="code" href="logging_8c.html#abe06a8732a47a291606edcfac5e5146e">logprint</a> (<a class="code" href="logging_8h.html#a9b52156aa5746cc612e2e3edea6d5dbd">LOG_STATUS</a>, <span class="stringliteral">&quot;]&quot;</span>);
<a name="l02103"></a>02103     }
<a name="l02104"></a>02104     <span class="keywordflow">else</span>
<a name="l02105"></a>02105     {
<a name="l02106"></a>02106         <a class="code" href="logging_8c.html#abe06a8732a47a291606edcfac5e5146e">logprint</a> (<a class="code" href="logging_8h.html#a9b52156aa5746cc612e2e3edea6d5dbd">LOG_STATUS</a>, <span class="stringliteral">&quot;%g&quot;</span>, value-&gt;<a class="code" href="structvalue__t.html#a00344d940adac2e92047e60efde51a36">value</a>);
<a name="l02107"></a>02107         <span class="keywordflow">if</span> (value-&gt;<a class="code" href="structvalue__t.html#a461a42371c5d4bfffbbddcbcaa1dace9">scale</a>)
<a name="l02108"></a>02108             <a class="code" href="logging_8c.html#abe06a8732a47a291606edcfac5e5146e">logprint</a> (<a class="code" href="logging_8h.html#a9b52156aa5746cc612e2e3edea6d5dbd">LOG_STATUS</a>, <span class="stringliteral">&quot;%s&quot;</span>, value-&gt;<a class="code" href="structvalue__t.html#a461a42371c5d4bfffbbddcbcaa1dace9">scale</a>);
<a name="l02109"></a>02109         <span class="keywordflow">if</span> (value-&gt;<a class="code" href="structvalue__t.html#a65816b15264dd82405c127899810d3d3">unit</a>)
<a name="l02110"></a>02110             <a class="code" href="logging_8c.html#abe06a8732a47a291606edcfac5e5146e">logprint</a> (<a class="code" href="logging_8h.html#a9b52156aa5746cc612e2e3edea6d5dbd">LOG_STATUS</a>, <span class="stringliteral">&quot;%s&quot;</span>, value-&gt;<a class="code" href="structvalue__t.html#a65816b15264dd82405c127899810d3d3">unit</a>);
<a name="l02111"></a>02111     }
<a name="l02112"></a>02112 }
<a name="l02113"></a>02113 
<a name="l02114"></a>02114 <span class="comment">/* Debug function: Prints definition list representation. */</span>
<a name="l02115"></a>02115 <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="qucs__producer_8cpp.html#ac605d223565c8dd3a7e84214ae19cf7e">netlist_lister</a> (<span class="keyword">struct</span> <a class="code" href="structdefinition__t.html">definition_t</a> * root, <span class="keyword">const</span> <span class="keywordtype">char</span> * prefix)
<a name="l02116"></a>02116 {
<a name="l02117"></a>02117     <span class="keyword">struct </span><a class="code" href="structdefinition__t.html">definition_t</a> * def;
<a name="l02118"></a>02118     <span class="keyword">struct </span><a class="code" href="structnode__t.html">node_t</a> * <a class="code" href="structnode__t.html#aebaf9d60a7b2db52c00204c89a20e94d">node</a>;
<a name="l02119"></a>02119     <span class="keyword">struct </span><a class="code" href="structpair__t.html">pair_t</a> * pair;
<a name="l02120"></a>02120     <span class="keywordflow">for</span> (def = root; def != NULL; def = def-&gt;<a class="code" href="structdefinition__t.html#ac6f2d42a0105ff6e699938fcd36bd12b">next</a>)
<a name="l02121"></a>02121     {
<a name="l02122"></a>02122         <a class="code" href="logging_8c.html#abe06a8732a47a291606edcfac5e5146e">logprint</a> (<a class="code" href="logging_8h.html#a9b52156aa5746cc612e2e3edea6d5dbd">LOG_STATUS</a>, <span class="stringliteral">&quot;%s%s:%s&quot;</span>, prefix, def-&gt;<a class="code" href="structdefinition__t.html#adbc03f56abf1631614d1cc4946961300">type</a>, def-&gt;<a class="code" href="structdefinition__t.html#a594dd31d0446b3364e5875eaced950eb">instance</a>);
<a name="l02123"></a>02123         <span class="keywordflow">for</span> (node = def-&gt;<a class="code" href="structdefinition__t.html#a2e38921eeafd06f6329859b847db874c">nodes</a>; node != NULL; node = node-&gt;<a class="code" href="structnode__t.html#aca548c9bafe54ba9db19d40a7a7f1cb3">next</a>)
<a name="l02124"></a>02124         {
<a name="l02125"></a>02125             <a class="code" href="logging_8c.html#abe06a8732a47a291606edcfac5e5146e">logprint</a> (<a class="code" href="logging_8h.html#a9b52156aa5746cc612e2e3edea6d5dbd">LOG_STATUS</a>, <span class="stringliteral">&quot; %s&quot;</span>, node-&gt;<a class="code" href="structnode__t.html#aebaf9d60a7b2db52c00204c89a20e94d">node</a>);
<a name="l02126"></a>02126         }
<a name="l02127"></a>02127         <span class="keywordflow">for</span> (pair = def-&gt;<a class="code" href="structdefinition__t.html#af1c52c3c0e0d2e5764a992e28084ed99">pairs</a>; pair != NULL; pair = pair-&gt;<a class="code" href="structpair__t.html#a77bd04da2c79936e50deb20d72070384">next</a>)
<a name="l02128"></a>02128         {
<a name="l02129"></a>02129             <a class="code" href="logging_8c.html#abe06a8732a47a291606edcfac5e5146e">logprint</a> (<a class="code" href="logging_8h.html#a9b52156aa5746cc612e2e3edea6d5dbd">LOG_STATUS</a>, <span class="stringliteral">&quot; %s=\&quot;&quot;</span>, pair-&gt;<a class="code" href="structpair__t.html#a528541470063ea3e6ef340122e6f946a">key</a>);
<a name="l02130"></a>02130             <a class="code" href="qucs__producer_8cpp.html#aa7c1ccfa2d441c06f347ef1bc9242527">netlist_list_value</a> (pair-&gt;<a class="code" href="structpair__t.html#a4971c332851244bac4916d04e6db3b7c">value</a>);
<a name="l02131"></a>02131             <a class="code" href="logging_8c.html#abe06a8732a47a291606edcfac5e5146e">logprint</a> (<a class="code" href="logging_8h.html#a9b52156aa5746cc612e2e3edea6d5dbd">LOG_STATUS</a>, <span class="stringliteral">&quot;\&quot;&quot;</span>);
<a name="l02132"></a>02132         }
<a name="l02133"></a>02133         <a class="code" href="logging_8c.html#abe06a8732a47a291606edcfac5e5146e">logprint</a> (<a class="code" href="logging_8h.html#a9b52156aa5746cc612e2e3edea6d5dbd">LOG_STATUS</a>, <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l02134"></a>02134     }
<a name="l02135"></a>02135 }
<a name="l02136"></a>02136 
<a name="l02137"></a>02137 <span class="comment">/* Debug function: Prints the overall netlist representation. */</span>
<a name="l02138"></a>02138 <span class="keywordtype">void</span> <a class="code" href="check__netlist_8h.html#a49187af0356b1de975c4408fb2f5f999">netlist_list</a> (<span class="keywordtype">void</span>)
<a name="l02139"></a>02139 {
<a name="l02140"></a>02140     <span class="keyword">struct </span><a class="code" href="structdefinition__t.html">definition_t</a> * def;
<a name="l02141"></a>02141     <a class="code" href="logging_8c.html#abe06a8732a47a291606edcfac5e5146e">logprint</a> (<a class="code" href="logging_8h.html#a9b52156aa5746cc612e2e3edea6d5dbd">LOG_STATUS</a>, <span class="stringliteral">&quot;subcircuit %s\n&quot;</span>, <span class="stringliteral">&quot;root&quot;</span>);
<a name="l02142"></a>02142     <a class="code" href="qucs__producer_8cpp.html#ac605d223565c8dd3a7e84214ae19cf7e">netlist_lister</a> (<a class="code" href="check__netlist_8cpp.html#a743ab6f836d53fd6b166066585882b8c">definition_root</a>, <span class="stringliteral">&quot;  &quot;</span>);
<a name="l02143"></a>02143     <span class="keywordflow">for</span> (def = <a class="code" href="check__netlist_8cpp.html#a8443096178b6c84a10f0da689c81ee44">subcircuit_root</a>; def != NULL; def = def-&gt;<a class="code" href="structdefinition__t.html#ac6f2d42a0105ff6e699938fcd36bd12b">next</a>)
<a name="l02144"></a>02144     {
<a name="l02145"></a>02145         <a class="code" href="logging_8c.html#abe06a8732a47a291606edcfac5e5146e">logprint</a> (<a class="code" href="logging_8h.html#a9b52156aa5746cc612e2e3edea6d5dbd">LOG_STATUS</a>, <span class="stringliteral">&quot;subcircuit %s\n&quot;</span>, def-&gt;<a class="code" href="structdefinition__t.html#a594dd31d0446b3364e5875eaced950eb">instance</a>);
<a name="l02146"></a>02146         <a class="code" href="qucs__producer_8cpp.html#ac605d223565c8dd3a7e84214ae19cf7e">netlist_lister</a> (def-&gt;<a class="code" href="structdefinition__t.html#adbac069b30fc5f0544f09e77e56fa26c">sub</a>, <span class="stringliteral">&quot;  &quot;</span>);
<a name="l02147"></a>02147     }
<a name="l02148"></a>02148 }
<a name="l02149"></a>02149 <span class="preprocessor">#endif </span><span class="comment">/* DEBUG */</span>
<a name="l02150"></a>02150 
<a name="l02151"></a>02151 <span class="comment">/* The function logs the content of the current netlist by telling how</span>
<a name="l02152"></a>02152 <span class="comment">   many instances of which kind of components are used in the netlist. */</span>
<a name="l02153"></a><a class="code" href="check__netlist_8h.html#aaf215fbfc70cb64f0271dec5036eea8e">02153</a> <span class="keywordtype">void</span> <a class="code" href="check__netlist_8cpp.html#aaf215fbfc70cb64f0271dec5036eea8e">netlist_status</a> (<span class="keywordtype">void</span>)
<a name="l02154"></a>02154 {
<a name="l02155"></a>02155     <span class="keyword">struct </span><a class="code" href="structdefine__t.html">define_t</a> * def;
<a name="l02156"></a>02156     <span class="keyword">struct </span><a class="code" href="structdefinition__t.html">definition_t</a> * cir;
<a name="l02157"></a>02157     <span class="keywordtype">int</span> count;
<a name="l02158"></a>02158     <a class="code" href="logging_8c.html#abe06a8732a47a291606edcfac5e5146e">logprint</a> (<a class="code" href="logging_8h.html#a9b52156aa5746cc612e2e3edea6d5dbd">LOG_STATUS</a>, <span class="stringliteral">&quot;netlist content\n&quot;</span>);
<a name="l02159"></a>02159     hashiterator&lt;module&gt; it;
<a name="l02160"></a>02160     <span class="keywordflow">for</span> (it = hashiterator&lt;module&gt; (module::modules); *it; ++it)
<a name="l02161"></a>02161     {
<a name="l02162"></a>02162         def = it.currentVal()-&gt;definition;
<a name="l02163"></a>02163         <span class="keywordflow">for</span> (count = 0, cir = <a class="code" href="check__netlist_8cpp.html#a743ab6f836d53fd6b166066585882b8c">definition_root</a>; cir != NULL; cir = cir-&gt;<a class="code" href="structdefinition__t.html#ac6f2d42a0105ff6e699938fcd36bd12b">next</a>)
<a name="l02164"></a>02164         {
<a name="l02165"></a>02165             <span class="keywordflow">if</span> (!strcmp (def-&gt;<a class="code" href="structdefine__t.html#ab76187b8a25a53f4afd953a66162280c">type</a>, cir-&gt;<a class="code" href="structdefinition__t.html#adbc03f56abf1631614d1cc4946961300">type</a>)) count++;
<a name="l02166"></a>02166         }
<a name="l02167"></a>02167         <span class="keywordflow">if</span> (count &gt; 0)
<a name="l02168"></a>02168         {
<a name="l02169"></a>02169             <a class="code" href="logging_8c.html#abe06a8732a47a291606edcfac5e5146e">logprint</a> (<a class="code" href="logging_8h.html#a9b52156aa5746cc612e2e3edea6d5dbd">LOG_STATUS</a>, <span class="stringliteral">&quot;  %5d %s instances\n&quot;</span>, count, def-&gt;<a class="code" href="structdefine__t.html#ab76187b8a25a53f4afd953a66162280c">type</a>);
<a name="l02170"></a>02170         }
<a name="l02171"></a>02171     }
<a name="l02172"></a>02172 }
<a name="l02173"></a>02173 
<a name="l02174"></a>02174 <span class="comment">/* The function builds the equation list for a given list of</span>
<a name="l02175"></a>02175 <span class="comment">   definition and removes the definition containing the equations from</span>
<a name="l02176"></a>02176 <span class="comment">   the list. */</span>
<a name="l02177"></a>02177 <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structdefinition__t.html">definition_t</a> *
<a name="l02178"></a><a class="code" href="check__netlist_8cpp.html#ab3b43b25a751a720ed821a6c19bfa840">02178</a> <a class="code" href="check__netlist_8cpp.html#ab3b43b25a751a720ed821a6c19bfa840">checker_build_equations</a> (<span class="keyword">struct</span> <a class="code" href="structdefinition__t.html">definition_t</a> * root, eqn::node ** eroot)
<a name="l02179"></a>02179 {
<a name="l02180"></a>02180     <span class="keyword">struct </span><a class="code" href="structdefinition__t.html">definition_t</a> * def, * <a class="code" href="parse__spice_8y.html#acde7555eca71d1f823fbaf6f6a1f4670">next</a>, * prev;
<a name="l02181"></a>02181     eqn::node * <a class="code" href="parse__netlist_8y.html#aad664ad10957bf531dcce47612c7677a">eqns</a>, * last;
<a name="l02182"></a>02182     *eroot = NULL;
<a name="l02183"></a>02183     <span class="comment">// go through list of definitions</span>
<a name="l02184"></a>02184     <span class="keywordflow">for</span> (prev = NULL, def = root; def != NULL; def = <a class="code" href="parse__spice_8y.html#acde7555eca71d1f823fbaf6f6a1f4670">next</a>)
<a name="l02185"></a>02185     {
<a name="l02186"></a>02186         next = def-&gt;<a class="code" href="structdefinition__t.html#ac6f2d42a0105ff6e699938fcd36bd12b">next</a>;
<a name="l02187"></a>02187         <span class="keywordflow">if</span> (!strcmp (def-&gt;<a class="code" href="structdefinition__t.html#adbc03f56abf1631614d1cc4946961300">type</a>, <span class="stringliteral">&quot;Eqn&quot;</span>))
<a name="l02188"></a>02188         {
<a name="l02189"></a>02189             <span class="comment">// rechain definition list</span>
<a name="l02190"></a>02190             <span class="keywordflow">if</span> (prev)
<a name="l02191"></a>02191             {
<a name="l02192"></a>02192                 prev-&gt;<a class="code" href="structdefinition__t.html#ac6f2d42a0105ff6e699938fcd36bd12b">next</a> = <a class="code" href="parse__spice_8y.html#acde7555eca71d1f823fbaf6f6a1f4670">next</a>;
<a name="l02193"></a>02193             }
<a name="l02194"></a>02194             <span class="keywordflow">else</span>
<a name="l02195"></a>02195             {
<a name="l02196"></a>02196                 root = <a class="code" href="parse__spice_8y.html#acde7555eca71d1f823fbaf6f6a1f4670">next</a>;
<a name="l02197"></a>02197             }
<a name="l02198"></a>02198             <span class="comment">// append equations</span>
<a name="l02199"></a>02199             eqns = (eqn::node *) def-&gt;<a class="code" href="structdefinition__t.html#a0b6d7899b414a85058aa318d7e399ab1">eqns</a>;
<a name="l02200"></a>02200             last = <a class="code" href="classqucs_1_1eqn_1_1checker.html#af136df3e905d88f2f4c900f289a59ca1">eqn::checker::lastEquation</a> (eqns);
<a name="l02201"></a>02201             last-&gt;<a class="code" href="classqucs_1_1eqn_1_1node.html#afe1752b581b0b1bb901226032240b41d">setNext</a> (*eroot);
<a name="l02202"></a>02202             *eroot = <a class="code" href="parse__netlist_8y.html#aad664ad10957bf531dcce47612c7677a">eqns</a>;
<a name="l02203"></a>02203             <span class="comment">// free this definition</span>
<a name="l02204"></a>02204             <a class="code" href="check__netlist_8cpp.html#a45b2f9e76ddb150962e5935e10a50508">netlist_free_definition</a> (def);
<a name="l02205"></a>02205         }
<a name="l02206"></a>02206         <span class="keywordflow">else</span> prev = def;
<a name="l02207"></a>02207     }
<a name="l02208"></a>02208     <span class="keywordflow">return</span> root;
<a name="l02209"></a>02209 }
<a name="l02210"></a>02210 
<a name="l02211"></a>02211 <span class="comment">/* The function creates an environment for the given definition root</span>
<a name="l02212"></a>02212 <span class="comment">   including equation checker and solver. */</span>
<a name="l02213"></a><a class="code" href="check__netlist_8cpp.html#aa0bed64d34b360f83f392a91d49a6eff">02213</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="check__netlist_8cpp.html#aa0bed64d34b360f83f392a91d49a6eff">checker_setup_env</a> (<span class="keyword">struct</span> <a class="code" href="structdefinition__t.html">definition_t</a> * root,
<a name="l02214"></a>02214                                environment * <a class="code" href="structdefinition__t.html#ac790455379f14759e49ec75d5187c85a">env</a>, eqn::node * <a class="code" href="parse__netlist_8y.html#aad664ad10957bf531dcce47612c7677a">eqns</a>)
<a name="l02215"></a>02215 {
<a name="l02216"></a>02216     <span class="comment">// create equation checker</span>
<a name="l02217"></a>02217     eqn::checker * checkee = <span class="keyword">new</span> eqn::checker ();
<a name="l02218"></a>02218     <span class="comment">// pass equations to the checker</span>
<a name="l02219"></a>02219     checkee-&gt;setEquations (eqns);
<a name="l02220"></a>02220     <span class="comment">// add constants to the list of equations</span>
<a name="l02221"></a>02221     checkee-&gt;constants ();
<a name="l02222"></a>02222     <span class="comment">// pass checker</span>
<a name="l02223"></a>02223     env-&gt;setChecker (checkee);
<a name="l02224"></a>02224     <span class="comment">// create equation solver</span>
<a name="l02225"></a>02225     eqn::solver * solvee = <span class="keyword">new</span> eqn::solver (checkee);
<a name="l02226"></a>02226     <span class="comment">// pass solver</span>
<a name="l02227"></a>02227     env-&gt;setSolver (solvee);
<a name="l02228"></a>02228     <span class="comment">// apply environment to the netlist root</span>
<a name="l02229"></a>02229     <span class="keywordflow">if</span> (root) root-&gt;<a class="code" href="structdefinition__t.html#ac790455379f14759e49ec75d5187c85a">env</a> = <a class="code" href="structdefinition__t.html#ac790455379f14759e49ec75d5187c85a">env</a>;
<a name="l02230"></a>02230 }
<a name="l02231"></a>02231 
<a name="l02232"></a>02232 <span class="comment">/* Adds the arguments of a subcircuit into the equation checker of the</span>
<a name="l02233"></a>02233 <span class="comment">   given environment. */</span>
<a name="l02234"></a><a class="code" href="check__netlist_8cpp.html#ac02bf34d648c875c30891c2c7ef339f1">02234</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="check__netlist_8cpp.html#ac02bf34d648c875c30891c2c7ef339f1">checker_subcircuit_args</a> (<span class="keyword">struct</span> <a class="code" href="structdefinition__t.html">definition_t</a> * def,
<a name="l02235"></a>02235                                      environment * <a class="code" href="structdefinition__t.html#ac790455379f14759e49ec75d5187c85a">env</a>)
<a name="l02236"></a>02236 {
<a name="l02237"></a>02237     <span class="keywordflow">for</span> (<span class="keyword">struct</span> <a class="code" href="structpair__t.html">pair_t</a> * pair = def-&gt;<a class="code" href="structdefinition__t.html#af1c52c3c0e0d2e5764a992e28084ed99">pairs</a>; pair != NULL; pair = pair-&gt;<a class="code" href="structpair__t.html#a77bd04da2c79936e50deb20d72070384">next</a>)
<a name="l02238"></a>02238     {
<a name="l02239"></a>02239         <span class="comment">// anything else than the &#39;Type&#39;</span>
<a name="l02240"></a>02240         <span class="keywordflow">if</span> (strcmp (pair-&gt;<a class="code" href="structpair__t.html#a528541470063ea3e6ef340122e6f946a">key</a>, <span class="stringliteral">&quot;Type&quot;</span>))
<a name="l02241"></a>02241         {
<a name="l02242"></a>02242             <span class="comment">// put it into the equation checker</span>
<a name="l02243"></a>02243             env-&gt;getChecker()-&gt;addDouble (<span class="stringliteral">&quot;#subcircuit&quot;</span>,
<a name="l02244"></a>02244                                           pair-&gt;<a class="code" href="structpair__t.html#a528541470063ea3e6ef340122e6f946a">key</a>, pair-&gt;<a class="code" href="structpair__t.html#a4971c332851244bac4916d04e6db3b7c">value</a>-&gt;<a class="code" href="structvalue__t.html#a00344d940adac2e92047e60efde51a36">value</a>);
<a name="l02245"></a>02245             <span class="comment">// also put it into the environment</span>
<a name="l02246"></a>02246             variable * <a class="code" href="parse__zvr_8y.html#ac4055e3a20b6b3af3d10590ea446ef6c">v</a> = <a class="code" href="check__netlist_8cpp.html#ac3dc55ce1dfdaf488e9a1cfefd890154">checker_add_variable</a> (env, pair-&gt;<a class="code" href="structpair__t.html#a528541470063ea3e6ef340122e6f946a">key</a>, <a class="code" href="namespacequcs_1_1eqn.html#a6d6a4e1bab3f5e23f5d898059f98c134aee3cae1f3216c92000dfd770eca19bfe">TAG_DOUBLE</a>, <span class="keyword">true</span>);
<a name="l02247"></a>02247             v-&gt;getConstant()-&gt;d = pair-&gt;<a class="code" href="structpair__t.html#a4971c332851244bac4916d04e6db3b7c">value</a>-&gt;<a class="code" href="structvalue__t.html#a00344d940adac2e92047e60efde51a36">value</a>;
<a name="l02248"></a>02248         }
<a name="l02249"></a>02249     }
<a name="l02250"></a>02250 }
<a name="l02251"></a>02251 
<a name="l02252"></a>02252 <span class="comment">/* This is the global netlist checker.  It returns zero on success and</span>
<a name="l02253"></a>02253 <span class="comment">   non-zero on errors. */</span>
<a name="l02254"></a><a class="code" href="check__netlist_8cpp.html#a73524089f49b419831bce135894724c3">02254</a> <span class="keywordtype">int</span> <a class="code" href="check__netlist_8cpp.html#a73524089f49b419831bce135894724c3">netlist_checker</a> (environment * <a class="code" href="structdefinition__t.html#ac790455379f14759e49ec75d5187c85a">env</a>)
<a name="l02255"></a>02255 {
<a name="l02256"></a>02256     <span class="keywordtype">int</span> errors = 0;
<a name="l02257"></a>02257     eqn::node * <a class="code" href="parse__netlist_8y.html#aad664ad10957bf531dcce47612c7677a">eqns</a>;
<a name="l02258"></a>02258     <span class="keyword">struct </span><a class="code" href="structdefinition__t.html">definition_t</a> * def;
<a name="l02259"></a>02259 
<a name="l02260"></a>02260     <span class="comment">// create top-level environment</span>
<a name="l02261"></a>02261     <a class="code" href="check__netlist_8cpp.html#a48cff5ac2e09a83a3ac15628009a4b3f">env_root</a> = <span class="keyword">new</span> environment (env-&gt;getName ());
<a name="l02262"></a>02262     <span class="comment">// create the subcircuit list</span>
<a name="l02263"></a>02263     <a class="code" href="check__netlist_8cpp.html#a743ab6f836d53fd6b166066585882b8c">definition_root</a> = <a class="code" href="check__netlist_8cpp.html#a1da36b88f193c9e93c04e7bdd25a3ad5">checker_build_subcircuits</a> (definition_root);
<a name="l02264"></a>02264     <span class="comment">// get equation list</span>
<a name="l02265"></a>02265     definition_root = <a class="code" href="check__netlist_8cpp.html#ab3b43b25a751a720ed821a6c19bfa840">checker_build_equations</a> (definition_root, &amp;eqns);
<a name="l02266"></a>02266     <span class="comment">// setup the root environment</span>
<a name="l02267"></a>02267     <a class="code" href="check__netlist_8cpp.html#aa0bed64d34b360f83f392a91d49a6eff">checker_setup_env</a> (definition_root, <a class="code" href="check__netlist_8cpp.html#a48cff5ac2e09a83a3ac15628009a4b3f">env_root</a>, eqns);
<a name="l02268"></a>02268     <span class="comment">// check list of subcircuits</span>
<a name="l02269"></a>02269     errors += <a class="code" href="check__netlist_8cpp.html#ac17a524127f28bce022c89bb61eb114a">netlist_checker_intern</a> (<a class="code" href="check__netlist_8cpp.html#a8443096178b6c84a10f0da689c81ee44">subcircuit_root</a>);
<a name="l02270"></a>02270     <span class="comment">// check global netlist</span>
<a name="l02271"></a>02271     errors += <a class="code" href="check__netlist_8cpp.html#ac17a524127f28bce022c89bb61eb114a">netlist_checker_intern</a> (definition_root);
<a name="l02272"></a>02272     <span class="comment">// check equations in root</span>
<a name="l02273"></a>02273     <a class="code" href="check__netlist_8cpp.html#a48cff5ac2e09a83a3ac15628009a4b3f">env_root</a>-&gt;setDefinitions (definition_root);
<a name="l02274"></a>02274     errors += <a class="code" href="check__netlist_8cpp.html#a48cff5ac2e09a83a3ac15628009a4b3f">env_root</a>-&gt;equationChecker (0);
<a name="l02275"></a>02275     <a class="code" href="check__netlist_8cpp.html#a48cff5ac2e09a83a3ac15628009a4b3f">env_root</a>-&gt;setDefinitions (NULL);
<a name="l02276"></a>02276 
<a name="l02277"></a>02277     <span class="comment">// then check each subcircuit list</span>
<a name="l02278"></a>02278     <span class="keywordflow">for</span> (def = <a class="code" href="check__netlist_8cpp.html#a8443096178b6c84a10f0da689c81ee44">subcircuit_root</a>; def != NULL; def = def-&gt;<a class="code" href="structdefinition__t.html#ac6f2d42a0105ff6e699938fcd36bd12b">next</a>)
<a name="l02279"></a>02279     {
<a name="l02280"></a>02280         <span class="comment">// get equation list</span>
<a name="l02281"></a>02281         def-&gt;<a class="code" href="structdefinition__t.html#adbac069b30fc5f0544f09e77e56fa26c">sub</a> = <a class="code" href="check__netlist_8cpp.html#ab3b43b25a751a720ed821a6c19bfa840">checker_build_equations</a> (def-&gt;<a class="code" href="structdefinition__t.html#adbac069b30fc5f0544f09e77e56fa26c">sub</a>, &amp;eqns);
<a name="l02282"></a>02282         <span class="comment">// setup the subcircuit environment</span>
<a name="l02283"></a>02283         environment * subenv = <span class="keyword">new</span> environment (def-&gt;<a class="code" href="structdefinition__t.html#a594dd31d0446b3364e5875eaced950eb">instance</a>);
<a name="l02284"></a>02284         <a class="code" href="check__netlist_8cpp.html#a48cff5ac2e09a83a3ac15628009a4b3f">env_root</a>-&gt;push_front_Child (subenv);
<a name="l02285"></a>02285         <a class="code" href="check__netlist_8cpp.html#aa0bed64d34b360f83f392a91d49a6eff">checker_setup_env</a> (def, subenv, eqns);
<a name="l02286"></a>02286         <span class="keywordflow">if</span> (def-&gt;<a class="code" href="structdefinition__t.html#adbac069b30fc5f0544f09e77e56fa26c">sub</a>) def-&gt;<a class="code" href="structdefinition__t.html#adbac069b30fc5f0544f09e77e56fa26c">sub</a>-&gt;<a class="code" href="structdefinition__t.html#ac790455379f14759e49ec75d5187c85a">env</a> = subenv;
<a name="l02287"></a>02287         <span class="comment">// add subcircuit parameters to equations</span>
<a name="l02288"></a>02288         <a class="code" href="check__netlist_8cpp.html#ac02bf34d648c875c30891c2c7ef339f1">checker_subcircuit_args</a> (def, subenv);
<a name="l02289"></a>02289         <span class="comment">// check subcircuit netlist</span>
<a name="l02290"></a>02290         errors += <a class="code" href="check__netlist_8cpp.html#ac17a524127f28bce022c89bb61eb114a">netlist_checker_intern</a> (def-&gt;<a class="code" href="structdefinition__t.html#adbac069b30fc5f0544f09e77e56fa26c">sub</a>);
<a name="l02291"></a>02291         <span class="comment">// check equations in subcircuit</span>
<a name="l02292"></a>02292         subenv-&gt;setDefinitions (def-&gt;<a class="code" href="structdefinition__t.html#adbac069b30fc5f0544f09e77e56fa26c">sub</a>);
<a name="l02293"></a>02293         errors += subenv-&gt;equationChecker (0);
<a name="l02294"></a>02294         subenv-&gt;setDefinitions (NULL);
<a name="l02295"></a>02295     }
<a name="l02296"></a>02296 
<a name="l02297"></a>02297     <span class="comment">// check actions</span>
<a name="l02298"></a>02298     errors += <a class="code" href="check__netlist_8cpp.html#a1023d56dc59a12d7d94f1f64062d799a">checker_validate_actions</a> (definition_root);
<a name="l02299"></a>02299 
<a name="l02300"></a>02300     <span class="keywordflow">if</span> (!errors)
<a name="l02301"></a>02301     {
<a name="l02302"></a>02302         <span class="comment">// create actual root environment</span>
<a name="l02303"></a>02303         env-&gt;copy (*<a class="code" href="check__netlist_8cpp.html#a48cff5ac2e09a83a3ac15628009a4b3f">env_root</a>);
<a name="l02304"></a>02304         <span class="comment">// and finally expand the subcircuits into the global netlist</span>
<a name="l02305"></a>02305         definition_root = <a class="code" href="check__netlist_8cpp.html#ac3082374448f4725971ae9beaf9a4001">checker_expand_subcircuits</a> (definition_root, env);
<a name="l02306"></a>02306     }
<a name="l02307"></a>02307 
<a name="l02308"></a>02308     <span class="keywordflow">return</span> errors ? -1 : 0;
<a name="l02309"></a>02309 }
<a name="l02310"></a>02310 
<a name="l02311"></a>02311 <span class="comment">/* The function deletes the given definition list. */</span>
<a name="l02312"></a><a class="code" href="check__netlist_8cpp.html#a0a8fdaa4a7d9987119667c5dafa4559b">02312</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="check__netlist_8cpp.html#a0a8fdaa4a7d9987119667c5dafa4559b">netlist_destroy_intern</a> (<span class="keyword">struct</span> <a class="code" href="structdefinition__t.html">definition_t</a> * root)
<a name="l02313"></a>02313 {
<a name="l02314"></a>02314     <span class="keyword">struct </span><a class="code" href="structdefinition__t.html">definition_t</a> * def, * <a class="code" href="parse__spice_8y.html#acde7555eca71d1f823fbaf6f6a1f4670">next</a>;
<a name="l02315"></a>02315     <span class="keywordflow">for</span> (def = root; def != NULL; def = <a class="code" href="parse__spice_8y.html#acde7555eca71d1f823fbaf6f6a1f4670">next</a>)
<a name="l02316"></a>02316     {
<a name="l02317"></a>02317         next = def-&gt;<a class="code" href="structdefinition__t.html#ac6f2d42a0105ff6e699938fcd36bd12b">next</a>;
<a name="l02318"></a>02318         <a class="code" href="check__netlist_8cpp.html#a45b2f9e76ddb150962e5935e10a50508">netlist_free_definition</a> (def);
<a name="l02319"></a>02319     }
<a name="l02320"></a>02320 }
<a name="l02321"></a>02321 
<a name="l02322"></a>02322 <span class="comment">/* Deletes all available definition lists. */</span>
<a name="l02323"></a><a class="code" href="check__netlist_8h.html#abb3dfc92fae0732f210414a0e2e965bd">02323</a> <span class="keywordtype">void</span> <a class="code" href="check__netlist_8cpp.html#abb3dfc92fae0732f210414a0e2e965bd">netlist_destroy</a> (<span class="keywordtype">void</span>)
<a name="l02324"></a>02324 {
<a name="l02325"></a>02325     <a class="code" href="check__netlist_8cpp.html#a0a8fdaa4a7d9987119667c5dafa4559b">netlist_destroy_intern</a> (<a class="code" href="check__netlist_8cpp.html#a743ab6f836d53fd6b166066585882b8c">definition_root</a>);
<a name="l02326"></a>02326     <span class="keywordflow">for</span> (<span class="keyword">struct</span> <a class="code" href="structdefinition__t.html">definition_t</a> * def = <a class="code" href="check__netlist_8cpp.html#a8443096178b6c84a10f0da689c81ee44">subcircuit_root</a>; def; def = def-&gt;<a class="code" href="structdefinition__t.html#ac6f2d42a0105ff6e699938fcd36bd12b">next</a>)
<a name="l02327"></a>02327     {
<a name="l02328"></a>02328         <a class="code" href="check__netlist_8cpp.html#a0a8fdaa4a7d9987119667c5dafa4559b">netlist_destroy_intern</a> (def-&gt;<a class="code" href="structdefinition__t.html#adbac069b30fc5f0544f09e77e56fa26c">sub</a>);
<a name="l02329"></a>02329     }
<a name="l02330"></a>02330     <a class="code" href="check__netlist_8cpp.html#a0a8fdaa4a7d9987119667c5dafa4559b">netlist_destroy_intern</a> (<a class="code" href="check__netlist_8cpp.html#a8443096178b6c84a10f0da689c81ee44">subcircuit_root</a>);
<a name="l02331"></a>02331     <a class="code" href="check__netlist_8cpp.html#a743ab6f836d53fd6b166066585882b8c">definition_root</a> = <a class="code" href="check__netlist_8cpp.html#a8443096178b6c84a10f0da689c81ee44">subcircuit_root</a> = NULL;
<a name="l02332"></a>02332     <a class="code" href="check__netlist_8h.html#a004b35c4a44e3f2dfaad88ea2ec2c4f4">netlist_lex_destroy</a> ();
<a name="l02333"></a>02333 }
<a name="l02334"></a>02334 
<a name="l02335"></a>02335 <span class="comment">/* Delete root environment(s) if necessary. */</span>
<a name="l02336"></a><a class="code" href="check__netlist_8h.html#a5d68dcfb8f42259b036bfb1a2f106d3d">02336</a> <span class="keywordtype">void</span> <a class="code" href="check__netlist_8cpp.html#a5d68dcfb8f42259b036bfb1a2f106d3d">netlist_destroy_env</a> (<span class="keywordtype">void</span>)
<a name="l02337"></a>02337 {
<a name="l02338"></a>02338     <span class="keywordflow">if</span> (<a class="code" href="check__netlist_8cpp.html#a48cff5ac2e09a83a3ac15628009a4b3f">env_root</a> != NULL)
<a name="l02339"></a>02339     {
<a name="l02340"></a>02340         <span class="keyword">delete</span> <a class="code" href="check__netlist_8cpp.html#a48cff5ac2e09a83a3ac15628009a4b3f">env_root</a>;
<a name="l02341"></a>02341         <a class="code" href="check__netlist_8cpp.html#a48cff5ac2e09a83a3ac15628009a4b3f">env_root</a> = NULL;
<a name="l02342"></a>02342     }
<a name="l02343"></a>02343 }
<a name="l02344"></a>02344 
</pre></div></div><!-- contents -->


<hr class="footer"/><address class="footer"><small>
Generated on Sun Feb 1 2015 16:26:52 for Qucs-core by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
