<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Qucs-core: trsolver.cpp Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />



</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">Qucs-core
   &#160;<span id="projectnumber">0.0.19</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">trsolver.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="trsolver_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * trsolver.cpp - transient solver class implementation</span>
<a name="l00003"></a>00003 <span class="comment"> *</span>
<a name="l00004"></a>00004 <span class="comment"> * Copyright (C) 2004, 2005, 2006, 2007, 2009 Stefan Jahn &lt;stefan@lkcc.org&gt;</span>
<a name="l00005"></a>00005 <span class="comment"> *</span>
<a name="l00006"></a>00006 <span class="comment"> * This is free software; you can redistribute it and/or modify</span>
<a name="l00007"></a>00007 <span class="comment"> * it under the terms of the GNU General Public License as published by</span>
<a name="l00008"></a>00008 <span class="comment"> * the Free Software Foundation; either version 2, or (at your option)</span>
<a name="l00009"></a>00009 <span class="comment"> * any later version.</span>
<a name="l00010"></a>00010 <span class="comment"> *</span>
<a name="l00011"></a>00011 <span class="comment"> * This software is distributed in the hope that it will be useful,</span>
<a name="l00012"></a>00012 <span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00013"></a>00013 <span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l00014"></a>00014 <span class="comment"> * GNU General Public License for more details.</span>
<a name="l00015"></a>00015 <span class="comment"> *</span>
<a name="l00016"></a>00016 <span class="comment"> * You should have received a copy of the GNU General Public License</span>
<a name="l00017"></a>00017 <span class="comment"> * along with this package; see the file COPYING.  If not, write to</span>
<a name="l00018"></a>00018 <span class="comment"> * the Free Software Foundation, Inc., 51 Franklin Street - Fifth Floor,</span>
<a name="l00019"></a>00019 <span class="comment"> * Boston, MA 02110-1301, USA.</span>
<a name="l00020"></a>00020 <span class="comment"> *</span>
<a name="l00021"></a>00021 <span class="comment"> * $Id$</span>
<a name="l00022"></a>00022 <span class="comment"> *</span>
<a name="l00023"></a>00023 <span class="comment"> */</span>
<a name="l00024"></a>00024 
<a name="l00025"></a>00025 <span class="preprocessor">#if HAVE_CONFIG_H</span>
<a name="l00026"></a>00026 <span class="preprocessor"></span><span class="preprocessor"># include &lt;<a class="code" href="config_8h.html">config.h</a>&gt;</span>
<a name="l00027"></a>00027 <span class="preprocessor">#endif</span>
<a name="l00028"></a>00028 <span class="preprocessor"></span>
<a name="l00029"></a>00029 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
<a name="l00030"></a>00030 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00031"></a>00031 <span class="preprocessor">#include &lt;float.h&gt;</span>
<a name="l00032"></a>00032 <span class="preprocessor">#include &lt;algorithm&gt;</span>
<a name="l00033"></a>00033 
<a name="l00034"></a>00034 <span class="preprocessor">#include &quot;<a class="code" href="compat_8h.html">compat.h</a>&quot;</span>
<a name="l00035"></a>00035 <span class="preprocessor">#include &quot;<a class="code" href="object_8h.html">object.h</a>&quot;</span>
<a name="l00036"></a>00036 <span class="preprocessor">#include &quot;<a class="code" href="logging_8h.html">logging.h</a>&quot;</span>
<a name="l00037"></a>00037 <span class="preprocessor">#include &quot;<a class="code" href="complex_8h.html">complex.h</a>&quot;</span>
<a name="l00038"></a>00038 <span class="preprocessor">#include &quot;<a class="code" href="circuit_8h.html" title="The circuit class header file.">circuit.h</a>&quot;</span>
<a name="l00039"></a>00039 <span class="preprocessor">#include &quot;<a class="code" href="sweep_8h.html">sweep.h</a>&quot;</span>
<a name="l00040"></a>00040 <span class="preprocessor">#include &quot;<a class="code" href="net_8h.html">net.h</a>&quot;</span>
<a name="l00041"></a>00041 <span class="preprocessor">#include &quot;<a class="code" href="netdefs_8h.html">netdefs.h</a>&quot;</span>
<a name="l00042"></a>00042 <span class="preprocessor">#include &quot;<a class="code" href="analysis_8h.html" title="The analysis class header file.">analysis.h</a>&quot;</span>
<a name="l00043"></a>00043 <span class="preprocessor">#include &quot;<a class="code" href="nasolver_8h.html">nasolver.h</a>&quot;</span>
<a name="l00044"></a>00044 <span class="preprocessor">#include &quot;<a class="code" href="history_8h.html">history.h</a>&quot;</span>
<a name="l00045"></a>00045 <span class="preprocessor">#include &quot;<a class="code" href="trsolver_8h.html">trsolver.h</a>&quot;</span>
<a name="l00046"></a>00046 <span class="preprocessor">#include &quot;<a class="code" href="transient_8h.html">transient.h</a>&quot;</span>
<a name="l00047"></a>00047 <span class="preprocessor">#include &quot;<a class="code" href="exception_8h.html">exception.h</a>&quot;</span>
<a name="l00048"></a>00048 <span class="preprocessor">#include &quot;<a class="code" href="exceptionstack_8h.html">exceptionstack.h</a>&quot;</span>
<a name="l00049"></a>00049 
<a name="l00050"></a><a class="code" href="trsolver_8cpp.html#a98660e0ab553d1df6b47973dbdfb855a">00050</a> <span class="preprocessor">#define STEPDEBUG   0 // set to zero for release</span>
<a name="l00051"></a><a class="code" href="trsolver_8cpp.html#a90268b3e1776a5d9305b92b086cd51eb">00051</a> <span class="preprocessor"></span><span class="preprocessor">#define BREAKPOINTS 0 // exact breakpoint calculation</span>
<a name="l00052"></a>00052 <span class="preprocessor"></span>
<a name="l00053"></a><a class="code" href="trsolver_8cpp.html#adc088a0aa10877612703be46ee0032a3">00053</a> <span class="preprocessor">#define dState 0 // delta T state</span>
<a name="l00054"></a><a class="code" href="trsolver_8cpp.html#a349c2d076c29da463d7c00f73b429397">00054</a> <span class="preprocessor"></span><span class="preprocessor">#define sState 1 // solution state</span>
<a name="l00055"></a>00055 <span class="preprocessor"></span>
<a name="l00056"></a>00056 <span class="comment">// Macro for the n-th state of the solution vector history.</span>
<a name="l00057"></a><a class="code" href="trsolver_8cpp.html#a556f2f68b282379a23e817600a7099ca">00057</a> <span class="preprocessor">#define SOL(state) (solution[(int) getState (sState, (state))])</span>
<a name="l00058"></a>00058 <span class="preprocessor"></span>
<a name="l00059"></a>00059 <span class="keyword">namespace </span><a class="code" href="structqucs.html">qucs</a> {
<a name="l00060"></a>00060 
<a name="l00061"></a>00061 <span class="keyword">using namespace </span>transient;
<a name="l00062"></a>00062 
<a name="l00063"></a>00063 <span class="comment">// Constructor creates an unnamed instance of the trsolver class.</span>
<a name="l00064"></a>00064 trsolver::trsolver ()
<a name="l00065"></a>00065     : nasolver&lt;nr_double_t&gt; (), states&lt;nr_double_t&gt; ()
<a name="l00066"></a>00066 {
<a name="l00067"></a>00067     swp = NULL;
<a name="l00068"></a>00068     <a class="code" href="parse__vcd_8y.html#ae0bd5e8ec17b2aad3338041991eb1056">type</a> = <a class="code" href="structqucs.html#add82670b369206f02d6378e495b91639acfe966377b8f20d6db84dfbc14a4b6d0">ANALYSIS_TRANSIENT</a>;
<a name="l00069"></a>00069     setDescription (<span class="stringliteral">&quot;transient&quot;</span>);
<a name="l00070"></a>00070     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="parse__mdl_8y.html#a7e98b8a17c0aad30ba64d47b74e2a6c1">i</a> = 0; <a class="code" href="parse__mdl_8y.html#a7e98b8a17c0aad30ba64d47b74e2a6c1">i</a> &lt; 8; <a class="code" href="parse__mdl_8y.html#a7e98b8a17c0aad30ba64d47b74e2a6c1">i</a>++) solution[<a class="code" href="parse__mdl_8y.html#a7e98b8a17c0aad30ba64d47b74e2a6c1">i</a>] = NULL;
<a name="l00071"></a>00071     tHistory = NULL;
<a name="l00072"></a>00072     relaxTSR = <span class="keyword">false</span>;
<a name="l00073"></a>00073     initialDC = <span class="keyword">true</span>;
<a name="l00074"></a>00074 }
<a name="l00075"></a>00075 
<a name="l00076"></a>00076 <span class="comment">// Constructor creates a named instance of the trsolver class.</span>
<a name="l00077"></a><a class="code" href="structqucs_1_1trsolver.html#a028d61b34778af903604fed5e973a56e">00077</a> trsolver::trsolver (<span class="keyword">const</span> <a class="code" href="namespacetesting_1_1internal.html#a5ca8a348395a6145775c1a2334e21889">std::string</a> &amp;<a class="code" href="parse__mdl_8y.html#aecba4cab5e52994730d1e21424997b33">n</a>)
<a name="l00078"></a>00078     : <a class="code" href="classqucs_1_1nasolver.html">nasolver</a>&lt;<a class="code" href="config_8h.html#a014aadc409afb297b8247c13f8ca89be">nr_double_t</a>&gt; (n), <a class="code" href="classqucs_1_1states.html" title="template class for storing state variables.">states</a>&lt;<a class="code" href="config_8h.html#a014aadc409afb297b8247c13f8ca89be">nr_double_t</a>&gt; ()
<a name="l00079"></a>00079 {
<a name="l00080"></a>00080     <a class="code" href="structqucs_1_1trsolver.html#a33f47349e0136c248f5ad184b66b604f">swp</a> = NULL;
<a name="l00081"></a>00081     <a class="code" href="parse__vcd_8y.html#ae0bd5e8ec17b2aad3338041991eb1056">type</a> = <a class="code" href="structqucs.html#add82670b369206f02d6378e495b91639acfe966377b8f20d6db84dfbc14a4b6d0">ANALYSIS_TRANSIENT</a>;
<a name="l00082"></a>00082     <a class="code" href="classqucs_1_1nasolver.html#a629e3245d6077438740cf5c57d50c8e2">setDescription</a> (<span class="stringliteral">&quot;transient&quot;</span>);
<a name="l00083"></a>00083     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="parse__mdl_8y.html#a7e98b8a17c0aad30ba64d47b74e2a6c1">i</a> = 0; <a class="code" href="parse__mdl_8y.html#a7e98b8a17c0aad30ba64d47b74e2a6c1">i</a> &lt; 8; <a class="code" href="parse__mdl_8y.html#a7e98b8a17c0aad30ba64d47b74e2a6c1">i</a>++) <a class="code" href="structqucs_1_1trsolver.html#aa87e84f035f603368293538f842110cd">solution</a>[<a class="code" href="parse__mdl_8y.html#a7e98b8a17c0aad30ba64d47b74e2a6c1">i</a>] = NULL;
<a name="l00084"></a>00084     <a class="code" href="structqucs_1_1trsolver.html#a3acfafd77b77337b5a445d57f5d56fd1">tHistory</a> = NULL;
<a name="l00085"></a>00085     <a class="code" href="structqucs_1_1trsolver.html#a345e4b96b7bebb8a7872b9950e6db73e">relaxTSR</a> = <span class="keyword">false</span>;
<a name="l00086"></a>00086     <a class="code" href="structqucs_1_1trsolver.html#aa1cf3ee24cb6e697a0646a46a0c95751">initialDC</a> = <span class="keyword">true</span>;
<a name="l00087"></a>00087 }
<a name="l00088"></a>00088 
<a name="l00089"></a>00089 <span class="comment">// Destructor deletes the trsolver class object.</span>
<a name="l00090"></a><a class="code" href="structqucs_1_1trsolver.html#aed4af337f6293ee160f9c211ba2b5768">00090</a> trsolver::~trsolver ()
<a name="l00091"></a>00091 {
<a name="l00092"></a>00092     <span class="keywordflow">if</span> (swp) <span class="keyword">delete</span> swp;
<a name="l00093"></a>00093     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="parse__mdl_8y.html#a7e98b8a17c0aad30ba64d47b74e2a6c1">i</a> = 0; <a class="code" href="parse__mdl_8y.html#a7e98b8a17c0aad30ba64d47b74e2a6c1">i</a> &lt; 8; <a class="code" href="parse__mdl_8y.html#a7e98b8a17c0aad30ba64d47b74e2a6c1">i</a>++)
<a name="l00094"></a>00094     {
<a name="l00095"></a>00095         <span class="keywordflow">if</span> (solution[<a class="code" href="parse__mdl_8y.html#a7e98b8a17c0aad30ba64d47b74e2a6c1">i</a>] != NULL)
<a name="l00096"></a>00096         {
<a name="l00097"></a>00097             <span class="keyword">delete</span> solution[<a class="code" href="parse__mdl_8y.html#a7e98b8a17c0aad30ba64d47b74e2a6c1">i</a>];
<a name="l00098"></a>00098         }
<a name="l00099"></a>00099     }
<a name="l00100"></a>00100     <span class="keywordflow">if</span> (tHistory) <span class="keyword">delete</span> tHistory;
<a name="l00101"></a>00101 }
<a name="l00102"></a>00102 
<a name="l00103"></a>00103 <span class="comment">/* The copy constructor creates a new instance of the trsolver class</span>
<a name="l00104"></a>00104 <span class="comment">   based on the given trsolver object. */</span>
<a name="l00105"></a><a class="code" href="structqucs_1_1trsolver.html#a34a8a1435e4de212a857a0a219333b67">00105</a> trsolver::trsolver (<a class="code" href="structqucs_1_1trsolver.html">trsolver</a> &amp; o)
<a name="l00106"></a>00106     : <a class="code" href="classqucs_1_1nasolver.html">nasolver</a>&lt;<a class="code" href="config_8h.html#a014aadc409afb297b8247c13f8ca89be">nr_double_t</a>&gt; (o), <a class="code" href="classqucs_1_1states.html" title="template class for storing state variables.">states</a>&lt;<a class="code" href="config_8h.html#a014aadc409afb297b8247c13f8ca89be">nr_double_t</a>&gt; (o)
<a name="l00107"></a>00107 {
<a name="l00108"></a>00108     <a class="code" href="structqucs_1_1trsolver.html#a33f47349e0136c248f5ad184b66b604f">swp</a> = o.<a class="code" href="structqucs_1_1trsolver.html#a33f47349e0136c248f5ad184b66b604f">swp</a> ? <span class="keyword">new</span> <a class="code" href="classqucs_1_1sweep.html">sweep</a> (*o.<a class="code" href="structqucs_1_1trsolver.html#a33f47349e0136c248f5ad184b66b604f">swp</a>) : NULL;
<a name="l00109"></a>00109     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="parse__mdl_8y.html#a7e98b8a17c0aad30ba64d47b74e2a6c1">i</a> = 0; <a class="code" href="parse__mdl_8y.html#a7e98b8a17c0aad30ba64d47b74e2a6c1">i</a> &lt; 8; <a class="code" href="parse__mdl_8y.html#a7e98b8a17c0aad30ba64d47b74e2a6c1">i</a>++) <a class="code" href="structqucs_1_1trsolver.html#aa87e84f035f603368293538f842110cd">solution</a>[<a class="code" href="parse__mdl_8y.html#a7e98b8a17c0aad30ba64d47b74e2a6c1">i</a>] = NULL;
<a name="l00110"></a>00110     <a class="code" href="structqucs_1_1trsolver.html#a3acfafd77b77337b5a445d57f5d56fd1">tHistory</a> = o.<a class="code" href="structqucs_1_1trsolver.html#a3acfafd77b77337b5a445d57f5d56fd1">tHistory</a> ? <span class="keyword">new</span> <a class="code" href="classqucs_1_1history.html">history</a> (*o.<a class="code" href="structqucs_1_1trsolver.html#a3acfafd77b77337b5a445d57f5d56fd1">tHistory</a>) : NULL;
<a name="l00111"></a>00111     <a class="code" href="structqucs_1_1trsolver.html#a345e4b96b7bebb8a7872b9950e6db73e">relaxTSR</a> = o.<a class="code" href="structqucs_1_1trsolver.html#a345e4b96b7bebb8a7872b9950e6db73e">relaxTSR</a>;
<a name="l00112"></a>00112     <a class="code" href="structqucs_1_1trsolver.html#aa1cf3ee24cb6e697a0646a46a0c95751">initialDC</a> = o.<a class="code" href="structqucs_1_1trsolver.html#aa1cf3ee24cb6e697a0646a46a0c95751">initialDC</a>;
<a name="l00113"></a>00113 }
<a name="l00114"></a>00114 
<a name="l00115"></a>00115 <span class="comment">// This function creates the time sweep if necessary.</span>
<a name="l00116"></a><a class="code" href="structqucs_1_1trsolver.html#ac64ec40080fd775bfb6f3b25bb214e25">00116</a> <span class="keywordtype">void</span> trsolver::initSteps (<span class="keywordtype">void</span>)
<a name="l00117"></a>00117 {
<a name="l00118"></a>00118     <span class="keywordflow">if</span> (swp != NULL) <span class="keyword">delete</span> swp;
<a name="l00119"></a>00119     swp = createSweep (<span class="stringliteral">&quot;time&quot;</span>);
<a name="l00120"></a>00120 }
<a name="l00121"></a>00121 
<a name="l00122"></a>00122 <span class="comment">// Performs the initial DC analysis.</span>
<a name="l00123"></a><a class="code" href="structqucs_1_1trsolver.html#a5d67db7f1ea2bc4c4bdb6f5c836007ff">00123</a> <span class="keywordtype">int</span> trsolver::dcAnalysis (<span class="keywordtype">void</span>)
<a name="l00124"></a>00124 {
<a name="l00125"></a>00125     <span class="keywordtype">int</span> error = 0;
<a name="l00126"></a>00126 
<a name="l00127"></a>00127     <span class="comment">// First calculate a initial state using the non-linear DC analysis.</span>
<a name="l00128"></a>00128     setDescription (<span class="stringliteral">&quot;initial DC&quot;</span>);
<a name="l00129"></a>00129     initDC ();
<a name="l00130"></a>00130     setCalculation ((calculate_func_t) &amp;calcDC);
<a name="l00131"></a>00131     solve_pre ();
<a name="l00132"></a>00132     applyNodeset ();
<a name="l00133"></a>00133 
<a name="l00134"></a>00134     <span class="comment">// Run the DC solver once.</span>
<a name="l00135"></a>00135     <a class="code" href="exceptionstack_8h.html#a5123cac5cf3369997ae7bc31d5f1e1ce">try_running</a> ()
<a name="l00136"></a>00136     {
<a name="l00137"></a>00137         error = solve_nonlinear ();
<a name="l00138"></a>00138     }
<a name="l00139"></a>00139     <span class="comment">// Appropriate exception handling.</span>
<a name="l00140"></a>00140     <a class="code" href="exceptionstack_8h.html#a1bcd5362715dd5fbe069fdf9f9b96399">catch_exception</a> ()
<a name="l00141"></a>00141     {
<a name="l00142"></a>00142     <span class="keywordflow">case</span> <a class="code" href="structqucs.html#ac060e999cf6725990fdd6c65600a62e5a28c96ff10d13b86706a9375af2dd7fe0">EXCEPTION_NO_CONVERGENCE</a>:
<a name="l00143"></a>00143         <a class="code" href="exceptionstack_8h.html#aa539da6ed9b41bb5d7db0218eaceeab3">pop_exception</a> ();
<a name="l00144"></a>00144         convHelper = <a class="code" href="nasolver_8h.html#abbd20ba066ff4757da98afbcb782c010">CONV_LineSearch</a>;
<a name="l00145"></a>00145         <a class="code" href="logging_8c.html#abe06a8732a47a291606edcfac5e5146e">logprint</a> (<a class="code" href="logging_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;WARNING: %s: %s analysis failed, using line search &quot;</span>
<a name="l00146"></a>00146                   <span class="stringliteral">&quot;fallback\n&quot;</span>, getName (), getDescription ().c_str());
<a name="l00147"></a>00147         applyNodeset ();
<a name="l00148"></a>00148         restart ();
<a name="l00149"></a>00149         error = solve_nonlinear ();
<a name="l00150"></a>00150         <span class="keywordflow">break</span>;
<a name="l00151"></a>00151     <span class="keywordflow">default</span>:
<a name="l00152"></a>00152         <span class="comment">// Otherwise return.</span>
<a name="l00153"></a>00153         <a class="code" href="structqucs.html#a99a68a2452092cafcd735a48a064a8bf">estack</a>.<a class="code" href="classqucs_1_1exceptionstack.html#a486af86b492f662998c8d7ced9ecd64f">print</a> ();
<a name="l00154"></a>00154         error++;
<a name="l00155"></a>00155         <span class="keywordflow">break</span>;
<a name="l00156"></a>00156     }
<a name="l00157"></a>00157 
<a name="l00158"></a>00158     <span class="comment">// Save the DC solution.</span>
<a name="l00159"></a>00159     storeSolution ();
<a name="l00160"></a>00160 
<a name="l00161"></a>00161     <span class="comment">// Cleanup nodal analysis solver.</span>
<a name="l00162"></a>00162     solve_post ();
<a name="l00163"></a>00163 
<a name="l00164"></a>00164     <span class="comment">// Really failed to find initial DC solution?</span>
<a name="l00165"></a>00165     <span class="keywordflow">if</span> (error)
<a name="l00166"></a>00166     {
<a name="l00167"></a>00167         <a class="code" href="logging_8c.html#abe06a8732a47a291606edcfac5e5146e">logprint</a> (<a class="code" href="logging_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;ERROR: %s: %s analysis failed\n&quot;</span>,
<a name="l00168"></a>00168                   getName (), getDescription ().c_str());
<a name="l00169"></a>00169     }
<a name="l00170"></a>00170     <span class="keywordflow">return</span> error;
<a name="l00171"></a>00171 }
<a name="l00172"></a>00172 
<a name="l00173"></a>00173 <span class="comment">/* This is the transient netlist solver.  It prepares the circuit list</span>
<a name="l00174"></a>00174 <span class="comment">   for each requested time and solves it then. */</span>
<a name="l00175"></a><a class="code" href="structqucs_1_1trsolver.html#a3f3339ea902f481f70e11699bd59caa5">00175</a> <span class="keywordtype">int</span> trsolver::solve (<span class="keywordtype">void</span>)
<a name="l00176"></a>00176 {
<a name="l00177"></a>00177     <a class="code" href="config_8h.html#a014aadc409afb297b8247c13f8ca89be">nr_double_t</a> time, saveCurrent;
<a name="l00178"></a>00178     <span class="keywordtype">int</span> error = 0, convError = 0;
<a name="l00179"></a>00179     <span class="keyword">const</span> <span class="keywordtype">char</span> * <span class="keyword">const</span> solver = getPropertyString (<span class="stringliteral">&quot;Solver&quot;</span>);
<a name="l00180"></a>00180     relaxTSR = !strcmp (getPropertyString (<span class="stringliteral">&quot;relaxTSR&quot;</span>), <span class="stringliteral">&quot;yes&quot;</span>) ? <span class="keyword">true</span> : <span class="keyword">false</span>;
<a name="l00181"></a>00181     initialDC = !strcmp (getPropertyString (<span class="stringliteral">&quot;initialDC&quot;</span>), <span class="stringliteral">&quot;yes&quot;</span>) ? <span class="keyword">true</span> : <span class="keyword">false</span>;
<a name="l00182"></a>00182 
<a name="l00183"></a>00183     runs++;
<a name="l00184"></a>00184     saveCurrent = current = 0;
<a name="l00185"></a>00185     stepDelta = -1;
<a name="l00186"></a>00186     converged = 0;
<a name="l00187"></a>00187     fixpoint = 0;
<a name="l00188"></a>00188     statRejected = statSteps = statIterations = statConvergence = 0;
<a name="l00189"></a>00189 
<a name="l00190"></a>00190     <span class="comment">// Choose a solver.</span>
<a name="l00191"></a>00191     <span class="keywordflow">if</span> (!strcmp (solver, <span class="stringliteral">&quot;CroutLU&quot;</span>))
<a name="l00192"></a>00192         eqnAlgo = <a class="code" href="eqnsys_8h.html#a92b72228de8e945a7cbdf109a4e3c14fa6cea149798988dc30e1b4186f8a3c8dd">ALGO_LU_DECOMPOSITION</a>;
<a name="l00193"></a>00193     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp (solver, <span class="stringliteral">&quot;DoolittleLU&quot;</span>))
<a name="l00194"></a>00194         eqnAlgo = <a class="code" href="eqnsys_8h.html#a92b72228de8e945a7cbdf109a4e3c14fa196dd5d012d40c13cf4de90b0b8edf45">ALGO_LU_DECOMPOSITION_DOOLITTLE</a>;
<a name="l00195"></a>00195     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp (solver, <span class="stringliteral">&quot;HouseholderQR&quot;</span>))
<a name="l00196"></a>00196         eqnAlgo = <a class="code" href="eqnsys_8h.html#a92b72228de8e945a7cbdf109a4e3c14fac3b1d218379ff03900575a1649bf647a">ALGO_QR_DECOMPOSITION</a>;
<a name="l00197"></a>00197     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp (solver, <span class="stringliteral">&quot;HouseholderLQ&quot;</span>))
<a name="l00198"></a>00198         eqnAlgo = <a class="code" href="eqnsys_8h.html#a92b72228de8e945a7cbdf109a4e3c14faba3f98b09f5a0e9521f8def8bf318ad7">ALGO_QR_DECOMPOSITION_LS</a>;
<a name="l00199"></a>00199     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp (solver, <span class="stringliteral">&quot;GolubSVD&quot;</span>))
<a name="l00200"></a>00200         eqnAlgo = <a class="code" href="eqnsys_8h.html#a92b72228de8e945a7cbdf109a4e3c14fafb3adc3a0e09ab386f1f4ed0c6d174d7">ALGO_SV_DECOMPOSITION</a>;
<a name="l00201"></a>00201 
<a name="l00202"></a>00202     <span class="comment">// Perform initial DC analysis.</span>
<a name="l00203"></a>00203     <span class="keywordflow">if</span> (initialDC)
<a name="l00204"></a>00204     {
<a name="l00205"></a>00205         error = dcAnalysis ();
<a name="l00206"></a>00206         <span class="keywordflow">if</span> (error)
<a name="l00207"></a>00207             <span class="keywordflow">return</span> -1;
<a name="l00208"></a>00208     }
<a name="l00209"></a>00209 
<a name="l00210"></a>00210     <span class="comment">// Initialize transient analysis.</span>
<a name="l00211"></a>00211     setDescription (<span class="stringliteral">&quot;transient&quot;</span>);
<a name="l00212"></a>00212     initTR ();
<a name="l00213"></a>00213     setCalculation ((calculate_func_t) &amp;calcTR);
<a name="l00214"></a>00214     solve_pre ();
<a name="l00215"></a>00215 
<a name="l00216"></a>00216     <span class="comment">// Create time sweep if necessary.</span>
<a name="l00217"></a>00217     initSteps ();
<a name="l00218"></a>00218     swp-&gt;reset ();
<a name="l00219"></a>00219 
<a name="l00220"></a>00220     <span class="comment">// Recall the DC solution.</span>
<a name="l00221"></a>00221     recallSolution ();
<a name="l00222"></a>00222 
<a name="l00223"></a>00223     <span class="comment">// Apply the nodesets and adjust previous solutions.</span>
<a name="l00224"></a>00224     applyNodeset (<span class="keyword">false</span>);
<a name="l00225"></a>00225     fillSolution (<a class="code" href="parse__mdl_8y.html#a9336ebf25087d91c818ee6e9ec29f8c1">x</a>);
<a name="l00226"></a>00226 
<a name="l00227"></a>00227     <span class="comment">// Tell integrators to be initialized.</span>
<a name="l00228"></a>00228     setMode (<a class="code" href="integrator_8h.html#a2c053dea44a70ca5cbc019cb7ba7086a">MODE_INIT</a>);
<a name="l00229"></a>00229 
<a name="l00230"></a>00230     <span class="keywordtype">int</span> running = 0;
<a name="l00231"></a>00231     rejected = 0;
<a name="l00232"></a>00232     delta /= 10;
<a name="l00233"></a>00233     fillState (<a class="code" href="trsolver_8cpp.html#adc088a0aa10877612703be46ee0032a3">dState</a>, delta);
<a name="l00234"></a>00234     adjustOrder (1);
<a name="l00235"></a>00235 
<a name="l00236"></a>00236     <span class="comment">// Start to sweep through time.</span>
<a name="l00237"></a>00237     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="parse__mdl_8y.html#a7e98b8a17c0aad30ba64d47b74e2a6c1">i</a> = 0; <a class="code" href="parse__mdl_8y.html#a7e98b8a17c0aad30ba64d47b74e2a6c1">i</a> &lt; swp-&gt;getSize (); <a class="code" href="parse__mdl_8y.html#a7e98b8a17c0aad30ba64d47b74e2a6c1">i</a>++)
<a name="l00238"></a>00238     {
<a name="l00239"></a>00239         time = swp-&gt;next ();
<a name="l00240"></a>00240         <span class="keywordflow">if</span> (progress) <a class="code" href="logging_8c.html#a81eabf431f4c406062f223e3d5f4a1b7">logprogressbar</a> (<a class="code" href="parse__mdl_8y.html#a7e98b8a17c0aad30ba64d47b74e2a6c1">i</a>, swp-&gt;getSize (), 40);
<a name="l00241"></a>00241 
<a name="l00242"></a>00242 <span class="preprocessor">#if DEBUG &amp;&amp; 0</span>
<a name="l00243"></a>00243 <span class="preprocessor"></span>        <a class="code" href="logging_8c.html#abe06a8732a47a291606edcfac5e5146e">logprint</a> (<a class="code" href="logging_8h.html#a9b52156aa5746cc612e2e3edea6d5dbd">LOG_STATUS</a>, <span class="stringliteral">&quot;NOTIFY: %s: solving netlist for t = %e\n&quot;</span>,
<a name="l00244"></a>00244                   getName (), (<span class="keywordtype">double</span>) time);
<a name="l00245"></a>00245 <span class="preprocessor">#endif</span>
<a name="l00246"></a>00246 <span class="preprocessor"></span>
<a name="l00247"></a>00247         <span class="keywordflow">do</span> <span class="comment">// while (saveCurrent &lt; time), i.e. until a requested breakpoint is hit</span>
<a name="l00248"></a>00248         {
<a name="l00249"></a>00249 <span class="preprocessor">#if STEPDEBUG</span>
<a name="l00250"></a>00250 <span class="preprocessor"></span>            <span class="keywordflow">if</span> (delta == deltaMin)
<a name="l00251"></a>00251             {
<a name="l00252"></a>00252                 <span class="comment">// the integrator step size has become smaller than the</span>
<a name="l00253"></a>00253                 <span class="comment">// specified allowed minimum, Qucs is unable to solve the circuit</span>
<a name="l00254"></a>00254                 <span class="comment">// while meeting the tolerance conditions</span>
<a name="l00255"></a>00255                 <a class="code" href="logging_8c.html#abe06a8732a47a291606edcfac5e5146e">logprint</a> (<a class="code" href="logging_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>,
<a name="l00256"></a>00256                           <span class="stringliteral">&quot;WARNING: %s: minimum delta h = %.3e at t = %.3e\n&quot;</span>,
<a name="l00257"></a>00257                           getName (), (<span class="keywordtype">double</span>) delta, (<span class="keywordtype">double</span>) current);
<a name="l00258"></a>00258             }
<a name="l00259"></a>00259 <span class="preprocessor">#endif</span>
<a name="l00260"></a>00260 <span class="preprocessor"></span>            <span class="comment">// updates the integrator coefficients, and updates the array of prev</span>
<a name="l00261"></a>00261             <span class="comment">// 8 deltas with the new delta for this step</span>
<a name="l00262"></a>00262             updateCoefficients (delta);
<a name="l00263"></a>00263 
<a name="l00264"></a>00264             <span class="comment">// Run predictor to get a start value for the solution vector for</span>
<a name="l00265"></a>00265             <span class="comment">// the successive iterative corrector process</span>
<a name="l00266"></a>00266             error += predictor ();
<a name="l00267"></a>00267 
<a name="l00268"></a>00268             <span class="comment">// restart Newton iteration</span>
<a name="l00269"></a>00269             <span class="keywordflow">if</span> (rejected)
<a name="l00270"></a>00270             {
<a name="l00271"></a>00271                 restart ();      <span class="comment">// restart non-linear devices</span>
<a name="l00272"></a>00272                 rejected = 0;
<a name="l00273"></a>00273             }
<a name="l00274"></a>00274 
<a name="l00275"></a>00275             <span class="comment">// Run corrector process with appropriate exception handling.</span>
<a name="l00276"></a>00276             <span class="comment">// The corrector iterates through the solutions of the integration</span>
<a name="l00277"></a>00277             <span class="comment">// process until a certain error tolerance has been reached.</span>
<a name="l00278"></a>00278             <a class="code" href="exceptionstack_8h.html#a5123cac5cf3369997ae7bc31d5f1e1ce">try_running</a> () <span class="comment">// #defined as:    do {</span>
<a name="l00279"></a>00279             {
<a name="l00280"></a>00280                 error += corrector ();
<a name="l00281"></a>00281             }
<a name="l00282"></a>00282             <a class="code" href="exceptionstack_8h.html#a1bcd5362715dd5fbe069fdf9f9b96399">catch_exception</a> () <span class="comment">// #defined as:   } while (0); if (estack.top ()) switch (estack.top()-&gt;getCode ())</span>
<a name="l00283"></a>00283             {
<a name="l00284"></a>00284             <span class="keywordflow">case</span> <a class="code" href="structqucs.html#ac060e999cf6725990fdd6c65600a62e5a28c96ff10d13b86706a9375af2dd7fe0">EXCEPTION_NO_CONVERGENCE</a>:
<a name="l00285"></a>00285                 <a class="code" href="exceptionstack_8h.html#aa539da6ed9b41bb5d7db0218eaceeab3">pop_exception</a> ();
<a name="l00286"></a>00286 
<a name="l00287"></a>00287                 <span class="comment">// step back from the current time value to the previous time</span>
<a name="l00288"></a>00288                 <span class="keywordflow">if</span> (current &gt; 0) current -= delta;
<a name="l00289"></a>00289                 <span class="comment">// Reduce step-size (by half) if failed to converge.</span>
<a name="l00290"></a>00290                 delta /= 2;
<a name="l00291"></a>00291                 <span class="keywordflow">if</span> (delta &lt;= deltaMin)
<a name="l00292"></a>00292                 {
<a name="l00293"></a>00293                     <span class="comment">// but do not reduce the step size below a specified minimum</span>
<a name="l00294"></a>00294                     delta = deltaMin;
<a name="l00295"></a>00295                     <span class="comment">// instead reduce the order of the integration</span>
<a name="l00296"></a>00296                     adjustOrder (1);
<a name="l00297"></a>00297                 }
<a name="l00298"></a>00298                 <span class="comment">// step forward to the new current time value</span>
<a name="l00299"></a>00299                 <span class="keywordflow">if</span> (current &gt; 0) current += delta;
<a name="l00300"></a>00300 
<a name="l00301"></a>00301                 <span class="comment">// Update statistics.</span>
<a name="l00302"></a>00302                 statRejected++;
<a name="l00303"></a>00303                 statConvergence++;
<a name="l00304"></a>00304                 rejected++; <span class="comment">// mark the previous step size choice as rejected</span>
<a name="l00305"></a>00305                 converged = 0;
<a name="l00306"></a>00306                 error = 0;
<a name="l00307"></a>00307 
<a name="l00308"></a>00308                 <span class="comment">// Start using damped Newton-Raphson.</span>
<a name="l00309"></a>00309                 convHelper = <a class="code" href="nasolver_8h.html#acbe2ee03561cd901e9175a2492a9b3a0">CONV_SteepestDescent</a>;
<a name="l00310"></a>00310                 convError = 2;
<a name="l00311"></a>00311 <span class="preprocessor">#if DEBUG</span>
<a name="l00312"></a>00312 <span class="preprocessor"></span>                <a class="code" href="logging_8c.html#abe06a8732a47a291606edcfac5e5146e">logprint</a> (<a class="code" href="logging_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;WARNING: delta rejected at t = %.3e, h = %.3e &quot;</span>
<a name="l00313"></a>00313                           <span class="stringliteral">&quot;(no convergence)\n&quot;</span>, (<span class="keywordtype">double</span>) saveCurrent, (<span class="keywordtype">double</span>) delta);
<a name="l00314"></a>00314 <span class="preprocessor">#endif</span>
<a name="l00315"></a>00315 <span class="preprocessor"></span>                <span class="keywordflow">break</span>;
<a name="l00316"></a>00316             <span class="keywordflow">default</span>:
<a name="l00317"></a>00317                 <span class="comment">// Otherwise return.</span>
<a name="l00318"></a>00318                 <a class="code" href="structqucs.html#a99a68a2452092cafcd735a48a064a8bf">estack</a>.<a class="code" href="classqucs_1_1exceptionstack.html#a486af86b492f662998c8d7ced9ecd64f">print</a> ();
<a name="l00319"></a>00319                 error++;
<a name="l00320"></a>00320                 <span class="keywordflow">break</span>;
<a name="l00321"></a>00321             }
<a name="l00322"></a>00322             <span class="comment">// return if any errors occured other than convergence failure</span>
<a name="l00323"></a>00323             <span class="keywordflow">if</span> (error) <span class="keywordflow">return</span> -1;
<a name="l00324"></a>00324 
<a name="l00325"></a>00325             <span class="comment">// if the step was rejected, the solution loop is restarted here</span>
<a name="l00326"></a>00326             <span class="keywordflow">if</span> (rejected) <span class="keywordflow">continue</span>;
<a name="l00327"></a>00327 
<a name="l00328"></a>00328             <span class="comment">// check whether Jacobian matrix is still non-singular</span>
<a name="l00329"></a>00329             <span class="keywordflow">if</span> (!<a class="code" href="eqndefined_8cpp.html#a70993d52766e31cb0157958a18aa499a">A</a>-&gt;isFinite ())
<a name="l00330"></a>00330             {
<a name="l00331"></a>00331                 <a class="code" href="logging_8c.html#abe06a8732a47a291606edcfac5e5146e">logprint</a> (<a class="code" href="logging_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;ERROR: %s: Jacobian singular at t = %.3e, &quot;</span>
<a name="l00332"></a>00332                           <span class="stringliteral">&quot;aborting %s analysis\n&quot;</span>, getName (), (<span class="keywordtype">double</span>) current,
<a name="l00333"></a>00333                           getDescription ().c_str());
<a name="l00334"></a>00334                 <span class="keywordflow">return</span> -1;
<a name="l00335"></a>00335             }
<a name="l00336"></a>00336 
<a name="l00337"></a>00337             <span class="comment">// Update statistics and no more damped Newton-Raphson.</span>
<a name="l00338"></a>00338             statIterations += iterations;
<a name="l00339"></a>00339             <span class="keywordflow">if</span> (--convError &lt; 0) convHelper = 0;
<a name="l00340"></a>00340 
<a name="l00341"></a>00341             <span class="comment">// Now advance in time or not...</span>
<a name="l00342"></a>00342             <span class="keywordflow">if</span> (running &gt; 1)
<a name="l00343"></a>00343             {
<a name="l00344"></a>00344                 adjustDelta (time);
<a name="l00345"></a>00345                 adjustOrder ();
<a name="l00346"></a>00346             }
<a name="l00347"></a>00347             <span class="keywordflow">else</span>
<a name="l00348"></a>00348             {
<a name="l00349"></a>00349                 fillStates ();
<a name="l00350"></a>00350                 nextStates ();
<a name="l00351"></a>00351                 rejected = 0;
<a name="l00352"></a>00352             }
<a name="l00353"></a>00353 
<a name="l00354"></a>00354             saveCurrent = current;
<a name="l00355"></a>00355             current += delta;
<a name="l00356"></a>00356             running++;
<a name="l00357"></a>00357             converged++;
<a name="l00358"></a>00358 
<a name="l00359"></a>00359             <span class="comment">// Tell integrators to be running.</span>
<a name="l00360"></a>00360             setMode (<a class="code" href="integrator_8h.html#a711fffeb11b40c66d48792fcd6664aa7">MODE_NONE</a>);
<a name="l00361"></a>00361 
<a name="l00362"></a>00362             <span class="comment">// Initialize or update history.</span>
<a name="l00363"></a>00363             <span class="keywordflow">if</span> (running &gt; 1)
<a name="l00364"></a>00364             {
<a name="l00365"></a>00365                 updateHistory (saveCurrent);
<a name="l00366"></a>00366             }
<a name="l00367"></a>00367             <span class="keywordflow">else</span>
<a name="l00368"></a>00368             {
<a name="l00369"></a>00369                 initHistory (saveCurrent);
<a name="l00370"></a>00370             }
<a name="l00371"></a>00371         }
<a name="l00372"></a>00372         <span class="keywordflow">while</span> (saveCurrent &lt; time); <span class="comment">// Hit a requested time point?</span>
<a name="l00373"></a>00373 
<a name="l00374"></a>00374         <span class="comment">// Save results.</span>
<a name="l00375"></a>00375 <span class="preprocessor">#if STEPDEBUG</span>
<a name="l00376"></a>00376 <span class="preprocessor"></span>        <a class="code" href="logging_8c.html#abe06a8732a47a291606edcfac5e5146e">logprint</a> (<a class="code" href="logging_8h.html#a9b52156aa5746cc612e2e3edea6d5dbd">LOG_STATUS</a>, <span class="stringliteral">&quot;DEBUG: save point at t = %.3e, h = %.3e\n&quot;</span>,
<a name="l00377"></a>00377                   (<span class="keywordtype">double</span>) saveCurrent, (<span class="keywordtype">double</span>) delta);
<a name="l00378"></a>00378 <span class="preprocessor">#endif</span>
<a name="l00379"></a>00379 <span class="preprocessor"></span>
<a name="l00380"></a>00380 <span class="preprocessor">#if BREAKPOINTS</span>
<a name="l00381"></a>00381 <span class="preprocessor"></span>        saveAllResults (saveCurrent);
<a name="l00382"></a>00382 <span class="preprocessor">#else</span>
<a name="l00383"></a>00383 <span class="preprocessor"></span>        saveAllResults (time);
<a name="l00384"></a>00384 <span class="preprocessor">#endif</span>
<a name="l00385"></a>00385 <span class="preprocessor"></span>    } <span class="comment">// for (int i = 0; i &lt; swp-&gt;getSize (); i++)</span>
<a name="l00386"></a>00386 
<a name="l00387"></a>00387     solve_post ();
<a name="l00388"></a>00388     <span class="keywordflow">if</span> (progress) <a class="code" href="logging_8c.html#ae978b0a54ab3a7b39fa6c540df3907c6">logprogressclear</a> (40);
<a name="l00389"></a>00389     <a class="code" href="logging_8c.html#abe06a8732a47a291606edcfac5e5146e">logprint</a> (<a class="code" href="logging_8h.html#a9b52156aa5746cc612e2e3edea6d5dbd">LOG_STATUS</a>, <span class="stringliteral">&quot;NOTIFY: %s: average time-step %g, %d rejections\n&quot;</span>,
<a name="l00390"></a>00390               getName (), (<span class="keywordtype">double</span>) (saveCurrent / statSteps), statRejected);
<a name="l00391"></a>00391     <a class="code" href="logging_8c.html#abe06a8732a47a291606edcfac5e5146e">logprint</a> (<a class="code" href="logging_8h.html#a9b52156aa5746cc612e2e3edea6d5dbd">LOG_STATUS</a>, <span class="stringliteral">&quot;NOTIFY: %s: average NR-iterations %g, &quot;</span>
<a name="l00392"></a>00392               <span class="stringliteral">&quot;%d non-convergences\n&quot;</span>, getName (),
<a name="l00393"></a>00393               (<span class="keywordtype">double</span>) statIterations / statSteps, statConvergence);
<a name="l00394"></a>00394 
<a name="l00395"></a>00395     <span class="comment">// cleanup</span>
<a name="l00396"></a>00396     deinitTR ();
<a name="l00397"></a>00397     <span class="keywordflow">return</span> 0;
<a name="l00398"></a>00398 }
<a name="l00399"></a>00399 
<a name="l00400"></a>00400 <span class="comment">// The function initializes the history.</span>
<a name="l00401"></a><a class="code" href="structqucs_1_1trsolver.html#a08fdb635d5020a8e07014bdced9c26ed">00401</a> <span class="keywordtype">void</span> trsolver::initHistory (<a class="code" href="config_8h.html#a014aadc409afb297b8247c13f8ca89be">nr_double_t</a> <a class="code" href="parse__vcd_8y.html#aaccc9105df5383111407fd5b41255e23">t</a>)
<a name="l00402"></a>00402 {
<a name="l00403"></a>00403     <span class="comment">// initialize time vector</span>
<a name="l00404"></a>00404     tHistory = <span class="keyword">new</span> <a class="code" href="classqucs_1_1history.html">history</a> ();
<a name="l00405"></a>00405     tHistory-&gt;push_back(t);
<a name="l00406"></a>00406     tHistory-&gt;self ();
<a name="l00407"></a>00407     <span class="comment">// initialize circuit histories</span>
<a name="l00408"></a>00408     <a class="code" href="config_8h.html#a014aadc409afb297b8247c13f8ca89be">nr_double_t</a> age = 0.0;
<a name="l00409"></a>00409     <a class="code" href="classqucs_1_1circuit.html" title="base class for qucs circuit elements.">circuit</a> * root = subnet-&gt;getRoot ();
<a name="l00410"></a>00410     <span class="keywordflow">for</span> (<a class="code" href="classqucs_1_1circuit.html" title="base class for qucs circuit elements.">circuit</a> * <a class="code" href="parse__netlist_8y.html#a519cf159c27abd2374c9f649b9e9946d">c</a> = root; <a class="code" href="parse__netlist_8y.html#a519cf159c27abd2374c9f649b9e9946d">c</a> != NULL; <a class="code" href="parse__netlist_8y.html#a519cf159c27abd2374c9f649b9e9946d">c</a> = (<a class="code" href="classqucs_1_1circuit.html" title="base class for qucs circuit elements.">circuit</a> *) <a class="code" href="parse__netlist_8y.html#a519cf159c27abd2374c9f649b9e9946d">c</a>-&gt;<a class="code" href="classqucs_1_1eqn_1_1node.html#ad2f8b4edb365f182a9c9eed4af7491fc">getNext</a> ())
<a name="l00411"></a>00411     {
<a name="l00412"></a>00412         <span class="keywordflow">if</span> (<a class="code" href="parse__netlist_8y.html#a519cf159c27abd2374c9f649b9e9946d">c</a>-&gt;hasHistory ())
<a name="l00413"></a>00413         {
<a name="l00414"></a>00414             <a class="code" href="parse__netlist_8y.html#a519cf159c27abd2374c9f649b9e9946d">c</a>-&gt;applyHistory (tHistory);
<a name="l00415"></a>00415             saveHistory (<a class="code" href="parse__netlist_8y.html#a519cf159c27abd2374c9f649b9e9946d">c</a>);
<a name="l00416"></a>00416             <span class="keywordflow">if</span> (<a class="code" href="parse__netlist_8y.html#a519cf159c27abd2374c9f649b9e9946d">c</a>-&gt;getHistoryAge () &gt; age)
<a name="l00417"></a>00417             {
<a name="l00418"></a>00418                 age = <a class="code" href="parse__netlist_8y.html#a519cf159c27abd2374c9f649b9e9946d">c</a>-&gt;getHistoryAge ();
<a name="l00419"></a>00419             }
<a name="l00420"></a>00420         }
<a name="l00421"></a>00421     }
<a name="l00422"></a>00422     <span class="comment">// set maximum required age for all circuits</span>
<a name="l00423"></a>00423     tHistory-&gt;setAge (age);
<a name="l00424"></a>00424 }
<a name="l00425"></a>00425 
<a name="l00426"></a>00426 <span class="comment">/* The following function updates the histories for the circuits which</span>
<a name="l00427"></a>00427 <span class="comment">   requested them. */</span>
<a name="l00428"></a><a class="code" href="structqucs_1_1trsolver.html#a3397ee8ae6ee24c3447c0d3707b624ca">00428</a> <span class="keywordtype">void</span> trsolver::updateHistory (<a class="code" href="config_8h.html#a014aadc409afb297b8247c13f8ca89be">nr_double_t</a> <a class="code" href="parse__vcd_8y.html#aaccc9105df5383111407fd5b41255e23">t</a>)
<a name="l00429"></a>00429 {
<a name="l00430"></a>00430     <span class="keywordflow">if</span> (t &gt; tHistory-&gt;last ())
<a name="l00431"></a>00431     {
<a name="l00432"></a>00432         <span class="comment">// update time vector</span>
<a name="l00433"></a>00433         tHistory-&gt;push_back (t);
<a name="l00434"></a>00434         <span class="comment">// update circuit histories</span>
<a name="l00435"></a>00435         <a class="code" href="classqucs_1_1circuit.html" title="base class for qucs circuit elements.">circuit</a> * root = subnet-&gt;getRoot ();
<a name="l00436"></a>00436         <span class="keywordflow">for</span> (<a class="code" href="classqucs_1_1circuit.html" title="base class for qucs circuit elements.">circuit</a> * <a class="code" href="parse__netlist_8y.html#a519cf159c27abd2374c9f649b9e9946d">c</a> = root; <a class="code" href="parse__netlist_8y.html#a519cf159c27abd2374c9f649b9e9946d">c</a> != NULL; <a class="code" href="parse__netlist_8y.html#a519cf159c27abd2374c9f649b9e9946d">c</a> = (<a class="code" href="classqucs_1_1circuit.html" title="base class for qucs circuit elements.">circuit</a> *) <a class="code" href="parse__netlist_8y.html#a519cf159c27abd2374c9f649b9e9946d">c</a>-&gt;<a class="code" href="classqucs_1_1eqn_1_1node.html#ad2f8b4edb365f182a9c9eed4af7491fc">getNext</a> ())
<a name="l00437"></a>00437         {
<a name="l00438"></a>00438             <span class="keywordflow">if</span> (<a class="code" href="parse__netlist_8y.html#a519cf159c27abd2374c9f649b9e9946d">c</a>-&gt;hasHistory ()) saveHistory (<a class="code" href="parse__netlist_8y.html#a519cf159c27abd2374c9f649b9e9946d">c</a>);
<a name="l00439"></a>00439         }
<a name="l00440"></a>00440         tHistory-&gt;drop ();
<a name="l00441"></a>00441     }
<a name="l00442"></a>00442 }
<a name="l00443"></a>00443 
<a name="l00444"></a>00444 <span class="comment">// Stores node voltages and branch currents in the given circuits history.</span>
<a name="l00445"></a><a class="code" href="structqucs_1_1trsolver.html#a624597132dc200192e6f516b0f985dd9">00445</a> <span class="keywordtype">void</span> trsolver::saveHistory (<a class="code" href="classqucs_1_1circuit.html" title="base class for qucs circuit elements.">circuit</a> * <a class="code" href="parse__netlist_8y.html#a519cf159c27abd2374c9f649b9e9946d">c</a>)
<a name="l00446"></a>00446 {
<a name="l00447"></a>00447 
<a name="l00448"></a>00448     <span class="keywordtype">int</span> <a class="code" href="equation_8cpp.html#a540f72cb9bcf86a19e3bbc259b9ec3e0">N</a> = countNodes ();
<a name="l00449"></a>00449     <span class="keywordtype">int</span> <a class="code" href="parse__mdl_8y.html#a514f1b439f404f86f77090fa9edc96ce">r</a>, <a class="code" href="parse__mdl_8y.html#a7e98b8a17c0aad30ba64d47b74e2a6c1">i</a>, s = c-&gt;<a class="code" href="classqucs_1_1circuit.html#aed2de3b676324a1c1ded4e0f3c6025a4" title="Get the number of ports the circuit element has.">getSize</a> ();
<a name="l00450"></a>00450 
<a name="l00451"></a>00451     <span class="keywordflow">for</span> (i = 0; i &lt; s; i++)
<a name="l00452"></a>00452     {
<a name="l00453"></a>00453         <span class="comment">// save node voltages</span>
<a name="l00454"></a>00454         r = findAssignedNode (c, i);
<a name="l00455"></a>00455         <span class="keywordflow">if</span> (r &lt; 0)
<a name="l00456"></a>00456             <span class="comment">// the node was not found, append a zero to the history</span>
<a name="l00457"></a>00457             <span class="comment">// matching this index</span>
<a name="l00458"></a>00458             c-&gt;<a class="code" href="classqucs_1_1circuit.html#a92c063e3de4c3ae980feef8b1399a5a6">appendHistory</a> (i, 0.0);
<a name="l00459"></a>00459         <span class="keywordflow">else</span>
<a name="l00460"></a>00460             <span class="comment">// the node was found, append the voltage value to</span>
<a name="l00461"></a>00461             <span class="comment">// that node&#39;s history</span>
<a name="l00462"></a>00462             c-&gt;<a class="code" href="classqucs_1_1circuit.html#a92c063e3de4c3ae980feef8b1399a5a6">appendHistory</a> (i, <a class="code" href="parse__mdl_8y.html#a9336ebf25087d91c818ee6e9ec29f8c1">x</a>-&gt;get (r));
<a name="l00463"></a>00463     }
<a name="l00464"></a>00464 
<a name="l00465"></a>00465     <span class="keywordflow">for</span> (i = 0; i &lt; c-&gt;<a class="code" href="classqucs_1_1circuit.html#a4665cb89cb115ad292275212a9e47144">getVoltageSources</a> (); i++)
<a name="l00466"></a>00466     {
<a name="l00467"></a>00467         <span class="comment">// save branch currents</span>
<a name="l00468"></a>00468         r = c-&gt;<a class="code" href="classqucs_1_1circuit.html#a393ca06fd0735f88c9cd98e82a67a074">getVoltageSource</a> () + <a class="code" href="parse__mdl_8y.html#a7e98b8a17c0aad30ba64d47b74e2a6c1">i</a>;
<a name="l00469"></a>00469         c-&gt;<a class="code" href="classqucs_1_1circuit.html#a92c063e3de4c3ae980feef8b1399a5a6">appendHistory</a> (i + s, <a class="code" href="parse__mdl_8y.html#a9336ebf25087d91c818ee6e9ec29f8c1">x</a>-&gt;get (r + N));
<a name="l00470"></a>00470     }
<a name="l00471"></a>00471 
<a name="l00472"></a>00472 }
<a name="l00473"></a>00473 
<a name="l00474"></a>00474 <span class="comment">/* This function predicts a start value for the solution vector for</span>
<a name="l00475"></a>00475 <span class="comment">   the successive iterative corrector process. */</span>
<a name="l00476"></a><a class="code" href="structqucs_1_1trsolver.html#af9e1ff1859f5221229860afa0e2c8dfe">00476</a> <span class="keywordtype">int</span> trsolver::predictor (<span class="keywordtype">void</span>)
<a name="l00477"></a>00477 {
<a name="l00478"></a>00478     <span class="keywordtype">int</span> error = 0;
<a name="l00479"></a>00479     <span class="keywordflow">switch</span> (predType)
<a name="l00480"></a>00480     {
<a name="l00481"></a>00481     <span class="keywordflow">case</span> <a class="code" href="structqucs.html#ad55b09e4c985d6150ec2714b2fc6fb21a5b47e5c96351b3a3820a0b216fb27942">INTEGRATOR_GEAR</a>: <span class="comment">// explicit GEAR</span>
<a name="l00482"></a>00482         predictGear ();
<a name="l00483"></a>00483         <span class="keywordflow">break</span>;
<a name="l00484"></a>00484     <span class="keywordflow">case</span> <a class="code" href="structqucs.html#ad55b09e4c985d6150ec2714b2fc6fb21acbcad9732b7f2c18cb3220bcceabde3e">INTEGRATOR_ADAMSBASHFORD</a>: <span class="comment">// ADAMS-BASHFORD</span>
<a name="l00485"></a>00485         predictBashford ();
<a name="l00486"></a>00486         <span class="keywordflow">break</span>;
<a name="l00487"></a>00487     <span class="keywordflow">case</span> <a class="code" href="structqucs.html#ad55b09e4c985d6150ec2714b2fc6fb21a616a3aff2312409efa1fed68bf233881">INTEGRATOR_EULER</a>: <span class="comment">// FORWARD EULER</span>
<a name="l00488"></a>00488         predictEuler ();
<a name="l00489"></a>00489         <span class="keywordflow">break</span>;
<a name="l00490"></a>00490     <span class="keywordflow">default</span>:
<a name="l00491"></a>00491         *<a class="code" href="parse__mdl_8y.html#a9336ebf25087d91c818ee6e9ec29f8c1">x</a> = *<a class="code" href="trsolver_8cpp.html#a556f2f68b282379a23e817600a7099ca">SOL</a> (1);  <span class="comment">// This is too a simple predictor...</span>
<a name="l00492"></a>00492         <span class="keywordflow">break</span>;
<a name="l00493"></a>00493     }
<a name="l00494"></a>00494     saveSolution ();
<a name="l00495"></a>00495     *<a class="code" href="trsolver_8cpp.html#a556f2f68b282379a23e817600a7099ca">SOL</a> (0) = *<a class="code" href="parse__mdl_8y.html#a9336ebf25087d91c818ee6e9ec29f8c1">x</a>;
<a name="l00496"></a>00496     <span class="keywordflow">return</span> error;
<a name="l00497"></a>00497 }
<a name="l00498"></a>00498 
<a name="l00499"></a>00499 <span class="comment">// Stores the given vector into all the solution vectors.</span>
<a name="l00500"></a><a class="code" href="structqucs_1_1trsolver.html#a64d77f8b636b10d9c26d9f34afa47119">00500</a> <span class="keywordtype">void</span> trsolver::fillSolution (<a class="code" href="classqucs_1_1tvector.html">tvector&lt;nr_double_t&gt;</a> * s)
<a name="l00501"></a>00501 {
<a name="l00502"></a>00502     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="parse__mdl_8y.html#a7e98b8a17c0aad30ba64d47b74e2a6c1">i</a> = 0; <a class="code" href="parse__mdl_8y.html#a7e98b8a17c0aad30ba64d47b74e2a6c1">i</a> &lt; 8; <a class="code" href="parse__mdl_8y.html#a7e98b8a17c0aad30ba64d47b74e2a6c1">i</a>++) *<a class="code" href="trsolver_8cpp.html#a556f2f68b282379a23e817600a7099ca">SOL</a> (<a class="code" href="parse__mdl_8y.html#a7e98b8a17c0aad30ba64d47b74e2a6c1">i</a>) = *s;
<a name="l00503"></a>00503 }
<a name="l00504"></a>00504 
<a name="l00505"></a>00505 <span class="comment">/* The function predicts the successive solution vector using the</span>
<a name="l00506"></a>00506 <span class="comment">   explicit Adams-Bashford integration formula. */</span>
<a name="l00507"></a><a class="code" href="structqucs_1_1trsolver.html#ad3fd8c59077cf737ad3e02e05f6f4e91">00507</a> <span class="keywordtype">void</span> trsolver::predictBashford (<span class="keywordtype">void</span>)
<a name="l00508"></a>00508 {
<a name="l00509"></a>00509     <span class="keywordtype">int</span> <a class="code" href="equation_8cpp.html#a540f72cb9bcf86a19e3bbc259b9ec3e0">N</a> = countNodes ();
<a name="l00510"></a>00510     <span class="keywordtype">int</span> <a class="code" href="evaluate_8cpp.html#a92592142cb41364b6fe6ef9cc1a16dbd">M</a> = countVoltageSources ();
<a name="l00511"></a>00511     <a class="code" href="config_8h.html#a014aadc409afb297b8247c13f8ca89be">nr_double_t</a> xn, dd, hn;
<a name="l00512"></a>00512 
<a name="l00513"></a>00513     <span class="comment">// go through each solution</span>
<a name="l00514"></a>00514     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="parse__mdl_8y.html#a514f1b439f404f86f77090fa9edc96ce">r</a> = 0; <a class="code" href="parse__mdl_8y.html#a514f1b439f404f86f77090fa9edc96ce">r</a> &lt; N + <a class="code" href="evaluate_8cpp.html#a92592142cb41364b6fe6ef9cc1a16dbd">M</a>; <a class="code" href="parse__mdl_8y.html#a514f1b439f404f86f77090fa9edc96ce">r</a>++)
<a name="l00515"></a>00515     {
<a name="l00516"></a>00516         xn = predCoeff[0] * <a class="code" href="trsolver_8cpp.html#a556f2f68b282379a23e817600a7099ca">SOL</a>(1)-&gt;get (<a class="code" href="parse__mdl_8y.html#a514f1b439f404f86f77090fa9edc96ce">r</a>); <span class="comment">// a0 coefficient</span>
<a name="l00517"></a>00517         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> o = 1; o &lt;= predOrder; o++)
<a name="l00518"></a>00518         {
<a name="l00519"></a>00519             hn = getState (<a class="code" href="trsolver_8cpp.html#adc088a0aa10877612703be46ee0032a3">dState</a>, o);         <span class="comment">// previous time-step</span>
<a name="l00520"></a>00520             <span class="comment">// divided differences</span>
<a name="l00521"></a>00521             dd = (<a class="code" href="trsolver_8cpp.html#a556f2f68b282379a23e817600a7099ca">SOL</a>(o)-&gt;get (<a class="code" href="parse__mdl_8y.html#a514f1b439f404f86f77090fa9edc96ce">r</a>) - <a class="code" href="trsolver_8cpp.html#a556f2f68b282379a23e817600a7099ca">SOL</a>(o + 1)-&gt;get (<a class="code" href="parse__mdl_8y.html#a514f1b439f404f86f77090fa9edc96ce">r</a>)) / hn;
<a name="l00522"></a>00522             xn += predCoeff[o] * dd;           <span class="comment">// b0, b1, ... coefficients</span>
<a name="l00523"></a>00523         }
<a name="l00524"></a>00524         <a class="code" href="parse__mdl_8y.html#a9336ebf25087d91c818ee6e9ec29f8c1">x</a>-&gt;set (<a class="code" href="parse__mdl_8y.html#a514f1b439f404f86f77090fa9edc96ce">r</a>, xn);                      <span class="comment">// save prediction</span>
<a name="l00525"></a>00525     }
<a name="l00526"></a>00526 }
<a name="l00527"></a>00527 
<a name="l00528"></a>00528 <span class="comment">/* The function predicts the successive solution vector using the</span>
<a name="l00529"></a>00529 <span class="comment">   explicit forward Euler integration formula.  Actually this is</span>
<a name="l00530"></a>00530 <span class="comment">   Adams-Bashford order 1. */</span>
<a name="l00531"></a><a class="code" href="structqucs_1_1trsolver.html#a7ed2d3f1a1b6f15aed2d3ac6a1d00301">00531</a> <span class="keywordtype">void</span> trsolver::predictEuler (<span class="keywordtype">void</span>)
<a name="l00532"></a>00532 {
<a name="l00533"></a>00533     <span class="keywordtype">int</span> <a class="code" href="equation_8cpp.html#a540f72cb9bcf86a19e3bbc259b9ec3e0">N</a> = countNodes ();
<a name="l00534"></a>00534     <span class="keywordtype">int</span> <a class="code" href="evaluate_8cpp.html#a92592142cb41364b6fe6ef9cc1a16dbd">M</a> = countVoltageSources ();
<a name="l00535"></a>00535     <a class="code" href="config_8h.html#a014aadc409afb297b8247c13f8ca89be">nr_double_t</a> xn, dd, hn;
<a name="l00536"></a>00536 
<a name="l00537"></a>00537     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="parse__mdl_8y.html#a514f1b439f404f86f77090fa9edc96ce">r</a> = 0; <a class="code" href="parse__mdl_8y.html#a514f1b439f404f86f77090fa9edc96ce">r</a> &lt; N + <a class="code" href="evaluate_8cpp.html#a92592142cb41364b6fe6ef9cc1a16dbd">M</a>; <a class="code" href="parse__mdl_8y.html#a514f1b439f404f86f77090fa9edc96ce">r</a>++)
<a name="l00538"></a>00538     {
<a name="l00539"></a>00539         xn = predCoeff[0] * <a class="code" href="trsolver_8cpp.html#a556f2f68b282379a23e817600a7099ca">SOL</a>(1)-&gt;get (<a class="code" href="parse__mdl_8y.html#a514f1b439f404f86f77090fa9edc96ce">r</a>);
<a name="l00540"></a>00540         hn = getState (<a class="code" href="trsolver_8cpp.html#adc088a0aa10877612703be46ee0032a3">dState</a>, 1);
<a name="l00541"></a>00541         dd = (<a class="code" href="trsolver_8cpp.html#a556f2f68b282379a23e817600a7099ca">SOL</a>(1)-&gt;get (<a class="code" href="parse__mdl_8y.html#a514f1b439f404f86f77090fa9edc96ce">r</a>) - <a class="code" href="trsolver_8cpp.html#a556f2f68b282379a23e817600a7099ca">SOL</a>(2)-&gt;get (<a class="code" href="parse__mdl_8y.html#a514f1b439f404f86f77090fa9edc96ce">r</a>)) / hn;
<a name="l00542"></a>00542         xn += predCoeff[1] * dd;
<a name="l00543"></a>00543         <a class="code" href="parse__mdl_8y.html#a9336ebf25087d91c818ee6e9ec29f8c1">x</a>-&gt;set (<a class="code" href="parse__mdl_8y.html#a514f1b439f404f86f77090fa9edc96ce">r</a>, xn);
<a name="l00544"></a>00544     }
<a name="l00545"></a>00545 }
<a name="l00546"></a>00546 
<a name="l00547"></a>00547 <span class="comment">/* The function predicts the successive solution vector using the</span>
<a name="l00548"></a>00548 <span class="comment">   explicit Gear integration formula. */</span>
<a name="l00549"></a><a class="code" href="structqucs_1_1trsolver.html#ac1569ab785bc34712965a221e71d636a">00549</a> <span class="keywordtype">void</span> trsolver::predictGear (<span class="keywordtype">void</span>)
<a name="l00550"></a>00550 {
<a name="l00551"></a>00551     <span class="keywordtype">int</span> <a class="code" href="equation_8cpp.html#a540f72cb9bcf86a19e3bbc259b9ec3e0">N</a> = countNodes ();
<a name="l00552"></a>00552     <span class="keywordtype">int</span> <a class="code" href="evaluate_8cpp.html#a92592142cb41364b6fe6ef9cc1a16dbd">M</a> = countVoltageSources ();
<a name="l00553"></a>00553     <a class="code" href="config_8h.html#a014aadc409afb297b8247c13f8ca89be">nr_double_t</a> xn;
<a name="l00554"></a>00554 
<a name="l00555"></a>00555     <span class="comment">// go through each solution</span>
<a name="l00556"></a>00556     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="parse__mdl_8y.html#a514f1b439f404f86f77090fa9edc96ce">r</a> = 0; <a class="code" href="parse__mdl_8y.html#a514f1b439f404f86f77090fa9edc96ce">r</a> &lt; N + <a class="code" href="evaluate_8cpp.html#a92592142cb41364b6fe6ef9cc1a16dbd">M</a>; <a class="code" href="parse__mdl_8y.html#a514f1b439f404f86f77090fa9edc96ce">r</a>++)
<a name="l00557"></a>00557     {
<a name="l00558"></a>00558         xn = 0;
<a name="l00559"></a>00559         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> o = 0; o &lt;= predOrder; o++)
<a name="l00560"></a>00560         {
<a name="l00561"></a>00561             <span class="comment">// a0, a1, ... coefficients</span>
<a name="l00562"></a>00562             xn += predCoeff[o] * <a class="code" href="trsolver_8cpp.html#a556f2f68b282379a23e817600a7099ca">SOL</a>(o + 1)-&gt;get (<a class="code" href="parse__mdl_8y.html#a514f1b439f404f86f77090fa9edc96ce">r</a>);
<a name="l00563"></a>00563         }
<a name="l00564"></a>00564         <a class="code" href="parse__mdl_8y.html#a9336ebf25087d91c818ee6e9ec29f8c1">x</a>-&gt;set (<a class="code" href="parse__mdl_8y.html#a514f1b439f404f86f77090fa9edc96ce">r</a>, xn); <span class="comment">// save prediction</span>
<a name="l00565"></a>00565     }
<a name="l00566"></a>00566 }
<a name="l00567"></a>00567 
<a name="l00568"></a>00568 <span class="comment">/* The function iterates through the solutions of the integration</span>
<a name="l00569"></a>00569 <span class="comment">   process until a certain error tolerance has been reached. */</span>
<a name="l00570"></a><a class="code" href="structqucs_1_1trsolver.html#abcd04601e322d5eee0bf32b08358608d">00570</a> <span class="keywordtype">int</span> trsolver::corrector (<span class="keywordtype">void</span>)
<a name="l00571"></a>00571 {
<a name="l00572"></a>00572     <span class="keywordtype">int</span> error = 0;
<a name="l00573"></a>00573     error += solve_nonlinear ();
<a name="l00574"></a>00574     <span class="keywordflow">return</span> error;
<a name="l00575"></a>00575 }
<a name="l00576"></a>00576 
<a name="l00577"></a>00577 <span class="comment">// The function advances one more time-step.</span>
<a name="l00578"></a><a class="code" href="structqucs_1_1trsolver.html#aaf901ba565862dd2f604050c07ab4a8b">00578</a> <span class="keywordtype">void</span> trsolver::nextStates (<span class="keywordtype">void</span>)
<a name="l00579"></a>00579 {
<a name="l00580"></a>00580     <a class="code" href="classqucs_1_1circuit.html" title="base class for qucs circuit elements.">circuit</a> * root = subnet-&gt;getRoot ();
<a name="l00581"></a>00581     <span class="keywordflow">for</span> (<a class="code" href="classqucs_1_1circuit.html" title="base class for qucs circuit elements.">circuit</a> * <a class="code" href="parse__netlist_8y.html#a519cf159c27abd2374c9f649b9e9946d">c</a> = root; <a class="code" href="parse__netlist_8y.html#a519cf159c27abd2374c9f649b9e9946d">c</a> != NULL; <a class="code" href="parse__netlist_8y.html#a519cf159c27abd2374c9f649b9e9946d">c</a> = (<a class="code" href="classqucs_1_1circuit.html" title="base class for qucs circuit elements.">circuit</a> *) <a class="code" href="parse__netlist_8y.html#a519cf159c27abd2374c9f649b9e9946d">c</a>-&gt;<a class="code" href="classqucs_1_1eqn_1_1node.html#ad2f8b4edb365f182a9c9eed4af7491fc">getNext</a> ())
<a name="l00582"></a>00582     {
<a name="l00583"></a>00583         <span class="comment">// for each circuit get the next state</span>
<a name="l00584"></a>00584         <a class="code" href="parse__netlist_8y.html#a519cf159c27abd2374c9f649b9e9946d">c</a>-&gt;nextState ();
<a name="l00585"></a>00585     }
<a name="l00586"></a>00586 
<a name="l00587"></a>00587     *<a class="code" href="trsolver_8cpp.html#a556f2f68b282379a23e817600a7099ca">SOL</a> (0) = *<a class="code" href="parse__mdl_8y.html#a9336ebf25087d91c818ee6e9ec29f8c1">x</a>; <span class="comment">// save current solution</span>
<a name="l00588"></a>00588     nextState ();
<a name="l00589"></a>00589     statSteps++;
<a name="l00590"></a>00590 }
<a name="l00591"></a>00591 
<a name="l00592"></a>00592 <span class="comment">/* This function stores the current state of each circuit into all</span>
<a name="l00593"></a>00593 <span class="comment">   other states as well.  It is useful for higher order integration</span>
<a name="l00594"></a>00594 <span class="comment">   methods in order to initialize the states after the initial</span>
<a name="l00595"></a>00595 <span class="comment">   transient solution. */</span>
<a name="l00596"></a><a class="code" href="structqucs_1_1trsolver.html#a7f235d4b8c168e19c1c806ccaebeb374">00596</a> <span class="keywordtype">void</span> trsolver::fillStates (<span class="keywordtype">void</span>)
<a name="l00597"></a>00597 {
<a name="l00598"></a>00598     <a class="code" href="classqucs_1_1circuit.html" title="base class for qucs circuit elements.">circuit</a> * root = subnet-&gt;getRoot ();
<a name="l00599"></a>00599     <span class="keywordflow">for</span> (<a class="code" href="classqucs_1_1circuit.html" title="base class for qucs circuit elements.">circuit</a> * <a class="code" href="parse__netlist_8y.html#a519cf159c27abd2374c9f649b9e9946d">c</a> = root; <a class="code" href="parse__netlist_8y.html#a519cf159c27abd2374c9f649b9e9946d">c</a> != NULL; <a class="code" href="parse__netlist_8y.html#a519cf159c27abd2374c9f649b9e9946d">c</a> = (<a class="code" href="classqucs_1_1circuit.html" title="base class for qucs circuit elements.">circuit</a> *) <a class="code" href="parse__netlist_8y.html#a519cf159c27abd2374c9f649b9e9946d">c</a>-&gt;<a class="code" href="classqucs_1_1eqn_1_1node.html#ad2f8b4edb365f182a9c9eed4af7491fc">getNext</a> ())
<a name="l00600"></a>00600     {
<a name="l00601"></a>00601         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> s = 0; s &lt; <a class="code" href="parse__netlist_8y.html#a519cf159c27abd2374c9f649b9e9946d">c</a>-&gt;getStates (); s++)
<a name="l00602"></a>00602             <a class="code" href="parse__netlist_8y.html#a519cf159c27abd2374c9f649b9e9946d">c</a>-&gt;fillState (s, <a class="code" href="parse__netlist_8y.html#a519cf159c27abd2374c9f649b9e9946d">c</a>-&gt;getState (s));
<a name="l00603"></a>00603     }
<a name="l00604"></a>00604 }
<a name="l00605"></a>00605 
<a name="l00606"></a>00606 <span class="comment">// The function modifies the circuit lists integrator mode.</span>
<a name="l00607"></a><a class="code" href="structqucs_1_1trsolver.html#a5fa51b655dbc55d0af9b96421508d3e7">00607</a> <span class="keywordtype">void</span> trsolver::setMode (<span class="keywordtype">int</span> state)
<a name="l00608"></a>00608 {
<a name="l00609"></a>00609     <a class="code" href="classqucs_1_1circuit.html" title="base class for qucs circuit elements.">circuit</a> * root = subnet-&gt;getRoot ();
<a name="l00610"></a>00610     <span class="keywordflow">for</span> (<a class="code" href="classqucs_1_1circuit.html" title="base class for qucs circuit elements.">circuit</a> * <a class="code" href="parse__netlist_8y.html#a519cf159c27abd2374c9f649b9e9946d">c</a> = root; <a class="code" href="parse__netlist_8y.html#a519cf159c27abd2374c9f649b9e9946d">c</a> != NULL; <a class="code" href="parse__netlist_8y.html#a519cf159c27abd2374c9f649b9e9946d">c</a> = (<a class="code" href="classqucs_1_1circuit.html" title="base class for qucs circuit elements.">circuit</a> *) <a class="code" href="parse__netlist_8y.html#a519cf159c27abd2374c9f649b9e9946d">c</a>-&gt;<a class="code" href="classqucs_1_1eqn_1_1node.html#ad2f8b4edb365f182a9c9eed4af7491fc">getNext</a> ())
<a name="l00611"></a>00611         <a class="code" href="parse__netlist_8y.html#a519cf159c27abd2374c9f649b9e9946d">c</a>-&gt;setMode (state);
<a name="l00612"></a>00612 }
<a name="l00613"></a>00613 
<a name="l00614"></a>00614 <span class="comment">// The function passes the time delta array to the circuit list.</span>
<a name="l00615"></a><a class="code" href="structqucs_1_1trsolver.html#a7721e731934141f1fa5b01fd5804252e">00615</a> <span class="keywordtype">void</span> trsolver::setDelta (<span class="keywordtype">void</span>)
<a name="l00616"></a>00616 {
<a name="l00617"></a>00617     <a class="code" href="classqucs_1_1circuit.html" title="base class for qucs circuit elements.">circuit</a> * root = subnet-&gt;getRoot ();
<a name="l00618"></a>00618     <span class="keywordflow">for</span> (<a class="code" href="classqucs_1_1circuit.html" title="base class for qucs circuit elements.">circuit</a> * <a class="code" href="parse__netlist_8y.html#a519cf159c27abd2374c9f649b9e9946d">c</a> = root; <a class="code" href="parse__netlist_8y.html#a519cf159c27abd2374c9f649b9e9946d">c</a> != NULL; <a class="code" href="parse__netlist_8y.html#a519cf159c27abd2374c9f649b9e9946d">c</a> = (<a class="code" href="classqucs_1_1circuit.html" title="base class for qucs circuit elements.">circuit</a> *) <a class="code" href="parse__netlist_8y.html#a519cf159c27abd2374c9f649b9e9946d">c</a>-&gt;<a class="code" href="classqucs_1_1eqn_1_1node.html#ad2f8b4edb365f182a9c9eed4af7491fc">getNext</a> ())
<a name="l00619"></a>00619         <a class="code" href="parse__netlist_8y.html#a519cf159c27abd2374c9f649b9e9946d">c</a>-&gt;setDelta (deltas);
<a name="l00620"></a>00620 }
<a name="l00621"></a>00621 
<a name="l00622"></a>00622 <span class="comment">/* This function tries to adapt the current time-step according to the</span>
<a name="l00623"></a>00623 <span class="comment">   global truncation error. */</span>
<a name="l00624"></a><a class="code" href="structqucs_1_1trsolver.html#a8be3c7286d1108ef6e9251adc227feef">00624</a> <span class="keywordtype">void</span> trsolver::adjustDelta (<a class="code" href="config_8h.html#a014aadc409afb297b8247c13f8ca89be">nr_double_t</a> <a class="code" href="parse__vcd_8y.html#aaccc9105df5383111407fd5b41255e23">t</a>)
<a name="l00625"></a>00625 {
<a name="l00626"></a>00626     deltaOld = delta;
<a name="l00627"></a>00627     delta = checkDelta ();
<a name="l00628"></a>00628     <span class="keywordflow">if</span> (delta &gt; deltaMax) delta = deltaMax;
<a name="l00629"></a>00629     <span class="keywordflow">if</span> (delta &lt; deltaMin) delta = deltaMin;
<a name="l00630"></a>00630 
<a name="l00631"></a>00631     <span class="comment">// delta correction in order to hit exact breakpoint</span>
<a name="l00632"></a>00632     <span class="keywordtype">int</span> good = 0;
<a name="l00633"></a>00633     <span class="keywordflow">if</span> (!relaxTSR)   <span class="comment">// relaxed step raster?</span>
<a name="l00634"></a>00634     {
<a name="l00635"></a>00635         <span class="keywordflow">if</span> (!statConvergence || converged &gt; 64)   <span class="comment">/* Is this a good guess? */</span>
<a name="l00636"></a>00636         {
<a name="l00637"></a>00637             <span class="comment">// check next breakpoint</span>
<a name="l00638"></a>00638             <span class="keywordflow">if</span> (stepDelta &gt; 0.0)
<a name="l00639"></a>00639             {
<a name="l00640"></a>00640                 <span class="comment">// restore last valid delta</span>
<a name="l00641"></a>00641                 delta = stepDelta;
<a name="l00642"></a>00642                 stepDelta = -1.0;
<a name="l00643"></a>00643             }
<a name="l00644"></a>00644             <span class="keywordflow">else</span>
<a name="l00645"></a>00645             {
<a name="l00646"></a>00646                 <span class="keywordflow">if</span> (delta &gt; (t - current) &amp;&amp; t &gt; current)
<a name="l00647"></a>00647                 {
<a name="l00648"></a>00648                     <span class="comment">// save last valid delta and set exact step</span>
<a name="l00649"></a>00649                     stepDelta = deltaOld;
<a name="l00650"></a>00650                     delta = t - current;
<a name="l00651"></a>00651                     good = 1;
<a name="l00652"></a>00652                 }
<a name="l00653"></a>00653                 <span class="keywordflow">else</span>
<a name="l00654"></a>00654                 {
<a name="l00655"></a>00655                     stepDelta = -1.0;
<a name="l00656"></a>00656                 }
<a name="l00657"></a>00657             }
<a name="l00658"></a>00658             <span class="keywordflow">if</span> (delta &gt; deltaMax) delta = deltaMax;
<a name="l00659"></a>00659             <span class="keywordflow">if</span> (delta &lt; deltaMin) delta = deltaMin;
<a name="l00660"></a>00660         }
<a name="l00661"></a>00661     }
<a name="l00662"></a>00662 
<a name="l00663"></a>00663     <span class="comment">// usual delta correction</span>
<a name="l00664"></a>00664     <span class="keywordflow">if</span> (delta &gt; 0.9 * deltaOld || good)   <span class="comment">// accept current delta</span>
<a name="l00665"></a>00665     {
<a name="l00666"></a>00666         nextStates ();
<a name="l00667"></a>00667         rejected = 0;
<a name="l00668"></a>00668 <span class="preprocessor">#if STEPDEBUG</span>
<a name="l00669"></a>00669 <span class="preprocessor"></span>        <a class="code" href="logging_8c.html#abe06a8732a47a291606edcfac5e5146e">logprint</a> (<a class="code" href="logging_8h.html#a9b52156aa5746cc612e2e3edea6d5dbd">LOG_STATUS</a>,
<a name="l00670"></a>00670                   <span class="stringliteral">&quot;DEBUG: delta accepted at t = %.3e, h = %.3e\n&quot;</span>,
<a name="l00671"></a>00671                   (<span class="keywordtype">double</span>) current, (<span class="keywordtype">double</span>) delta);
<a name="l00672"></a>00672 <span class="preprocessor">#endif</span>
<a name="l00673"></a>00673 <span class="preprocessor"></span>    }
<a name="l00674"></a>00674     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (deltaOld &gt; delta)   <span class="comment">// reject current delta</span>
<a name="l00675"></a>00675     {
<a name="l00676"></a>00676         rejected++;
<a name="l00677"></a>00677         statRejected++;
<a name="l00678"></a>00678 <span class="preprocessor">#if STEPDEBUG</span>
<a name="l00679"></a>00679 <span class="preprocessor"></span>        <a class="code" href="logging_8c.html#abe06a8732a47a291606edcfac5e5146e">logprint</a> (<a class="code" href="logging_8h.html#a9b52156aa5746cc612e2e3edea6d5dbd">LOG_STATUS</a>,
<a name="l00680"></a>00680                   <span class="stringliteral">&quot;DEBUG: delta rejected at t = %.3e, h = %.3e\n&quot;</span>,
<a name="l00681"></a>00681                   (<span class="keywordtype">double</span>) current, (<span class="keywordtype">double</span>) delta);
<a name="l00682"></a>00682 <span class="preprocessor">#endif</span>
<a name="l00683"></a>00683 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (current &gt; 0) current -= deltaOld;
<a name="l00684"></a>00684     }
<a name="l00685"></a>00685     <span class="keywordflow">else</span>
<a name="l00686"></a>00686     {
<a name="l00687"></a>00687         nextStates ();
<a name="l00688"></a>00688         rejected = 0;
<a name="l00689"></a>00689     }
<a name="l00690"></a>00690 }
<a name="l00691"></a>00691 
<a name="l00692"></a>00692 <span class="comment">/* The function can be used to increase the current order of the</span>
<a name="l00693"></a>00693 <span class="comment">   integration method or to reduce it. */</span>
<a name="l00694"></a><a class="code" href="structqucs_1_1trsolver.html#a5ca98eac140565552de9427ee4f88af0">00694</a> <span class="keywordtype">void</span> trsolver::adjustOrder (<span class="keywordtype">int</span> reduce)
<a name="l00695"></a>00695 {
<a name="l00696"></a>00696     <span class="keywordflow">if</span> ((corrOrder &lt; corrMaxOrder &amp;&amp; !rejected) || reduce)
<a name="l00697"></a>00697     {
<a name="l00698"></a>00698         <span class="keywordflow">if</span> (reduce)
<a name="l00699"></a>00699         {
<a name="l00700"></a>00700             corrOrder = 1;
<a name="l00701"></a>00701         }
<a name="l00702"></a>00702         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!rejected)
<a name="l00703"></a>00703         {
<a name="l00704"></a>00704             corrOrder++;
<a name="l00705"></a>00705         }
<a name="l00706"></a>00706 
<a name="l00707"></a>00707         <span class="comment">// adjust type and order of corrector and predictor</span>
<a name="l00708"></a>00708         corrType = <a class="code" href="namespacequcs_1_1transient.html#a036926b1ffb3c3b16d0e55a8f3a925cd">correctorType</a> (CMethod, corrOrder);
<a name="l00709"></a>00709         predType = <a class="code" href="namespacequcs_1_1transient.html#a36aadcb6151743b2968889c1a58c1572">predictorType</a> (corrType, corrOrder, predOrder);
<a name="l00710"></a>00710 
<a name="l00711"></a>00711         <span class="comment">// apply new corrector method and order to each circuit</span>
<a name="l00712"></a>00712         <a class="code" href="classqucs_1_1circuit.html" title="base class for qucs circuit elements.">circuit</a> * root = subnet-&gt;getRoot ();
<a name="l00713"></a>00713         <span class="keywordflow">for</span> (<a class="code" href="classqucs_1_1circuit.html" title="base class for qucs circuit elements.">circuit</a> * <a class="code" href="parse__netlist_8y.html#a519cf159c27abd2374c9f649b9e9946d">c</a> = root; <a class="code" href="parse__netlist_8y.html#a519cf159c27abd2374c9f649b9e9946d">c</a> != NULL; <a class="code" href="parse__netlist_8y.html#a519cf159c27abd2374c9f649b9e9946d">c</a> = (<a class="code" href="classqucs_1_1circuit.html" title="base class for qucs circuit elements.">circuit</a> *) <a class="code" href="parse__netlist_8y.html#a519cf159c27abd2374c9f649b9e9946d">c</a>-&gt;<a class="code" href="classqucs_1_1eqn_1_1node.html#ad2f8b4edb365f182a9c9eed4af7491fc">getNext</a> ())
<a name="l00714"></a>00714         {
<a name="l00715"></a>00715             <a class="code" href="parse__netlist_8y.html#a519cf159c27abd2374c9f649b9e9946d">c</a>-&gt;setOrder (corrOrder);
<a name="l00716"></a>00716             <a class="code" href="namespacequcs_1_1transient.html#a2726136dfc41d01788294233e68f250f">setIntegrationMethod</a> (<a class="code" href="parse__netlist_8y.html#a519cf159c27abd2374c9f649b9e9946d">c</a>, corrType);
<a name="l00717"></a>00717         }
<a name="l00718"></a>00718     }
<a name="l00719"></a>00719 }
<a name="l00720"></a>00720 
<a name="l00721"></a>00721 <span class="comment">/* Goes through the list of circuit objects and runs its calcDC()</span>
<a name="l00722"></a>00722 <span class="comment">   function. */</span>
<a name="l00723"></a><a class="code" href="structqucs_1_1trsolver.html#a24b5f7b3a21db0ab8edb3d8febac4a7e">00723</a> <span class="keywordtype">void</span> trsolver::calcDC (<a class="code" href="structqucs_1_1trsolver.html">trsolver</a> * <span class="keyword">self</span>)
<a name="l00724"></a>00724 {
<a name="l00725"></a>00725     <a class="code" href="classqucs_1_1circuit.html" title="base class for qucs circuit elements.">circuit</a> * root = <span class="keyword">self</span>-&gt;<a class="code" href="classqucs_1_1circuit.html#a1fd37ca5a3d4dc9c490ec6e091782cfb">getNet</a>()-&gt;<a class="code" href="classqucs_1_1net.html#a455b0f56b9d0e0415a820880475e0eb8">getRoot</a> ();
<a name="l00726"></a>00726     <span class="keywordflow">for</span> (<a class="code" href="classqucs_1_1circuit.html" title="base class for qucs circuit elements.">circuit</a> * <a class="code" href="parse__netlist_8y.html#a519cf159c27abd2374c9f649b9e9946d">c</a> = root; <a class="code" href="parse__netlist_8y.html#a519cf159c27abd2374c9f649b9e9946d">c</a> != NULL; <a class="code" href="parse__netlist_8y.html#a519cf159c27abd2374c9f649b9e9946d">c</a> = (<a class="code" href="classqucs_1_1circuit.html" title="base class for qucs circuit elements.">circuit</a> *) <a class="code" href="parse__netlist_8y.html#a519cf159c27abd2374c9f649b9e9946d">c</a>-&gt;<a class="code" href="classqucs_1_1eqn_1_1node.html#ad2f8b4edb365f182a9c9eed4af7491fc">getNext</a> ())
<a name="l00727"></a>00727     {
<a name="l00728"></a>00728         <a class="code" href="parse__netlist_8y.html#a519cf159c27abd2374c9f649b9e9946d">c</a>-&gt;calcDC ();
<a name="l00729"></a>00729     }
<a name="l00730"></a>00730 }
<a name="l00731"></a>00731 
<a name="l00732"></a>00732 <span class="comment">/* Goes through the list of circuit objects and runs its calcTR()</span>
<a name="l00733"></a>00733 <span class="comment">   function. */</span>
<a name="l00734"></a><a class="code" href="structqucs_1_1trsolver.html#a4100e3c385b3a38b9fba0f3c7075f85c">00734</a> <span class="keywordtype">void</span> trsolver::calcTR (<a class="code" href="structqucs_1_1trsolver.html">trsolver</a> * <span class="keyword">self</span>)
<a name="l00735"></a>00735 {
<a name="l00736"></a>00736     <a class="code" href="classqucs_1_1circuit.html" title="base class for qucs circuit elements.">circuit</a> * root = <span class="keyword">self</span>-&gt;<a class="code" href="classqucs_1_1circuit.html#a1fd37ca5a3d4dc9c490ec6e091782cfb">getNet</a>()-&gt;<a class="code" href="classqucs_1_1net.html#a455b0f56b9d0e0415a820880475e0eb8">getRoot</a> ();
<a name="l00737"></a>00737     <span class="keywordflow">for</span> (<a class="code" href="classqucs_1_1circuit.html" title="base class for qucs circuit elements.">circuit</a> * <a class="code" href="parse__netlist_8y.html#a519cf159c27abd2374c9f649b9e9946d">c</a> = root; <a class="code" href="parse__netlist_8y.html#a519cf159c27abd2374c9f649b9e9946d">c</a> != NULL; <a class="code" href="parse__netlist_8y.html#a519cf159c27abd2374c9f649b9e9946d">c</a> = (<a class="code" href="classqucs_1_1circuit.html" title="base class for qucs circuit elements.">circuit</a> *) <a class="code" href="parse__netlist_8y.html#a519cf159c27abd2374c9f649b9e9946d">c</a>-&gt;<a class="code" href="classqucs_1_1eqn_1_1node.html#ad2f8b4edb365f182a9c9eed4af7491fc">getNext</a> ())
<a name="l00738"></a>00738     {
<a name="l00739"></a>00739         <a class="code" href="parse__netlist_8y.html#a519cf159c27abd2374c9f649b9e9946d">c</a>-&gt;calcTR (self-&gt;current);
<a name="l00740"></a>00740     }
<a name="l00741"></a>00741 }
<a name="l00742"></a>00742 
<a name="l00743"></a>00743 <span class="comment">/* Goes through the list of non-linear circuit objects and runs its</span>
<a name="l00744"></a>00744 <span class="comment">   restartDC() function. */</span>
<a name="l00745"></a><a class="code" href="structqucs_1_1trsolver.html#ae419fd6623f5c3092d3ada27540c9b12">00745</a> <span class="keywordtype">void</span> trsolver::restart (<span class="keywordtype">void</span>)
<a name="l00746"></a>00746 {
<a name="l00747"></a>00747     <a class="code" href="classqucs_1_1circuit.html" title="base class for qucs circuit elements.">circuit</a> * root = subnet-&gt;getRoot ();
<a name="l00748"></a>00748     <span class="keywordflow">for</span> (<a class="code" href="classqucs_1_1circuit.html" title="base class for qucs circuit elements.">circuit</a> * <a class="code" href="parse__netlist_8y.html#a519cf159c27abd2374c9f649b9e9946d">c</a> = root; <a class="code" href="parse__netlist_8y.html#a519cf159c27abd2374c9f649b9e9946d">c</a> != NULL; <a class="code" href="parse__netlist_8y.html#a519cf159c27abd2374c9f649b9e9946d">c</a> = (<a class="code" href="classqucs_1_1circuit.html" title="base class for qucs circuit elements.">circuit</a> *) <a class="code" href="parse__netlist_8y.html#a519cf159c27abd2374c9f649b9e9946d">c</a>-&gt;<a class="code" href="classqucs_1_1eqn_1_1node.html#ad2f8b4edb365f182a9c9eed4af7491fc">getNext</a> ())
<a name="l00749"></a>00749     {
<a name="l00750"></a>00750         <span class="keywordflow">if</span> (<a class="code" href="parse__netlist_8y.html#a519cf159c27abd2374c9f649b9e9946d">c</a>-&gt;isNonLinear ()) <a class="code" href="parse__netlist_8y.html#a519cf159c27abd2374c9f649b9e9946d">c</a>-&gt;restartDC ();
<a name="l00751"></a>00751     }
<a name="l00752"></a>00752 }
<a name="l00753"></a>00753 
<a name="l00754"></a>00754 <span class="comment">/* Goes through the list of circuit objects and runs its initDC()</span>
<a name="l00755"></a>00755 <span class="comment">   function. */</span>
<a name="l00756"></a><a class="code" href="structqucs_1_1trsolver.html#af7881ad815b67fd1479c399fef99d065">00756</a> <span class="keywordtype">void</span> trsolver::initDC (<span class="keywordtype">void</span>)
<a name="l00757"></a>00757 {
<a name="l00758"></a>00758     <a class="code" href="classqucs_1_1circuit.html" title="base class for qucs circuit elements.">circuit</a> * root = subnet-&gt;getRoot ();
<a name="l00759"></a>00759     <span class="keywordflow">for</span> (<a class="code" href="classqucs_1_1circuit.html" title="base class for qucs circuit elements.">circuit</a> * <a class="code" href="parse__netlist_8y.html#a519cf159c27abd2374c9f649b9e9946d">c</a> = root; <a class="code" href="parse__netlist_8y.html#a519cf159c27abd2374c9f649b9e9946d">c</a> != NULL; <a class="code" href="parse__netlist_8y.html#a519cf159c27abd2374c9f649b9e9946d">c</a> = (<a class="code" href="classqucs_1_1circuit.html" title="base class for qucs circuit elements.">circuit</a> *) <a class="code" href="parse__netlist_8y.html#a519cf159c27abd2374c9f649b9e9946d">c</a>-&gt;<a class="code" href="classqucs_1_1eqn_1_1node.html#ad2f8b4edb365f182a9c9eed4af7491fc">getNext</a> ())
<a name="l00760"></a>00760     {
<a name="l00761"></a>00761         <a class="code" href="parse__netlist_8y.html#a519cf159c27abd2374c9f649b9e9946d">c</a>-&gt;initDC ();
<a name="l00762"></a>00762     }
<a name="l00763"></a>00763 }
<a name="l00764"></a>00764 
<a name="l00765"></a>00765 <span class="comment">/* Goes through the list of circuit objects and runs its initTR()</span>
<a name="l00766"></a>00766 <span class="comment">   function. */</span>
<a name="l00767"></a><a class="code" href="structqucs_1_1trsolver.html#a8b88479f6d976db8860e2dcc438396b4">00767</a> <span class="keywordtype">void</span> trsolver::initTR (<span class="keywordtype">void</span>)
<a name="l00768"></a>00768 {
<a name="l00769"></a>00769     <span class="keyword">const</span> <span class="keywordtype">char</span> * <span class="keyword">const</span> IMethod = getPropertyString (<span class="stringliteral">&quot;IntegrationMethod&quot;</span>);
<a name="l00770"></a>00770     <a class="code" href="config_8h.html#a014aadc409afb297b8247c13f8ca89be">nr_double_t</a> start = getPropertyDouble (<span class="stringliteral">&quot;Start&quot;</span>);
<a name="l00771"></a>00771     <a class="code" href="config_8h.html#a014aadc409afb297b8247c13f8ca89be">nr_double_t</a> stop = getPropertyDouble (<span class="stringliteral">&quot;Stop&quot;</span>);
<a name="l00772"></a>00772     <a class="code" href="config_8h.html#a014aadc409afb297b8247c13f8ca89be">nr_double_t</a> points = getPropertyDouble (<span class="stringliteral">&quot;Points&quot;</span>);
<a name="l00773"></a>00773 
<a name="l00774"></a>00774     <span class="comment">// fetch corrector integration method and determine predicor method</span>
<a name="l00775"></a>00775     corrMaxOrder = getPropertyInteger (<span class="stringliteral">&quot;Order&quot;</span>);
<a name="l00776"></a>00776     corrType = CMethod = <a class="code" href="namespacequcs_1_1transient.html#a036926b1ffb3c3b16d0e55a8f3a925cd">correctorType</a> (IMethod, corrMaxOrder);
<a name="l00777"></a>00777     predType = PMethod = <a class="code" href="namespacequcs_1_1transient.html#a36aadcb6151743b2968889c1a58c1572">predictorType</a> (CMethod, corrMaxOrder, predMaxOrder);
<a name="l00778"></a>00778     corrOrder = corrMaxOrder;
<a name="l00779"></a>00779     predOrder = predMaxOrder;
<a name="l00780"></a>00780 
<a name="l00781"></a>00781     <span class="comment">// initialize step values</span>
<a name="l00782"></a>00782     delta = getPropertyDouble (<span class="stringliteral">&quot;InitialStep&quot;</span>);
<a name="l00783"></a>00783     deltaMin = getPropertyDouble (<span class="stringliteral">&quot;MinStep&quot;</span>);
<a name="l00784"></a>00784     deltaMax = getPropertyDouble (<span class="stringliteral">&quot;MaxStep&quot;</span>);
<a name="l00785"></a>00785     <span class="keywordflow">if</span> (deltaMax == 0.0)
<a name="l00786"></a>00786         deltaMax = std::min ((stop - start) / (points - 1), stop / 200);
<a name="l00787"></a>00787     <span class="keywordflow">if</span> (deltaMin == 0.0)
<a name="l00788"></a>00788         deltaMin = NR_TINY * 10 * deltaMax;
<a name="l00789"></a>00789     <span class="keywordflow">if</span> (delta == 0.0)
<a name="l00790"></a>00790         delta = std::min (stop / 200, deltaMax) / 10;
<a name="l00791"></a>00791     <span class="keywordflow">if</span> (delta &lt; deltaMin) delta = deltaMin;
<a name="l00792"></a>00792     <span class="keywordflow">if</span> (delta &gt; deltaMax) delta = deltaMax;
<a name="l00793"></a>00793 
<a name="l00794"></a>00794     <span class="comment">// initialize step history</span>
<a name="l00795"></a>00795     setStates (2);
<a name="l00796"></a>00796     initStates ();
<a name="l00797"></a>00797     <span class="comment">// initialise the history of states, setting them all to &#39;delta&#39;</span>
<a name="l00798"></a>00798     fillState (<a class="code" href="trsolver_8cpp.html#adc088a0aa10877612703be46ee0032a3">dState</a>, delta);
<a name="l00799"></a>00799 
<a name="l00800"></a>00800     <span class="comment">// copy the initialised states to the &#39;deltas&#39; array</span>
<a name="l00801"></a>00801     saveState (<a class="code" href="trsolver_8cpp.html#adc088a0aa10877612703be46ee0032a3">dState</a>, deltas);
<a name="l00802"></a>00802     <span class="comment">// copy the deltas to all the circuits</span>
<a name="l00803"></a>00803     setDelta ();
<a name="l00804"></a>00804     <span class="comment">// set the initial corrector and predictor coefficients</span>
<a name="l00805"></a>00805     <a class="code" href="namespacequcs_1_1transient.html#a8404d7f047e5d70a1da7a7df465cb231">calcCorrectorCoeff</a> (corrType, corrOrder, corrCoeff, deltas);
<a name="l00806"></a>00806     <a class="code" href="namespacequcs_1_1transient.html#a9bbb36e88ea3f6ff7e8372ae8ae298da">calcPredictorCoeff</a> (predType, predOrder, predCoeff, deltas);
<a name="l00807"></a>00807 
<a name="l00808"></a>00808     <span class="comment">// initialize history of solution vectors (solutions)</span>
<a name="l00809"></a>00809     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="parse__mdl_8y.html#a7e98b8a17c0aad30ba64d47b74e2a6c1">i</a> = 0; <a class="code" href="parse__mdl_8y.html#a7e98b8a17c0aad30ba64d47b74e2a6c1">i</a> &lt; 8; <a class="code" href="parse__mdl_8y.html#a7e98b8a17c0aad30ba64d47b74e2a6c1">i</a>++)
<a name="l00810"></a>00810     {
<a name="l00811"></a>00811         <span class="comment">// solution contains the last sets of node voltages and branch</span>
<a name="l00812"></a>00812         <span class="comment">// currents at each of the last 8 &#39;deltas&#39;.</span>
<a name="l00813"></a>00813         <span class="comment">// Note for convenience the definition:</span>
<a name="l00814"></a>00814         <span class="comment">//   #define SOL(state) (solution[(int) getState (sState, (state))])</span>
<a name="l00815"></a>00815         <span class="comment">// is provided and used elsewhere to update the solutions</span>
<a name="l00816"></a>00816         solution[<a class="code" href="parse__mdl_8y.html#a7e98b8a17c0aad30ba64d47b74e2a6c1">i</a>] = <span class="keyword">new</span> <a class="code" href="classqucs_1_1tvector.html">tvector&lt;nr_double_t&gt;</a>;
<a name="l00817"></a>00817         setState (<a class="code" href="trsolver_8cpp.html#a349c2d076c29da463d7c00f73b429397">sState</a>, (<a class="code" href="config_8h.html#a014aadc409afb297b8247c13f8ca89be">nr_double_t</a>) <a class="code" href="parse__mdl_8y.html#a7e98b8a17c0aad30ba64d47b74e2a6c1">i</a>, i);
<a name="l00818"></a>00818     }
<a name="l00819"></a>00819 
<a name="l00820"></a>00820     <span class="comment">// tell circuits about the transient analysis</span>
<a name="l00821"></a>00821     <a class="code" href="classqucs_1_1circuit.html" title="base class for qucs circuit elements.">circuit</a> *<a class="code" href="parse__netlist_8y.html#a519cf159c27abd2374c9f649b9e9946d">c</a>, * root = subnet-&gt;getRoot ();
<a name="l00822"></a>00822     <span class="keywordflow">for</span> (c = root; c != NULL; c = (<a class="code" href="classqucs_1_1circuit.html" title="base class for qucs circuit elements.">circuit</a> *) c-&gt;<a class="code" href="classqucs_1_1circuit.html#aeaa43301149fe33c836800afacc31540">getNext</a> ())
<a name="l00823"></a>00823         initCircuitTR (c);
<a name="l00824"></a>00824     <span class="comment">// also initialize created circuits</span>
<a name="l00825"></a>00825     <span class="keywordflow">for</span> (c = root; c != NULL; c = (<a class="code" href="classqucs_1_1circuit.html" title="base class for qucs circuit elements.">circuit</a> *) c-&gt;<a class="code" href="classqucs_1_1circuit.html#af0c6bfaa51e4b38e89910621d9bdb3e6">getPrev</a> ())
<a name="l00826"></a>00826         initCircuitTR (c);
<a name="l00827"></a>00827 }
<a name="l00828"></a>00828 
<a name="l00829"></a>00829 <span class="comment">// This function cleans up some memory used by the transient analysis.</span>
<a name="l00830"></a><a class="code" href="structqucs_1_1trsolver.html#a1d77e64a54044922fe2b59fa658faf76">00830</a> <span class="keywordtype">void</span> trsolver::deinitTR (<span class="keywordtype">void</span>)
<a name="l00831"></a>00831 {
<a name="l00832"></a>00832     <span class="comment">// cleanup solutions</span>
<a name="l00833"></a>00833     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="parse__mdl_8y.html#a7e98b8a17c0aad30ba64d47b74e2a6c1">i</a> = 0; <a class="code" href="parse__mdl_8y.html#a7e98b8a17c0aad30ba64d47b74e2a6c1">i</a> &lt; 8; <a class="code" href="parse__mdl_8y.html#a7e98b8a17c0aad30ba64d47b74e2a6c1">i</a>++)
<a name="l00834"></a>00834     {
<a name="l00835"></a>00835         <span class="keyword">delete</span> solution[<a class="code" href="parse__mdl_8y.html#a7e98b8a17c0aad30ba64d47b74e2a6c1">i</a>];
<a name="l00836"></a>00836         solution[<a class="code" href="parse__mdl_8y.html#a7e98b8a17c0aad30ba64d47b74e2a6c1">i</a>] = NULL;
<a name="l00837"></a>00837     }
<a name="l00838"></a>00838     <span class="comment">// cleanup history</span>
<a name="l00839"></a>00839     <span class="keywordflow">if</span> (tHistory)
<a name="l00840"></a>00840     {
<a name="l00841"></a>00841         <span class="keyword">delete</span> tHistory;
<a name="l00842"></a>00842         tHistory = NULL;
<a name="l00843"></a>00843     }
<a name="l00844"></a>00844 }
<a name="l00845"></a>00845 
<a name="l00846"></a>00846 <span class="comment">// The function initialize a single circuit.</span>
<a name="l00847"></a><a class="code" href="structqucs_1_1trsolver.html#a6944e99cd8cdd90b84813f792af67225">00847</a> <span class="keywordtype">void</span> trsolver::initCircuitTR (<a class="code" href="classqucs_1_1circuit.html" title="base class for qucs circuit elements.">circuit</a> * <a class="code" href="parse__netlist_8y.html#a519cf159c27abd2374c9f649b9e9946d">c</a>)
<a name="l00848"></a>00848 {
<a name="l00849"></a>00849     c-&gt;<a class="code" href="classqucs_1_1circuit.html#af12727725459431af7a6195e493be7b2">initTR</a> ();
<a name="l00850"></a>00850     c-&gt;<a class="code" href="classqucs_1_1states.html#a09969664ef4ec9ac29d22a2bb087eba5">initStates</a> ();
<a name="l00851"></a>00851     c-&gt;<a class="code" href="classqucs_1_1integrator.html#a9707454dc3757fa7cdb39e3315351ce7">setCoefficients</a> (corrCoeff);
<a name="l00852"></a>00852     c-&gt;<a class="code" href="classqucs_1_1integrator.html#a4bc55c8b70c2ed993eb6c0fe8f97cf6e">setOrder</a> (corrOrder);
<a name="l00853"></a>00853     <a class="code" href="namespacequcs_1_1transient.html#a2726136dfc41d01788294233e68f250f">setIntegrationMethod</a> (c, corrType);
<a name="l00854"></a>00854 }
<a name="l00855"></a>00855 
<a name="l00856"></a>00856 <span class="comment">/* This function saves the results of a single solve() functionality</span>
<a name="l00857"></a>00857 <span class="comment">   (for the given timestamp) into the output dataset. */</span>
<a name="l00858"></a><a class="code" href="structqucs_1_1trsolver.html#a086352af0b92f5c190042edff5162423">00858</a> <span class="keywordtype">void</span> trsolver::saveAllResults (<a class="code" href="config_8h.html#a014aadc409afb297b8247c13f8ca89be">nr_double_t</a> time)
<a name="l00859"></a>00859 {
<a name="l00860"></a>00860     qucs::vector * <a class="code" href="parse__vcd_8y.html#aaccc9105df5383111407fd5b41255e23">t</a>;
<a name="l00861"></a>00861     <span class="comment">// add current frequency to the dependency of the output dataset</span>
<a name="l00862"></a>00862     <span class="keywordflow">if</span> ((t = <a class="code" href="parse__citi_8y.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>-&gt;findDependency (<span class="stringliteral">&quot;time&quot;</span>)) == NULL)
<a name="l00863"></a>00863     {
<a name="l00864"></a>00864       t = <span class="keyword">new</span> qucs::vector (<span class="stringliteral">&quot;time&quot;</span>);
<a name="l00865"></a>00865         <a class="code" href="parse__citi_8y.html#a511ae0b1c13f95e5f08f1a0dd3da3d93">data</a>-&gt;addDependency (t);
<a name="l00866"></a>00866     }
<a name="l00867"></a>00867     <span class="keywordflow">if</span> (runs == 1) t-&gt;add (time);
<a name="l00868"></a>00868     saveResults (<span class="stringliteral">&quot;Vt&quot;</span>, <span class="stringliteral">&quot;It&quot;</span>, 0, t);
<a name="l00869"></a>00869 }
<a name="l00870"></a>00870 
<a name="l00871"></a>00871 <span class="comment">/* This function is meant to adapt the current time-step the transient</span>
<a name="l00872"></a>00872 <span class="comment">   analysis advanced.  For the computation of the new time-step the</span>
<a name="l00873"></a>00873 <span class="comment">   truncation error depending on the integration method is used. */</span>
<a name="l00874"></a><a class="code" href="structqucs_1_1trsolver.html#aa1ab1609ba35472a123be18f35c4abb5">00874</a> <a class="code" href="config_8h.html#a014aadc409afb297b8247c13f8ca89be">nr_double_t</a> trsolver::checkDelta (<span class="keywordtype">void</span>)
<a name="l00875"></a>00875 {
<a name="l00876"></a>00876     <a class="code" href="config_8h.html#a014aadc409afb297b8247c13f8ca89be">nr_double_t</a> LTEreltol = getPropertyDouble (<span class="stringliteral">&quot;LTEreltol&quot;</span>);
<a name="l00877"></a>00877     <a class="code" href="config_8h.html#a014aadc409afb297b8247c13f8ca89be">nr_double_t</a> LTEabstol = getPropertyDouble (<span class="stringliteral">&quot;LTEabstol&quot;</span>);
<a name="l00878"></a>00878     <a class="code" href="config_8h.html#a014aadc409afb297b8247c13f8ca89be">nr_double_t</a> LTEfactor = getPropertyDouble (<span class="stringliteral">&quot;LTEfactor&quot;</span>);
<a name="l00879"></a>00879     <a class="code" href="config_8h.html#a014aadc409afb297b8247c13f8ca89be">nr_double_t</a> dif, rel, <a class="code" href="testDefine_8h.html#a7fe7a2d892789540ed424673579f2f35">tol</a>, lte, q, <a class="code" href="parse__mdl_8y.html#aecba4cab5e52994730d1e21424997b33">n</a> =  std::numeric_limits&lt;nr_double_t&gt;::max();
<a name="l00880"></a>00880     <span class="keywordtype">int</span> <a class="code" href="equation_8cpp.html#a540f72cb9bcf86a19e3bbc259b9ec3e0">N</a> = countNodes ();
<a name="l00881"></a>00881     <span class="keywordtype">int</span> <a class="code" href="evaluate_8cpp.html#a92592142cb41364b6fe6ef9cc1a16dbd">M</a> = countVoltageSources ();
<a name="l00882"></a>00882 
<a name="l00883"></a>00883     <span class="comment">// cec = corrector error constant</span>
<a name="l00884"></a>00884     <a class="code" href="config_8h.html#a014aadc409afb297b8247c13f8ca89be">nr_double_t</a> cec = <a class="code" href="namespacequcs_1_1transient.html#a2895054668619bab9010618006a0ba91">getCorrectorError</a> (corrType, corrOrder);
<a name="l00885"></a>00885     <span class="comment">// pec = predictor error constant</span>
<a name="l00886"></a>00886     <a class="code" href="config_8h.html#a014aadc409afb297b8247c13f8ca89be">nr_double_t</a> pec = <a class="code" href="namespacequcs_1_1transient.html#abfc023f4182133f892849d8ccdcfad54">getPredictorError</a> (predType, predOrder);
<a name="l00887"></a>00887 
<a name="l00888"></a>00888     <span class="comment">// go through each solution</span>
<a name="l00889"></a>00889     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="parse__mdl_8y.html#a514f1b439f404f86f77090fa9edc96ce">r</a> = 0; <a class="code" href="parse__mdl_8y.html#a514f1b439f404f86f77090fa9edc96ce">r</a> &lt; N + <a class="code" href="evaluate_8cpp.html#a92592142cb41364b6fe6ef9cc1a16dbd">M</a>; <a class="code" href="parse__mdl_8y.html#a514f1b439f404f86f77090fa9edc96ce">r</a>++)
<a name="l00890"></a>00890     {
<a name="l00891"></a>00891 
<a name="l00892"></a>00892         <span class="comment">// skip real voltage sources</span>
<a name="l00893"></a>00893         <span class="keywordflow">if</span> (<a class="code" href="parse__mdl_8y.html#a514f1b439f404f86f77090fa9edc96ce">r</a> &gt;= N)
<a name="l00894"></a>00894         {
<a name="l00895"></a>00895             <span class="keywordflow">if</span> (findVoltageSource(<a class="code" href="parse__mdl_8y.html#a514f1b439f404f86f77090fa9edc96ce">r</a> - N)-&gt;isVSource ())
<a name="l00896"></a>00896                 <span class="keywordflow">continue</span>;
<a name="l00897"></a>00897         }
<a name="l00898"></a>00898 
<a name="l00899"></a>00899         dif = <a class="code" href="parse__mdl_8y.html#a9336ebf25087d91c818ee6e9ec29f8c1">x</a>-&gt;get (<a class="code" href="parse__mdl_8y.html#a514f1b439f404f86f77090fa9edc96ce">r</a>) - <a class="code" href="trsolver_8cpp.html#a556f2f68b282379a23e817600a7099ca">SOL</a>(0)-&gt;get (<a class="code" href="parse__mdl_8y.html#a514f1b439f404f86f77090fa9edc96ce">r</a>);
<a name="l00900"></a>00900         <span class="keywordflow">if</span> (std::isfinite (dif) &amp;&amp; dif != 0)
<a name="l00901"></a>00901         {
<a name="l00902"></a>00902             <span class="comment">// use Milne&#39; estimate for the local truncation error</span>
<a name="l00903"></a>00903             rel = MAX (fabs (<a class="code" href="parse__mdl_8y.html#a9336ebf25087d91c818ee6e9ec29f8c1">x</a>-&gt;get (<a class="code" href="parse__mdl_8y.html#a514f1b439f404f86f77090fa9edc96ce">r</a>)), fabs (<a class="code" href="trsolver_8cpp.html#a556f2f68b282379a23e817600a7099ca">SOL</a>(0)-&gt;get (<a class="code" href="parse__mdl_8y.html#a514f1b439f404f86f77090fa9edc96ce">r</a>)));
<a name="l00904"></a>00904             tol = LTEreltol * rel + LTEabstol;
<a name="l00905"></a>00905             lte = LTEfactor * (cec / (pec - cec)) * dif;
<a name="l00906"></a>00906             q =  delta * <a class="code" href="namespacequcs.html#ab5bb59c9137b45fbab66bdbeac414b40" title="Compute complex exponential.">exp</a> (<a class="code" href="namespacequcs.html#ad72d35f69fd807087269078dfeca1533" title="Compute principal value of natural logarithm of z.">log</a> (fabs (tol / lte)) / (corrOrder + 1));
<a name="l00907"></a>00907             n = std::min (n, q);
<a name="l00908"></a>00908         }
<a name="l00909"></a>00909     }
<a name="l00910"></a>00910 <span class="preprocessor">#if STEPDEBUG</span>
<a name="l00911"></a>00911 <span class="preprocessor"></span>    <a class="code" href="logging_8c.html#abe06a8732a47a291606edcfac5e5146e">logprint</a> (<a class="code" href="logging_8h.html#a9b52156aa5746cc612e2e3edea6d5dbd">LOG_STATUS</a>, <span class="stringliteral">&quot;DEBUG: delta according to local truncation &quot;</span>
<a name="l00912"></a>00912               <span class="stringliteral">&quot;error h = %.3e\n&quot;</span>, (<span class="keywordtype">double</span>) n);
<a name="l00913"></a>00913 <span class="preprocessor">#endif</span>
<a name="l00914"></a>00914 <span class="preprocessor"></span>    delta = std::min ((n &gt; 1.9 * delta) ? 2 * delta : delta, n);
<a name="l00915"></a>00915     <span class="keywordflow">return</span> delta;
<a name="l00916"></a>00916 }
<a name="l00917"></a>00917 
<a name="l00918"></a>00918 <span class="comment">// The function updates the integration coefficients.</span>
<a name="l00919"></a><a class="code" href="structqucs_1_1trsolver.html#ae4e2217214f6f3052c01763fc90cf5e2">00919</a> <span class="keywordtype">void</span> trsolver::updateCoefficients (<a class="code" href="config_8h.html#a014aadc409afb297b8247c13f8ca89be">nr_double_t</a> delta)
<a name="l00920"></a>00920 {
<a name="l00921"></a>00921     setState (<a class="code" href="trsolver_8cpp.html#adc088a0aa10877612703be46ee0032a3">dState</a>, delta);
<a name="l00922"></a>00922     saveState (<a class="code" href="trsolver_8cpp.html#adc088a0aa10877612703be46ee0032a3">dState</a>, deltas);
<a name="l00923"></a>00923     <a class="code" href="namespacequcs_1_1transient.html#a8404d7f047e5d70a1da7a7df465cb231">calcCorrectorCoeff</a> (corrType, corrOrder, corrCoeff, deltas);
<a name="l00924"></a>00924     <a class="code" href="namespacequcs_1_1transient.html#a9bbb36e88ea3f6ff7e8372ae8ae298da">calcPredictorCoeff</a> (predType, predOrder, predCoeff, deltas);
<a name="l00925"></a>00925 }
<a name="l00926"></a>00926 
<a name="l00927"></a>00927 <span class="comment">// properties</span>
<a name="l00928"></a>00928 <a class="code" href="structqucs.html#a22dddfa38928996c2851157e7609cc33">PROP_REQ</a> [] =
<a name="l00929"></a>00929 {
<a name="l00930"></a>00930     {
<a name="l00931"></a>00931         <span class="stringliteral">&quot;Type&quot;</span>, <a class="code" href="netdefs_8h.html#a552766d94553aab12e7876b233745eba">PROP_STR</a>, { <a class="code" href="netdefs_8h.html#afb940e1f3110901a9a494273b104f586">PROP_NO_VAL</a>, <span class="stringliteral">&quot;lin&quot;</span> },
<a name="l00932"></a>00932         <a class="code" href="netdefs_8h.html#ade558e1667df91aa0e9ecf79987ff6a8">PROP_RNG_STR2</a> (<span class="stringliteral">&quot;lin&quot;</span>, <span class="stringliteral">&quot;log&quot;</span>)
<a name="l00933"></a>00933     },
<a name="l00934"></a>00934     { <span class="stringliteral">&quot;Start&quot;</span>, <a class="code" href="netdefs_8h.html#affd5c5788fc34f8a0ab1b07b77604103">PROP_REAL</a>, { 0, <a class="code" href="netdefs_8h.html#a4d0941b8422de2007248d250c7c5c9ed">PROP_NO_STR</a> }, <a class="code" href="netdefs_8h.html#a4980d9d0ee76163dc5bfffbad6fa6213">PROP_POS_RANGE</a> },
<a name="l00935"></a>00935     { <span class="stringliteral">&quot;Stop&quot;</span>, <a class="code" href="netdefs_8h.html#affd5c5788fc34f8a0ab1b07b77604103">PROP_REAL</a>, { 1e-3, <a class="code" href="netdefs_8h.html#a4d0941b8422de2007248d250c7c5c9ed">PROP_NO_STR</a> }, <a class="code" href="netdefs_8h.html#a4980d9d0ee76163dc5bfffbad6fa6213">PROP_POS_RANGE</a> },
<a name="l00936"></a>00936     { <span class="stringliteral">&quot;Points&quot;</span>, <a class="code" href="netdefs_8h.html#a1a52c37e7df2d230169832d17a1c0c5c">PROP_INT</a>, { 10, <a class="code" href="netdefs_8h.html#a4d0941b8422de2007248d250c7c5c9ed">PROP_NO_STR</a> }, <a class="code" href="netdefs_8h.html#a87f670224851c2a44bfa1be44eddbb13">PROP_MIN_VAL</a> (2) },
<a name="l00937"></a>00937     <a class="code" href="netdefs_8h.html#abe2affa5f22fc12b66df2bb2c385af8b">PROP_NO_PROP</a>
<a name="l00938"></a>00938 };
<a name="l00939"></a>00939 <a class="code" href="structqucs.html#a23d1ecdd5939cc3ab98c05aed05eb1be">PROP_OPT</a> [] =
<a name="l00940"></a>00940 {
<a name="l00941"></a>00941     {
<a name="l00942"></a>00942         <span class="stringliteral">&quot;IntegrationMethod&quot;</span>, <a class="code" href="netdefs_8h.html#a552766d94553aab12e7876b233745eba">PROP_STR</a>, { <a class="code" href="netdefs_8h.html#afb940e1f3110901a9a494273b104f586">PROP_NO_VAL</a>, <span class="stringliteral">&quot;Trapezoidal&quot;</span> },
<a name="l00943"></a>00943         <a class="code" href="netdefs_8h.html#afbf1a9baf37a6c5fc4c90b8cfb7579a6">PROP_RNG_STR4</a> (<span class="stringliteral">&quot;Euler&quot;</span>, <span class="stringliteral">&quot;Trapezoidal&quot;</span>, <span class="stringliteral">&quot;Gear&quot;</span>, <span class="stringliteral">&quot;AdamsMoulton&quot;</span>)
<a name="l00944"></a>00944     },
<a name="l00945"></a>00945     { <span class="stringliteral">&quot;Order&quot;</span>, <a class="code" href="netdefs_8h.html#a1a52c37e7df2d230169832d17a1c0c5c">PROP_INT</a>, { 2, <a class="code" href="netdefs_8h.html#a4d0941b8422de2007248d250c7c5c9ed">PROP_NO_STR</a> }, <a class="code" href="netdefs_8h.html#aa6ae43a3d5db7a8e127e51641f27de7c">PROP_RNGII</a> (1, 6) },
<a name="l00946"></a>00946     { <span class="stringliteral">&quot;InitialStep&quot;</span>, <a class="code" href="netdefs_8h.html#affd5c5788fc34f8a0ab1b07b77604103">PROP_REAL</a>, { 1e-9, <a class="code" href="netdefs_8h.html#a4d0941b8422de2007248d250c7c5c9ed">PROP_NO_STR</a> }, <a class="code" href="netdefs_8h.html#a4980d9d0ee76163dc5bfffbad6fa6213">PROP_POS_RANGE</a> },
<a name="l00947"></a>00947     { <span class="stringliteral">&quot;MinStep&quot;</span>, <a class="code" href="netdefs_8h.html#affd5c5788fc34f8a0ab1b07b77604103">PROP_REAL</a>, { 1e-16, <a class="code" href="netdefs_8h.html#a4d0941b8422de2007248d250c7c5c9ed">PROP_NO_STR</a> }, <a class="code" href="netdefs_8h.html#a4980d9d0ee76163dc5bfffbad6fa6213">PROP_POS_RANGE</a> },
<a name="l00948"></a>00948     { <span class="stringliteral">&quot;MaxStep&quot;</span>, <a class="code" href="netdefs_8h.html#affd5c5788fc34f8a0ab1b07b77604103">PROP_REAL</a>, { 0, <a class="code" href="netdefs_8h.html#a4d0941b8422de2007248d250c7c5c9ed">PROP_NO_STR</a> }, <a class="code" href="netdefs_8h.html#a4980d9d0ee76163dc5bfffbad6fa6213">PROP_POS_RANGE</a> },
<a name="l00949"></a>00949     { <span class="stringliteral">&quot;MaxIter&quot;</span>, <a class="code" href="netdefs_8h.html#a1a52c37e7df2d230169832d17a1c0c5c">PROP_INT</a>, { 150, <a class="code" href="netdefs_8h.html#a4d0941b8422de2007248d250c7c5c9ed">PROP_NO_STR</a> }, <a class="code" href="netdefs_8h.html#aa6ae43a3d5db7a8e127e51641f27de7c">PROP_RNGII</a> (2, 10000) },
<a name="l00950"></a>00950     { <span class="stringliteral">&quot;abstol&quot;</span>, <a class="code" href="netdefs_8h.html#affd5c5788fc34f8a0ab1b07b77604103">PROP_REAL</a>, { 1e-12, <a class="code" href="netdefs_8h.html#a4d0941b8422de2007248d250c7c5c9ed">PROP_NO_STR</a> }, <a class="code" href="netdefs_8h.html#a7e9ba27c049eba55e49f20f4fc4c2f03">PROP_RNG_X01I</a> },
<a name="l00951"></a>00951     { <span class="stringliteral">&quot;vntol&quot;</span>, <a class="code" href="netdefs_8h.html#affd5c5788fc34f8a0ab1b07b77604103">PROP_REAL</a>, { 1e-6, <a class="code" href="netdefs_8h.html#a4d0941b8422de2007248d250c7c5c9ed">PROP_NO_STR</a> }, <a class="code" href="netdefs_8h.html#a7e9ba27c049eba55e49f20f4fc4c2f03">PROP_RNG_X01I</a> },
<a name="l00952"></a>00952     { <span class="stringliteral">&quot;reltol&quot;</span>, <a class="code" href="netdefs_8h.html#affd5c5788fc34f8a0ab1b07b77604103">PROP_REAL</a>, { 1e-3, <a class="code" href="netdefs_8h.html#a4d0941b8422de2007248d250c7c5c9ed">PROP_NO_STR</a> }, <a class="code" href="netdefs_8h.html#a7e9ba27c049eba55e49f20f4fc4c2f03">PROP_RNG_X01I</a> },
<a name="l00953"></a>00953     { <span class="stringliteral">&quot;LTEabstol&quot;</span>, <a class="code" href="netdefs_8h.html#affd5c5788fc34f8a0ab1b07b77604103">PROP_REAL</a>, { 1e-6, <a class="code" href="netdefs_8h.html#a4d0941b8422de2007248d250c7c5c9ed">PROP_NO_STR</a> }, <a class="code" href="netdefs_8h.html#a7e9ba27c049eba55e49f20f4fc4c2f03">PROP_RNG_X01I</a> },
<a name="l00954"></a>00954     { <span class="stringliteral">&quot;LTEreltol&quot;</span>, <a class="code" href="netdefs_8h.html#affd5c5788fc34f8a0ab1b07b77604103">PROP_REAL</a>, { 1e-3, <a class="code" href="netdefs_8h.html#a4d0941b8422de2007248d250c7c5c9ed">PROP_NO_STR</a> }, <a class="code" href="netdefs_8h.html#a7e9ba27c049eba55e49f20f4fc4c2f03">PROP_RNG_X01I</a> },
<a name="l00955"></a>00955     { <span class="stringliteral">&quot;LTEfactor&quot;</span>, <a class="code" href="netdefs_8h.html#affd5c5788fc34f8a0ab1b07b77604103">PROP_REAL</a>, { 1, <a class="code" href="netdefs_8h.html#a4d0941b8422de2007248d250c7c5c9ed">PROP_NO_STR</a> }, <a class="code" href="netdefs_8h.html#aa6ae43a3d5db7a8e127e51641f27de7c">PROP_RNGII</a> (1, 16) },
<a name="l00956"></a>00956     { <span class="stringliteral">&quot;Temp&quot;</span>, <a class="code" href="netdefs_8h.html#affd5c5788fc34f8a0ab1b07b77604103">PROP_REAL</a>, { 26.85, <a class="code" href="netdefs_8h.html#a4d0941b8422de2007248d250c7c5c9ed">PROP_NO_STR</a> }, <a class="code" href="netdefs_8h.html#a87f670224851c2a44bfa1be44eddbb13">PROP_MIN_VAL</a> (<a class="code" href="group__qucsPhysConstants.html#ga61e4d22eb77fc2ac9b4b80a4d8a235a1" title="Absolute 0 in centigrade.">K</a>) },
<a name="l00957"></a>00957     { <span class="stringliteral">&quot;Solver&quot;</span>, <a class="code" href="netdefs_8h.html#a552766d94553aab12e7876b233745eba">PROP_STR</a>, { <a class="code" href="netdefs_8h.html#afb940e1f3110901a9a494273b104f586">PROP_NO_VAL</a>, <span class="stringliteral">&quot;CroutLU&quot;</span> }, <a class="code" href="netdefs_8h.html#afb4fcd5b521f3200f227bd225bf73ee6">PROP_RNG_SOL</a> },
<a name="l00958"></a>00958     { <span class="stringliteral">&quot;relaxTSR&quot;</span>, <a class="code" href="netdefs_8h.html#a552766d94553aab12e7876b233745eba">PROP_STR</a>, { <a class="code" href="netdefs_8h.html#afb940e1f3110901a9a494273b104f586">PROP_NO_VAL</a>, <span class="stringliteral">&quot;no&quot;</span> }, <a class="code" href="netdefs_8h.html#a4bf829946eefc66a76ba797b92b040a3">PROP_RNG_YESNO</a> },
<a name="l00959"></a>00959     { <span class="stringliteral">&quot;initialDC&quot;</span>, <a class="code" href="netdefs_8h.html#a552766d94553aab12e7876b233745eba">PROP_STR</a>, { <a class="code" href="netdefs_8h.html#afb940e1f3110901a9a494273b104f586">PROP_NO_VAL</a>, <span class="stringliteral">&quot;yes&quot;</span> }, <a class="code" href="netdefs_8h.html#a4bf829946eefc66a76ba797b92b040a3">PROP_RNG_YESNO</a> },
<a name="l00960"></a>00960     <a class="code" href="netdefs_8h.html#abe2affa5f22fc12b66df2bb2c385af8b">PROP_NO_PROP</a>
<a name="l00961"></a>00961 };
<a name="l00962"></a><a class="code" href="structqucs_1_1trsolver.html">00962</a> <span class="keyword">struct </span><a class="code" href="structdefine__t.html">define_t</a> <a class="code" href="structqucs_1_1trsolver.html">trsolver</a>::anadef =
<a name="l00963"></a><a class="code" href="structqucs_1_1trsolver.html#a25b1548d0fa08d805de88081e5855754">00963</a>     { <span class="stringliteral">&quot;TR&quot;</span>, 0, <a class="code" href="netdefs_8h.html#a7f2eed3c8b53ad19237413982b693f6f">PROP_ACTION</a>, <a class="code" href="netdefs_8h.html#a1bccc85ea1eada75219823bb543d134f">PROP_NO_SUBSTRATE</a>, <a class="code" href="netdefs_8h.html#abbc3dc5d6e7ed19e109e2c80caba81bf">PROP_LINEAR</a>, <a class="code" href="netdefs_8h.html#acd1661cbcb5d1e27c3cf1b93f5ef8153">PROP_DEF</a> };
<a name="l00964"></a>00964 
<a name="l00965"></a>00965 } <span class="comment">// namespace qucs</span>
</pre></div></div><!-- contents -->


<hr class="footer"/><address class="footer"><small>
Generated on Fri Jun 12 2015 10:06:29 for Qucs-core by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
