<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Qucs-GUI: /home/travis/build/Qucs/qucs/qucs/qucs/qucs.cpp Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />

<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">Qucs-GUI
   &#160;<span id="projectnumber">0.0.19</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">/home/travis/build/Qucs/qucs/qucs/qucs/qucs.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="qucs_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/***************************************************************************</span>
<a name="l00002"></a>00002 <span class="comment">                                 qucs.cpp</span>
<a name="l00003"></a>00003 <span class="comment">                                ----------</span>
<a name="l00004"></a>00004 <span class="comment">    begin                : Thu Aug 28 2003</span>
<a name="l00005"></a>00005 <span class="comment">    copyright            : (C) 2003, 2004, 2005, 2006 by Michael Margraf</span>
<a name="l00006"></a>00006 <span class="comment">    email                : michael.margraf@alumni.tu-berlin.de</span>
<a name="l00007"></a>00007 <span class="comment"> ***************************************************************************/</span>
<a name="l00008"></a>00008 
<a name="l00009"></a>00009 <span class="comment">/***************************************************************************</span>
<a name="l00010"></a>00010 <span class="comment"> *                                                                         *</span>
<a name="l00011"></a>00011 <span class="comment"> *   This program is free software; you can redistribute it and/or modify  *</span>
<a name="l00012"></a>00012 <span class="comment"> *   it under the terms of the GNU General Public License as published by  *</span>
<a name="l00013"></a>00013 <span class="comment"> *   the Free Software Foundation; either version 2 of the License, or     *</span>
<a name="l00014"></a>00014 <span class="comment"> *   (at your option) any later version.                                   *</span>
<a name="l00015"></a>00015 <span class="comment"> *                                                                         *</span>
<a name="l00016"></a>00016 <span class="comment"> ***************************************************************************/</span>
<a name="l00017"></a>00017 
<a name="l00018"></a>00018 <span class="preprocessor">#ifdef HAVE_CONFIG_H</span>
<a name="l00019"></a>00019 <span class="preprocessor"></span><span class="preprocessor"># include &lt;config.h&gt;</span>
<a name="l00020"></a>00020 <span class="preprocessor">#endif</span>
<a name="l00021"></a>00021 <span class="preprocessor"></span>
<a name="l00022"></a>00022 <span class="preprocessor">#include &lt;QModelIndex&gt;</span>
<a name="l00023"></a>00023 <span class="preprocessor">#include &lt;QAction&gt;</span>
<a name="l00024"></a>00024 <span class="preprocessor">#include &lt;QTreeWidget&gt;</span>
<a name="l00025"></a>00025 <span class="preprocessor">#include &lt;QTreeWidgetItem&gt;</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include &lt;QDockWidget&gt;</span>
<a name="l00027"></a>00027 <span class="preprocessor">#include &lt;QLineEdit&gt;</span>
<a name="l00028"></a>00028 <span class="preprocessor">#include &lt;QPushButton&gt;</span>
<a name="l00029"></a>00029 <span class="preprocessor">#include &lt;QListWidget&gt;</span>
<a name="l00030"></a>00030 <span class="preprocessor">#include &lt;QComboBox&gt;</span>
<a name="l00031"></a>00031 <span class="preprocessor">#include &lt;QMenu&gt;</span>
<a name="l00032"></a>00032 <span class="preprocessor">#include &lt;QMessageBox&gt;</span>
<a name="l00033"></a>00033 <span class="preprocessor">#include &lt;QFileDialog&gt;</span>
<a name="l00034"></a>00034 <span class="preprocessor">#include &lt;QStatusBar&gt;</span>
<a name="l00035"></a>00035 <span class="preprocessor">#include &lt;QShortcut&gt;</span>
<a name="l00036"></a>00036 <span class="preprocessor">#include &lt;QApplication&gt;</span>
<a name="l00037"></a>00037 <span class="preprocessor">#include &lt;QClipboard&gt;</span>
<a name="l00038"></a>00038 <span class="preprocessor">#include &lt;QInputDialog&gt;</span>
<a name="l00039"></a>00039 <span class="preprocessor">#include &lt;QDesktopServices&gt;</span>
<a name="l00040"></a>00040 <span class="preprocessor">#include &lt;QFileSystemModel&gt;</span>
<a name="l00041"></a>00041 <span class="preprocessor">#include &lt;QUrl&gt;</span>
<a name="l00042"></a>00042 <span class="preprocessor">#include &lt;QSettings&gt;</span>
<a name="l00043"></a>00043 <span class="preprocessor">#include &lt;QDebug&gt;</span>
<a name="l00044"></a>00044 
<a name="l00045"></a>00045 <span class="preprocessor">#include &quot;<a class="code" href="main_8h.html" title="Definitions and declarations for the main application.">main.h</a>&quot;</span>
<a name="l00046"></a>00046 <span class="preprocessor">#include &quot;<a class="code" href="qucs_8h.html">qucs.h</a>&quot;</span>
<a name="l00047"></a>00047 <span class="preprocessor">#include &quot;<a class="code" href="qucsdoc_8h.html">qucsdoc.h</a>&quot;</span>
<a name="l00048"></a>00048 <span class="preprocessor">#include &quot;<a class="code" href="textdoc_8h.html" title="Definition of the TextDoc class.">textdoc.h</a>&quot;</span>
<a name="l00049"></a>00049 <span class="preprocessor">#include &quot;<a class="code" href="schematic_8h.html">schematic.h</a>&quot;</span>
<a name="l00050"></a>00050 <span class="preprocessor">#include &quot;<a class="code" href="mouseactions_8h.html">mouseactions.h</a>&quot;</span>
<a name="l00051"></a>00051 <span class="preprocessor">#include &quot;<a class="code" href="messagedock_8h.html" title="The MessageDock class definiion.">messagedock.h</a>&quot;</span>
<a name="l00052"></a>00052 <span class="preprocessor">#include &quot;<a class="code" href="wire_8h.html">wire.h</a>&quot;</span>
<a name="l00053"></a>00053 <span class="preprocessor">#include &quot;<a class="code" href="module_8h.html">module.h</a>&quot;</span>
<a name="l00054"></a>00054 <span class="preprocessor">#include &quot;<a class="code" href="projectView_8h.html">projectView.h</a>&quot;</span>
<a name="l00055"></a>00055 <span class="preprocessor">#include &quot;<a class="code" href="components_8h.html">components/components.h</a>&quot;</span>
<a name="l00056"></a>00056 <span class="preprocessor">#include &quot;<a class="code" href="paintings_8h.html">paintings/paintings.h</a>&quot;</span>
<a name="l00057"></a>00057 <span class="preprocessor">#include &quot;<a class="code" href="diagrams_8h.html">diagrams/diagrams.h</a>&quot;</span>
<a name="l00058"></a>00058 <span class="preprocessor">#include &quot;<a class="code" href="savedialog_8h.html">dialogs/savedialog.h</a>&quot;</span>
<a name="l00059"></a>00059 <span class="preprocessor">#include &quot;<a class="code" href="newprojdialog_8h.html">dialogs/newprojdialog.h</a>&quot;</span>
<a name="l00060"></a>00060 <span class="preprocessor">#include &quot;<a class="code" href="settingsdialog_8h.html">dialogs/settingsdialog.h</a>&quot;</span>
<a name="l00061"></a>00061 <span class="preprocessor">#include &quot;<a class="code" href="digisettingsdialog_8h.html">dialogs/digisettingsdialog.h</a>&quot;</span>
<a name="l00062"></a>00062 <span class="preprocessor">#include &quot;<a class="code" href="vasettingsdialog_8h.html">dialogs/vasettingsdialog.h</a>&quot;</span>
<a name="l00063"></a>00063 <span class="preprocessor">#include &quot;<a class="code" href="qucssettingsdialog_8h.html">dialogs/qucssettingsdialog.h</a>&quot;</span>
<a name="l00064"></a>00064 <span class="preprocessor">#include &quot;<a class="code" href="searchdialog_8h.html">dialogs/searchdialog.h</a>&quot;</span>
<a name="l00065"></a>00065 <span class="preprocessor">#include &quot;<a class="code" href="sweepdialog_8h.html">dialogs/sweepdialog.h</a>&quot;</span>
<a name="l00066"></a>00066 <span class="preprocessor">#include &quot;<a class="code" href="labeldialog_8h.html">dialogs/labeldialog.h</a>&quot;</span>
<a name="l00067"></a>00067 <span class="preprocessor">#include &quot;<a class="code" href="matchdialog_8h.html">dialogs/matchdialog.h</a>&quot;</span>
<a name="l00068"></a>00068 <span class="preprocessor">#include &quot;<a class="code" href="simmessage_8h.html">dialogs/simmessage.h</a>&quot;</span>
<a name="l00069"></a>00069 <span class="preprocessor">#include &quot;<a class="code" href="exportdialog_8h.html">dialogs/exportdialog.h</a>&quot;</span>
<a name="l00070"></a>00070 <span class="preprocessor">#include &quot;<a class="code" href="octave__window_8h.html">octave_window.h</a>&quot;</span>
<a name="l00071"></a>00071 <span class="preprocessor">#include &quot;<a class="code" href="printerwriter_8h.html">printerwriter.h</a>&quot;</span>
<a name="l00072"></a>00072 <span class="preprocessor">#include &quot;<a class="code" href="imagewriter_8h.html">imagewriter.h</a>&quot;</span>
<a name="l00073"></a>00073 <span class="preprocessor">#include &quot;../qucs-lib/qucslib_common.h&quot;</span>
<a name="l00074"></a>00074 <span class="preprocessor">#include &quot;<a class="code" href="misc_8h.html" title="of some miscellaneous function">misc.h</a>&quot;</span>
<a name="l00075"></a>00075 
<a name="l00076"></a>00076 <span class="comment">// icon for unsaved files (diskette)</span>
<a name="l00077"></a><a class="code" href="qucs_8cpp.html#ab308523b9287d6370177a8b11b417d26">00077</a> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="qucs_8cpp.html#ab308523b9287d6370177a8b11b417d26">smallsave_xpm</a>[] = {
<a name="l00078"></a>00078 <span class="stringliteral">&quot;16 17 66 1&quot;</span>, <span class="stringliteral">&quot;   c None&quot;</span>,
<a name="l00079"></a>00079 <span class="stringliteral">&quot;.  c #595963&quot;</span>,<span class="stringliteral">&quot;+ c #E6E6F1&quot;</span>,<span class="stringliteral">&quot;@ c #465460&quot;</span>,<span class="stringliteral">&quot;# c #FEFEFF&quot;</span>,
<a name="l00080"></a>00080 <span class="stringliteral">&quot;$  c #DEDEEE&quot;</span>,<span class="stringliteral">&quot;% c #43535F&quot;</span>,<span class="stringliteral">&quot;&amp; c #D1D1E6&quot;</span>,<span class="stringliteral">&quot;* c #5E5E66&quot;</span>,
<a name="l00081"></a>00081 <span class="stringliteral">&quot;=  c #FFFFFF&quot;</span>,<span class="stringliteral">&quot;- c #C5C5DF&quot;</span>,<span class="stringliteral">&quot;; c #FCF8F9&quot;</span>,<span class="stringliteral">&quot;&gt; c #BDBDDA&quot;</span>,
<a name="l00082"></a>00082 <span class="stringliteral">&quot;,  c #BFBFDC&quot;</span>,<span class="stringliteral">&quot;&#39; c #C4C4DF&quot;</span>,<span class="stringliteral">&quot;) c #FBF7F7&quot;</span>,<span class="stringliteral">&quot;! c #D6D6E9&quot;</span>,
<a name="l00083"></a>00083 <span class="stringliteral">&quot;~  c #CBCBE3&quot;</span>,<span class="stringliteral">&quot;{ c #B5B5D6&quot;</span>,<span class="stringliteral">&quot;] c #BCBCDA&quot;</span>,<span class="stringliteral">&quot;^ c #C6C6E0&quot;</span>,
<a name="l00084"></a>00084 <span class="stringliteral">&quot;/  c #CFCFE5&quot;</span>,<span class="stringliteral">&quot;( c #CEC9DC&quot;</span>,<span class="stringliteral">&quot;_ c #D8D8EA&quot;</span>,<span class="stringliteral">&quot;: c #DADAEB&quot;</span>,
<a name="l00085"></a>00085 <span class="stringliteral">&quot;&lt;  c #313134&quot;</span>,<span class="stringliteral">&quot;[ c #807FB3&quot;</span>,<span class="stringliteral">&quot;} c #AEAED1&quot;</span>,<span class="stringliteral">&quot;| c #B7B7D7&quot;</span>,
<a name="l00086"></a>00086 <span class="stringliteral">&quot;1  c #E2E2EF&quot;</span>,<span class="stringliteral">&quot;2 c #9393C0&quot;</span>,<span class="stringliteral">&quot;3 c #E3E3F0&quot;</span>,<span class="stringliteral">&quot;4 c #DDD5E1&quot;</span>,
<a name="l00087"></a>00087 <span class="stringliteral">&quot;5  c #E8E8F3&quot;</span>,<span class="stringliteral">&quot;6 c #2F2F31&quot;</span>,<span class="stringliteral">&quot;7 c #7B7BAF&quot;</span>,<span class="stringliteral">&quot;8 c #8383B5&quot;</span>,
<a name="l00088"></a>00088 <span class="stringliteral">&quot;9  c #151518&quot;</span>,<span class="stringliteral">&quot;0 c #000000&quot;</span>,<span class="stringliteral">&quot;a c #C0C0DC&quot;</span>,<span class="stringliteral">&quot;b c #8E8FBD&quot;</span>,
<a name="l00089"></a>00089 <span class="stringliteral">&quot;c  c #8989BA&quot;</span>,<span class="stringliteral">&quot;d c #E7EEF6&quot;</span>,<span class="stringliteral">&quot;e c #282829&quot;</span>,<span class="stringliteral">&quot;f c #6867A1&quot;</span>,
<a name="l00090"></a>00090 <span class="stringliteral">&quot;g  c #7373A9&quot;</span>,<span class="stringliteral">&quot;h c #A7A7CD&quot;</span>,<span class="stringliteral">&quot;i c #8080B3&quot;</span>,<span class="stringliteral">&quot;j c #7B7CB0&quot;</span>,
<a name="l00091"></a>00091 <span class="stringliteral">&quot;k  c #7070A8&quot;</span>,<span class="stringliteral">&quot;l c #6D6DA5&quot;</span>,<span class="stringliteral">&quot;m c #6E6EA6&quot;</span>,<span class="stringliteral">&quot;n c #6969A2&quot;</span>,
<a name="l00092"></a>00092 <span class="stringliteral">&quot;o  c #7A79AF&quot;</span>,<span class="stringliteral">&quot;p c #DCDCEC&quot;</span>,<span class="stringliteral">&quot;q c #60609A&quot;</span>,<span class="stringliteral">&quot;r c #7777AC&quot;</span>,
<a name="l00093"></a>00093 <span class="stringliteral">&quot;s  c #5D5D98&quot;</span>,<span class="stringliteral">&quot;t c #7676AB&quot;</span>,<span class="stringliteral">&quot;u c #484785&quot;</span>,<span class="stringliteral">&quot;v c #575793&quot;</span>,
<a name="l00094"></a>00094 <span class="stringliteral">&quot;w  c #50506A&quot;</span>,<span class="stringliteral">&quot;x c #8787B8&quot;</span>,<span class="stringliteral">&quot;y c #53536E&quot;</span>,<span class="stringliteral">&quot;z c #07070E&quot;</span>,
<a name="l00095"></a>00095 <span class="stringliteral">&quot;A  c #666688&quot;</span>,
<a name="l00096"></a>00096 <span class="stringliteral">&quot;        .       &quot;</span>,
<a name="l00097"></a>00097 <span class="stringliteral">&quot;       .+.      &quot;</span>,
<a name="l00098"></a>00098 <span class="stringliteral">&quot;      .+@#.     &quot;</span>,
<a name="l00099"></a>00099 <span class="stringliteral">&quot;     .$%###.    &quot;</span>,
<a name="l00100"></a>00100 <span class="stringliteral">&quot;    .&amp;*####=.   &quot;</span>,
<a name="l00101"></a>00101 <span class="stringliteral">&quot;   .-.#;#####.  &quot;</span>,
<a name="l00102"></a>00102 <span class="stringliteral">&quot;  .&gt;,&#39;.#)!!!!~. &quot;</span>,
<a name="l00103"></a>00103 <span class="stringliteral">&quot; .{].&#39;^./(!_:&lt;[.&quot;</span>,
<a name="l00104"></a>00104 <span class="stringliteral">&quot;.}|.1./2.3456789&quot;</span>,
<a name="l00105"></a>00105 <span class="stringliteral">&quot;0a.$11.bc.defg9 &quot;</span>,
<a name="l00106"></a>00106 <span class="stringliteral">&quot; 011h11.ij9kl9  &quot;</span>,
<a name="l00107"></a>00107 <span class="stringliteral">&quot;  0_1h1h.mno9   &quot;</span>,
<a name="l00108"></a>00108 <span class="stringliteral">&quot;   0p12h9qr9    &quot;</span>,
<a name="l00109"></a>00109 <span class="stringliteral">&quot;    0hh9st9     &quot;</span>,
<a name="l00110"></a>00110 <span class="stringliteral">&quot;     09uv9w     &quot;</span>,
<a name="l00111"></a>00111 <span class="stringliteral">&quot;      0x9y      &quot;</span>,
<a name="l00112"></a>00112 <span class="stringliteral">&quot;       zA       &quot;</span>};
<a name="l00113"></a>00113 
<a name="l00114"></a><a class="code" href="qucs_8cpp.html#a098a06ee0c473d9178da66df32798581">00114</a> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="qucs_8cpp.html#a098a06ee0c473d9178da66df32798581">empty_xpm</a>[] = {  <span class="comment">// provides same height than &quot;smallsave_xpm&quot;</span>
<a name="l00115"></a>00115 <span class="stringliteral">&quot;1 17 1 1&quot;</span>, <span class="stringliteral">&quot;  c None&quot;</span>, <span class="stringliteral">&quot; &quot;</span>, <span class="stringliteral">&quot; &quot;</span>, <span class="stringliteral">&quot; &quot;</span>, <span class="stringliteral">&quot; &quot;</span>, <span class="stringliteral">&quot; &quot;</span>,
<a name="l00116"></a>00116 <span class="stringliteral">&quot; &quot;</span>, <span class="stringliteral">&quot; &quot;</span>, <span class="stringliteral">&quot; &quot;</span>, <span class="stringliteral">&quot; &quot;</span>, <span class="stringliteral">&quot; &quot;</span>, <span class="stringliteral">&quot; &quot;</span>, <span class="stringliteral">&quot; &quot;</span>, <span class="stringliteral">&quot; &quot;</span>, <span class="stringliteral">&quot; &quot;</span>, <span class="stringliteral">&quot; &quot;</span>, <span class="stringliteral">&quot; &quot;</span>, <span class="stringliteral">&quot; &quot;</span>};
<a name="l00117"></a>00117 
<a name="l00118"></a>00118 
<a name="l00119"></a><a class="code" href="classQucsApp.html#a9eb972c574c798b45a1fb3692aed1d22">00119</a> <a class="code" href="classQucsApp.html#a9eb972c574c798b45a1fb3692aed1d22">QucsApp::QucsApp</a>()
<a name="l00120"></a>00120 {
<a name="l00121"></a>00121   setWindowTitle(<span class="stringliteral">&quot;Qucs &quot;</span> PACKAGE_VERSION);
<a name="l00122"></a>00122 
<a name="l00123"></a>00123   <a class="code" href="classQucsApp.html#aab06a01bf8066d0678a800fc6ea958e1">spiceExtensions</a> &lt;&lt; <span class="stringliteral">&quot;*.sp&quot;</span> &lt;&lt; <span class="stringliteral">&quot;*.cir&quot;</span> &lt;&lt; <span class="stringliteral">&quot;*.spc&quot;</span> &lt;&lt; <span class="stringliteral">&quot;*.spi&quot;</span>;
<a name="l00124"></a>00124 
<a name="l00125"></a>00125   <a class="code" href="classQucsApp.html#a00855ea292564b6816e25c23058c568f">QucsFileFilter</a> =
<a name="l00126"></a>00126     tr(<span class="stringliteral">&quot;Schematic&quot;</span>) + <span class="stringliteral">&quot; (*.sch);;&quot;</span> +
<a name="l00127"></a>00127     tr(<span class="stringliteral">&quot;Data Display&quot;</span>) + <span class="stringliteral">&quot; (*.dpl);;&quot;</span> +
<a name="l00128"></a>00128     tr(<span class="stringliteral">&quot;Qucs Documents&quot;</span>) + <span class="stringliteral">&quot; (*.sch *.dpl);;&quot;</span> +
<a name="l00129"></a>00129     tr(<span class="stringliteral">&quot;VHDL Sources&quot;</span>) + <span class="stringliteral">&quot; (*.vhdl *.vhd);;&quot;</span> +
<a name="l00130"></a>00130     tr(<span class="stringliteral">&quot;Verilog Sources&quot;</span>) + <span class="stringliteral">&quot; (*.v);;&quot;</span> +
<a name="l00131"></a>00131     tr(<span class="stringliteral">&quot;Verilog-A Sources&quot;</span>) + <span class="stringliteral">&quot; (*.va);;&quot;</span> +
<a name="l00132"></a>00132     tr(<span class="stringliteral">&quot;Octave Scripts&quot;</span>) + <span class="stringliteral">&quot; (*.m *.oct);;&quot;</span> +
<a name="l00133"></a>00133     tr(<span class="stringliteral">&quot;Spice Files&quot;</span>) + QString(<span class="stringliteral">&quot; (&quot;</span>) + <a class="code" href="classQucsApp.html#aab06a01bf8066d0678a800fc6ea958e1">spiceExtensions</a>.join(<span class="stringliteral">&quot; &quot;</span>) + QString(<span class="stringliteral">&quot;);;&quot;</span>) +
<a name="l00134"></a>00134     tr(<span class="stringliteral">&quot;Any File&quot;</span>)+<span class="stringliteral">&quot; (*)&quot;</span>;
<a name="l00135"></a>00135 
<a name="l00136"></a>00136   <a class="code" href="classQucsApp.html#ae223813596b54c221cd292adb3b81c0f">updateSchNameHash</a>();
<a name="l00137"></a>00137   <a class="code" href="classQucsApp.html#ad5e4abc792d281a23c167bedbca47a0f">updateSpiceNameHash</a>();
<a name="l00138"></a>00138 
<a name="l00139"></a>00139   move  (<a class="code" href="main_8cpp.html#ac2e3fb7eed4aa9bd981210dc5df2e02e">QucsSettings</a>.<a class="code" href="structtQucsSettings.html#a34b9641cbb3adcaba31bec3507e695e3">x</a>,  <a class="code" href="main_8cpp.html#ac2e3fb7eed4aa9bd981210dc5df2e02e">QucsSettings</a>.<a class="code" href="structtQucsSettings.html#adc432431bd5891432d2b73d8901ff916">y</a>);
<a name="l00140"></a>00140   resize(<a class="code" href="main_8cpp.html#ac2e3fb7eed4aa9bd981210dc5df2e02e">QucsSettings</a>.<a class="code" href="structtQucsSettings.html#a6bff4be70a3e6001e742ec4db039c024">dx</a>, <a class="code" href="main_8cpp.html#ac2e3fb7eed4aa9bd981210dc5df2e02e">QucsSettings</a>.<a class="code" href="structtQucsSettings.html#a4ad269745402329daddb963783c44157">dy</a>);
<a name="l00141"></a>00141 
<a name="l00142"></a>00142   <a class="code" href="classQucsApp.html#a1d5729667911400f757d5de8e1c0e6a9">MouseMoveAction</a> = 0;
<a name="l00143"></a>00143   <a class="code" href="classQucsApp.html#a7d713de7a2ead6d4dcab9c4ec1b32de4">MousePressAction</a> = 0;
<a name="l00144"></a>00144   <a class="code" href="classQucsApp.html#a710ae7088df8673e969ffb926157a9d6">MouseReleaseAction</a> = 0;
<a name="l00145"></a>00145   <a class="code" href="classQucsApp.html#a1fa601c2f555cb015aee8f828c4ed834">MouseDoubleClickAction</a> = 0;
<a name="l00146"></a>00146 
<a name="l00147"></a>00147   <a class="code" href="classQucsApp.html#ad9329f499af0fe0675d8d0c76194895d" title="QucsApp::initView Setup the layour of all widgets.">initView</a>();
<a name="l00148"></a>00148   <a class="code" href="classQucsApp.html#a90a56851da22ac5e5b9a3776b87a3b59" title="QucsApp::initActions Initializes all QActions of the application.">initActions</a>();
<a name="l00149"></a>00149   <a class="code" href="classQucsApp.html#a8031a76274a75eb2428fdba555032fde">initMenuBar</a>();
<a name="l00150"></a>00150   <a class="code" href="classQucsApp.html#add18a288c898d3e52c784d21ae90e822">initToolBar</a>();
<a name="l00151"></a>00151   <a class="code" href="classQucsApp.html#a99dd30db262cd5a57c6353e0aa9282bf">initStatusBar</a>();
<a name="l00152"></a>00152   <a class="code" href="classQucsApp.html#a9d0a2aa47a28be71e2e877bba7d8568a">viewToolBar</a>-&gt;setChecked(<span class="keyword">true</span>);
<a name="l00153"></a>00153   <a class="code" href="classQucsApp.html#afbb8e978ed885633b13a08a6db4debf4">viewStatusBar</a>-&gt;setChecked(<span class="keyword">true</span>);
<a name="l00154"></a>00154   <a class="code" href="classQucsApp.html#a869ae303b975318f9591cf20b17d8353">viewBrowseDock</a>-&gt;setChecked(<span class="keyword">true</span>);
<a name="l00155"></a>00155   <a class="code" href="classQucsApp.html#a7abb07ce8bfbdd6bb4299a7bfd8c7aae">slotViewOctaveDock</a>(<span class="keyword">false</span>);
<a name="l00156"></a>00156   <a class="code" href="classQucsApp.html#ae11e60e28902f1e1eb4604c90657459e">slotUpdateRecentFiles</a>();
<a name="l00157"></a>00157   <a class="code" href="classQucsApp.html#af6ba119183cfbf355a164e5890b2b89d">initCursorMenu</a>();
<a name="l00158"></a>00158   <a class="code" href="classModule.html#a1fe30a0d93ffea2c424b9037f0123ddf">Module::registerModules</a> ();
<a name="l00159"></a>00159 
<a name="l00160"></a>00160   <span class="comment">// instance of small text search dialog</span>
<a name="l00161"></a>00161   <a class="code" href="classQucsApp.html#a0b73c5a0f7881ba6ab91259263c2fa2d">SearchDia</a> = <span class="keyword">new</span> <a class="code" href="classSearchDialog.html">SearchDialog</a>(<span class="keyword">this</span>);
<a name="l00162"></a>00162 
<a name="l00163"></a>00163   <span class="comment">// creates a document called &quot;untitled&quot;</span>
<a name="l00164"></a>00164   <a class="code" href="classSchematic.html">Schematic</a> *d = <span class="keyword">new</span> <a class="code" href="classSchematic.html">Schematic</a>(<span class="keyword">this</span>, <span class="stringliteral">&quot;&quot;</span>);
<a name="l00165"></a>00165   <span class="keywordtype">int</span> i = <a class="code" href="classQucsApp.html#ae7612793599ca4f5106f7e9f488d4225">DocumentTab</a>-&gt;addTab(d, QPixmap(<a class="code" href="qucs_8cpp.html#a098a06ee0c473d9178da66df32798581">empty_xpm</a>), QObject::tr(<span class="stringliteral">&quot;untitled&quot;</span>));
<a name="l00166"></a>00166   <a class="code" href="classQucsApp.html#ae7612793599ca4f5106f7e9f488d4225">DocumentTab</a>-&gt;setCurrentIndex(i);
<a name="l00167"></a>00167 
<a name="l00168"></a>00168   <a class="code" href="classQucsApp.html#a7169b1bfa43595e0269ce41567a9b0e3">select</a>-&gt;setChecked(<span class="keyword">true</span>);  <span class="comment">// switch on the &#39;select&#39; action</span>
<a name="l00169"></a>00169   <a class="code" href="classQucsApp.html#ad6b73decde3208e952ca5d916a125c5a">switchSchematicDoc</a>(<span class="keyword">true</span>);  <span class="comment">// &quot;untitled&quot; document is schematic</span>
<a name="l00170"></a>00170 
<a name="l00171"></a>00171   <a class="code" href="classQucsApp.html#a0b5d68bd5b86c5f3a657d1af5fe6fb0a">lastExportFilename</a> = QDir::homePath() + QDir::separator() + <span class="stringliteral">&quot;export.png&quot;</span>;
<a name="l00172"></a>00172 
<a name="l00173"></a>00173   <span class="comment">// load documents given as command line arguments</span>
<a name="l00174"></a>00174   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> z=1; z&lt;qApp-&gt;argc(); z++) {
<a name="l00175"></a>00175     QString arg = qApp-&gt;argv()[z];
<a name="l00176"></a>00176     <span class="keywordflow">if</span>(*(arg) != <span class="charliteral">&#39;-&#39;</span>) {
<a name="l00177"></a>00177       QFileInfo Info(arg);
<a name="l00178"></a>00178       <a class="code" href="main_8cpp.html#ac2e3fb7eed4aa9bd981210dc5df2e02e">QucsSettings</a>.<a class="code" href="structtQucsSettings.html#ac416ec4c4a8bfc243ea836dbf334ccae">QucsWorkDir</a>.setPath(Info.absoluteDir().absolutePath());
<a name="l00179"></a>00179       arg = <a class="code" href="main_8cpp.html#ac2e3fb7eed4aa9bd981210dc5df2e02e">QucsSettings</a>.<a class="code" href="structtQucsSettings.html#ac416ec4c4a8bfc243ea836dbf334ccae">QucsWorkDir</a>.filePath(Info.fileName());
<a name="l00180"></a>00180       <a class="code" href="classQucsApp.html#aaaeffebcd5551096a2c6261d4bfc5636">gotoPage</a>(arg);
<a name="l00181"></a>00181     }
<a name="l00182"></a>00182   }
<a name="l00183"></a>00183 }
<a name="l00184"></a>00184 
<a name="l00185"></a><a class="code" href="classQucsApp.html#a1be3924d3b11cb77332051039d3462fc">00185</a> <a class="code" href="classQucsApp.html#a1be3924d3b11cb77332051039d3462fc">QucsApp::~QucsApp</a>()
<a name="l00186"></a>00186 {
<a name="l00187"></a>00187   <a class="code" href="classModule.html#a0065ce6daf91894854e982db384d6d92">Module::unregisterModules</a> ();
<a name="l00188"></a>00188 }
<a name="l00189"></a>00189 
<a name="l00190"></a>00190 
<a name="l00191"></a>00191 <span class="comment">// #######################################################################</span>
<a name="l00192"></a>00192 <span class="comment">// ##########                                                   ##########</span>
<a name="l00193"></a>00193 <span class="comment">// ##########     Creates the working area (QTabWidget etc.)    ##########</span>
<a name="l00194"></a>00194 <span class="comment">// ##########                                                   ##########</span>
<a name="l00195"></a>00195 <span class="comment">// #######################################################################</span>
<a name="l00199"></a><a class="code" href="classQucsApp.html#ad9329f499af0fe0675d8d0c76194895d">00199</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="classQucsApp.html#ad9329f499af0fe0675d8d0c76194895d" title="QucsApp::initView Setup the layour of all widgets.">QucsApp::initView</a>()
<a name="l00200"></a>00200 {
<a name="l00201"></a>00201 
<a name="l00202"></a>00202 
<a name="l00203"></a>00203   <span class="comment">// set application icon</span>
<a name="l00204"></a>00204   <span class="comment">// APPLE sets the QApplication icon with Info.plist</span>
<a name="l00205"></a>00205 <span class="preprocessor">#ifndef __APPLE__</span>
<a name="l00206"></a>00206 <span class="preprocessor"></span>  setWindowIcon (QPixmap(<span class="stringliteral">&quot;:/bitmaps/big.qucs.xpm&quot;</span>));
<a name="l00207"></a>00207 <span class="preprocessor">#endif</span>
<a name="l00208"></a>00208 <span class="preprocessor"></span>
<a name="l00209"></a>00209   <a class="code" href="classQucsApp.html#ae7612793599ca4f5106f7e9f488d4225">DocumentTab</a> = <span class="keyword">new</span> QTabWidget(<span class="keyword">this</span>);
<a name="l00210"></a>00210   setCentralWidget(<a class="code" href="classQucsApp.html#ae7612793599ca4f5106f7e9f488d4225">DocumentTab</a>);
<a name="l00211"></a>00211 
<a name="l00212"></a>00212   connect(<a class="code" href="classQucsApp.html#ae7612793599ca4f5106f7e9f488d4225">DocumentTab</a>,
<a name="l00213"></a>00213           SIGNAL(currentChanged(QWidget*)), SLOT(<a class="code" href="classQucsApp.html#a3924e8c4441d1446641f930d7f407bef">slotChangeView</a>(QWidget*)));
<a name="l00214"></a>00214 
<a name="l00215"></a>00215   <span class="comment">// Give every tab a close button, and connect the button&#39;s signal to</span>
<a name="l00216"></a>00216   <span class="comment">// slotFileClose</span>
<a name="l00217"></a>00217   <a class="code" href="classQucsApp.html#ae7612793599ca4f5106f7e9f488d4225">DocumentTab</a>-&gt;setTabsClosable(<span class="keyword">true</span>);
<a name="l00218"></a>00218   connect(<a class="code" href="classQucsApp.html#ae7612793599ca4f5106f7e9f488d4225">DocumentTab</a>,
<a name="l00219"></a>00219           SIGNAL(tabCloseRequested(<span class="keywordtype">int</span>)), SLOT(<a class="code" href="classQucsApp.html#aacfb383853027265ecccf4bedb863ddb">slotFileClose</a>(<span class="keywordtype">int</span>)));
<a name="l00220"></a>00220 <span class="preprocessor">#ifdef HAVE_QTABWIDGET_SETMOVABLE</span>
<a name="l00221"></a>00221 <span class="preprocessor"></span>  <span class="comment">// make tabs draggable if supported</span>
<a name="l00222"></a>00222   <a class="code" href="classQucsApp.html#ae7612793599ca4f5106f7e9f488d4225">DocumentTab</a>-&gt;setMovable (<span class="keyword">true</span>);
<a name="l00223"></a>00223 <span class="preprocessor">#endif</span>
<a name="l00224"></a>00224 <span class="preprocessor"></span>
<a name="l00225"></a>00225   <a class="code" href="classQucsApp.html#aaead7a724117265cc8afe2ef7e7279b3">dock</a> = <span class="keyword">new</span> QDockWidget(tr(<span class="stringliteral">&quot;Main Dock&quot;</span>),<span class="keyword">this</span>);
<a name="l00226"></a>00226   <a class="code" href="classQucsApp.html#a7bb309c9a24921c091c005a7fee29644">TabView</a> = <span class="keyword">new</span> QTabWidget(<a class="code" href="classQucsApp.html#aaead7a724117265cc8afe2ef7e7279b3">dock</a>);
<a name="l00227"></a>00227   <a class="code" href="classQucsApp.html#a7bb309c9a24921c091c005a7fee29644">TabView</a>-&gt;setTabPosition(QTabWidget::West);
<a name="l00228"></a>00228 
<a name="l00229"></a>00229   connect(<a class="code" href="classQucsApp.html#aaead7a724117265cc8afe2ef7e7279b3">dock</a>, SIGNAL(visibilityChanged(<span class="keywordtype">bool</span>)), SLOT(<a class="code" href="classQucsApp.html#a071eb338c29202a4030dc1435230a237">slotToggleDock</a>(<span class="keywordtype">bool</span>)));
<a name="l00230"></a>00230 
<a name="l00231"></a>00231   <a class="code" href="classQucsApp.html#a372ee1fa475722ca832511027a34c383">view</a> = <span class="keyword">new</span> <a class="code" href="classMouseActions.html">MouseActions</a>(<span class="keyword">this</span>);
<a name="l00232"></a>00232 
<a name="l00233"></a>00233   <a class="code" href="classQucsApp.html#ab1126a50f9800423f4810a36c688f4ed">editText</a> = <span class="keyword">new</span> QLineEdit(<span class="keyword">this</span>);  <span class="comment">// for editing component properties</span>
<a name="l00234"></a>00234   <a class="code" href="classQucsApp.html#ab1126a50f9800423f4810a36c688f4ed">editText</a>-&gt;setFrame(<span class="keyword">false</span>);
<a name="l00235"></a>00235   <a class="code" href="classQucsApp.html#ab1126a50f9800423f4810a36c688f4ed">editText</a>-&gt;setHidden(<span class="keyword">true</span>);
<a name="l00236"></a>00236 
<a name="l00237"></a>00237   QPalette p = palette();
<a name="l00238"></a>00238   p.setColor(backgroundRole(), <a class="code" href="main_8cpp.html#ac2e3fb7eed4aa9bd981210dc5df2e02e">QucsSettings</a>.<a class="code" href="structtQucsSettings.html#abbffb341e96cc04778160970b29a3a35">BGColor</a>);
<a name="l00239"></a>00239   <a class="code" href="classQucsApp.html#ab1126a50f9800423f4810a36c688f4ed">editText</a>-&gt;setPalette(p);
<a name="l00240"></a>00240 
<a name="l00241"></a>00241   connect(<a class="code" href="classQucsApp.html#ab1126a50f9800423f4810a36c688f4ed">editText</a>, SIGNAL(returnPressed()), SLOT(<a class="code" href="classQucsApp.html#a49e4a70cfd6f8d61e653dcd4b984ef32">slotApplyCompText</a>()));
<a name="l00242"></a>00242   connect(<a class="code" href="classQucsApp.html#ab1126a50f9800423f4810a36c688f4ed">editText</a>, SIGNAL(textChanged(<span class="keyword">const</span> QString&amp;)),
<a name="l00243"></a>00243           SLOT(<a class="code" href="classQucsApp.html#a07bb9dd02c11dda52c4ca17cc16d64de">slotResizePropEdit</a>(<span class="keyword">const</span> QString&amp;)));
<a name="l00244"></a>00244   connect(<a class="code" href="classQucsApp.html#ab1126a50f9800423f4810a36c688f4ed">editText</a>, SIGNAL(lostFocus()), SLOT(<a class="code" href="classQucsApp.html#acf15a168d7497bc25103174b31019db7">slotHideEdit</a>()));
<a name="l00245"></a>00245 
<a name="l00246"></a>00246   <span class="comment">// ----------------------------------------------------------</span>
<a name="l00247"></a>00247   <span class="comment">// &quot;Project Tab&quot; of the left QTabWidget</span>
<a name="l00248"></a>00248   QWidget *ProjGroup = <span class="keyword">new</span> QWidget();
<a name="l00249"></a>00249   QVBoxLayout *ProjGroupLayout = <span class="keyword">new</span> QVBoxLayout();
<a name="l00250"></a>00250   QWidget *ProjButts = <span class="keyword">new</span> QWidget();
<a name="l00251"></a>00251   QPushButton *ProjNew = <span class="keyword">new</span> QPushButton(tr(<span class="stringliteral">&quot;New&quot;</span>));
<a name="l00252"></a>00252   connect(ProjNew, SIGNAL(clicked()), SLOT(<a class="code" href="classQucsApp.html#a24f658f740d8eb179e0a68e4055aeeb4">slotButtonProjNew</a>()));
<a name="l00253"></a>00253   QPushButton *ProjOpen = <span class="keyword">new</span> QPushButton(tr(<span class="stringliteral">&quot;Open&quot;</span>));
<a name="l00254"></a>00254   connect(ProjOpen, SIGNAL(clicked()), SLOT(<a class="code" href="classQucsApp.html#aa4495d06c23658bc3389aa4affb9a29e">slotButtonProjOpen</a>()));
<a name="l00255"></a>00255   QPushButton *ProjDel = <span class="keyword">new</span> QPushButton(tr(<span class="stringliteral">&quot;Delete&quot;</span>));
<a name="l00256"></a>00256   connect(ProjDel, SIGNAL(clicked()), SLOT(<a class="code" href="classQucsApp.html#ac04782bf781df3a06b397d11ff36d8d1">slotButtonProjDel</a>()));
<a name="l00257"></a>00257 
<a name="l00258"></a>00258   QHBoxLayout *ProjButtsLayout = <span class="keyword">new</span> QHBoxLayout();
<a name="l00259"></a>00259   ProjButtsLayout-&gt;addWidget(ProjNew);
<a name="l00260"></a>00260   ProjButtsLayout-&gt;addWidget(ProjOpen);
<a name="l00261"></a>00261   ProjButtsLayout-&gt;addWidget(ProjDel);
<a name="l00262"></a>00262   ProjButts-&gt;setLayout(ProjButtsLayout);
<a name="l00263"></a>00263 
<a name="l00264"></a>00264   ProjGroupLayout-&gt;addWidget(ProjButts);
<a name="l00265"></a>00265 
<a name="l00266"></a>00266   <a class="code" href="classQucsApp.html#a31fbf006da2167fc516bbc5ce8e0d28c">Projects</a> = <span class="keyword">new</span> QListView();
<a name="l00267"></a>00267 
<a name="l00268"></a>00268   ProjGroupLayout-&gt;addWidget(<a class="code" href="classQucsApp.html#a31fbf006da2167fc516bbc5ce8e0d28c">Projects</a>);
<a name="l00269"></a>00269   ProjGroup-&gt;setLayout(ProjGroupLayout);
<a name="l00270"></a>00270 
<a name="l00271"></a>00271   <a class="code" href="classQucsApp.html#a7bb309c9a24921c091c005a7fee29644">TabView</a>-&gt;addTab(ProjGroup, tr(<span class="stringliteral">&quot;Projects&quot;</span>));
<a name="l00272"></a>00272   <a class="code" href="classQucsApp.html#a7bb309c9a24921c091c005a7fee29644">TabView</a>-&gt;setTabToolTip(<a class="code" href="classQucsApp.html#a7bb309c9a24921c091c005a7fee29644">TabView</a>-&gt;indexOf(ProjGroup), tr(<span class="stringliteral">&quot;content of project directory&quot;</span>));
<a name="l00273"></a>00273 
<a name="l00274"></a>00274   connect(<a class="code" href="classQucsApp.html#a31fbf006da2167fc516bbc5ce8e0d28c">Projects</a>, SIGNAL(doubleClicked(<span class="keyword">const</span> QModelIndex &amp;)),
<a name="l00275"></a>00275           <span class="keyword">this</span>, SLOT(<a class="code" href="classQucsApp.html#a1ad75ae02b66f2195be0f7dd34158096">slotListProjOpen</a>(<span class="keyword">const</span> QModelIndex &amp;)));
<a name="l00276"></a>00276 
<a name="l00277"></a>00277   <span class="comment">// ----------------------------------------------------------</span>
<a name="l00278"></a>00278   <span class="comment">// &quot;Content&quot; Tab of the left QTabWidget</span>
<a name="l00279"></a>00279   <a class="code" href="classQucsApp.html#a4fb9ed646ac33093c199803e9625823d">Content</a> = <span class="keyword">new</span> ProjectView(<span class="keyword">this</span>);
<a name="l00280"></a>00280   <a class="code" href="classQucsApp.html#a4fb9ed646ac33093c199803e9625823d">Content</a>-&gt;setContextMenuPolicy(Qt::CustomContextMenu);
<a name="l00281"></a>00281 
<a name="l00282"></a>00282   <a class="code" href="classQucsApp.html#a7bb309c9a24921c091c005a7fee29644">TabView</a>-&gt;addTab(<a class="code" href="classQucsApp.html#a4fb9ed646ac33093c199803e9625823d">Content</a>, tr(<span class="stringliteral">&quot;Content&quot;</span>));
<a name="l00283"></a>00283   <a class="code" href="classQucsApp.html#a7bb309c9a24921c091c005a7fee29644">TabView</a>-&gt;setTabToolTip(<a class="code" href="classQucsApp.html#a7bb309c9a24921c091c005a7fee29644">TabView</a>-&gt;indexOf(<a class="code" href="classQucsApp.html#a4fb9ed646ac33093c199803e9625823d">Content</a>), tr(<span class="stringliteral">&quot;content of current project&quot;</span>));
<a name="l00284"></a>00284 
<a name="l00285"></a>00285   connect(<a class="code" href="classQucsApp.html#a4fb9ed646ac33093c199803e9625823d">Content</a>, SIGNAL(clicked(<span class="keyword">const</span> QModelIndex &amp;)), 
<a name="l00286"></a>00286           SLOT(<a class="code" href="classQucsApp.html#ab57330cad63942e3900e7456ae2cb7aa">slotSelectSubcircuit</a>(<span class="keyword">const</span> QModelIndex &amp;)));
<a name="l00287"></a>00287 
<a name="l00288"></a>00288   connect(<a class="code" href="classQucsApp.html#a4fb9ed646ac33093c199803e9625823d">Content</a>, SIGNAL(doubleClicked(<span class="keyword">const</span> QModelIndex &amp;)),
<a name="l00289"></a>00289           SLOT(<a class="code" href="classQucsApp.html#aeb426abb7ebfe9d361e8c30fd146f080">slotOpenContent</a>(<span class="keyword">const</span> QModelIndex &amp;)));
<a name="l00290"></a>00290 
<a name="l00291"></a>00291   <span class="comment">// ----------------------------------------------------------</span>
<a name="l00292"></a>00292   <span class="comment">// &quot;Component&quot; Tab of the left QTabWidget</span>
<a name="l00293"></a>00293   QWidget *CompGroup  = <span class="keyword">new</span> QWidget();
<a name="l00294"></a>00294   QVBoxLayout *CompGroupLayout = <span class="keyword">new</span> QVBoxLayout();
<a name="l00295"></a>00295   QHBoxLayout *CompSearchLayout = <span class="keyword">new</span> QHBoxLayout();
<a name="l00296"></a>00296 
<a name="l00297"></a>00297   <a class="code" href="classQucsApp.html#a86a11e3dd62788d233346c18a2db158d">CompChoose</a> = <span class="keyword">new</span> QComboBox(<span class="keyword">this</span>);
<a name="l00298"></a>00298   <a class="code" href="classQucsApp.html#a25b294ea056b55a37b0904811c426177">CompComps</a> = <span class="keyword">new</span> QListWidget(<span class="keyword">this</span>);
<a name="l00299"></a>00299   <a class="code" href="classQucsApp.html#a25b294ea056b55a37b0904811c426177">CompComps</a>-&gt;setViewMode(QListView::IconMode);
<a name="l00300"></a>00300   <a class="code" href="classQucsApp.html#a25b294ea056b55a37b0904811c426177">CompComps</a>-&gt;setGridSize(QSize(110,90));
<a name="l00301"></a>00301   <a class="code" href="classQucsApp.html#a4daea51690e6dd3c8651f9876bdc7fa7">CompSearch</a> = <span class="keyword">new</span> QLineEdit(<span class="keyword">this</span>);
<a name="l00302"></a>00302   <a class="code" href="classQucsApp.html#a4daea51690e6dd3c8651f9876bdc7fa7">CompSearch</a>-&gt;setPlaceholderText(tr(<span class="stringliteral">&quot;Search Components&quot;</span>));
<a name="l00303"></a>00303   <a class="code" href="classQucsApp.html#a3c9253d8def465fd65de0b3400033f2e">CompSearchClear</a> = <span class="keyword">new</span> QPushButton(tr(<span class="stringliteral">&quot;Clear&quot;</span>));
<a name="l00304"></a>00304 
<a name="l00305"></a>00305   CompGroupLayout-&gt;setSpacing(5);
<a name="l00306"></a>00306   CompGroupLayout-&gt;addWidget(<a class="code" href="classQucsApp.html#a86a11e3dd62788d233346c18a2db158d">CompChoose</a>);
<a name="l00307"></a>00307   CompGroupLayout-&gt;addWidget(<a class="code" href="classQucsApp.html#a25b294ea056b55a37b0904811c426177">CompComps</a>);
<a name="l00308"></a>00308   CompGroupLayout-&gt;addLayout(CompSearchLayout);
<a name="l00309"></a>00309   CompSearchLayout-&gt;addWidget(<a class="code" href="classQucsApp.html#a4daea51690e6dd3c8651f9876bdc7fa7">CompSearch</a>);
<a name="l00310"></a>00310   CompSearchLayout-&gt;addWidget(<a class="code" href="classQucsApp.html#a3c9253d8def465fd65de0b3400033f2e">CompSearchClear</a>);
<a name="l00311"></a>00311   CompGroup-&gt;setLayout(CompGroupLayout);
<a name="l00312"></a>00312 
<a name="l00313"></a>00313   <a class="code" href="classQucsApp.html#a7bb309c9a24921c091c005a7fee29644">TabView</a>-&gt;addTab(CompGroup,tr(<span class="stringliteral">&quot;Components&quot;</span>));
<a name="l00314"></a>00314   <a class="code" href="classQucsApp.html#a7bb309c9a24921c091c005a7fee29644">TabView</a>-&gt;setTabToolTip(<a class="code" href="classQucsApp.html#a7bb309c9a24921c091c005a7fee29644">TabView</a>-&gt;indexOf(CompGroup), tr(<span class="stringliteral">&quot;components and diagrams&quot;</span>));
<a name="l00315"></a>00315   <a class="code" href="classQucsApp.html#a1f0d73873a143ac38d74915b6d6dc347">fillComboBox</a>(<span class="keyword">true</span>);
<a name="l00316"></a>00316 
<a name="l00317"></a>00317   <a class="code" href="classQucsApp.html#a7ab3e7daff34dea1e5f2b0f9feff1a2d">slotSetCompView</a>(0);
<a name="l00318"></a>00318   connect(<a class="code" href="classQucsApp.html#a86a11e3dd62788d233346c18a2db158d">CompChoose</a>, SIGNAL(activated(<span class="keywordtype">int</span>)), SLOT(<a class="code" href="classQucsApp.html#a7ab3e7daff34dea1e5f2b0f9feff1a2d">slotSetCompView</a>(<span class="keywordtype">int</span>)));
<a name="l00319"></a>00319   connect(<a class="code" href="classQucsApp.html#a25b294ea056b55a37b0904811c426177">CompComps</a>, SIGNAL(itemActivated(QListWidgetItem*)), SLOT(<a class="code" href="classQucsApp.html#aba322956eb31e6df60cec5ae4db74d55">slotSelectComponent</a>(QListWidgetItem*)));
<a name="l00320"></a>00320   connect(<a class="code" href="classQucsApp.html#a25b294ea056b55a37b0904811c426177">CompComps</a>, SIGNAL(itemPressed(QListWidgetItem*)), SLOT(<a class="code" href="classQucsApp.html#aba322956eb31e6df60cec5ae4db74d55">slotSelectComponent</a>(QListWidgetItem*)));
<a name="l00321"></a>00321   connect(<a class="code" href="classQucsApp.html#a4daea51690e6dd3c8651f9876bdc7fa7">CompSearch</a>, SIGNAL(textEdited(<span class="keyword">const</span> QString &amp;)), SLOT(<a class="code" href="classQucsApp.html#aa5ce32e93ad36131daf03cbc20a8c404">slotSearchComponent</a>(<span class="keyword">const</span> QString &amp;)));
<a name="l00322"></a>00322   connect(<a class="code" href="classQucsApp.html#a3c9253d8def465fd65de0b3400033f2e">CompSearchClear</a>, SIGNAL(clicked()), SLOT(<a class="code" href="classQucsApp.html#a86f99f3b1a710b9cf2d3e007a946dbae">slotSearchClear</a>()));
<a name="l00323"></a>00323 
<a name="l00324"></a>00324   <span class="comment">// ----------------------------------------------------------</span>
<a name="l00325"></a>00325   <span class="comment">// &quot;Libraries&quot; Tab of the left QTabWidget</span>
<a name="l00326"></a>00326 
<a name="l00327"></a>00327   QWidget *LibGroup = <span class="keyword">new</span> QWidget ();
<a name="l00328"></a>00328   QVBoxLayout *LibGroupLayout = <span class="keyword">new</span> QVBoxLayout ();
<a name="l00329"></a>00329   QWidget *LibButts = <span class="keyword">new</span> QWidget ();
<a name="l00330"></a>00330   QPushButton *LibManage = <span class="keyword">new</span> QPushButton (tr (<span class="stringliteral">&quot;Manage Libraries&quot;</span>));
<a name="l00331"></a>00331   connect(LibManage, SIGNAL(clicked()), SLOT(<a class="code" href="classQucsApp.html#aeff2584502f91059d162f34aa0fc8f1b">slotCallLibrary</a>()));
<a name="l00332"></a>00332 
<a name="l00333"></a>00333   QHBoxLayout *LibButtsLayout = <span class="keyword">new</span> QHBoxLayout();
<a name="l00334"></a>00334   LibButtsLayout-&gt;addWidget (LibManage);
<a name="l00335"></a>00335   LibButts-&gt;setLayout(LibButtsLayout);
<a name="l00336"></a>00336 
<a name="l00337"></a>00337   LibGroupLayout-&gt;addWidget(LibButts);
<a name="l00338"></a>00338 
<a name="l00339"></a>00339 
<a name="l00340"></a>00340   <a class="code" href="classQucsApp.html#adc8f8e90d640025e8a950bf7a9b31a63">libTreeWidget</a> = <span class="keyword">new</span> QTreeWidget (<span class="keyword">this</span>);
<a name="l00341"></a>00341   <a class="code" href="classQucsApp.html#adc8f8e90d640025e8a950bf7a9b31a63">libTreeWidget</a>-&gt;setColumnCount (1);
<a name="l00342"></a>00342   QStringList headers;
<a name="l00343"></a>00343   headers.clear ();
<a name="l00344"></a>00344   headers &lt;&lt; tr (<span class="stringliteral">&quot;Libraries&quot;</span>);
<a name="l00345"></a>00345   <a class="code" href="classQucsApp.html#adc8f8e90d640025e8a950bf7a9b31a63">libTreeWidget</a>-&gt;setHeaderLabels (headers);
<a name="l00346"></a>00346 
<a name="l00347"></a>00347   LibGroupLayout-&gt;addWidget (<a class="code" href="classQucsApp.html#adc8f8e90d640025e8a950bf7a9b31a63">libTreeWidget</a>);
<a name="l00348"></a>00348   LibGroup-&gt;setLayout (LibGroupLayout);
<a name="l00349"></a>00349 
<a name="l00350"></a>00350   <a class="code" href="classQucsApp.html#af691cbc3d466a0c174c13c57fc981b8b">fillLibrariesTreeView</a> ();
<a name="l00351"></a>00351 
<a name="l00352"></a>00352   <a class="code" href="classQucsApp.html#a7bb309c9a24921c091c005a7fee29644">TabView</a>-&gt;addTab (LibGroup, tr(<span class="stringliteral">&quot;Libraries&quot;</span>));
<a name="l00353"></a>00353   <a class="code" href="classQucsApp.html#a7bb309c9a24921c091c005a7fee29644">TabView</a>-&gt;setTabToolTip (<a class="code" href="classQucsApp.html#a7bb309c9a24921c091c005a7fee29644">TabView</a>-&gt;indexOf (CompGroup), tr (<span class="stringliteral">&quot;system and user component libraries&quot;</span>));
<a name="l00354"></a>00354 
<a name="l00355"></a>00355   connect(<a class="code" href="classQucsApp.html#adc8f8e90d640025e8a950bf7a9b31a63">libTreeWidget</a>, SIGNAL(itemPressed (QTreeWidgetItem*, <span class="keywordtype">int</span>)),
<a name="l00356"></a>00356            SLOT(<a class="code" href="classQucsApp.html#adca6dc371ca66a9d633d6ff2f6b42b4b">slotSelectLibComponent</a> (QTreeWidgetItem*)));
<a name="l00357"></a>00357 
<a name="l00358"></a>00358   <span class="comment">// ----------------------------------------------------------</span>
<a name="l00359"></a>00359   <span class="comment">// put the tab widget in the dock</span>
<a name="l00360"></a>00360   <a class="code" href="classQucsApp.html#aaead7a724117265cc8afe2ef7e7279b3">dock</a>-&gt;setWidget(<a class="code" href="classQucsApp.html#a7bb309c9a24921c091c005a7fee29644">TabView</a>);
<a name="l00361"></a>00361   <a class="code" href="classQucsApp.html#aaead7a724117265cc8afe2ef7e7279b3">dock</a>-&gt;setAllowedAreas(Qt::LeftDockWidgetArea);
<a name="l00362"></a>00362   this-&gt;addDockWidget(Qt::LeftDockWidgetArea, <a class="code" href="classQucsApp.html#aaead7a724117265cc8afe2ef7e7279b3">dock</a>);
<a name="l00363"></a>00363   <a class="code" href="classQucsApp.html#a7bb309c9a24921c091c005a7fee29644">TabView</a>-&gt;setCurrentIndex(0);
<a name="l00364"></a>00364 
<a name="l00365"></a>00365   <span class="comment">// ----------------------------------------------------------</span>
<a name="l00366"></a>00366   <span class="comment">// Octave docking window</span>
<a name="l00367"></a>00367   <a class="code" href="classQucsApp.html#aa6937af70df595645d0c726e74153d9e">octDock</a> = <span class="keyword">new</span> QDockWidget(tr(<span class="stringliteral">&quot;Octave Dock&quot;</span>));
<a name="l00368"></a>00368 
<a name="l00369"></a>00369   connect(<a class="code" href="classQucsApp.html#aa6937af70df595645d0c726e74153d9e">octDock</a>, SIGNAL(visibilityChanged(<span class="keywordtype">bool</span>)), SLOT(<a class="code" href="classQucsApp.html#ab9cdd18f2a870b5930f2296c9bfd89ad">slotToggleOctave</a>(<span class="keywordtype">bool</span>)));
<a name="l00370"></a>00370   <a class="code" href="classQucsApp.html#a2442034cd3aa8a3fef9f1abf70633a0b">octave</a> = <span class="keyword">new</span> <a class="code" href="classOctaveWindow.html">OctaveWindow</a>(<a class="code" href="classQucsApp.html#aa6937af70df595645d0c726e74153d9e">octDock</a>);
<a name="l00371"></a>00371   this-&gt;addDockWidget(Qt::BottomDockWidgetArea, <a class="code" href="classQucsApp.html#aa6937af70df595645d0c726e74153d9e">octDock</a>);
<a name="l00372"></a>00372   this-&gt;setCorner(Qt::BottomLeftCorner  , Qt::LeftDockWidgetArea);
<a name="l00373"></a>00373 
<a name="l00374"></a>00374   <span class="comment">// ............................................</span>
<a name="l00375"></a>00375 
<a name="l00376"></a>00376   <a class="code" href="classQucsApp.html#af04bb1a30a43a72e3db0712d5410549b">messageDock</a> = <span class="keyword">new</span> <a class="code" href="classMessageDock.html">MessageDock</a>(<span class="keyword">this</span>);
<a name="l00377"></a>00377 
<a name="l00378"></a>00378   <span class="comment">// initial home directory model</span>
<a name="l00379"></a>00379   <a class="code" href="classQucsApp.html#adec5dadec32a071f4a9ba67b841f2822">m_homeDirModel</a> = <span class="keyword">new</span> QFileSystemModel(<span class="keyword">this</span>);
<a name="l00380"></a>00380   QStringList filters;
<a name="l00381"></a>00381   filters &lt;&lt; <span class="stringliteral">&quot;*_prj&quot;</span>;
<a name="l00382"></a>00382   <a class="code" href="classQucsApp.html#adec5dadec32a071f4a9ba67b841f2822">m_homeDirModel</a>-&gt;setNameFilters(filters);
<a name="l00383"></a>00383   <a class="code" href="classQucsApp.html#adec5dadec32a071f4a9ba67b841f2822">m_homeDirModel</a>-&gt;setNameFilterDisables(<span class="keyword">false</span>);
<a name="l00384"></a>00384   <a class="code" href="classQucsApp.html#adec5dadec32a071f4a9ba67b841f2822">m_homeDirModel</a>-&gt;setFilter(QDir::Dirs | QDir::NoDotAndDotDot);
<a name="l00385"></a>00385 
<a name="l00386"></a>00386   <span class="comment">// ............................................</span>
<a name="l00387"></a>00387   <a class="code" href="classQucsApp.html#a580aa50035a82c66f13fe7befce9c5e2">readProjects</a>(); <span class="comment">// reads all projects and inserts them into the ListBox</span>
<a name="l00388"></a>00388 }
<a name="l00389"></a>00389 
<a name="l00390"></a>00390 <span class="comment">// Put all available libraries into ComboBox.</span>
<a name="l00391"></a><a class="code" href="classQucsApp.html#af691cbc3d466a0c174c13c57fc981b8b">00391</a> <span class="keywordtype">void</span> <a class="code" href="classQucsApp.html#af691cbc3d466a0c174c13c57fc981b8b">QucsApp::fillLibrariesTreeView</a> ()
<a name="l00392"></a>00392 {
<a name="l00393"></a>00393     QStringList LibFiles;
<a name="l00394"></a>00394     QStringList::iterator it;
<a name="l00395"></a>00395     QList&lt;QTreeWidgetItem *&gt; topitems;
<a name="l00396"></a>00396 
<a name="l00397"></a>00397     <a class="code" href="classQucsApp.html#adc8f8e90d640025e8a950bf7a9b31a63">libTreeWidget</a>-&gt;clear();
<a name="l00398"></a>00398 
<a name="l00399"></a>00399     <span class="comment">// make the system libraries section header</span>
<a name="l00400"></a>00400     QTreeWidgetItem* newitem = <span class="keyword">new</span> QTreeWidgetItem((QTreeWidget*)0, QStringList(<span class="stringliteral">&quot;System Libraries&quot;</span>));
<a name="l00401"></a>00401     newitem-&gt;setChildIndicatorPolicy (QTreeWidgetItem::DontShowIndicator);
<a name="l00402"></a>00402     QFont sectionFont = newitem-&gt;font(0);
<a name="l00403"></a>00403     sectionFont.setItalic (<span class="keyword">true</span>);
<a name="l00404"></a>00404     sectionFont.setBold (<span class="keyword">true</span>);
<a name="l00405"></a>00405     newitem-&gt;setFont (0, sectionFont);
<a name="l00406"></a>00406 <span class="comment">//    newitem-&gt;setBackground</span>
<a name="l00407"></a>00407     topitems.append (newitem);
<a name="l00408"></a>00408 
<a name="l00409"></a>00409     QDir LibDir(<a class="code" href="main_8cpp.html#ac2e3fb7eed4aa9bd981210dc5df2e02e">QucsSettings</a>.<a class="code" href="structtQucsSettings.html#aae35c62d8372f459bde55aff398c2390">LibDir</a>);
<a name="l00410"></a>00410     LibFiles = LibDir.entryList(QStringList(<span class="stringliteral">&quot;*.lib&quot;</span>), QDir::Files, QDir::Name);
<a name="l00411"></a>00411 
<a name="l00412"></a>00412     <span class="comment">// create top level library itmes, base on the library names</span>
<a name="l00413"></a>00413     <span class="keywordflow">for</span>(it = LibFiles.begin(); it != LibFiles.end(); it++)
<a name="l00414"></a>00414     {
<a name="l00415"></a>00415         ComponentLibrary parsedlibrary;
<a name="l00416"></a>00416 
<a name="l00417"></a>00417         <span class="keywordtype">int</span> result = parseComponentLibrary (<a class="code" href="main_8cpp.html#ac2e3fb7eed4aa9bd981210dc5df2e02e">QucsSettings</a>.<a class="code" href="structtQucsSettings.html#aae35c62d8372f459bde55aff398c2390">LibDir</a> + *it , parsedlibrary);
<a name="l00418"></a>00418         QStringList nameAndFileName;
<a name="l00419"></a>00419         nameAndFileName.append (parsedlibrary.name);
<a name="l00420"></a>00420         nameAndFileName.append (<a class="code" href="main_8cpp.html#ac2e3fb7eed4aa9bd981210dc5df2e02e">QucsSettings</a>.<a class="code" href="structtQucsSettings.html#aae35c62d8372f459bde55aff398c2390">LibDir</a> + *it);
<a name="l00421"></a>00421 
<a name="l00422"></a>00422         QTreeWidgetItem* newlibitem = <span class="keyword">new</span> QTreeWidgetItem((QTreeWidget*)0, nameAndFileName);
<a name="l00423"></a>00423 
<a name="l00424"></a>00424         <span class="keywordflow">switch</span> (result)
<a name="l00425"></a>00425         {
<a name="l00426"></a>00426             <span class="keywordflow">case</span> QUCS_COMP_LIB_IO_ERROR:
<a name="l00427"></a>00427                 QMessageBox::critical(0, tr (<span class="stringliteral">&quot;Error&quot;</span>), tr(<span class="stringliteral">&quot;Cannot open \&quot;%1\&quot;.&quot;</span>).arg (*it));
<a name="l00428"></a>00428                 <span class="keywordflow">return</span>;
<a name="l00429"></a>00429             <span class="keywordflow">case</span> QUCS_COMP_LIB_CORRUPT:
<a name="l00430"></a>00430                 QMessageBox::critical(0, tr(<span class="stringliteral">&quot;Error&quot;</span>), tr(<span class="stringliteral">&quot;Library is corrupt.&quot;</span>));
<a name="l00431"></a>00431                 <span class="keywordflow">return</span>;
<a name="l00432"></a>00432             <span class="keywordflow">default</span>:
<a name="l00433"></a>00433                 <span class="keywordflow">break</span>;
<a name="l00434"></a>00434         }
<a name="l00435"></a>00435 
<a name="l00436"></a>00436         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; parsedlibrary.components.count (); i++)
<a name="l00437"></a>00437         {
<a name="l00438"></a>00438             QStringList compNameAndDefinition;
<a name="l00439"></a>00439 
<a name="l00440"></a>00440             compNameAndDefinition.append (parsedlibrary.components[i].name);
<a name="l00441"></a>00441 
<a name="l00442"></a>00442             QString s = <span class="stringliteral">&quot;&lt;Qucs Schematic &quot;</span> PACKAGE_VERSION <span class="stringliteral">&quot;&gt;\n&quot;</span>;
<a name="l00443"></a>00443 
<a name="l00444"></a>00444             s +=  <span class="stringliteral">&quot;&lt;Components&gt;\n  &quot;</span> +
<a name="l00445"></a>00445                   parsedlibrary.components[i].modelString + <span class="stringliteral">&quot;\n&quot;</span> +
<a name="l00446"></a>00446                   <span class="stringliteral">&quot;&lt;/Components&gt;\n&quot;</span>;
<a name="l00447"></a>00447 
<a name="l00448"></a>00448             compNameAndDefinition.append (s);
<a name="l00449"></a>00449 
<a name="l00450"></a>00450             QTreeWidgetItem* newcompitem = <span class="keyword">new</span> QTreeWidgetItem(newlibitem, compNameAndDefinition);
<a name="l00451"></a>00451 
<a name="l00452"></a>00452             <span class="comment">// Silence warning from the compiler about unused variable newcompitem</span>
<a name="l00453"></a>00453             <span class="comment">// we pass the pointer to the parent item in the constructor</span>
<a name="l00454"></a>00454             Q_UNUSED( newcompitem )
<a name="l00455"></a>00455         }
<a name="l00456"></a>00456 
<a name="l00457"></a>00457         topitems.append (newlibitem);
<a name="l00458"></a>00458     }
<a name="l00459"></a>00459 
<a name="l00460"></a>00460 
<a name="l00461"></a>00461     <span class="comment">// make the user libraries section header</span>
<a name="l00462"></a>00462     newitem = <span class="keyword">new</span> QTreeWidgetItem((QTreeWidget*)0, QStringList(<span class="stringliteral">&quot;User Libraries&quot;</span>));
<a name="l00463"></a>00463     newitem-&gt;setChildIndicatorPolicy (QTreeWidgetItem::DontShowIndicator);
<a name="l00464"></a>00464     newitem-&gt;setFont (0, sectionFont);
<a name="l00465"></a>00465     topitems.append (newitem);
<a name="l00466"></a>00466 
<a name="l00467"></a>00467     QDir UserLibDir = QDir (<a class="code" href="main_8cpp.html#ac2e3fb7eed4aa9bd981210dc5df2e02e">QucsSettings</a>.<a class="code" href="structtQucsSettings.html#a80d828678da4014a033ddf5ec3f831c7">QucsHomeDir</a>.canonicalPath () + <span class="stringliteral">&quot;/user_lib/&quot;</span>);
<a name="l00468"></a>00468 
<a name="l00469"></a>00469     <span class="comment">// if there are user libraries, add them too</span>
<a name="l00470"></a>00470     <span class="keywordflow">if</span>(UserLibDir.exists ())
<a name="l00471"></a>00471     {
<a name="l00472"></a>00472         <span class="comment">//LibFiles = UserLibDir.entryList(&quot;*.lib&quot;, QDir::Files, QDir::Name);</span>
<a name="l00473"></a>00473         LibFiles = UserLibDir.entryList(QStringList(<span class="stringliteral">&quot;*.lib&quot;</span>), QDir::Files, QDir::Name);
<a name="l00474"></a>00474         <span class="keywordtype">int</span> UserLibCount = LibFiles.count();
<a name="l00475"></a>00475 
<a name="l00476"></a>00476         <span class="keywordflow">if</span> (UserLibCount &gt; 0)
<a name="l00477"></a>00477         {
<a name="l00478"></a>00478 
<a name="l00479"></a>00479             <span class="comment">// create top level library itmes, base on the library names</span>
<a name="l00480"></a>00480             <span class="keywordflow">for</span>(it = LibFiles.begin(); it != LibFiles.end(); it++)
<a name="l00481"></a>00481             {
<a name="l00482"></a>00482                 ComponentLibrary parsedlibrary;
<a name="l00483"></a>00483 
<a name="l00484"></a>00484                 <span class="keywordtype">int</span> result = parseComponentLibrary (UserLibDir.absolutePath() +<span class="stringliteral">&quot;/&quot;</span>+ *it , parsedlibrary);
<a name="l00485"></a>00485                 QStringList nameAndFileName;
<a name="l00486"></a>00486                 nameAndFileName.append (parsedlibrary.name);
<a name="l00487"></a>00487                 nameAndFileName.append (UserLibDir.absolutePath() +<span class="stringliteral">&quot;/&quot;</span>+ *it);
<a name="l00488"></a>00488 
<a name="l00489"></a>00489                 QTreeWidgetItem* newlibitem = <span class="keyword">new</span> QTreeWidgetItem((QTreeWidget*)0, nameAndFileName);
<a name="l00490"></a>00490 
<a name="l00491"></a>00491                 <span class="keywordflow">switch</span> (result)
<a name="l00492"></a>00492                 {
<a name="l00493"></a>00493                     <span class="keywordflow">case</span> QUCS_COMP_LIB_IO_ERROR:
<a name="l00494"></a>00494                         QMessageBox::critical(0, tr (<span class="stringliteral">&quot;Error&quot;</span>), tr(<span class="stringliteral">&quot;Cannot open \&quot;%1\&quot;.&quot;</span>).arg (UserLibDir.absolutePath()+<span class="stringliteral">&quot;/&quot;</span> +*it));
<a name="l00495"></a>00495                         <span class="keywordflow">return</span>;
<a name="l00496"></a>00496                     <span class="keywordflow">case</span> QUCS_COMP_LIB_CORRUPT:
<a name="l00497"></a>00497                         QMessageBox::critical(0, tr(<span class="stringliteral">&quot;Error&quot;</span>), tr(<span class="stringliteral">&quot;Library is corrupt.&quot;</span>));
<a name="l00498"></a>00498                         <span class="keywordflow">return</span>;
<a name="l00499"></a>00499                     <span class="keywordflow">default</span>:
<a name="l00500"></a>00500                         <span class="keywordflow">break</span>;
<a name="l00501"></a>00501                 }
<a name="l00502"></a>00502 
<a name="l00503"></a>00503                 <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; parsedlibrary.components.count (); i++)
<a name="l00504"></a>00504                 {
<a name="l00505"></a>00505                     QStringList compNameAndDefinition;
<a name="l00506"></a>00506 
<a name="l00507"></a>00507                     compNameAndDefinition.append (parsedlibrary.components[i].name);
<a name="l00508"></a>00508 
<a name="l00509"></a>00509                     QString s = <span class="stringliteral">&quot;&lt;Qucs Schematic &quot;</span> PACKAGE_VERSION <span class="stringliteral">&quot;&gt;\n&quot;</span>;
<a name="l00510"></a>00510 
<a name="l00511"></a>00511                     s +=  <span class="stringliteral">&quot;&lt;Components&gt;\n  &quot;</span> +
<a name="l00512"></a>00512                           parsedlibrary.components[i].modelString + <span class="stringliteral">&quot;\n&quot;</span> +
<a name="l00513"></a>00513                           <span class="stringliteral">&quot;&lt;/Components&gt;\n&quot;</span>;
<a name="l00514"></a>00514 
<a name="l00515"></a>00515                     compNameAndDefinition.append (s);
<a name="l00516"></a>00516 
<a name="l00517"></a>00517 
<a name="l00518"></a>00518                     QTreeWidgetItem* newcompitem = <span class="keyword">new</span> QTreeWidgetItem(newlibitem, compNameAndDefinition);
<a name="l00519"></a>00519 
<a name="l00520"></a>00520                     <span class="comment">// Silence warning from the compiler about unused variable newcompitem</span>
<a name="l00521"></a>00521                     <span class="comment">// we pass the pointer to the parent item in the constructor</span>
<a name="l00522"></a>00522                     Q_UNUSED( newcompitem )
<a name="l00523"></a>00523                 }
<a name="l00524"></a>00524 
<a name="l00525"></a>00525                 topitems.append (newlibitem);
<a name="l00526"></a>00526             }
<a name="l00527"></a>00527             <a class="code" href="classQucsApp.html#adc8f8e90d640025e8a950bf7a9b31a63">libTreeWidget</a>-&gt;insertTopLevelItems(0, topitems);
<a name="l00528"></a>00528         }
<a name="l00529"></a>00529         <span class="keywordflow">else</span>
<a name="l00530"></a>00530         {
<a name="l00531"></a>00531             <span class="comment">// make the user libraries section header</span>
<a name="l00532"></a>00532             newitem = <span class="keyword">new</span> QTreeWidgetItem((QTreeWidget*)0, QStringList(<span class="stringliteral">&quot;No User Libraries&quot;</span>));
<a name="l00533"></a>00533             sectionFont.setBold (<span class="keyword">false</span>);
<a name="l00534"></a>00534             newitem-&gt;setFont (0, sectionFont);
<a name="l00535"></a>00535             topitems.append (newitem);
<a name="l00536"></a>00536         }
<a name="l00537"></a>00537     }
<a name="l00538"></a>00538     <span class="keywordflow">else</span>
<a name="l00539"></a>00539     {
<a name="l00540"></a>00540         <span class="comment">// make the user libraries section header</span>
<a name="l00541"></a>00541         newitem = <span class="keyword">new</span> QTreeWidgetItem((QTreeWidget*)0, QStringList(<span class="stringliteral">&quot;No User Libraries&quot;</span>));
<a name="l00542"></a>00542         sectionFont.setBold (<span class="keyword">false</span>);
<a name="l00543"></a>00543         newitem-&gt;setFont (0, sectionFont);
<a name="l00544"></a>00544         topitems.append (newitem);
<a name="l00545"></a>00545     }
<a name="l00546"></a>00546 
<a name="l00547"></a>00547     <a class="code" href="classQucsApp.html#adc8f8e90d640025e8a950bf7a9b31a63">libTreeWidget</a>-&gt;insertTopLevelItems(0, topitems);
<a name="l00548"></a>00548 }
<a name="l00549"></a>00549 
<a name="l00550"></a>00550 
<a name="l00551"></a>00551 <span class="comment">// ---------------------------------------------------------------</span>
<a name="l00552"></a>00552 <span class="comment">// Returns a pointer to the QucsDoc object whose number is &quot;No&quot;.</span>
<a name="l00553"></a>00553 <span class="comment">// If No &lt; 0 then a pointer to the current document is returned.</span>
<a name="l00554"></a><a class="code" href="classQucsApp.html#a5a91682ea446a8a35c039c5ea233b587">00554</a> <a class="code" href="classQucsDoc.html">QucsDoc</a>* <a class="code" href="classQucsApp.html#a5a91682ea446a8a35c039c5ea233b587">QucsApp::getDoc</a>(<span class="keywordtype">int</span> No)
<a name="l00555"></a>00555 {
<a name="l00556"></a>00556   QWidget *w;
<a name="l00557"></a>00557   <span class="keywordflow">if</span>(No &lt; 0)
<a name="l00558"></a>00558     w = <a class="code" href="classQucsApp.html#ae7612793599ca4f5106f7e9f488d4225">DocumentTab</a>-&gt;currentWidget();
<a name="l00559"></a>00559   <span class="keywordflow">else</span>
<a name="l00560"></a>00560     w = <a class="code" href="classQucsApp.html#ae7612793599ca4f5106f7e9f488d4225">DocumentTab</a>-&gt;widget(No);
<a name="l00561"></a>00561 
<a name="l00562"></a>00562   <span class="keywordflow">if</span>(w) {
<a name="l00563"></a>00563     <span class="keywordflow">if</span>(<a class="code" href="classQucsApp.html#aa699c68344d4bd4f53fe90f0ccd4b6ae">isTextDocument</a> (w))
<a name="l00564"></a>00564       <span class="keywordflow">return</span> (<a class="code" href="classQucsDoc.html">QucsDoc</a>*) ((<a class="code" href="classTextDoc.html" title="The TextDoc class definition.">TextDoc</a>*)w);
<a name="l00565"></a>00565     <span class="keywordflow">else</span>
<a name="l00566"></a>00566       <span class="keywordflow">return</span> (<a class="code" href="classQucsDoc.html">QucsDoc</a>*) ((<a class="code" href="classSchematic.html">Schematic</a>*)w);
<a name="l00567"></a>00567   }
<a name="l00568"></a>00568 
<a name="l00569"></a>00569   <span class="keywordflow">return</span> 0;
<a name="l00570"></a>00570 }
<a name="l00571"></a>00571 
<a name="l00572"></a>00572 <span class="comment">// ---------------------------------------------------------------</span>
<a name="l00573"></a>00573 <span class="comment">// Returns a pointer to the QucsDoc object whose file name is &quot;Name&quot;.</span>
<a name="l00574"></a><a class="code" href="classQucsApp.html#aedb93e909d0b2cff6a8e4ccc82809057">00574</a> <a class="code" href="classQucsDoc.html">QucsDoc</a> * <a class="code" href="classQucsApp.html#aedb93e909d0b2cff6a8e4ccc82809057">QucsApp::findDoc</a> (QString File, <span class="keywordtype">int</span> * Pos)
<a name="l00575"></a>00575 {
<a name="l00576"></a>00576   <a class="code" href="classQucsDoc.html">QucsDoc</a> * d;
<a name="l00577"></a>00577   <span class="keywordtype">int</span> No = 0;
<a name="l00578"></a>00578   File = QDir::convertSeparators (File);
<a name="l00579"></a>00579   <span class="keywordflow">while</span> ((d = <a class="code" href="classQucsApp.html#a5a91682ea446a8a35c039c5ea233b587">getDoc</a> (No++)) != 0)
<a name="l00580"></a>00580     <span class="keywordflow">if</span> (QDir::convertSeparators (d-&gt;<a class="code" href="classQucsDoc.html#a2d87112c4f75a4770c9311bb6c2d407b">DocName</a>) == File) {
<a name="l00581"></a>00581       <span class="keywordflow">if</span> (Pos) *Pos = No - 1;
<a name="l00582"></a>00582       <span class="keywordflow">return</span> d;
<a name="l00583"></a>00583     }
<a name="l00584"></a>00584   <span class="keywordflow">return</span> 0;
<a name="l00585"></a>00585 }
<a name="l00586"></a>00586 
<a name="l00587"></a>00587 <span class="comment">// ---------------------------------------------------------------</span>
<a name="l00588"></a>00588 <span class="comment">// Put the component groups into the ComboBox. It is possible to</span>
<a name="l00589"></a>00589 <span class="comment">// only put the paintings in it, because of &quot;symbol painting mode&quot;.</span>
<a name="l00590"></a>00590 
<a name="l00591"></a>00591 <span class="comment">// if setAll, add all categories to combobox</span>
<a name="l00592"></a>00592 <span class="comment">// if not, set just paintings (symbol painting mode)</span>
<a name="l00593"></a><a class="code" href="classQucsApp.html#a1f0d73873a143ac38d74915b6d6dc347">00593</a> <span class="keywordtype">void</span> <a class="code" href="classQucsApp.html#a1f0d73873a143ac38d74915b6d6dc347">QucsApp::fillComboBox</a> (<span class="keywordtype">bool</span> setAll)
<a name="l00594"></a>00594 {
<a name="l00595"></a>00595   <span class="comment">//CompChoose-&gt;setMaxVisibleItems (13); // Increase this if you add items below.</span>
<a name="l00596"></a>00596   <a class="code" href="classQucsApp.html#a86a11e3dd62788d233346c18a2db158d">CompChoose</a>-&gt;clear ();
<a name="l00597"></a>00597 
<a name="l00598"></a>00598   <span class="keywordflow">if</span> (!setAll) {
<a name="l00599"></a>00599     <a class="code" href="classQucsApp.html#a86a11e3dd62788d233346c18a2db158d">CompChoose</a>-&gt;insertItem(<a class="code" href="classQucsApp.html#a86a11e3dd62788d233346c18a2db158d">CompChoose</a>-&gt;count(), QObject::tr(<span class="stringliteral">&quot;paintings&quot;</span>));
<a name="l00600"></a>00600   } <span class="keywordflow">else</span> {
<a name="l00601"></a>00601     QStringList cats = <a class="code" href="classCategory.html#a960a0e59d07a74118852ba06a63b7806">Category::getCategories</a> ();
<a name="l00602"></a>00602     <span class="keywordflow">foreach</span> (QString it, cats) {
<a name="l00603"></a>00603       <a class="code" href="classQucsApp.html#a86a11e3dd62788d233346c18a2db158d">CompChoose</a>-&gt;insertItem(<a class="code" href="classQucsApp.html#a86a11e3dd62788d233346c18a2db158d">CompChoose</a>-&gt;count(), it);
<a name="l00604"></a>00604     }
<a name="l00605"></a>00605   }
<a name="l00606"></a>00606 }
<a name="l00607"></a>00607 
<a name="l00608"></a>00608 <span class="comment">// ----------------------------------------------------------</span>
<a name="l00609"></a>00609 <span class="comment">// Whenever the Component Library ComboBox is changed, this slot fills the</span>
<a name="l00610"></a>00610 <span class="comment">// Component IconView with the appropriate components.</span>
<a name="l00611"></a><a class="code" href="classQucsApp.html#a7ab3e7daff34dea1e5f2b0f9feff1a2d">00611</a> <span class="keywordtype">void</span> <a class="code" href="classQucsApp.html#a7ab3e7daff34dea1e5f2b0f9feff1a2d">QucsApp::slotSetCompView</a> (<span class="keywordtype">int</span> index)
<a name="l00612"></a>00612 {
<a name="l00613"></a>00613 <span class="comment">//  qDebug() &lt;&lt; &quot;QucsApp::slotSetCompView (int index)&quot;;</span>
<a name="l00614"></a>00614 
<a name="l00615"></a>00615   <a class="code" href="classQucsApp.html#ab1126a50f9800423f4810a36c688f4ed">editText</a>-&gt;setHidden (<span class="keyword">true</span>); <span class="comment">// disable text edit of component property</span>
<a name="l00616"></a>00616   <a class="code" href="classQucsApp.html#a4daea51690e6dd3c8651f9876bdc7fa7">CompSearch</a>-&gt;clear();
<a name="l00617"></a>00617 
<a name="l00618"></a>00618   QList&lt;Module *&gt; Comps;
<a name="l00619"></a>00619   <a class="code" href="classQucsApp.html#a25b294ea056b55a37b0904811c426177">CompComps</a>-&gt;clear ();   <span class="comment">// clear the IconView</span>
<a name="l00620"></a>00620   <span class="keywordflow">if</span> (<a class="code" href="classQucsApp.html#a86a11e3dd62788d233346c18a2db158d">CompChoose</a>-&gt;count () &lt;= 0) <span class="keywordflow">return</span>;
<a name="l00621"></a>00621 
<a name="l00622"></a>00622   QString item = <a class="code" href="classQucsApp.html#a86a11e3dd62788d233346c18a2db158d">CompChoose</a>-&gt;itemText (index);
<a name="l00623"></a>00623 
<a name="l00624"></a>00624   Comps = <a class="code" href="classCategory.html#ae86abddba33031433969ef9fbb906226">Category::getModules</a>(item);
<a name="l00625"></a>00625   QString Name;
<a name="l00626"></a>00626 
<a name="l00627"></a>00627   <span class="comment">// if something was registered dynamicaly, get and draw icons into dock</span>
<a name="l00628"></a>00628   <span class="keywordflow">if</span> (item == QObject::tr(<span class="stringliteral">&quot;verilog-a user devices&quot;</span>)) {
<a name="l00629"></a>00629 
<a name="l00630"></a>00630     QListWidgetItem *icon;
<a name="l00631"></a>00631     QMapIterator&lt;QString, QString&gt; i(<a class="code" href="classModule.html#acd53986d2c48def80f2570ff339c1327">Module::vaComponents</a>);
<a name="l00632"></a>00632     <span class="keywordflow">while</span> (i.hasNext()) {
<a name="l00633"></a>00633       i.next();
<a name="l00634"></a>00634 
<a name="l00635"></a>00635       <span class="comment">// default icon initally matches the module name</span>
<a name="l00636"></a>00636       <span class="comment">//Name = i.key();</span>
<a name="l00637"></a>00637 
<a name="l00638"></a>00638       <span class="comment">// Just need path to bitmap, do not create an object</span>
<a name="l00639"></a>00639       QString Name, vaBitmap;
<a name="l00640"></a>00640       <a class="code" href="classComponent.html" title="The Component class implements a generic analog component.">Component</a> * c = (<a class="code" href="classComponent.html" title="The Component class implements a generic analog component.">Component</a> *)
<a name="l00641"></a>00641               <a class="code" href="classvacomponent.html#aef5cf006f1f20f54c12c4677a8497277" title="vacomponent::info is used to either get information or create objects.">vacomponent::info</a> (Name, vaBitmap, <span class="keyword">false</span>, i.value());
<a name="l00642"></a>00642       <span class="keywordflow">if</span> (c) <span class="keyword">delete</span> c;
<a name="l00643"></a>00643 
<a name="l00644"></a>00644       <span class="comment">// check if icon exists, fall back to default</span>
<a name="l00645"></a>00645       QString iconPath = <a class="code" href="main_8cpp.html#ac2e3fb7eed4aa9bd981210dc5df2e02e">QucsSettings</a>.<a class="code" href="structtQucsSettings.html#ac416ec4c4a8bfc243ea836dbf334ccae">QucsWorkDir</a>.filePath(vaBitmap+<span class="stringliteral">&quot;.png&quot;</span>);
<a name="l00646"></a>00646 
<a name="l00647"></a>00647       QFile iconFile(iconPath);
<a name="l00648"></a>00648       QPixmap vaIcon;
<a name="l00649"></a>00649 
<a name="l00650"></a>00650       <span class="keywordflow">if</span>(iconFile.exists())
<a name="l00651"></a>00651       {
<a name="l00652"></a>00652         <span class="comment">// load bitmap defined on the JSON symbol file</span>
<a name="l00653"></a>00653         vaIcon = QPixmap(iconPath);
<a name="l00654"></a>00654       }
<a name="l00655"></a>00655       <span class="keywordflow">else</span>
<a name="l00656"></a>00656       {
<a name="l00657"></a>00657         QMessageBox::information(<span class="keyword">this</span>, tr(<span class="stringliteral">&quot;Info&quot;</span>),
<a name="l00658"></a>00658                      tr(<span class="stringliteral">&quot;Default icon not found:\n %1.png&quot;</span>).arg(vaBitmap));
<a name="l00659"></a>00659         <span class="comment">// default icon</span>
<a name="l00660"></a>00660         vaIcon = QPixmap(<span class="stringliteral">&quot;:/bitmaps/editdelete.png&quot;</span>);
<a name="l00661"></a>00661       }
<a name="l00662"></a>00662 
<a name="l00663"></a>00663       <span class="comment">// Add icon an name tag to dock</span>
<a name="l00664"></a>00664       icon = <span class="keyword">new</span> QListWidgetItem(vaIcon, Name);
<a name="l00665"></a>00665       icon-&gt;setToolTip(Name);
<a name="l00666"></a>00666       <a class="code" href="classQucsApp.html#a25b294ea056b55a37b0904811c426177">CompComps</a>-&gt;addItem(icon);
<a name="l00667"></a>00667     }
<a name="l00668"></a>00668   }
<a name="l00669"></a>00669   <span class="keywordflow">else</span> {
<a name="l00670"></a>00670     <span class="keywordtype">char</span> * File;
<a name="l00671"></a>00671     <span class="comment">// Populate list of component bitmaps</span>
<a name="l00672"></a>00672     QList&lt;Module *&gt;::const_iterator it;
<a name="l00673"></a>00673     <span class="keywordflow">for</span> (it = Comps.constBegin(); it != Comps.constEnd(); it++) {
<a name="l00674"></a>00674       <span class="keywordflow">if</span> ((*it)-&gt;info) {
<a name="l00676"></a>00676         (void) *((*it)-&gt;info) (Name, File, <span class="keyword">false</span>);
<a name="l00677"></a>00677         QListWidgetItem *icon = <span class="keyword">new</span> QListWidgetItem(QPixmap(<span class="stringliteral">&quot;:/bitmaps/&quot;</span> + QString (File) + <span class="stringliteral">&quot;.png&quot;</span>), Name);
<a name="l00678"></a>00678         icon-&gt;setToolTip(Name);
<a name="l00679"></a>00679         <a class="code" href="classQucsApp.html#a25b294ea056b55a37b0904811c426177">CompComps</a>-&gt;addItem(icon);
<a name="l00680"></a>00680       }
<a name="l00681"></a>00681     }
<a name="l00682"></a>00682   }
<a name="l00683"></a>00683 }
<a name="l00684"></a>00684 
<a name="l00685"></a>00685 <span class="comment">// ------------------------------------------------------------------</span>
<a name="l00686"></a>00686 <span class="comment">// When CompSearch is being edited, create a temp page show the</span>
<a name="l00687"></a>00687 <span class="comment">// search result</span>
<a name="l00688"></a><a class="code" href="classQucsApp.html#aa5ce32e93ad36131daf03cbc20a8c404">00688</a> <span class="keywordtype">void</span> <a class="code" href="classQucsApp.html#aa5ce32e93ad36131daf03cbc20a8c404">QucsApp::slotSearchComponent</a>(<span class="keyword">const</span> QString &amp;searchText)
<a name="l00689"></a>00689 {
<a name="l00690"></a>00690   qDebug() &lt;&lt; <span class="stringliteral">&quot;User search: &quot;</span> &lt;&lt; searchText;
<a name="l00691"></a>00691   <a class="code" href="classQucsApp.html#a25b294ea056b55a37b0904811c426177">CompComps</a>-&gt;clear ();   <span class="comment">// clear the IconView</span>
<a name="l00692"></a>00692   <span class="keywordflow">if</span> (searchText.isEmpty()) {
<a name="l00693"></a>00693     <a class="code" href="classQucsApp.html#a7ab3e7daff34dea1e5f2b0f9feff1a2d">slotSetCompView</a>(<a class="code" href="classQucsApp.html#a86a11e3dd62788d233346c18a2db158d">CompChoose</a>-&gt;currentIndex());
<a name="l00694"></a>00694   } <span class="keywordflow">else</span> {
<a name="l00695"></a>00695     <a class="code" href="classQucsApp.html#ab1126a50f9800423f4810a36c688f4ed">editText</a>-&gt;setHidden (<span class="keyword">true</span>); <span class="comment">// disable text edit of component property</span>
<a name="l00696"></a>00696 
<a name="l00697"></a>00697     <span class="comment">//traverse all component and match searchText with name</span>
<a name="l00698"></a>00698     QString Name;
<a name="l00699"></a>00699     <span class="keywordtype">char</span> * File;
<a name="l00700"></a>00700     QList&lt;Module *&gt; Comps;
<a name="l00701"></a>00701 
<a name="l00702"></a>00702     QStringList cats = <a class="code" href="classCategory.html#a960a0e59d07a74118852ba06a63b7806">Category::getCategories</a> ();
<a name="l00703"></a>00703     <span class="keywordflow">foreach</span>(QString it, cats) {
<a name="l00704"></a>00704       Comps = <a class="code" href="classCategory.html#ae86abddba33031433969ef9fbb906226">Category::getModules</a>(it);
<a name="l00705"></a>00705       QList&lt;Module *&gt;::const_iterator modit;
<a name="l00706"></a>00706       <span class="keywordflow">for</span> (modit = Comps.constBegin(); modit != Comps.constEnd(); modit++) {
<a name="l00707"></a>00707         <span class="keywordflow">if</span> ((*modit)-&gt;info) {
<a name="l00709"></a>00709           (void) *((*modit)-&gt;info) (Name, File, <span class="keyword">false</span>);
<a name="l00710"></a>00710 
<a name="l00711"></a>00711           <span class="keywordflow">if</span>((Name.indexOf(searchText, 0, Qt::CaseInsensitive)) != -1) {
<a name="l00712"></a>00712             <span class="comment">//match</span>
<a name="l00713"></a>00713             QListWidgetItem *icon = <span class="keyword">new</span> QListWidgetItem(QPixmap(<span class="stringliteral">&quot;:/bitmaps/&quot;</span> + QString (File) + <span class="stringliteral">&quot;.png&quot;</span>), Name);
<a name="l00714"></a>00714             icon-&gt;setToolTip(it + <span class="stringliteral">&quot;: &quot;</span> + Name);
<a name="l00715"></a>00715             <a class="code" href="classQucsApp.html#a25b294ea056b55a37b0904811c426177">CompComps</a>-&gt;addItem(icon);
<a name="l00716"></a>00716           }
<a name="l00717"></a>00717         }
<a name="l00718"></a>00718       }
<a name="l00719"></a>00719     }
<a name="l00720"></a>00720     QMapIterator&lt;QString, QString&gt; i(<a class="code" href="classModule.html#acd53986d2c48def80f2570ff339c1327">Module::vaComponents</a>);
<a name="l00721"></a>00721     <span class="keywordflow">while</span> (i.hasNext()) {
<a name="l00722"></a>00722       i.next();
<a name="l00723"></a>00723 
<a name="l00724"></a>00724       <span class="comment">// Just need path to bitmap, do not create an object</span>
<a name="l00725"></a>00725       QString Name, vaBitmap;
<a name="l00726"></a>00726       <a class="code" href="classvacomponent.html#aef5cf006f1f20f54c12c4677a8497277" title="vacomponent::info is used to either get information or create objects.">vacomponent::info</a> (Name, vaBitmap, <span class="keyword">false</span>, i.value());
<a name="l00727"></a>00727 
<a name="l00728"></a>00728       <span class="keywordflow">if</span>((Name.indexOf(searchText, 0, Qt::CaseInsensitive)) != -1) {
<a name="l00729"></a>00729         <span class="comment">//match</span>
<a name="l00730"></a>00730 
<a name="l00731"></a>00731         <span class="comment">// check if icon exists, fall back to default</span>
<a name="l00732"></a>00732         QString iconPath = <a class="code" href="main_8cpp.html#ac2e3fb7eed4aa9bd981210dc5df2e02e">QucsSettings</a>.<a class="code" href="structtQucsSettings.html#ac416ec4c4a8bfc243ea836dbf334ccae">QucsWorkDir</a>.filePath(vaBitmap+<span class="stringliteral">&quot;.png&quot;</span>);
<a name="l00733"></a>00733 
<a name="l00734"></a>00734         QFile iconFile(iconPath);
<a name="l00735"></a>00735         QPixmap vaIcon;
<a name="l00736"></a>00736 
<a name="l00737"></a>00737         <span class="keywordflow">if</span>(iconFile.exists())
<a name="l00738"></a>00738         {
<a name="l00739"></a>00739           <span class="comment">// load bitmap defined on the JSON symbol file</span>
<a name="l00740"></a>00740           vaIcon = QPixmap(iconPath);
<a name="l00741"></a>00741         }
<a name="l00742"></a>00742         <span class="keywordflow">else</span>
<a name="l00743"></a>00743         {
<a name="l00744"></a>00744           <span class="comment">// default icon</span>
<a name="l00745"></a>00745           vaIcon = QPixmap(<span class="stringliteral">&quot;:/bitmaps/editdelete.png&quot;</span>);
<a name="l00746"></a>00746         }
<a name="l00747"></a>00747 
<a name="l00748"></a>00748         <span class="comment">// Add icon an name tag to dock</span>
<a name="l00749"></a>00749         QListWidgetItem *icon = <span class="keyword">new</span> QListWidgetItem(vaIcon, Name);
<a name="l00750"></a>00750         icon-&gt;setToolTip(<span class="stringliteral">&quot;verilog-a user devices: &quot;</span> + Name);
<a name="l00751"></a>00751         <a class="code" href="classQucsApp.html#a25b294ea056b55a37b0904811c426177">CompComps</a>-&gt;addItem(icon);
<a name="l00752"></a>00752       }
<a name="l00753"></a>00753     }
<a name="l00754"></a>00754   }
<a name="l00755"></a>00755 }
<a name="l00756"></a>00756 
<a name="l00757"></a>00757 <span class="comment">// ------------------------------------------------------------------</span>
<a name="l00758"></a><a class="code" href="classQucsApp.html#a86f99f3b1a710b9cf2d3e007a946dbae">00758</a> <span class="keywordtype">void</span> <a class="code" href="classQucsApp.html#a86f99f3b1a710b9cf2d3e007a946dbae">QucsApp::slotSearchClear</a>()
<a name="l00759"></a>00759 {
<a name="l00760"></a>00760   <a class="code" href="classQucsApp.html#a4daea51690e6dd3c8651f9876bdc7fa7">CompSearch</a>-&gt;clear();
<a name="l00761"></a>00761   <a class="code" href="classQucsApp.html#a7ab3e7daff34dea1e5f2b0f9feff1a2d">slotSetCompView</a>(<a class="code" href="classQucsApp.html#a86a11e3dd62788d233346c18a2db158d">CompChoose</a>-&gt;currentIndex());
<a name="l00762"></a>00762 }
<a name="l00763"></a>00763 
<a name="l00764"></a>00764 <span class="comment">// ------------------------------------------------------------------</span>
<a name="l00765"></a>00765 <span class="comment">// Is called when the mouse is clicked within the Component QIconView.</span>
<a name="l00766"></a><a class="code" href="classQucsApp.html#aba322956eb31e6df60cec5ae4db74d55">00766</a> <span class="keywordtype">void</span> <a class="code" href="classQucsApp.html#aba322956eb31e6df60cec5ae4db74d55">QucsApp::slotSelectComponent</a>(QListWidgetItem *item)
<a name="l00767"></a>00767 {
<a name="l00768"></a>00768   <a class="code" href="classQucsApp.html#acf15a168d7497bc25103174b31019db7">slotHideEdit</a>(); <span class="comment">// disable text edit of component property</span>
<a name="l00769"></a>00769 
<a name="l00770"></a>00770   <span class="comment">// delete previously selected elements</span>
<a name="l00771"></a>00771   <span class="keywordflow">if</span>(<a class="code" href="classQucsApp.html#a372ee1fa475722ca832511027a34c383">view</a>-&gt;<a class="code" href="classMouseActions.html#a523750a82a7eb74f51b9a5ed5a073003">selElem</a> != 0)  <span class="keyword">delete</span> <a class="code" href="classQucsApp.html#a372ee1fa475722ca832511027a34c383">view</a>-&gt;<a class="code" href="classMouseActions.html#a523750a82a7eb74f51b9a5ed5a073003">selElem</a>;
<a name="l00772"></a>00772   <a class="code" href="classQucsApp.html#a372ee1fa475722ca832511027a34c383">view</a>-&gt;<a class="code" href="classMouseActions.html#a523750a82a7eb74f51b9a5ed5a073003">selElem</a>  = 0;   <span class="comment">// no component/diagram/painting selected</span>
<a name="l00773"></a>00773 
<a name="l00774"></a>00774   <span class="keywordflow">if</span>(item == 0) {   <span class="comment">// mouse button pressed not over an item ?</span>
<a name="l00775"></a>00775     <a class="code" href="classQucsApp.html#a25b294ea056b55a37b0904811c426177">CompComps</a>-&gt;clearSelection();  <span class="comment">// deselect component in ViewList</span>
<a name="l00776"></a>00776     <span class="keywordflow">return</span>;
<a name="l00777"></a>00777   }
<a name="l00778"></a>00778 
<a name="l00779"></a>00779   <span class="keywordflow">if</span>(<a class="code" href="classQucsApp.html#a372ee1fa475722ca832511027a34c383">view</a>-&gt;<a class="code" href="classMouseActions.html#ad43ee60feb7239ee9692300605dc9aed">drawn</a>)
<a name="l00780"></a>00780     ((Q3ScrollView*)<a class="code" href="classQucsApp.html#ae7612793599ca4f5106f7e9f488d4225">DocumentTab</a>-&gt;currentWidget())-&gt;viewport()-&gt;update();
<a name="l00781"></a>00781   <a class="code" href="classQucsApp.html#a372ee1fa475722ca832511027a34c383">view</a>-&gt;<a class="code" href="classMouseActions.html#ad43ee60feb7239ee9692300605dc9aed">drawn</a> = <span class="keyword">false</span>;
<a name="l00782"></a>00782 
<a name="l00783"></a>00783   <span class="comment">// toggle last toolbar button off</span>
<a name="l00784"></a>00784   <span class="keywordflow">if</span>(<a class="code" href="classQucsApp.html#ac4f8f4eb432b8bc69bc5e3d0ff79b9ad">activeAction</a>) {
<a name="l00785"></a>00785     <a class="code" href="classQucsApp.html#ac4f8f4eb432b8bc69bc5e3d0ff79b9ad">activeAction</a>-&gt;blockSignals(<span class="keyword">true</span>); <span class="comment">// do not call toggle slot</span>
<a name="l00786"></a>00786     <a class="code" href="classQucsApp.html#ac4f8f4eb432b8bc69bc5e3d0ff79b9ad">activeAction</a>-&gt;setChecked(<span class="keyword">false</span>);       <span class="comment">// set last toolbar button off</span>
<a name="l00787"></a>00787     <a class="code" href="classQucsApp.html#ac4f8f4eb432b8bc69bc5e3d0ff79b9ad">activeAction</a>-&gt;blockSignals(<span class="keyword">false</span>);
<a name="l00788"></a>00788   }
<a name="l00789"></a>00789   <a class="code" href="classQucsApp.html#ac4f8f4eb432b8bc69bc5e3d0ff79b9ad">activeAction</a> = 0;
<a name="l00790"></a>00790 
<a name="l00791"></a>00791   <a class="code" href="classQucsApp.html#a1d5729667911400f757d5de8e1c0e6a9">MouseMoveAction</a> = &amp;<a class="code" href="classMouseActions.html#ada8a7aeace90479d3fe31c58ceea01e1">MouseActions::MMoveElement</a>;
<a name="l00792"></a>00792   <a class="code" href="classQucsApp.html#a7d713de7a2ead6d4dcab9c4ec1b32de4">MousePressAction</a> = &amp;<a class="code" href="classMouseActions.html#a964ac8fd47ffa0885cd512a74eef76e2">MouseActions::MPressElement</a>;
<a name="l00793"></a>00793   <a class="code" href="classQucsApp.html#a710ae7088df8673e969ffb926157a9d6">MouseReleaseAction</a> = 0;
<a name="l00794"></a>00794   <a class="code" href="classQucsApp.html#a1fa601c2f555cb015aee8f828c4ed834">MouseDoubleClickAction</a> = 0;
<a name="l00795"></a>00795 
<a name="l00796"></a>00796   <a class="code" href="module_8h.html#a5ad59a5d3c30d603ac5f35937383a3f6">pInfoFunc</a> Infos = 0;
<a name="l00797"></a>00797   <a class="code" href="module_8h.html#a04aaf3b251e3795fe4d55691241f004c">pInfoVAFunc</a> InfosVA = 0;
<a name="l00798"></a>00798 
<a name="l00799"></a>00799   <span class="keywordtype">int</span> i = <a class="code" href="classQucsApp.html#a25b294ea056b55a37b0904811c426177">CompComps</a>-&gt;row(item);
<a name="l00800"></a>00800   QList&lt;Module *&gt; Comps;
<a name="l00801"></a>00801 
<a name="l00802"></a>00802   <span class="comment">// if symbol mode, only paintings are enabled.</span>
<a name="l00803"></a>00803   Comps = <a class="code" href="classCategory.html#ae86abddba33031433969ef9fbb906226">Category::getModules</a>(<a class="code" href="classQucsApp.html#a86a11e3dd62788d233346c18a2db158d">CompChoose</a>-&gt;currentText());
<a name="l00804"></a>00804   qDebug() &lt;&lt; <span class="stringliteral">&quot;pressed CompComps id&quot;</span> &lt;&lt; i;
<a name="l00805"></a>00805   qDebug() &lt;&lt; <a class="code" href="classQucsApp.html#a25b294ea056b55a37b0904811c426177">CompComps</a>-&gt;item(i)-&gt;text(); <span class="comment">//Name;</span>
<a name="l00806"></a>00806 
<a name="l00807"></a>00807   QString name = <a class="code" href="classQucsApp.html#a25b294ea056b55a37b0904811c426177">CompComps</a>-&gt;item(i)-&gt;text();
<a name="l00808"></a>00808   QString CompName;
<a name="l00809"></a>00809   QString CompFile_qstr;
<a name="l00810"></a>00810   <span class="keywordtype">char</span> *CompFile_cptr;
<a name="l00811"></a>00811 
<a name="l00812"></a>00812   <span class="keywordflow">if</span> (!<a class="code" href="classQucsApp.html#a4daea51690e6dd3c8651f9876bdc7fa7">CompSearch</a>-&gt;text().isEmpty()) {
<a name="l00813"></a>00813     <span class="comment">//comp search is not empty, search all category to get a component in same name</span>
<a name="l00814"></a>00814     QStringList cats = <a class="code" href="classCategory.html#a960a0e59d07a74118852ba06a63b7806">Category::getCategories</a>();
<a name="l00815"></a>00815     <span class="keywordtype">int</span> i = 0;
<a name="l00816"></a>00816     <span class="comment">//search normal component</span>
<a name="l00817"></a>00817     <span class="keywordflow">foreach</span> (QString it, cats) {
<a name="l00818"></a>00818       Comps = <a class="code" href="classCategory.html#ae86abddba33031433969ef9fbb906226">Category::getModules</a> (it);
<a name="l00819"></a>00819       <span class="keywordflow">foreach</span>(<a class="code" href="classModule.html">Module</a> *mod, Comps) {
<a name="l00820"></a>00820         <span class="keywordflow">if</span> (mod-&gt;<a class="code" href="classModule.html#abac66acb1a2201908e49b49ab42c965f">info</a>) {
<a name="l00821"></a>00821           (*mod-&gt;<a class="code" href="classModule.html#abac66acb1a2201908e49b49ab42c965f">info</a>)(CompName, CompFile_cptr, <span class="keyword">false</span>);
<a name="l00822"></a>00822           <span class="keywordflow">if</span> (CompName == name) {
<a name="l00823"></a>00823             <a class="code" href="classQucsApp.html#a86a11e3dd62788d233346c18a2db158d">CompChoose</a>-&gt;setCurrentIndex(i);
<a name="l00824"></a>00824             <a class="code" href="classQucsApp.html#a372ee1fa475722ca832511027a34c383">view</a>-&gt;<a class="code" href="classMouseActions.html#a523750a82a7eb74f51b9a5ed5a073003">selElem</a> = (*mod-&gt;<a class="code" href="classModule.html#abac66acb1a2201908e49b49ab42c965f">info</a>) (CompName, CompFile_cptr, <span class="keyword">true</span>);
<a name="l00825"></a>00825           }
<a name="l00826"></a>00826         }
<a name="l00827"></a>00827       }
<a name="l00828"></a>00828       i++;
<a name="l00829"></a>00829     }
<a name="l00830"></a>00830     <span class="comment">//search verilog-a component</span>
<a name="l00831"></a>00831     i = <a class="code" href="classQucsApp.html#a86a11e3dd62788d233346c18a2db158d">CompChoose</a>-&gt;findText(QObject::tr(<span class="stringliteral">&quot;verilog-a user devices&quot;</span>));
<a name="l00832"></a>00832     QMapIterator&lt;QString, QString&gt; it(<a class="code" href="classModule.html#acd53986d2c48def80f2570ff339c1327">Module::vaComponents</a>);
<a name="l00833"></a>00833     <span class="keywordflow">while</span> (it.hasNext()) {
<a name="l00834"></a>00834       it.next();
<a name="l00835"></a>00835 
<a name="l00836"></a>00836       <span class="comment">// Just need vacomponent name, do not create an object</span>
<a name="l00837"></a>00837       QString Name, vaBitmap;
<a name="l00838"></a>00838       <a class="code" href="classvacomponent.html#aef5cf006f1f20f54c12c4677a8497277" title="vacomponent::info is used to either get information or create objects.">vacomponent::info</a> (Name, vaBitmap, <span class="keyword">false</span>, it.value());
<a name="l00839"></a>00839 
<a name="l00840"></a>00840       <span class="keywordflow">if</span> (Name == name) {
<a name="l00841"></a>00841         <a class="code" href="classQucsApp.html#a372ee1fa475722ca832511027a34c383">view</a>-&gt;<a class="code" href="classMouseActions.html#a523750a82a7eb74f51b9a5ed5a073003">selElem</a> = <a class="code" href="classvacomponent.html#aef5cf006f1f20f54c12c4677a8497277" title="vacomponent::info is used to either get information or create objects.">vacomponent::info</a>(CompName, CompFile_qstr, <span class="keyword">true</span>, it.value());
<a name="l00842"></a>00842       }
<a name="l00843"></a>00843     }
<a name="l00844"></a>00844   } <span class="keywordflow">else</span> {
<a name="l00845"></a>00845     <span class="comment">// handle static and dynamic components</span>
<a name="l00846"></a>00846     <span class="keywordflow">if</span> (<a class="code" href="classQucsApp.html#a86a11e3dd62788d233346c18a2db158d">CompChoose</a>-&gt;currentText() == QObject::tr(<span class="stringliteral">&quot;verilog-a user devices&quot;</span>)){
<a name="l00847"></a>00847       InfosVA = Comps.at(i)-&gt;infoVA;
<a name="l00848"></a>00848 
<a name="l00849"></a>00849       <span class="comment">// get JSON file out of item name on widgetitem</span>
<a name="l00850"></a>00850       QString filename = <a class="code" href="classModule.html#acd53986d2c48def80f2570ff339c1327">Module::vaComponents</a>[name];
<a name="l00851"></a>00851 
<a name="l00852"></a>00852       <span class="keywordflow">if</span> (InfosVA) {
<a name="l00853"></a>00853         qDebug() &lt;&lt;  <span class="stringliteral">&quot; slotSelectComponent, view-&gt;selElem&quot;</span> ;
<a name="l00854"></a>00854         <a class="code" href="classQucsApp.html#a372ee1fa475722ca832511027a34c383">view</a>-&gt;<a class="code" href="classMouseActions.html#a523750a82a7eb74f51b9a5ed5a073003">selElem</a> = (*InfosVA) (CompName, CompFile_qstr, <span class="keyword">true</span>, filename);
<a name="l00855"></a>00855       }
<a name="l00856"></a>00856     }
<a name="l00857"></a>00857     <span class="keywordflow">else</span> {
<a name="l00858"></a>00858       Infos = Comps.at(i)-&gt;info;
<a name="l00859"></a>00859 
<a name="l00860"></a>00860       <span class="keywordflow">if</span> (Infos)
<a name="l00861"></a>00861         <a class="code" href="classQucsApp.html#a372ee1fa475722ca832511027a34c383">view</a>-&gt;<a class="code" href="classMouseActions.html#a523750a82a7eb74f51b9a5ed5a073003">selElem</a> = (*Infos) (CompName, CompFile_cptr, <span class="keyword">true</span>);
<a name="l00862"></a>00862     }
<a name="l00863"></a>00863   }
<a name="l00864"></a>00864 }
<a name="l00865"></a>00865 
<a name="l00866"></a>00866 <span class="comment">// ####################################################################</span>
<a name="l00867"></a>00867 <span class="comment">// #####  Functions for the menu that appears when right-clicking #####</span>
<a name="l00868"></a>00868 <span class="comment">// #####  on a file in the &quot;Content&quot; ListView.                    #####</span>
<a name="l00869"></a>00869 <span class="comment">// ####################################################################</span>
<a name="l00870"></a>00870 
<a name="l00871"></a><a class="code" href="classQucsApp.html#af6ba119183cfbf355a164e5890b2b89d">00871</a> <span class="keywordtype">void</span> <a class="code" href="classQucsApp.html#af6ba119183cfbf355a164e5890b2b89d">QucsApp::initCursorMenu</a>()
<a name="l00872"></a>00872 {
<a name="l00873"></a>00873   <a class="code" href="classQucsApp.html#afa9ff1a866f5c9f33b8c57bbd76c3887">ContentMenu</a> = <span class="keyword">new</span> QMenu(<span class="keyword">this</span>);
<a name="l00874"></a>00874 <span class="preprocessor">#define APPEND_MENU(action, slot, text) \</span>
<a name="l00875"></a>00875 <span class="preprocessor">  { \</span>
<a name="l00876"></a>00876 <span class="preprocessor">  action = new QAction(tr(text), ContentMenu); \</span>
<a name="l00877"></a>00877 <span class="preprocessor">  connect(action, SIGNAL(triggered()), SLOT(slot())); \</span>
<a name="l00878"></a>00878 <span class="preprocessor">  ContentMenu-&gt;addAction(action); \</span>
<a name="l00879"></a>00879 <span class="preprocessor">  }</span>
<a name="l00880"></a>00880 <span class="preprocessor"></span>  
<a name="l00881"></a>00881   <a class="code" href="qucs_8cpp.html#a53e7fb776bdab8ec26bae31bd14e838f">APPEND_MENU</a>(<a class="code" href="classQucsApp.html#a66963325cd7f703c0256a0bd74b8342e">ActionCMenuOpen</a>, <a class="code" href="classQucsApp.html#a48e4d3b3f26f50320e3aff47ee90747d">slotCMenuOpen</a>, <span class="stringliteral">&quot;Open&quot;</span>)
<a name="l00882"></a>00882   <a class="code" href="qucs_8cpp.html#a53e7fb776bdab8ec26bae31bd14e838f">APPEND_MENU</a>(<a class="code" href="classQucsApp.html#a4a3e52b31638f74f0f490244603b9d44">ActionCMenuCopy</a>, <a class="code" href="classQucsApp.html#ab4ff814a316476d6b53e741c5ccb8768">slotCMenuCopy</a>, <span class="stringliteral">&quot;Duplicate&quot;</span>)
<a name="l00883"></a>00883   <a class="code" href="qucs_8cpp.html#a53e7fb776bdab8ec26bae31bd14e838f">APPEND_MENU</a>(<a class="code" href="classQucsApp.html#ae1a9f2b85d0f5911f364149bb1cddf14">ActionCMenuRename</a>, <a class="code" href="classQucsApp.html#a8cd61f8aef307252e3d18560ec0d295a">slotCMenuRename</a>, <span class="stringliteral">&quot;Rename&quot;</span>)
<a name="l00884"></a>00884   <a class="code" href="qucs_8cpp.html#a53e7fb776bdab8ec26bae31bd14e838f">APPEND_MENU</a>(<a class="code" href="classQucsApp.html#ab6d3a50d9df72ee06aee878903a28b43">ActionCMenuDelete</a>, <a class="code" href="classQucsApp.html#a0ef9baad36bb574044a511d9876a2a35">slotCMenuDelete</a>, <span class="stringliteral">&quot;Delete&quot;</span>)
<a name="l00885"></a>00885   <a class="code" href="qucs_8cpp.html#a53e7fb776bdab8ec26bae31bd14e838f">APPEND_MENU</a>(<a class="code" href="classQucsApp.html#acc0a0ed14963abb08dbd9ccc98c3463b">ActionCMenuInsert</a>, <a class="code" href="classQucsApp.html#a519ffc8de04bceef9cc355d456f566fc">slotCMenuInsert</a>, <span class="stringliteral">&quot;Insert&quot;</span>)
<a name="l00886"></a>00886 
<a name="l00887"></a>00887 <span class="preprocessor">#undef APPEND_MENU</span>
<a name="l00888"></a>00888 <span class="preprocessor"></span>  connect(<a class="code" href="classQucsApp.html#a4fb9ed646ac33093c199803e9625823d">Content</a>, SIGNAL(customContextMenuRequested(<span class="keyword">const</span> QPoint&amp;)), SLOT(<a class="code" href="classQucsApp.html#ad9ff3355959e25b0b68bfbe685f6d208">slotShowContentMenu</a>(<span class="keyword">const</span> QPoint&amp;)));
<a name="l00889"></a>00889 }
<a name="l00890"></a>00890 
<a name="l00891"></a>00891 <span class="comment">// ----------------------------------------------------------</span>
<a name="l00892"></a>00892 <span class="comment">// Shows the menu.</span>
<a name="l00893"></a><a class="code" href="classQucsApp.html#ad9ff3355959e25b0b68bfbe685f6d208">00893</a> <span class="keywordtype">void</span> <a class="code" href="classQucsApp.html#ad9ff3355959e25b0b68bfbe685f6d208">QucsApp::slotShowContentMenu</a>(<span class="keyword">const</span> QPoint&amp; pos) 
<a name="l00894"></a>00894 {
<a name="l00895"></a>00895   QModelIndex idx = <a class="code" href="classQucsApp.html#a4fb9ed646ac33093c199803e9625823d">Content</a>-&gt;indexAt(pos);
<a name="l00896"></a>00896   <span class="keywordflow">if</span> (idx.isValid() &amp;&amp; idx.parent().isValid()) {
<a name="l00897"></a>00897     <a class="code" href="classQucsApp.html#acc0a0ed14963abb08dbd9ccc98c3463b">ActionCMenuInsert</a>-&gt;setVisible(
<a name="l00898"></a>00898         idx.sibling(idx.row(), 1).data().toString().contains(tr(<span class="stringliteral">&quot;-port&quot;</span>))
<a name="l00899"></a>00899     );
<a name="l00900"></a>00900     <a class="code" href="classQucsApp.html#afa9ff1a866f5c9f33b8c57bbd76c3887">ContentMenu</a>-&gt;popup(<a class="code" href="classQucsApp.html#a4fb9ed646ac33093c199803e9625823d">Content</a>-&gt;mapToGlobal(pos));
<a name="l00901"></a>00901   }    
<a name="l00902"></a>00902 }
<a name="l00903"></a>00903 
<a name="l00904"></a>00904 <span class="comment">// ----------------------------------------------------------</span>
<a name="l00905"></a><a class="code" href="classQucsApp.html#a248b5a0bd26dd9e0e164d6e331c5acc6">00905</a> QString <a class="code" href="classQucsApp.html#a248b5a0bd26dd9e0e164d6e331c5acc6">QucsApp::fileType</a> (<span class="keyword">const</span> QString&amp; Ext)
<a name="l00906"></a>00906 {
<a name="l00907"></a>00907   QString Type = tr(<span class="stringliteral">&quot;unknown&quot;</span>);
<a name="l00908"></a>00908   <span class="keywordflow">if</span> (Ext == <span class="stringliteral">&quot;v&quot;</span>)
<a name="l00909"></a>00909     Type = tr(<span class="stringliteral">&quot;Verilog source&quot;</span>);
<a name="l00910"></a>00910   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Ext == <span class="stringliteral">&quot;va&quot;</span>)
<a name="l00911"></a>00911     Type = tr(<span class="stringliteral">&quot;Verilog-A source&quot;</span>);
<a name="l00912"></a>00912   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Ext == <span class="stringliteral">&quot;vhd&quot;</span> || Ext == <span class="stringliteral">&quot;vhdl&quot;</span>)
<a name="l00913"></a>00913     Type = tr(<span class="stringliteral">&quot;VHDL source&quot;</span>);
<a name="l00914"></a>00914   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Ext == <span class="stringliteral">&quot;dat&quot;</span>)
<a name="l00915"></a>00915     Type = tr(<span class="stringliteral">&quot;data file&quot;</span>);
<a name="l00916"></a>00916   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Ext == <span class="stringliteral">&quot;dpl&quot;</span>)
<a name="l00917"></a>00917     Type = tr(<span class="stringliteral">&quot;data display&quot;</span>);
<a name="l00918"></a>00918   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Ext == <span class="stringliteral">&quot;sch&quot;</span>)
<a name="l00919"></a>00919     Type = tr(<span class="stringliteral">&quot;schematic&quot;</span>);
<a name="l00920"></a>00920   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Ext == <span class="stringliteral">&quot;sym&quot;</span>)
<a name="l00921"></a>00921     Type = tr(<span class="stringliteral">&quot;symbol&quot;</span>);
<a name="l00922"></a>00922   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Ext == <span class="stringliteral">&quot;vhdl.cfg&quot;</span> || Ext == <span class="stringliteral">&quot;vhd.cfg&quot;</span>)
<a name="l00923"></a>00923     Type = tr(<span class="stringliteral">&quot;VHDL configuration&quot;</span>);
<a name="l00924"></a>00924   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Ext == <span class="stringliteral">&quot;cfg&quot;</span>)
<a name="l00925"></a>00925     Type = tr(<span class="stringliteral">&quot;configuration&quot;</span>);
<a name="l00926"></a>00926   <span class="keywordflow">return</span> Type;
<a name="l00927"></a>00927 }
<a name="l00928"></a>00928 
<a name="l00929"></a><a class="code" href="classQucsApp.html#a48e4d3b3f26f50320e3aff47ee90747d">00929</a> <span class="keywordtype">void</span> <a class="code" href="classQucsApp.html#a48e4d3b3f26f50320e3aff47ee90747d">QucsApp::slotCMenuOpen</a>()
<a name="l00930"></a>00930 {
<a name="l00931"></a>00931   <a class="code" href="classQucsApp.html#aeb426abb7ebfe9d361e8c30fd146f080">slotOpenContent</a>(<a class="code" href="classQucsApp.html#a4fb9ed646ac33093c199803e9625823d">Content</a>-&gt;currentIndex());
<a name="l00932"></a>00932 }
<a name="l00933"></a>00933 
<a name="l00934"></a><a class="code" href="classQucsApp.html#ab4ff814a316476d6b53e741c5ccb8768">00934</a> <span class="keywordtype">void</span> <a class="code" href="classQucsApp.html#ab4ff814a316476d6b53e741c5ccb8768">QucsApp::slotCMenuCopy</a>()
<a name="l00935"></a>00935 {
<a name="l00936"></a>00936   QModelIndex idx = <a class="code" href="classQucsApp.html#a4fb9ed646ac33093c199803e9625823d">Content</a>-&gt;currentIndex();
<a name="l00937"></a>00937 
<a name="l00938"></a>00938   <span class="comment">//test the item is valid</span>
<a name="l00939"></a>00939   <span class="keywordflow">if</span> (!idx.isValid() || !idx.parent().isValid()) { <span class="keywordflow">return</span>; }
<a name="l00940"></a>00940 
<a name="l00941"></a>00941   QString filename = idx.sibling(idx.row(), 0).data().toString();
<a name="l00942"></a>00942   QDir dir(<a class="code" href="main_8cpp.html#ac2e3fb7eed4aa9bd981210dc5df2e02e">QucsSettings</a>.<a class="code" href="structtQucsSettings.html#ac416ec4c4a8bfc243ea836dbf334ccae">QucsWorkDir</a>);
<a name="l00943"></a>00943   QString file(dir.filePath(filename));
<a name="l00944"></a>00944   QFileInfo fileinfo(file);
<a name="l00945"></a>00945 
<a name="l00946"></a>00946   <span class="comment">//check changed file save</span>
<a name="l00947"></a>00947   <span class="keywordtype">int</span> z = 0; <span class="comment">//search if the doc is loaded</span>
<a name="l00948"></a>00948   <a class="code" href="classQucsDoc.html">QucsDoc</a> *d = <a class="code" href="classQucsApp.html#aedb93e909d0b2cff6a8e4ccc82809057">findDoc</a>(file, &amp;z);
<a name="l00949"></a>00949   <span class="keywordflow">if</span> (d != NULL &amp;&amp; d-&gt;<a class="code" href="classQucsDoc.html#add1f5816d2da623e61ac7cff6397f7af">DocChanged</a>) {
<a name="l00950"></a>00950     <a class="code" href="classQucsApp.html#ae7612793599ca4f5106f7e9f488d4225">DocumentTab</a>-&gt;setCurrentIndex(z);
<a name="l00951"></a>00951     <span class="keywordtype">int</span> ret = QMessageBox::question(<span class="keyword">this</span>, tr(<span class="stringliteral">&quot;Copying Qucs document&quot;</span>), 
<a name="l00952"></a>00952         tr(<span class="stringliteral">&quot;The document contains unsaved changes!\n&quot;</span>) + 
<a name="l00953"></a>00953         tr(<span class="stringliteral">&quot;Do you want to save the changes before copying?&quot;</span>),
<a name="l00954"></a>00954         tr(<span class="stringliteral">&quot;&amp;Ignore&quot;</span>), tr(<span class="stringliteral">&quot;&amp;Save&quot;</span>), 0, 1);
<a name="l00955"></a>00955     <span class="keywordflow">if</span> (ret == 1) {
<a name="l00956"></a>00956       d-&gt;<a class="code" href="classQucsDoc.html#ac6adc86a294176c8c62e44de65e5f509">save</a>();
<a name="l00957"></a>00957     }
<a name="l00958"></a>00958   }
<a name="l00959"></a>00959 
<a name="l00960"></a>00960   QString suffix = fileinfo.suffix();
<a name="l00961"></a>00961   QString base = fileinfo.completeBaseName();
<a name="l00962"></a>00962   <span class="keywordflow">if</span>(base.isEmpty()) {
<a name="l00963"></a>00963     base = filename;
<a name="l00964"></a>00964   }
<a name="l00965"></a>00965 
<a name="l00966"></a>00966   <span class="keywordtype">bool</span> exists = <span class="keyword">true</span>;   <span class="comment">//generate unique name</span>
<a name="l00967"></a>00967   <span class="keywordtype">int</span> i = 0;
<a name="l00968"></a>00968   QString defaultName;
<a name="l00969"></a>00969   <span class="keywordflow">while</span> (exists) {
<a name="l00970"></a>00970     ++i;
<a name="l00971"></a>00971     defaultName = base + <span class="stringliteral">&quot;_copy&quot;</span> + QString::number(i) + <span class="stringliteral">&quot;.&quot;</span> + suffix;
<a name="l00972"></a>00972     exists = QFile::exists(dir.filePath(defaultName));
<a name="l00973"></a>00973   }
<a name="l00974"></a>00974 
<a name="l00975"></a>00975   <span class="keywordtype">bool</span> ok;
<a name="l00976"></a>00976   QString s = QInputDialog::getText(<span class="keyword">this</span>, tr(<span class="stringliteral">&quot;Copy file&quot;</span>), tr(<span class="stringliteral">&quot;Enter new name:&quot;</span>), QLineEdit::Normal, defaultName, &amp;ok);
<a name="l00977"></a>00977 
<a name="l00978"></a>00978   <span class="keywordflow">if</span>(ok &amp;&amp; !s.isEmpty()) {
<a name="l00979"></a>00979     <span class="keywordflow">if</span> (!s.endsWith(suffix)) {
<a name="l00980"></a>00980       s += QString(<span class="stringliteral">&quot;.&quot;</span>) + suffix;
<a name="l00981"></a>00981     }
<a name="l00982"></a>00982 
<a name="l00983"></a>00983     <span class="keywordflow">if</span> (QFile::exists(dir.filePath(s))) {  <span class="comment">//check New Name exists</span>
<a name="l00984"></a>00984       QMessageBox::critical(<span class="keyword">this</span>, tr(<span class="stringliteral">&quot;error&quot;</span>), tr(<span class="stringliteral">&quot;Cannot copy file to identical name: %1&quot;</span>).arg(filename));
<a name="l00985"></a>00985       <span class="keywordflow">return</span>;
<a name="l00986"></a>00986     }
<a name="l00987"></a>00987 
<a name="l00988"></a>00988     <span class="keywordflow">if</span> (!QFile::copy(dir.filePath(filename), dir.filePath(s))) {
<a name="l00989"></a>00989       QMessageBox::critical(<span class="keyword">this</span>, tr(<span class="stringliteral">&quot;Error&quot;</span>), tr(<span class="stringliteral">&quot;Cannot copy schematic: %1&quot;</span>).arg(filename));
<a name="l00990"></a>00990       <span class="keywordflow">return</span>;
<a name="l00991"></a>00991     }
<a name="l00992"></a>00992     <span class="comment">//TODO: maybe require disable edit here</span>
<a name="l00993"></a>00993 
<a name="l00994"></a>00994     <span class="comment">// refresh the schematic file path</span>
<a name="l00995"></a>00995     this-&gt;<a class="code" href="classQucsApp.html#ae223813596b54c221cd292adb3b81c0f">updateSchNameHash</a>();
<a name="l00996"></a>00996     this-&gt;<a class="code" href="classQucsApp.html#ad5e4abc792d281a23c167bedbca47a0f">updateSpiceNameHash</a>();
<a name="l00997"></a>00997 
<a name="l00998"></a>00998     <a class="code" href="classQucsApp.html#abc9b64e52b905e3a287dc618d8507d2c">slotUpdateTreeview</a>();
<a name="l00999"></a>00999   }
<a name="l01000"></a>01000 }
<a name="l01001"></a>01001 
<a name="l01002"></a><a class="code" href="classQucsApp.html#a8cd61f8aef307252e3d18560ec0d295a">01002</a> <span class="keywordtype">void</span> <a class="code" href="classQucsApp.html#a8cd61f8aef307252e3d18560ec0d295a">QucsApp::slotCMenuRename</a>()
<a name="l01003"></a>01003 {
<a name="l01004"></a>01004   QModelIndex idx = <a class="code" href="classQucsApp.html#a4fb9ed646ac33093c199803e9625823d">Content</a>-&gt;currentIndex();
<a name="l01005"></a>01005 
<a name="l01006"></a>01006   <span class="comment">//test the item is valid</span>
<a name="l01007"></a>01007   <span class="keywordflow">if</span> (!idx.isValid() || !idx.parent().isValid()) { <span class="keywordflow">return</span>; }
<a name="l01008"></a>01008 
<a name="l01009"></a>01009   QString filename = idx.sibling(idx.row(), 0).data().toString();
<a name="l01010"></a>01010   QString file(<a class="code" href="main_8cpp.html#ac2e3fb7eed4aa9bd981210dc5df2e02e">QucsSettings</a>.<a class="code" href="structtQucsSettings.html#ac416ec4c4a8bfc243ea836dbf334ccae">QucsWorkDir</a>.filePath(filename));
<a name="l01011"></a>01011   QFileInfo fileinfo(file);
<a name="l01012"></a>01012 
<a name="l01013"></a>01013   <span class="keywordflow">if</span> (<a class="code" href="classQucsApp.html#aedb93e909d0b2cff6a8e4ccc82809057">findDoc</a>(file)) {
<a name="l01014"></a>01014     QMessageBox::critical(<span class="keyword">this</span>, tr(<span class="stringliteral">&quot;Error&quot;</span>),
<a name="l01015"></a>01015         tr(<span class="stringliteral">&quot;Cannot rename an open file!&quot;</span>));
<a name="l01016"></a>01016     <span class="keywordflow">return</span>;
<a name="l01017"></a>01017   }
<a name="l01018"></a>01018 
<a name="l01019"></a>01019   QString suffix = fileinfo.suffix();
<a name="l01020"></a>01020   QString base = fileinfo.completeBaseName();
<a name="l01021"></a>01021   <span class="keywordflow">if</span>(base.isEmpty()) {
<a name="l01022"></a>01022     base = filename;
<a name="l01023"></a>01023   }
<a name="l01024"></a>01024 
<a name="l01025"></a>01025   <span class="keywordtype">bool</span> ok;
<a name="l01026"></a>01026   QString s = QInputDialog::getText(<span class="keyword">this</span>, tr(<span class="stringliteral">&quot;Rename file&quot;</span>), tr(<span class="stringliteral">&quot;Enter new filename:&quot;</span>), QLineEdit::Normal, base, &amp;ok);
<a name="l01027"></a>01027 
<a name="l01028"></a>01028   <span class="keywordflow">if</span>(ok &amp;&amp; !s.isEmpty()) { 
<a name="l01029"></a>01029     <span class="keywordflow">if</span> (!s.endsWith(suffix)) {
<a name="l01030"></a>01030       s += QString(<span class="stringliteral">&quot;.&quot;</span>) + suffix;
<a name="l01031"></a>01031     }
<a name="l01032"></a>01032     QDir dir(<a class="code" href="main_8cpp.html#ac2e3fb7eed4aa9bd981210dc5df2e02e">QucsSettings</a>.<a class="code" href="structtQucsSettings.html#ac416ec4c4a8bfc243ea836dbf334ccae">QucsWorkDir</a>.path());
<a name="l01033"></a>01033     <span class="keywordflow">if</span>(!dir.rename(filename, s)) {
<a name="l01034"></a>01034       QMessageBox::critical(<span class="keyword">this</span>, tr(<span class="stringliteral">&quot;Error&quot;</span>), tr(<span class="stringliteral">&quot;Cannot rename file: %1&quot;</span>).arg(filename));
<a name="l01035"></a>01035       <span class="keywordflow">return</span>;
<a name="l01036"></a>01036     }
<a name="l01037"></a>01037 
<a name="l01038"></a>01038     <a class="code" href="classQucsApp.html#abc9b64e52b905e3a287dc618d8507d2c">slotUpdateTreeview</a>();
<a name="l01039"></a>01039   }
<a name="l01040"></a>01040 }
<a name="l01041"></a>01041 
<a name="l01042"></a><a class="code" href="classQucsApp.html#a0ef9baad36bb574044a511d9876a2a35">01042</a> <span class="keywordtype">void</span> <a class="code" href="classQucsApp.html#a0ef9baad36bb574044a511d9876a2a35">QucsApp::slotCMenuDelete</a>()
<a name="l01043"></a>01043 {
<a name="l01044"></a>01044   QModelIndex idx = <a class="code" href="classQucsApp.html#a4fb9ed646ac33093c199803e9625823d">Content</a>-&gt;currentIndex();
<a name="l01045"></a>01045 
<a name="l01046"></a>01046   <span class="comment">//test the item is valid</span>
<a name="l01047"></a>01047   <span class="keywordflow">if</span> (!idx.isValid() || !idx.parent().isValid()) { <span class="keywordflow">return</span>; }
<a name="l01048"></a>01048 
<a name="l01049"></a>01049   QString filename = idx.sibling(idx.row(), 0).data().toString();
<a name="l01050"></a>01050   QString file(<a class="code" href="main_8cpp.html#ac2e3fb7eed4aa9bd981210dc5df2e02e">QucsSettings</a>.<a class="code" href="structtQucsSettings.html#ac416ec4c4a8bfc243ea836dbf334ccae">QucsWorkDir</a>.filePath(filename));
<a name="l01051"></a>01051 
<a name="l01052"></a>01052   <span class="keywordflow">if</span> (<a class="code" href="classQucsApp.html#aedb93e909d0b2cff6a8e4ccc82809057">findDoc</a> (file)) {
<a name="l01053"></a>01053     QMessageBox::critical(<span class="keyword">this</span>, tr(<span class="stringliteral">&quot;Error&quot;</span>), tr(<span class="stringliteral">&quot;Cannot delete an open file!&quot;</span>));
<a name="l01054"></a>01054     <span class="keywordflow">return</span>;
<a name="l01055"></a>01055   }
<a name="l01056"></a>01056 
<a name="l01057"></a>01057   <span class="keywordtype">int</span> No;
<a name="l01058"></a>01058   No = QMessageBox::warning(<span class="keyword">this</span>, tr(<span class="stringliteral">&quot;Warning&quot;</span>),
<a name="l01059"></a>01059       tr(<span class="stringliteral">&quot;This will delete the file permanently! Continue ?&quot;</span>),
<a name="l01060"></a>01060       tr(<span class="stringliteral">&quot;No&quot;</span>), tr(<span class="stringliteral">&quot;Yes&quot;</span>));
<a name="l01061"></a>01061   <span class="keywordflow">if</span>(No == 1) {
<a name="l01062"></a>01062     <span class="keywordflow">if</span>(!QFile::remove(file)) {
<a name="l01063"></a>01063       QMessageBox::critical(<span class="keyword">this</span>, tr(<span class="stringliteral">&quot;Error&quot;</span>),
<a name="l01064"></a>01064       tr(<span class="stringliteral">&quot;Cannot delete file: %1&quot;</span>).arg(filename));
<a name="l01065"></a>01065       <span class="keywordflow">return</span>;
<a name="l01066"></a>01066     }
<a name="l01067"></a>01067   }
<a name="l01068"></a>01068 
<a name="l01069"></a>01069   <a class="code" href="classQucsApp.html#abc9b64e52b905e3a287dc618d8507d2c">slotUpdateTreeview</a>();
<a name="l01070"></a>01070 }
<a name="l01071"></a>01071 
<a name="l01072"></a><a class="code" href="classQucsApp.html#a519ffc8de04bceef9cc355d456f566fc">01072</a> <span class="keywordtype">void</span> <a class="code" href="classQucsApp.html#a519ffc8de04bceef9cc355d456f566fc">QucsApp::slotCMenuInsert</a>()
<a name="l01073"></a>01073 {
<a name="l01074"></a>01074   <a class="code" href="classQucsApp.html#ab57330cad63942e3900e7456ae2cb7aa">slotSelectSubcircuit</a>(<a class="code" href="classQucsApp.html#a4fb9ed646ac33093c199803e9625823d">Content</a>-&gt;currentIndex());
<a name="l01075"></a>01075 }
<a name="l01076"></a>01076 
<a name="l01077"></a>01077 <span class="comment">// ################################################################</span>
<a name="l01078"></a>01078 <span class="comment">// #####    Functions that handle the project operations.     #####</span>
<a name="l01079"></a>01079 <span class="comment">// ################################################################</span>
<a name="l01080"></a>01080 
<a name="l01081"></a>01081 <span class="comment">// Checks for qucs directory and reads all existing Qucs projects.</span>
<a name="l01082"></a><a class="code" href="classQucsApp.html#a580aa50035a82c66f13fe7befce9c5e2">01082</a> <span class="keywordtype">void</span> <a class="code" href="classQucsApp.html#a580aa50035a82c66f13fe7befce9c5e2">QucsApp::readProjects</a>()
<a name="l01083"></a>01083 {
<a name="l01084"></a>01084   QString path = <a class="code" href="main_8cpp.html#ac2e3fb7eed4aa9bd981210dc5df2e02e">QucsSettings</a>.<a class="code" href="structtQucsSettings.html#a80d828678da4014a033ddf5ec3f831c7">QucsHomeDir</a>.absolutePath();
<a name="l01085"></a>01085   QDir ProjDir(path);
<a name="l01086"></a>01086 
<a name="l01087"></a>01087   <span class="comment">// create home dir if not exist</span>
<a name="l01088"></a>01088   <span class="keywordflow">if</span>(!ProjDir.exists()) {
<a name="l01089"></a>01089     <span class="keywordflow">if</span>(!ProjDir.mkdir(path)) {
<a name="l01090"></a>01090       QMessageBox::warning(<span class="keyword">this</span>, tr(<span class="stringliteral">&quot;Warning&quot;</span>),
<a name="l01091"></a>01091           tr(<span class="stringliteral">&quot;Cannot create work directory !&quot;</span>));
<a name="l01092"></a>01092       <span class="keywordflow">return</span>;
<a name="l01093"></a>01093     }
<a name="l01094"></a>01094   }
<a name="l01095"></a>01095   <a class="code" href="classQucsApp.html#adec5dadec32a071f4a9ba67b841f2822">m_homeDirModel</a>-&gt;setRootPath(path);
<a name="l01096"></a>01096   <a class="code" href="classQucsApp.html#a31fbf006da2167fc516bbc5ce8e0d28c">Projects</a>-&gt;setModel(<a class="code" href="classQucsApp.html#adec5dadec32a071f4a9ba67b841f2822">m_homeDirModel</a>);
<a name="l01097"></a>01097   <a class="code" href="classQucsApp.html#a31fbf006da2167fc516bbc5ce8e0d28c">Projects</a>-&gt;setRootIndex(<a class="code" href="classQucsApp.html#adec5dadec32a071f4a9ba67b841f2822">m_homeDirModel</a>-&gt;index(path));
<a name="l01098"></a>01098 }
<a name="l01099"></a>01099 
<a name="l01100"></a>01100 <span class="comment">// ----------------------------------------------------------</span>
<a name="l01101"></a>01101 <span class="comment">// Is called, when &quot;Create New Project&quot; button is pressed.</span>
<a name="l01102"></a><a class="code" href="classQucsApp.html#a24f658f740d8eb179e0a68e4055aeeb4">01102</a> <span class="keywordtype">void</span> <a class="code" href="classQucsApp.html#a24f658f740d8eb179e0a68e4055aeeb4">QucsApp::slotButtonProjNew</a>()
<a name="l01103"></a>01103 {
<a name="l01104"></a>01104   <a class="code" href="classQucsApp.html#acf15a168d7497bc25103174b31019db7">slotHideEdit</a>(); <span class="comment">// disable text edit of component property</span>
<a name="l01105"></a>01105 
<a name="l01106"></a>01106   <a class="code" href="classNewProjDialog.html">NewProjDialog</a> *d = <span class="keyword">new</span> <a class="code" href="classNewProjDialog.html">NewProjDialog</a>(<span class="keyword">this</span>);
<a name="l01107"></a>01107   <span class="keywordflow">if</span>(d-&gt;exec() != QDialog::Accepted) <span class="keywordflow">return</span>;
<a name="l01108"></a>01108 
<a name="l01109"></a>01109   QDir projDir(<a class="code" href="main_8cpp.html#ac2e3fb7eed4aa9bd981210dc5df2e02e">QucsSettings</a>.<a class="code" href="structtQucsSettings.html#a80d828678da4014a033ddf5ec3f831c7">QucsHomeDir</a>.path());
<a name="l01110"></a>01110   QString name = d-&gt;<a class="code" href="classNewProjDialog.html#a2ce2e9275ceb51a0b1d7be763c236461">ProjName</a>-&gt;text();
<a name="l01111"></a>01111   <span class="keywordtype">bool</span> open = d-&gt;<a class="code" href="classNewProjDialog.html#a8097afdbcded6d76b5f097464edfaf8e">OpenProj</a>-&gt;isChecked();
<a name="l01112"></a>01112 
<a name="l01113"></a>01113   <span class="keywordflow">if</span> (!name.endsWith(<span class="stringliteral">&quot;_prj&quot;</span>)) {
<a name="l01114"></a>01114     name += <span class="stringliteral">&quot;_prj&quot;</span>;
<a name="l01115"></a>01115   }
<a name="l01116"></a>01116 
<a name="l01117"></a>01117   <span class="keywordflow">if</span>(!projDir.mkdir(name)) {
<a name="l01118"></a>01118     QMessageBox::information(<span class="keyword">this</span>, tr(<span class="stringliteral">&quot;Info&quot;</span>),
<a name="l01119"></a>01119         tr(<span class="stringliteral">&quot;Cannot create project directory !&quot;</span>));
<a name="l01120"></a>01120   }
<a name="l01121"></a>01121   <span class="keywordflow">if</span>(open) {
<a name="l01122"></a>01122     <a class="code" href="classQucsApp.html#a1029e5d96d9c8b59b3e8efff987c276c">openProject</a>(<a class="code" href="main_8cpp.html#ac2e3fb7eed4aa9bd981210dc5df2e02e">QucsSettings</a>.<a class="code" href="structtQucsSettings.html#a80d828678da4014a033ddf5ec3f831c7">QucsHomeDir</a>.filePath(name));
<a name="l01123"></a>01123   }
<a name="l01124"></a>01124 }
<a name="l01125"></a>01125 
<a name="l01126"></a>01126 <span class="comment">// ----------------------------------------------------------</span>
<a name="l01127"></a>01127 <span class="comment">// Opens an existing project.</span>
<a name="l01128"></a><a class="code" href="classQucsApp.html#a1029e5d96d9c8b59b3e8efff987c276c">01128</a> <span class="keywordtype">void</span> <a class="code" href="classQucsApp.html#a1029e5d96d9c8b59b3e8efff987c276c">QucsApp::openProject</a>(<span class="keyword">const</span> QString&amp; Path)
<a name="l01129"></a>01129 {
<a name="l01130"></a>01130   <a class="code" href="classQucsApp.html#acf15a168d7497bc25103174b31019db7">slotHideEdit</a>(); <span class="comment">// disable text edit of component property</span>
<a name="l01131"></a>01131 
<a name="l01132"></a>01132   QString Name = Path;
<a name="l01133"></a>01133   <span class="keywordflow">if</span> (Name.endsWith(QDir::separator())) {
<a name="l01134"></a>01134     Name = Name.left(Name.length()-1);  <span class="comment">// cut off trailing &#39;/&#39;</span>
<a name="l01135"></a>01135   }
<a name="l01136"></a>01136   <span class="keywordtype">int</span> i = Name.lastIndexOf(QDir::separator());
<a name="l01137"></a>01137   <span class="keywordflow">if</span>(i &gt; 0) Name = Name.mid(i+1);   <span class="comment">// cut out the last subdirectory</span>
<a name="l01138"></a>01138   Name.remove(<span class="stringliteral">&quot;_prj&quot;</span>);
<a name="l01139"></a>01139 
<a name="l01140"></a>01140   <span class="keywordflow">if</span>(!<a class="code" href="classQucsApp.html#ad879e6b32e2ea281a177c409a8c01b5a">closeAllFiles</a>()) <span class="keywordflow">return</span>;   <span class="comment">// close files and ask for saving them</span>
<a name="l01141"></a>01141   <a class="code" href="classSchematic.html">Schematic</a> *d = <span class="keyword">new</span> <a class="code" href="classSchematic.html">Schematic</a>(<span class="keyword">this</span>, <span class="stringliteral">&quot;&quot;</span>);
<a name="l01142"></a>01142   i = <a class="code" href="classQucsApp.html#ae7612793599ca4f5106f7e9f488d4225">DocumentTab</a>-&gt;addTab(d, QPixmap(<a class="code" href="qucs_8cpp.html#a098a06ee0c473d9178da66df32798581">empty_xpm</a>), QObject::tr(<span class="stringliteral">&quot;untitled&quot;</span>));
<a name="l01143"></a>01143   <a class="code" href="classQucsApp.html#ae7612793599ca4f5106f7e9f488d4225">DocumentTab</a>-&gt;setCurrentIndex(i);
<a name="l01144"></a>01144 
<a name="l01145"></a>01145   <a class="code" href="classQucsApp.html#a372ee1fa475722ca832511027a34c383">view</a>-&gt;<a class="code" href="classMouseActions.html#ad43ee60feb7239ee9692300605dc9aed">drawn</a> = <span class="keyword">false</span>;
<a name="l01146"></a>01146 
<a name="l01147"></a>01147   <a class="code" href="classQucsApp.html#a52975f3e54d3100585a2fd3db0f11f3c">slotResetWarnings</a>();
<a name="l01148"></a>01148 
<a name="l01149"></a>01149   QDir ProjDir(QDir::cleanPath(Path));
<a name="l01150"></a>01150   <span class="keywordflow">if</span>(!ProjDir.exists() || !ProjDir.isReadable()) { <span class="comment">// check project directory</span>
<a name="l01151"></a>01151     QMessageBox::critical(<span class="keyword">this</span>, tr(<span class="stringliteral">&quot;Error&quot;</span>),
<a name="l01152"></a>01152                           tr(<span class="stringliteral">&quot;Cannot access project directory: &quot;</span>)+Path);
<a name="l01153"></a>01153     <span class="keywordflow">return</span>;
<a name="l01154"></a>01154   }
<a name="l01155"></a>01155   <a class="code" href="main_8cpp.html#ac2e3fb7eed4aa9bd981210dc5df2e02e">QucsSettings</a>.<a class="code" href="structtQucsSettings.html#ac416ec4c4a8bfc243ea836dbf334ccae">QucsWorkDir</a>.setPath(ProjDir.path());
<a name="l01156"></a>01156   <a class="code" href="classQucsApp.html#a2442034cd3aa8a3fef9f1abf70633a0b">octave</a>-&gt;<a class="code" href="classOctaveWindow.html#a2696584a025ce5e71f32e88006d9da1f">adjustDirectory</a>();
<a name="l01157"></a>01157 
<a name="l01158"></a>01158   <a class="code" href="classQucsApp.html#a4fb9ed646ac33093c199803e9625823d">Content</a>-&gt;setProjPath(<a class="code" href="main_8cpp.html#ac2e3fb7eed4aa9bd981210dc5df2e02e">QucsSettings</a>.<a class="code" href="structtQucsSettings.html#ac416ec4c4a8bfc243ea836dbf334ccae">QucsWorkDir</a>.absolutePath());
<a name="l01159"></a>01159 
<a name="l01160"></a>01160   <a class="code" href="classQucsApp.html#a7bb309c9a24921c091c005a7fee29644">TabView</a>-&gt;setCurrentIndex(1);   <span class="comment">// switch to &quot;Content&quot;-Tab</span>
<a name="l01161"></a>01161   <a class="code" href="classQucsApp.html#a346d3b157d16b8b09ea079dd2098cd47">ProjName</a> = Name;   <span class="comment">// remember the name of project</span>
<a name="l01162"></a>01162 
<a name="l01163"></a>01163   <span class="comment">// show name in title of main window</span>
<a name="l01164"></a>01164   setWindowTitle(<span class="stringliteral">&quot;Qucs &quot;</span> PACKAGE_VERSION + tr(<span class="stringliteral">&quot; - Project: &quot;</span>)+Name);
<a name="l01165"></a>01165 }
<a name="l01166"></a>01166 
<a name="l01167"></a>01167 <span class="comment">// ----------------------------------------------------------</span>
<a name="l01168"></a>01168 <span class="comment">// Is called when the open project menu is called.</span>
<a name="l01169"></a><a class="code" href="classQucsApp.html#a12cc9d5b52cbaccbe9c77faefc8f59ea">01169</a> <span class="keywordtype">void</span> <a class="code" href="classQucsApp.html#a12cc9d5b52cbaccbe9c77faefc8f59ea">QucsApp::slotMenuProjOpen</a>()
<a name="l01170"></a>01170 {
<a name="l01171"></a>01171   QString d = QFileDialog::getExistingDirectory(
<a name="l01172"></a>01172       <span class="keyword">this</span>, tr(<span class="stringliteral">&quot;Choose Project Directory for Opening&quot;</span>),
<a name="l01173"></a>01173       <a class="code" href="main_8cpp.html#ac2e3fb7eed4aa9bd981210dc5df2e02e">QucsSettings</a>.<a class="code" href="structtQucsSettings.html#a80d828678da4014a033ddf5ec3f831c7">QucsHomeDir</a>.path(),
<a name="l01174"></a>01174       QFileDialog::ShowDirsOnly | QFileDialog::DontResolveSymlinks);
<a name="l01175"></a>01175   <span class="keywordflow">if</span>(d.isEmpty()) <span class="keywordflow">return</span>;
<a name="l01176"></a>01176 
<a name="l01177"></a>01177   <a class="code" href="classQucsApp.html#a1029e5d96d9c8b59b3e8efff987c276c">openProject</a>(d);
<a name="l01178"></a>01178 }
<a name="l01179"></a>01179 
<a name="l01180"></a>01180 <span class="comment">// ----------------------------------------------------------</span>
<a name="l01181"></a>01181 <span class="comment">// Is called, when &quot;Open Project&quot; button is pressed.</span>
<a name="l01182"></a><a class="code" href="classQucsApp.html#aa4495d06c23658bc3389aa4affb9a29e">01182</a> <span class="keywordtype">void</span> <a class="code" href="classQucsApp.html#aa4495d06c23658bc3389aa4affb9a29e">QucsApp::slotButtonProjOpen</a>()
<a name="l01183"></a>01183 {
<a name="l01184"></a>01184   <a class="code" href="classQucsApp.html#acf15a168d7497bc25103174b31019db7">slotHideEdit</a>();
<a name="l01185"></a>01185 
<a name="l01186"></a>01186   QModelIndex idx = <a class="code" href="classQucsApp.html#a31fbf006da2167fc516bbc5ce8e0d28c">Projects</a>-&gt;currentIndex();
<a name="l01187"></a>01187   <span class="keywordflow">if</span> (!idx.isValid()) {
<a name="l01188"></a>01188     QMessageBox::information(<span class="keyword">this</span>, tr(<span class="stringliteral">&quot;Info&quot;</span>),
<a name="l01189"></a>01189         tr(<span class="stringliteral">&quot;No project is selected !&quot;</span>));
<a name="l01190"></a>01190   } <span class="keywordflow">else</span> {
<a name="l01191"></a>01191     <a class="code" href="classQucsApp.html#a1ad75ae02b66f2195be0f7dd34158096">slotListProjOpen</a>(idx);
<a name="l01192"></a>01192   }
<a name="l01193"></a>01193 }
<a name="l01194"></a>01194 
<a name="l01195"></a>01195 <span class="comment">// ----------------------------------------------------------</span>
<a name="l01196"></a>01196 <span class="comment">// Is called when project is double-clicked to open it.</span>
<a name="l01197"></a><a class="code" href="classQucsApp.html#a1ad75ae02b66f2195be0f7dd34158096">01197</a> <span class="keywordtype">void</span> <a class="code" href="classQucsApp.html#a1ad75ae02b66f2195be0f7dd34158096">QucsApp::slotListProjOpen</a>(<span class="keyword">const</span> QModelIndex &amp;idx)
<a name="l01198"></a>01198 {
<a name="l01199"></a>01199   <a class="code" href="classQucsApp.html#a1029e5d96d9c8b59b3e8efff987c276c">openProject</a>(<a class="code" href="main_8cpp.html#ac2e3fb7eed4aa9bd981210dc5df2e02e">QucsSettings</a>.<a class="code" href="structtQucsSettings.html#a80d828678da4014a033ddf5ec3f831c7">QucsHomeDir</a>.filePath(
<a name="l01200"></a>01200       idx.data().toString()));
<a name="l01201"></a>01201 }
<a name="l01202"></a>01202 
<a name="l01203"></a>01203 <span class="comment">// ----------------------------------------------------------</span>
<a name="l01204"></a>01204 <span class="comment">// Is called when the close project menu is called.</span>
<a name="l01205"></a><a class="code" href="classQucsApp.html#a17e94f1c2027b60df354cd483f6e1e38">01205</a> <span class="keywordtype">void</span> <a class="code" href="classQucsApp.html#a17e94f1c2027b60df354cd483f6e1e38">QucsApp::slotMenuProjClose</a>()
<a name="l01206"></a>01206 {
<a name="l01207"></a>01207   <a class="code" href="classQucsApp.html#acf15a168d7497bc25103174b31019db7">slotHideEdit</a>(); <span class="comment">// disable text edit of component property</span>
<a name="l01208"></a>01208 
<a name="l01209"></a>01209   <span class="keywordflow">if</span>(!<a class="code" href="classQucsApp.html#ad879e6b32e2ea281a177c409a8c01b5a">closeAllFiles</a>()) <span class="keywordflow">return</span>;   <span class="comment">// close files and ask for saving them</span>
<a name="l01210"></a>01210   <a class="code" href="classSchematic.html">Schematic</a> *d = <span class="keyword">new</span> <a class="code" href="classSchematic.html">Schematic</a>(<span class="keyword">this</span>, <span class="stringliteral">&quot;&quot;</span>);
<a name="l01211"></a>01211   <span class="keywordtype">int</span> i = <a class="code" href="classQucsApp.html#ae7612793599ca4f5106f7e9f488d4225">DocumentTab</a>-&gt;addTab(d, QPixmap(<a class="code" href="qucs_8cpp.html#a098a06ee0c473d9178da66df32798581">empty_xpm</a>), QObject::tr(<span class="stringliteral">&quot;untitled&quot;</span>));
<a name="l01212"></a>01212   <a class="code" href="classQucsApp.html#ae7612793599ca4f5106f7e9f488d4225">DocumentTab</a>-&gt;setCurrentIndex(i);
<a name="l01213"></a>01213 
<a name="l01214"></a>01214   <a class="code" href="classQucsApp.html#a372ee1fa475722ca832511027a34c383">view</a>-&gt;<a class="code" href="classMouseActions.html#ad43ee60feb7239ee9692300605dc9aed">drawn</a> = <span class="keyword">false</span>;
<a name="l01215"></a>01215 
<a name="l01216"></a>01216   <a class="code" href="classQucsApp.html#a52975f3e54d3100585a2fd3db0f11f3c">slotResetWarnings</a>();
<a name="l01217"></a>01217   setWindowTitle(<span class="stringliteral">&quot;Qucs &quot;</span> PACKAGE_VERSION + tr(<span class="stringliteral">&quot; - Project: &quot;</span>));
<a name="l01218"></a>01218   <a class="code" href="main_8cpp.html#ac2e3fb7eed4aa9bd981210dc5df2e02e">QucsSettings</a>.<a class="code" href="structtQucsSettings.html#ac416ec4c4a8bfc243ea836dbf334ccae">QucsWorkDir</a>.setPath(QDir::homePath()+QDir::convertSeparators (<span class="stringliteral">&quot;/.qucs&quot;</span>));
<a name="l01219"></a>01219   <a class="code" href="classQucsApp.html#a2442034cd3aa8a3fef9f1abf70633a0b">octave</a>-&gt;<a class="code" href="classOctaveWindow.html#a2696584a025ce5e71f32e88006d9da1f">adjustDirectory</a>();
<a name="l01220"></a>01220 
<a name="l01221"></a>01221   <a class="code" href="classQucsApp.html#a4fb9ed646ac33093c199803e9625823d">Content</a>-&gt;setProjPath(<span class="stringliteral">&quot;&quot;</span>);
<a name="l01222"></a>01222 
<a name="l01223"></a>01223   <a class="code" href="classQucsApp.html#a7bb309c9a24921c091c005a7fee29644">TabView</a>-&gt;setCurrentIndex(0);   <span class="comment">// switch to &quot;Projects&quot;-Tab</span>
<a name="l01224"></a>01224   <a class="code" href="classQucsApp.html#a346d3b157d16b8b09ea079dd2098cd47">ProjName</a> = <span class="stringliteral">&quot;&quot;</span>;
<a name="l01225"></a>01225 }
<a name="l01226"></a>01226 
<a name="l01227"></a>01227 <span class="comment">// remove a directory recursively</span>
<a name="l01228"></a><a class="code" href="classQucsApp.html#a2668487eee3b726374892edb23cf880e">01228</a> <span class="keywordtype">bool</span> <a class="code" href="classQucsApp.html#a2668487eee3b726374892edb23cf880e">QucsApp::recurRemove</a>(<span class="keyword">const</span> QString &amp;Path)
<a name="l01229"></a>01229 {
<a name="l01230"></a>01230   <span class="keywordtype">bool</span> result = <span class="keyword">true</span>;
<a name="l01231"></a>01231   QDir projDir = QDir(Path);
<a name="l01232"></a>01232 
<a name="l01233"></a>01233   <span class="keywordflow">if</span> (projDir.exists(Path)) {
<a name="l01234"></a>01234     Q_FOREACH(QFileInfo info, 
<a name="l01235"></a>01235         projDir.entryInfoList(
<a name="l01236"></a>01236             QDir::AllDirs | QDir::NoDotAndDotDot | QDir::Hidden | QDir::AllEntries, QDir::DirsFirst)) {
<a name="l01237"></a>01237       <span class="keywordflow">if</span> (info.isDir()) {
<a name="l01238"></a>01238         result = <a class="code" href="classQucsApp.html#a2668487eee3b726374892edb23cf880e">recurRemove</a>(info.absoluteFilePath());
<a name="l01239"></a>01239         <span class="keywordflow">if</span> (!result) {
<a name="l01240"></a>01240           QMessageBox::information(<span class="keyword">this</span>, tr(<span class="stringliteral">&quot;Info&quot;</span>),
<a name="l01241"></a>01241               tr(<span class="stringliteral">&quot;Cannot remove directory: %1&quot;</span>).arg(Path));
<a name="l01242"></a>01242           <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01243"></a>01243         }
<a name="l01244"></a>01244       }
<a name="l01245"></a>01245       <span class="keywordflow">else</span> <span class="keywordflow">if</span>(info.isFile()) {
<a name="l01246"></a>01246         result = QFile::remove(info.absoluteFilePath());
<a name="l01247"></a>01247         <span class="keywordflow">if</span> (!result) {
<a name="l01248"></a>01248           QMessageBox::information(<span class="keyword">this</span>, tr(<span class="stringliteral">&quot;Info&quot;</span>),
<a name="l01249"></a>01249               tr(<span class="stringliteral">&quot;Cannot delete file: %1&quot;</span>).arg(info.fileName()));
<a name="l01250"></a>01250           <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01251"></a>01251         }
<a name="l01252"></a>01252       }
<a name="l01253"></a>01253     }
<a name="l01254"></a>01254     result = projDir.rmdir(Path);
<a name="l01255"></a>01255   }
<a name="l01256"></a>01256   <span class="keywordflow">return</span> result;
<a name="l01257"></a>01257 }
<a name="l01258"></a>01258 
<a name="l01259"></a>01259 <span class="comment">// ----------------------------------------------------------</span>
<a name="l01260"></a><a class="code" href="classQucsApp.html#a9157e4c028a8711d888e1fc3c9ad9602">01260</a> <span class="keywordtype">bool</span> <a class="code" href="classQucsApp.html#a9157e4c028a8711d888e1fc3c9ad9602">QucsApp::deleteProject</a>(<span class="keyword">const</span> QString&amp; Path)
<a name="l01261"></a>01261 {
<a name="l01262"></a>01262   <a class="code" href="classQucsApp.html#acf15a168d7497bc25103174b31019db7">slotHideEdit</a>();
<a name="l01263"></a>01263 
<a name="l01264"></a>01264   QString Name = Path;
<a name="l01265"></a>01265 
<a name="l01266"></a>01266   <span class="keywordflow">if</span>(Name.isEmpty()) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01267"></a>01267 
<a name="l01268"></a>01268   <span class="keywordflow">if</span> (Name.endsWith(QDir::separator())) {
<a name="l01269"></a>01269     Name = Name.left(Name.length()-1);  <span class="comment">// cut off trailing &#39;/&#39;</span>
<a name="l01270"></a>01270   }
<a name="l01271"></a>01271   <span class="keywordtype">int</span> i = Name.lastIndexOf(QDir::separator());
<a name="l01272"></a>01272   <span class="keywordflow">if</span>(i &gt; 0) Name = Name.mid(i+1);  <span class="comment">// cut out the last subdirectory</span>
<a name="l01273"></a>01273   Name.chop(4); <span class="comment">// remove &quot;_prj&quot; from name</span>
<a name="l01274"></a>01274 
<a name="l01275"></a>01275   <span class="keywordflow">if</span>(Name == <a class="code" href="classQucsApp.html#a346d3b157d16b8b09ea079dd2098cd47">ProjName</a>) {
<a name="l01276"></a>01276     QMessageBox::information(<span class="keyword">this</span>, tr(<span class="stringliteral">&quot;Info&quot;</span>),
<a name="l01277"></a>01277         tr(<span class="stringliteral">&quot;Cannot delete an open project !&quot;</span>));
<a name="l01278"></a>01278     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01279"></a>01279   }
<a name="l01280"></a>01280 
<a name="l01281"></a>01281   <span class="comment">// first ask, if really delete project ?</span>
<a name="l01282"></a>01282   <span class="keywordflow">if</span>(QMessageBox::warning(<span class="keyword">this</span>, tr(<span class="stringliteral">&quot;Warning&quot;</span>),
<a name="l01283"></a>01283       tr(<span class="stringliteral">&quot;This will destroy all the project files permanently ! Continue ?&quot;</span>),
<a name="l01284"></a>01284       tr(<span class="stringliteral">&quot;&amp;Yes&quot;</span>), tr(<span class="stringliteral">&quot;&amp;No&quot;</span>), 0,1,1))  <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01285"></a>01285 
<a name="l01286"></a>01286   <span class="keywordflow">if</span> (!<a class="code" href="classQucsApp.html#a2668487eee3b726374892edb23cf880e">recurRemove</a>(Path)) {
<a name="l01287"></a>01287     QMessageBox::information(<span class="keyword">this</span>, tr(<span class="stringliteral">&quot;Info&quot;</span>),
<a name="l01288"></a>01288         tr(<span class="stringliteral">&quot;Cannot remove project directory!&quot;</span>));
<a name="l01289"></a>01289     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01290"></a>01290   }
<a name="l01291"></a>01291   <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01292"></a>01292 }
<a name="l01293"></a>01293 
<a name="l01294"></a>01294 <span class="comment">// ----------------------------------------------------------</span>
<a name="l01295"></a>01295 <span class="comment">// Is called, when &quot;Delete Project&quot; menu is activated.</span>
<a name="l01296"></a><a class="code" href="classQucsApp.html#a69b02d3b95871238d012a97481813ef4">01296</a> <span class="keywordtype">void</span> <a class="code" href="classQucsApp.html#a69b02d3b95871238d012a97481813ef4">QucsApp::slotMenuProjDel</a>()
<a name="l01297"></a>01297 {
<a name="l01298"></a>01298   QString d = QFileDialog::getExistingDirectory(
<a name="l01299"></a>01299       <span class="keyword">this</span>, tr(<span class="stringliteral">&quot;Choose Project Directory for Deleting&quot;</span>),
<a name="l01300"></a>01300       <a class="code" href="main_8cpp.html#ac2e3fb7eed4aa9bd981210dc5df2e02e">QucsSettings</a>.<a class="code" href="structtQucsSettings.html#a80d828678da4014a033ddf5ec3f831c7">QucsHomeDir</a>.path(),
<a name="l01301"></a>01301       QFileDialog::ShowDirsOnly
<a name="l01302"></a>01302       | QFileDialog::DontResolveSymlinks);
<a name="l01303"></a>01303 
<a name="l01304"></a>01304   <a class="code" href="classQucsApp.html#a9157e4c028a8711d888e1fc3c9ad9602">deleteProject</a>(d);
<a name="l01305"></a>01305 }
<a name="l01306"></a>01306 
<a name="l01307"></a>01307 <span class="comment">// ----------------------------------------------------------</span>
<a name="l01308"></a>01308 <span class="comment">// Is called, when &quot;Delete Project&quot; button is pressed.</span>
<a name="l01309"></a><a class="code" href="classQucsApp.html#ac04782bf781df3a06b397d11ff36d8d1">01309</a> <span class="keywordtype">void</span> <a class="code" href="classQucsApp.html#ac04782bf781df3a06b397d11ff36d8d1">QucsApp::slotButtonProjDel</a>()
<a name="l01310"></a>01310 {
<a name="l01311"></a>01311   QModelIndex idx = <a class="code" href="classQucsApp.html#a31fbf006da2167fc516bbc5ce8e0d28c">Projects</a>-&gt;currentIndex();
<a name="l01312"></a>01312   <span class="keywordflow">if</span>(!idx.isValid()) {
<a name="l01313"></a>01313     QMessageBox::information(<span class="keyword">this</span>, tr(<span class="stringliteral">&quot;Info&quot;</span>),
<a name="l01314"></a>01314         tr(<span class="stringliteral">&quot;No project is selected!&quot;</span>));
<a name="l01315"></a>01315     <span class="keywordflow">return</span>;
<a name="l01316"></a>01316   }
<a name="l01317"></a>01317 
<a name="l01318"></a>01318   <a class="code" href="classQucsApp.html#a9157e4c028a8711d888e1fc3c9ad9602">deleteProject</a>(<a class="code" href="main_8cpp.html#ac2e3fb7eed4aa9bd981210dc5df2e02e">QucsSettings</a>.<a class="code" href="structtQucsSettings.html#a80d828678da4014a033ddf5ec3f831c7">QucsHomeDir</a>.filePath(idx.data().toString()));
<a name="l01319"></a>01319 }
<a name="l01320"></a>01320 
<a name="l01321"></a>01321 
<a name="l01322"></a>01322 <span class="comment">// ################################################################</span>
<a name="l01323"></a>01323 <span class="comment">// #####  Functions that handle the file operations for the   #####</span>
<a name="l01324"></a>01324 <span class="comment">// #####  documents.                                          #####</span>
<a name="l01325"></a>01325 <span class="comment">// ################################################################</span>
<a name="l01326"></a>01326 
<a name="l01327"></a><a class="code" href="classQucsApp.html#a53e2f80d731d8643a33ed1952ddaeb50">01327</a> <span class="keywordtype">void</span> <a class="code" href="classQucsApp.html#a53e2f80d731d8643a33ed1952ddaeb50">QucsApp::slotFileNew</a>()
<a name="l01328"></a>01328 {
<a name="l01329"></a>01329   statusBar()-&gt;showMessage(tr(<span class="stringliteral">&quot;Creating new schematic...&quot;</span>));
<a name="l01330"></a>01330   <a class="code" href="classQucsApp.html#acf15a168d7497bc25103174b31019db7">slotHideEdit</a>(); <span class="comment">// disable text edit of component property</span>
<a name="l01331"></a>01331 
<a name="l01332"></a>01332   <a class="code" href="classSchematic.html">Schematic</a> *d = <span class="keyword">new</span> <a class="code" href="classSchematic.html">Schematic</a>(<span class="keyword">this</span>, <span class="stringliteral">&quot;&quot;</span>);
<a name="l01333"></a>01333   <span class="keywordtype">int</span> i = <a class="code" href="classQucsApp.html#ae7612793599ca4f5106f7e9f488d4225">DocumentTab</a>-&gt;addTab(d, QPixmap(<a class="code" href="qucs_8cpp.html#a098a06ee0c473d9178da66df32798581">empty_xpm</a>), QObject::tr(<span class="stringliteral">&quot;untitled&quot;</span>));
<a name="l01334"></a>01334   <a class="code" href="classQucsApp.html#ae7612793599ca4f5106f7e9f488d4225">DocumentTab</a>-&gt;setCurrentIndex(i);
<a name="l01335"></a>01335 
<a name="l01336"></a>01336   statusBar()-&gt;showMessage(tr(<span class="stringliteral">&quot;Ready.&quot;</span>));
<a name="l01337"></a>01337 }
<a name="l01338"></a>01338 
<a name="l01339"></a>01339 <span class="comment">// --------------------------------------------------------------</span>
<a name="l01340"></a><a class="code" href="classQucsApp.html#a9ed09eeae42bf73919e74a039228c49f">01340</a> <span class="keywordtype">void</span> <a class="code" href="classQucsApp.html#a9ed09eeae42bf73919e74a039228c49f">QucsApp::slotTextNew</a>()
<a name="l01341"></a>01341 {
<a name="l01342"></a>01342   statusBar()-&gt;showMessage(tr(<span class="stringliteral">&quot;Creating new text editor...&quot;</span>));
<a name="l01343"></a>01343   <a class="code" href="classQucsApp.html#acf15a168d7497bc25103174b31019db7">slotHideEdit</a>(); <span class="comment">// disable text edit of component property</span>
<a name="l01344"></a>01344   <a class="code" href="classTextDoc.html" title="The TextDoc class definition.">TextDoc</a> *d = <span class="keyword">new</span> <a class="code" href="classTextDoc.html" title="The TextDoc class definition.">TextDoc</a>(<span class="keyword">this</span>, <span class="stringliteral">&quot;&quot;</span>);
<a name="l01345"></a>01345   <span class="keywordtype">int</span> i = <a class="code" href="classQucsApp.html#ae7612793599ca4f5106f7e9f488d4225">DocumentTab</a>-&gt;addTab(d, QPixmap(<a class="code" href="qucs_8cpp.html#a098a06ee0c473d9178da66df32798581">empty_xpm</a>), QObject::tr(<span class="stringliteral">&quot;untitled&quot;</span>));
<a name="l01346"></a>01346   <a class="code" href="classQucsApp.html#ae7612793599ca4f5106f7e9f488d4225">DocumentTab</a>-&gt;setCurrentIndex(i);
<a name="l01347"></a>01347 
<a name="l01348"></a>01348   statusBar()-&gt;showMessage(tr(<span class="stringliteral">&quot;Ready.&quot;</span>));
<a name="l01349"></a>01349 }
<a name="l01350"></a>01350 
<a name="l01351"></a>01351 <span class="comment">// --------------------------------------------------------------</span>
<a name="l01352"></a>01352 <span class="comment">// Changes to the document &quot;Name&quot;. If already open then it goes to it</span>
<a name="l01353"></a>01353 <span class="comment">// directly, otherwise it loads it.</span>
<a name="l01354"></a><a class="code" href="classQucsApp.html#aaaeffebcd5551096a2c6261d4bfc5636">01354</a> <span class="keywordtype">bool</span> <a class="code" href="classQucsApp.html#aaaeffebcd5551096a2c6261d4bfc5636">QucsApp::gotoPage</a>(<span class="keyword">const</span> QString&amp; Name)
<a name="l01355"></a>01355 {
<a name="l01356"></a>01356   <span class="keywordtype">int</span> No = <a class="code" href="classQucsApp.html#ae7612793599ca4f5106f7e9f488d4225">DocumentTab</a>-&gt;currentIndex();
<a name="l01357"></a>01357 
<a name="l01358"></a>01358   <span class="keywordtype">int</span> i = 0;
<a name="l01359"></a>01359   <a class="code" href="classQucsDoc.html">QucsDoc</a> * d = <a class="code" href="classQucsApp.html#aedb93e909d0b2cff6a8e4ccc82809057">findDoc</a> (Name, &amp;i);  <span class="comment">// search, if page is already loaded</span>
<a name="l01360"></a>01360 
<a name="l01361"></a>01361   <span class="keywordflow">if</span>(d) {   <span class="comment">// open page found ?</span>
<a name="l01362"></a>01362     d-&gt;<a class="code" href="classQucsDoc.html#a855ac5692d3dceacf88e745cc65002b7">becomeCurrent</a>(<span class="keyword">true</span>);
<a name="l01363"></a>01363     <a class="code" href="classQucsApp.html#ae7612793599ca4f5106f7e9f488d4225">DocumentTab</a>-&gt;setCurrentIndex(i);  <span class="comment">// make new document the current</span>
<a name="l01364"></a>01364     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01365"></a>01365   }
<a name="l01366"></a>01366 
<a name="l01367"></a>01367   QFileInfo Info(Name);
<a name="l01368"></a>01368   <span class="keywordflow">if</span>(Info.suffix() == <span class="stringliteral">&quot;sch&quot;</span> || Info.suffix() == <span class="stringliteral">&quot;dpl&quot;</span> ||
<a name="l01369"></a>01369      Info.suffix() == <span class="stringliteral">&quot;sym&quot;</span>) {
<a name="l01370"></a>01370     d = <span class="keyword">new</span> <a class="code" href="classSchematic.html">Schematic</a>(<span class="keyword">this</span>, Name);
<a name="l01371"></a>01371     i = <a class="code" href="classQucsApp.html#ae7612793599ca4f5106f7e9f488d4225">DocumentTab</a>-&gt;addTab((<a class="code" href="classSchematic.html">Schematic</a> *)d, QPixmap(<a class="code" href="qucs_8cpp.html#a098a06ee0c473d9178da66df32798581">empty_xpm</a>), Info.fileName()); 
<a name="l01372"></a>01372   }
<a name="l01373"></a>01373   <span class="keywordflow">else</span> {
<a name="l01374"></a>01374     d = <span class="keyword">new</span> <a class="code" href="classTextDoc.html" title="The TextDoc class definition.">TextDoc</a>(<span class="keyword">this</span>, Name);
<a name="l01375"></a>01375     i = <a class="code" href="classQucsApp.html#ae7612793599ca4f5106f7e9f488d4225">DocumentTab</a>-&gt;addTab((<a class="code" href="classTextDoc.html" title="The TextDoc class definition.">TextDoc</a> *)d, QPixmap(<a class="code" href="qucs_8cpp.html#a098a06ee0c473d9178da66df32798581">empty_xpm</a>), Info.fileName());
<a name="l01376"></a>01376   }
<a name="l01377"></a>01377   <a class="code" href="classQucsApp.html#ae7612793599ca4f5106f7e9f488d4225">DocumentTab</a>-&gt;setCurrentIndex(i);
<a name="l01378"></a>01378 
<a name="l01379"></a>01379   <span class="keywordflow">if</span>(!d-&gt;<a class="code" href="classQucsDoc.html#abaac4e6662cca0c496bf665fd3d893e3">load</a>()) {    <span class="comment">// load document if possible</span>
<a name="l01380"></a>01380     <span class="keyword">delete</span> d;
<a name="l01381"></a>01381     <a class="code" href="classQucsApp.html#ae7612793599ca4f5106f7e9f488d4225">DocumentTab</a>-&gt;setCurrentIndex(No);
<a name="l01382"></a>01382     <a class="code" href="classQucsApp.html#a372ee1fa475722ca832511027a34c383">view</a>-&gt;<a class="code" href="classMouseActions.html#ad43ee60feb7239ee9692300605dc9aed">drawn</a> = <span class="keyword">false</span>;
<a name="l01383"></a>01383     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01384"></a>01384   }
<a name="l01385"></a>01385   <a class="code" href="classQucsApp.html#a3924e8c4441d1446641f930d7f407bef">slotChangeView</a>(<a class="code" href="classQucsApp.html#ae7612793599ca4f5106f7e9f488d4225">DocumentTab</a>-&gt;currentWidget());
<a name="l01386"></a>01386 
<a name="l01387"></a>01387   <span class="comment">// if only an untitled document was open -&gt; close it</span>
<a name="l01388"></a>01388   <span class="keywordflow">if</span>(<a class="code" href="classQucsApp.html#a5a91682ea446a8a35c039c5ea233b587">getDoc</a>(0)-&gt;<a class="code" href="classQucsDoc.html#a2d87112c4f75a4770c9311bb6c2d407b">DocName</a>.isEmpty())
<a name="l01389"></a>01389     <span class="keywordflow">if</span>(!<a class="code" href="classQucsApp.html#a5a91682ea446a8a35c039c5ea233b587">getDoc</a>(0)-&gt;<a class="code" href="classQucsDoc.html#add1f5816d2da623e61ac7cff6397f7af">DocChanged</a>)
<a name="l01390"></a>01390       <span class="keyword">delete</span> <a class="code" href="classQucsApp.html#ae7612793599ca4f5106f7e9f488d4225">DocumentTab</a>-&gt;widget(0);
<a name="l01391"></a>01391 
<a name="l01392"></a>01392   <a class="code" href="classQucsApp.html#a372ee1fa475722ca832511027a34c383">view</a>-&gt;<a class="code" href="classMouseActions.html#ad43ee60feb7239ee9692300605dc9aed">drawn</a> = <span class="keyword">false</span>;
<a name="l01393"></a>01393   <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01394"></a>01394 }
<a name="l01395"></a>01395 
<a name="l01396"></a><a class="code" href="qucs__actions_8cpp.html#a372caee5282c48e430cb5b8add470027">01396</a> QString <a class="code" href="qucs_8cpp.html#a372caee5282c48e430cb5b8add470027">lastDirOpenSave</a>; <span class="comment">// to remember last directory and file</span>
<a name="l01397"></a>01397 
<a name="l01398"></a>01398 <span class="comment">// --------------------------------------------------------------</span>
<a name="l01399"></a><a class="code" href="classQucsApp.html#a4638bd730cdb683a22bb1c09575ce116">01399</a> <span class="keywordtype">void</span> <a class="code" href="classQucsApp.html#a4638bd730cdb683a22bb1c09575ce116">QucsApp::slotFileOpen</a>()
<a name="l01400"></a>01400 {
<a name="l01401"></a>01401   <a class="code" href="classQucsApp.html#acf15a168d7497bc25103174b31019db7">slotHideEdit</a>(); <span class="comment">// disable text edit of component property</span>
<a name="l01402"></a>01402 
<a name="l01403"></a>01403   statusBar()-&gt;showMessage(tr(<span class="stringliteral">&quot;Opening file...&quot;</span>));
<a name="l01404"></a>01404 
<a name="l01405"></a>01405   QString s = QFileDialog::getOpenFileName(<span class="keyword">this</span>, tr(<span class="stringliteral">&quot;Enter a Schematic Name&quot;</span>),
<a name="l01406"></a>01406     <a class="code" href="qucs_8cpp.html#a372caee5282c48e430cb5b8add470027">lastDirOpenSave</a>.isEmpty() ? QString(<span class="stringliteral">&quot;.&quot;</span>) : <a class="code" href="qucs_8cpp.html#a372caee5282c48e430cb5b8add470027">lastDirOpenSave</a>, <a class="code" href="classQucsApp.html#a00855ea292564b6816e25c23058c568f">QucsFileFilter</a>);
<a name="l01407"></a>01407 
<a name="l01408"></a>01408   <span class="keywordflow">if</span>(s.isEmpty())
<a name="l01409"></a>01409     statusBar()-&gt;showMessage(tr(<span class="stringliteral">&quot;Opening aborted&quot;</span>), 2000);
<a name="l01410"></a>01410   <span class="keywordflow">else</span> {
<a name="l01411"></a>01411     <a class="code" href="classQucsApp.html#aced5f32507a107d9e5d81c44b281ba71">updateRecentFilesList</a>(s);
<a name="l01412"></a>01412 
<a name="l01413"></a>01413     <a class="code" href="classQucsApp.html#aaaeffebcd5551096a2c6261d4bfc5636">gotoPage</a>(s);
<a name="l01414"></a>01414     <a class="code" href="qucs_8cpp.html#a372caee5282c48e430cb5b8add470027">lastDirOpenSave</a> = s;   <span class="comment">// remember last directory and file</span>
<a name="l01415"></a>01415 
<a name="l01416"></a>01416     statusBar()-&gt;showMessage(tr(<span class="stringliteral">&quot;Ready.&quot;</span>));
<a name="l01417"></a>01417   }
<a name="l01418"></a>01418 }
<a name="l01419"></a>01419 
<a name="l01420"></a>01420 <span class="comment">// --------------------------------------------------------------</span>
<a name="l01421"></a><a class="code" href="classQucsApp.html#a8215365755360cc362fbf812dc4965ec">01421</a> <span class="keywordtype">bool</span> <a class="code" href="classQucsApp.html#a8215365755360cc362fbf812dc4965ec">QucsApp::saveFile</a>(<a class="code" href="classQucsDoc.html">QucsDoc</a> *Doc)
<a name="l01422"></a>01422 {
<a name="l01423"></a>01423   <span class="keywordflow">if</span>(!Doc)
<a name="l01424"></a>01424     Doc = <a class="code" href="classQucsApp.html#a5a91682ea446a8a35c039c5ea233b587">getDoc</a>();
<a name="l01425"></a>01425 
<a name="l01426"></a>01426   <span class="keywordflow">if</span>(Doc-&gt;<a class="code" href="classQucsDoc.html#a2d87112c4f75a4770c9311bb6c2d407b">DocName</a>.isEmpty())
<a name="l01427"></a>01427     <span class="keywordflow">return</span> <a class="code" href="classQucsApp.html#aceaecb4d84e675e470037afd19135d32">saveAs</a>();
<a name="l01428"></a>01428 
<a name="l01429"></a>01429   <span class="keywordtype">int</span> Result = Doc-&gt;<a class="code" href="classQucsDoc.html#ac6adc86a294176c8c62e44de65e5f509">save</a>();
<a name="l01430"></a>01430   <span class="keywordflow">if</span>(Result &lt; 0)  <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01431"></a>01431 
<a name="l01432"></a>01432   <a class="code" href="classQucsApp.html#a8d660a5a6479c2683e03282a23a42c65">updatePortNumber</a>(Doc, Result);
<a name="l01433"></a>01433   <a class="code" href="classQucsApp.html#abc9b64e52b905e3a287dc618d8507d2c">slotUpdateTreeview</a>();
<a name="l01434"></a>01434   <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01435"></a>01435 }
<a name="l01436"></a>01436 
<a name="l01437"></a>01437 <span class="comment">// --------------------------------------------------------------</span>
<a name="l01438"></a><a class="code" href="classQucsApp.html#a5b0458655f1d8ec9a87b63aef560f187">01438</a> <span class="keywordtype">void</span> <a class="code" href="classQucsApp.html#a5b0458655f1d8ec9a87b63aef560f187">QucsApp::slotFileSave</a>()
<a name="l01439"></a>01439 {
<a name="l01440"></a>01440   statusBar()-&gt;showMessage(tr(<span class="stringliteral">&quot;Saving file...&quot;</span>));
<a name="l01441"></a>01441   <a class="code" href="classQucsApp.html#ae7612793599ca4f5106f7e9f488d4225">DocumentTab</a>-&gt;blockSignals(<span class="keyword">true</span>);   <span class="comment">// no user interaction during that time</span>
<a name="l01442"></a>01442   <a class="code" href="classQucsApp.html#acf15a168d7497bc25103174b31019db7">slotHideEdit</a>(); <span class="comment">// disable text edit of component property</span>
<a name="l01443"></a>01443 
<a name="l01444"></a>01444   <span class="keywordflow">if</span>(!<a class="code" href="classQucsApp.html#a8215365755360cc362fbf812dc4965ec">saveFile</a>()) {
<a name="l01445"></a>01445     <a class="code" href="classQucsApp.html#ae7612793599ca4f5106f7e9f488d4225">DocumentTab</a>-&gt;blockSignals(<span class="keyword">false</span>);
<a name="l01446"></a>01446     statusBar()-&gt;showMessage(tr(<span class="stringliteral">&quot;Saving aborted&quot;</span>), 2000);
<a name="l01447"></a>01447     statusBar()-&gt;showMessage(tr(<span class="stringliteral">&quot;Ready.&quot;</span>));
<a name="l01448"></a>01448     <span class="keywordflow">return</span>;
<a name="l01449"></a>01449   }
<a name="l01450"></a>01450 
<a name="l01451"></a>01451   <a class="code" href="classQucsApp.html#ae7612793599ca4f5106f7e9f488d4225">DocumentTab</a>-&gt;blockSignals(<span class="keyword">false</span>);
<a name="l01452"></a>01452   statusBar()-&gt;showMessage(tr(<span class="stringliteral">&quot;Ready.&quot;</span>));
<a name="l01453"></a>01453 
<a name="l01454"></a>01454   <span class="keywordflow">if</span>(!<a class="code" href="classQucsApp.html#a346d3b157d16b8b09ea079dd2098cd47">ProjName</a>.isEmpty())
<a name="l01455"></a>01455     <a class="code" href="classQucsApp.html#abc9b64e52b905e3a287dc618d8507d2c">slotUpdateTreeview</a>();
<a name="l01456"></a>01456 }
<a name="l01457"></a>01457 
<a name="l01458"></a>01458 <span class="comment">// --------------------------------------------------------------</span>
<a name="l01459"></a><a class="code" href="classQucsApp.html#aceaecb4d84e675e470037afd19135d32">01459</a> <span class="keywordtype">bool</span> <a class="code" href="classQucsApp.html#aceaecb4d84e675e470037afd19135d32">QucsApp::saveAs</a>()
<a name="l01460"></a>01460 {
<a name="l01461"></a>01461   QWidget *w = <a class="code" href="classQucsApp.html#ae7612793599ca4f5106f7e9f488d4225">DocumentTab</a>-&gt;currentWidget();
<a name="l01462"></a>01462   <a class="code" href="classQucsDoc.html">QucsDoc</a> *Doc = <a class="code" href="classQucsApp.html#a5a91682ea446a8a35c039c5ea233b587">getDoc</a>();
<a name="l01463"></a>01463 
<a name="l01464"></a>01464   <span class="keywordtype">int</span> n = -1;
<a name="l01465"></a>01465   <span class="keywordtype">bool</span> intoView = <span class="keyword">true</span>;
<a name="l01466"></a>01466   QString s, Filter;
<a name="l01467"></a>01467   QFileInfo Info;
<a name="l01468"></a>01468   <span class="keywordflow">while</span>(<span class="keyword">true</span>) {
<a name="l01469"></a>01469     intoView = <span class="keyword">true</span>;
<a name="l01470"></a>01470     s = Doc-&gt;<a class="code" href="classQucsDoc.html#a2d87112c4f75a4770c9311bb6c2d407b">DocName</a>;
<a name="l01471"></a>01471     Info.setFile(s);
<a name="l01472"></a>01472     <span class="keywordflow">if</span>(s.isEmpty()) {   <span class="comment">// which is default directory ?</span>
<a name="l01473"></a>01473       <span class="keywordflow">if</span>(<a class="code" href="classQucsApp.html#a346d3b157d16b8b09ea079dd2098cd47">ProjName</a>.isEmpty()) {
<a name="l01474"></a>01474         <span class="keywordflow">if</span>(<a class="code" href="qucs_8cpp.html#a372caee5282c48e430cb5b8add470027">lastDirOpenSave</a>.isEmpty())  s = QDir::currentPath();
<a name="l01475"></a>01475         <span class="keywordflow">else</span>  s = <a class="code" href="qucs_8cpp.html#a372caee5282c48e430cb5b8add470027">lastDirOpenSave</a>;
<a name="l01476"></a>01476       }
<a name="l01477"></a>01477       <span class="keywordflow">else</span> s = <a class="code" href="main_8cpp.html#ac2e3fb7eed4aa9bd981210dc5df2e02e">QucsSettings</a>.<a class="code" href="structtQucsSettings.html#ac416ec4c4a8bfc243ea836dbf334ccae">QucsWorkDir</a>.path();
<a name="l01478"></a>01478     }
<a name="l01479"></a>01479 
<a name="l01480"></a>01480     <span class="comment">// list of known file extensions</span>
<a name="l01481"></a>01481     QString ext = <span class="stringliteral">&quot;vhdl;vhd;v;va;sch;dpl;m;oct;net;qnet;txt&quot;</span>;
<a name="l01482"></a>01482     QStringList extlist = ext.split (<span class="charliteral">&#39;;&#39;</span>);
<a name="l01483"></a>01483 
<a name="l01484"></a>01484     <span class="keywordflow">if</span>(<a class="code" href="classQucsApp.html#aa699c68344d4bd4f53fe90f0ccd4b6ae">isTextDocument</a> (w))
<a name="l01485"></a>01485       Filter = tr(<span class="stringliteral">&quot;VHDL Sources&quot;</span>)+<span class="stringliteral">&quot; (*.vhdl *.vhd);;&quot;</span> +
<a name="l01486"></a>01486          tr(<span class="stringliteral">&quot;Verilog Sources&quot;</span>)+<span class="stringliteral">&quot; (*.v);;&quot;</span>+
<a name="l01487"></a>01487          tr(<span class="stringliteral">&quot;Verilog-A Sources&quot;</span>)+<span class="stringliteral">&quot; (*.va);;&quot;</span>+
<a name="l01488"></a>01488          tr(<span class="stringliteral">&quot;Octave Scripts&quot;</span>)+<span class="stringliteral">&quot; (*.m *.oct);;&quot;</span>+
<a name="l01489"></a>01489          tr(<span class="stringliteral">&quot;Qucs Netlist&quot;</span>)+<span class="stringliteral">&quot; (*.net *.qnet);;&quot;</span>+
<a name="l01490"></a>01490          tr(<span class="stringliteral">&quot;Plain Text&quot;</span>)+<span class="stringliteral">&quot; (*.txt);;&quot;</span>+
<a name="l01491"></a>01491          tr(<span class="stringliteral">&quot;Any File&quot;</span>)+<span class="stringliteral">&quot; (*)&quot;</span>;
<a name="l01492"></a>01492     <span class="keywordflow">else</span>
<a name="l01493"></a>01493       Filter = <a class="code" href="classQucsApp.html#a00855ea292564b6816e25c23058c568f">QucsFileFilter</a>;
<a name="l01494"></a>01494 
<a name="l01495"></a>01495     s = QFileDialog::getSaveFileName(<span class="keyword">this</span>, tr(<span class="stringliteral">&quot;Enter a Document Name&quot;</span>),
<a name="l01496"></a>01496                                      <a class="code" href="main_8cpp.html#ac2e3fb7eed4aa9bd981210dc5df2e02e">QucsSettings</a>.<a class="code" href="structtQucsSettings.html#ac416ec4c4a8bfc243ea836dbf334ccae">QucsWorkDir</a>.absolutePath(),
<a name="l01497"></a>01497                                      Filter);
<a name="l01498"></a>01498     <span class="keywordflow">if</span>(s.isEmpty())  <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01499"></a>01499     Info.setFile(s);               <span class="comment">// try to guess the best extension ...</span>
<a name="l01500"></a>01500     ext = Info.suffix();
<a name="l01501"></a>01501 
<a name="l01502"></a>01502     <span class="keywordflow">if</span>(ext.isEmpty() || !extlist.contains(ext))
<a name="l01503"></a>01503     {
<a name="l01504"></a>01504       <span class="comment">// if no extension was specified or is unknown</span>
<a name="l01505"></a>01505       <span class="keywordflow">if</span> (!<a class="code" href="classQucsApp.html#aa699c68344d4bd4f53fe90f0ccd4b6ae">isTextDocument</a> (w))
<a name="l01506"></a>01506       {
<a name="l01507"></a>01507         <span class="comment">// assume it is a schematic</span>
<a name="l01508"></a>01508         s += <span class="stringliteral">&quot;.sch&quot;</span>;
<a name="l01509"></a>01509       }
<a name="l01510"></a>01510     }
<a name="l01511"></a>01511 
<a name="l01512"></a>01512     Info.setFile(s);
<a name="l01513"></a>01513     <span class="keywordflow">if</span>(QFile::exists(s)) {
<a name="l01514"></a>01514       n = QMessageBox::warning(<span class="keyword">this</span>, tr(<span class="stringliteral">&quot;Warning&quot;</span>),
<a name="l01515"></a>01515     tr(<span class="stringliteral">&quot;The file &#39;&quot;</span>)+Info.fileName()+tr(<span class="stringliteral">&quot;&#39; already exists!\n&quot;</span>)+
<a name="l01516"></a>01516     tr(<span class="stringliteral">&quot;Saving will overwrite the old one! Continue?&quot;</span>),
<a name="l01517"></a>01517     tr(<span class="stringliteral">&quot;No&quot;</span>), tr(<span class="stringliteral">&quot;Yes&quot;</span>), tr(<span class="stringliteral">&quot;Cancel&quot;</span>));
<a name="l01518"></a>01518       <span class="keywordflow">if</span>(n == 2) <span class="keywordflow">return</span> <span class="keyword">false</span>;    <span class="comment">// cancel</span>
<a name="l01519"></a>01519       <span class="keywordflow">if</span>(n == 0) <span class="keywordflow">continue</span>;
<a name="l01520"></a>01520       intoView = <span class="keyword">false</span>;    <span class="comment">// file already exists</span>
<a name="l01521"></a>01521     }
<a name="l01522"></a>01522 
<a name="l01523"></a>01523     <span class="comment">// search, if document is open</span>
<a name="l01524"></a>01524     <a class="code" href="classQucsDoc.html">QucsDoc</a> * d = <a class="code" href="classQucsApp.html#aedb93e909d0b2cff6a8e4ccc82809057">findDoc</a> (s);
<a name="l01525"></a>01525     <span class="keywordflow">if</span>(d) {
<a name="l01526"></a>01526       QMessageBox::information(<span class="keyword">this</span>, tr(<span class="stringliteral">&quot;Info&quot;</span>),
<a name="l01527"></a>01527     tr(<span class="stringliteral">&quot;Cannot overwrite an open document&quot;</span>));
<a name="l01528"></a>01528       <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01529"></a>01529     }
<a name="l01530"></a>01530 
<a name="l01531"></a>01531     <span class="keywordflow">break</span>;
<a name="l01532"></a>01532   }
<a name="l01533"></a>01533   Doc-&gt;<a class="code" href="classQucsDoc.html#a00d81c661aabc1d11dcc0f4889bbfbbe">setName</a>(s);
<a name="l01534"></a>01534   <a class="code" href="classQucsApp.html#ae7612793599ca4f5106f7e9f488d4225">DocumentTab</a>-&gt;setTabText(<a class="code" href="classQucsApp.html#ae7612793599ca4f5106f7e9f488d4225">DocumentTab</a>-&gt;indexOf(w), <a class="code" href="namespacemisc.html#ac8fd14eba8c53f7438395f6c62e2dc43">misc::properFileName</a>(s));
<a name="l01535"></a>01535   <a class="code" href="qucs_8cpp.html#a372caee5282c48e430cb5b8add470027">lastDirOpenSave</a> = Info.absolutePath();  <span class="comment">// remember last directory and file</span>
<a name="l01536"></a>01536   <a class="code" href="classQucsApp.html#aced5f32507a107d9e5d81c44b281ba71">updateRecentFilesList</a>(s);
<a name="l01537"></a>01537 
<a name="l01538"></a>01538   n = Doc-&gt;<a class="code" href="classQucsDoc.html#ac6adc86a294176c8c62e44de65e5f509">save</a>();   <span class="comment">// SAVE</span>
<a name="l01539"></a>01539   <span class="keywordflow">if</span>(n &lt; 0)  <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01540"></a>01540 
<a name="l01541"></a>01541   <a class="code" href="classQucsApp.html#a8d660a5a6479c2683e03282a23a42c65">updatePortNumber</a>(Doc, n);
<a name="l01542"></a>01542   <a class="code" href="classQucsApp.html#abc9b64e52b905e3a287dc618d8507d2c">slotUpdateTreeview</a>();
<a name="l01543"></a>01543   <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01544"></a>01544 }
<a name="l01545"></a>01545 
<a name="l01546"></a>01546 <span class="comment">// --------------------------------------------------------------</span>
<a name="l01547"></a><a class="code" href="classQucsApp.html#a8a79e16c44618c159ae1e5276d3f746e">01547</a> <span class="keywordtype">void</span> <a class="code" href="classQucsApp.html#a8a79e16c44618c159ae1e5276d3f746e">QucsApp::slotFileSaveAs</a>()
<a name="l01548"></a>01548 {
<a name="l01549"></a>01549   statusBar()-&gt;showMessage(tr(<span class="stringliteral">&quot;Saving file under new filename...&quot;</span>));
<a name="l01550"></a>01550   <a class="code" href="classQucsApp.html#ae7612793599ca4f5106f7e9f488d4225">DocumentTab</a>-&gt;blockSignals(<span class="keyword">true</span>);   <span class="comment">// no user interaction during the time</span>
<a name="l01551"></a>01551   <a class="code" href="classQucsApp.html#acf15a168d7497bc25103174b31019db7">slotHideEdit</a>(); <span class="comment">// disable text edit of component property</span>
<a name="l01552"></a>01552 
<a name="l01553"></a>01553   <span class="keywordflow">if</span>(!<a class="code" href="classQucsApp.html#aceaecb4d84e675e470037afd19135d32">saveAs</a>()) {
<a name="l01554"></a>01554     <a class="code" href="classQucsApp.html#ae7612793599ca4f5106f7e9f488d4225">DocumentTab</a>-&gt;blockSignals(<span class="keyword">false</span>);
<a name="l01555"></a>01555     statusBar()-&gt;showMessage(tr(<span class="stringliteral">&quot;Saving aborted&quot;</span>), 3000);
<a name="l01556"></a>01556     statusBar()-&gt;showMessage(tr(<span class="stringliteral">&quot;Ready.&quot;</span>));
<a name="l01557"></a>01557     <span class="keywordflow">return</span>;
<a name="l01558"></a>01558   }
<a name="l01559"></a>01559 
<a name="l01560"></a>01560   <a class="code" href="classQucsApp.html#ae7612793599ca4f5106f7e9f488d4225">DocumentTab</a>-&gt;blockSignals(<span class="keyword">false</span>);
<a name="l01561"></a>01561   statusBar()-&gt;showMessage(tr(<span class="stringliteral">&quot;Ready.&quot;</span>));
<a name="l01562"></a>01562 
<a name="l01563"></a>01563   <span class="comment">// refresh the schematic file path</span>
<a name="l01564"></a>01564   <a class="code" href="classQucsApp.html#a76573b87bb7d8bb4477e5ff8accfe194">slotRefreshSchPath</a>();
<a name="l01565"></a>01565 
<a name="l01566"></a>01566   <span class="keywordflow">if</span>(!<a class="code" href="classQucsApp.html#a346d3b157d16b8b09ea079dd2098cd47">ProjName</a>.isEmpty())
<a name="l01567"></a>01567     <a class="code" href="classQucsApp.html#abc9b64e52b905e3a287dc618d8507d2c">slotUpdateTreeview</a>();
<a name="l01568"></a>01568 }
<a name="l01569"></a>01569 
<a name="l01570"></a>01570 
<a name="l01571"></a>01571 <span class="comment">// --------------------------------------------------------------</span>
<a name="l01572"></a><a class="code" href="classQucsApp.html#a2f0374da49b42c68f208cbc17e3d4bab">01572</a> <span class="keywordtype">void</span> <a class="code" href="classQucsApp.html#a2f0374da49b42c68f208cbc17e3d4bab">QucsApp::slotFileSaveAll</a>()
<a name="l01573"></a>01573 {
<a name="l01574"></a>01574   statusBar()-&gt;showMessage(tr(<span class="stringliteral">&quot;Saving all files...&quot;</span>));
<a name="l01575"></a>01575   <a class="code" href="classQucsApp.html#acf15a168d7497bc25103174b31019db7">slotHideEdit</a>(); <span class="comment">// disable text edit of component property</span>
<a name="l01576"></a>01576   <a class="code" href="classQucsApp.html#ae7612793599ca4f5106f7e9f488d4225">DocumentTab</a>-&gt;blockSignals(<span class="keyword">true</span>);   <span class="comment">// no user interaction during the time</span>
<a name="l01577"></a>01577 
<a name="l01578"></a>01578   <span class="keywordtype">int</span> No=0;
<a name="l01579"></a>01579   <a class="code" href="classQucsDoc.html">QucsDoc</a> *Doc;  <span class="comment">// search, if page is already loaded</span>
<a name="l01580"></a>01580   <span class="keywordflow">while</span>((Doc=<a class="code" href="classQucsApp.html#a5a91682ea446a8a35c039c5ea233b587">getDoc</a>(No++)) != 0) {
<a name="l01581"></a>01581     <span class="keywordflow">if</span>(Doc-&gt;<a class="code" href="classQucsDoc.html#a2d87112c4f75a4770c9311bb6c2d407b">DocName</a>.isEmpty())  <span class="comment">// make document the current ?</span>
<a name="l01582"></a>01582       <a class="code" href="classQucsApp.html#ae7612793599ca4f5106f7e9f488d4225">DocumentTab</a>-&gt;setCurrentIndex(No-1);
<a name="l01583"></a>01583     <a class="code" href="classQucsApp.html#a8215365755360cc362fbf812dc4965ec">saveFile</a>(Doc);
<a name="l01584"></a>01584   }
<a name="l01585"></a>01585 
<a name="l01586"></a>01586   <a class="code" href="classQucsApp.html#ae7612793599ca4f5106f7e9f488d4225">DocumentTab</a>-&gt;blockSignals(<span class="keyword">false</span>);
<a name="l01587"></a>01587   <span class="comment">// Call update() to update subcircuit symbols in current Schematic document.</span>
<a name="l01588"></a>01588   <span class="comment">// TextDoc has no viewport, it needs no update.</span>
<a name="l01589"></a>01589   QString tabType = <a class="code" href="classQucsApp.html#ae7612793599ca4f5106f7e9f488d4225">DocumentTab</a>-&gt;currentWidget()-&gt;metaObject()-&gt;className();
<a name="l01590"></a>01590 
<a name="l01591"></a>01591   <span class="keywordflow">if</span> (tabType == <span class="stringliteral">&quot;Schematic&quot;</span>) {
<a name="l01592"></a>01592     ((Q3ScrollView*)<a class="code" href="classQucsApp.html#ae7612793599ca4f5106f7e9f488d4225">DocumentTab</a>-&gt;currentWidget())-&gt;viewport()-&gt;update();
<a name="l01593"></a>01593   }
<a name="l01594"></a>01594   <a class="code" href="classQucsApp.html#a372ee1fa475722ca832511027a34c383">view</a>-&gt;<a class="code" href="classMouseActions.html#ad43ee60feb7239ee9692300605dc9aed">drawn</a> = <span class="keyword">false</span>;
<a name="l01595"></a>01595   statusBar()-&gt;showMessage(tr(<span class="stringliteral">&quot;Ready.&quot;</span>));
<a name="l01596"></a>01596 
<a name="l01597"></a>01597   <span class="comment">// refresh the schematic file path</span>
<a name="l01598"></a>01598   <a class="code" href="classQucsApp.html#a76573b87bb7d8bb4477e5ff8accfe194">slotRefreshSchPath</a>();
<a name="l01599"></a>01599   <a class="code" href="classQucsApp.html#abc9b64e52b905e3a287dc618d8507d2c">slotUpdateTreeview</a>();
<a name="l01600"></a>01600 }
<a name="l01601"></a>01601 
<a name="l01602"></a>01602 <span class="comment">// --------------------------------------------------------------</span>
<a name="l01603"></a>01603 <span class="comment">// Close the currently active file tab</span>
<a name="l01604"></a><a class="code" href="classQucsApp.html#aacfb383853027265ecccf4bedb863ddb">01604</a> <span class="keywordtype">void</span> <a class="code" href="classQucsApp.html#aacfb383853027265ecccf4bedb863ddb">QucsApp::slotFileClose</a>()
<a name="l01605"></a>01605 {
<a name="l01606"></a>01606     <span class="comment">// Using file index -1 closes the currently active file window</span>
<a name="l01607"></a>01607     <a class="code" href="classQucsApp.html#ab27cc385c98599110890cf1a302c583f">closeFile</a>(-1);
<a name="l01608"></a>01608 }
<a name="l01609"></a>01609 
<a name="l01610"></a>01610 <span class="comment">// --------------------------------------------------------------</span>
<a name="l01611"></a>01611 <span class="comment">// Close the file tab specified by its index</span>
<a name="l01612"></a><a class="code" href="classQucsApp.html#a305680d88c97be7d31153fe56836e156">01612</a> <span class="keywordtype">void</span> <a class="code" href="classQucsApp.html#aacfb383853027265ecccf4bedb863ddb">QucsApp::slotFileClose</a>(<span class="keywordtype">int</span> index)
<a name="l01613"></a>01613 {
<a name="l01614"></a>01614     <span class="comment">// Call closeFile with a specific tab index</span>
<a name="l01615"></a>01615     <a class="code" href="classQucsApp.html#ab27cc385c98599110890cf1a302c583f">closeFile</a>(index);
<a name="l01616"></a>01616 }
<a name="l01617"></a>01617 
<a name="l01618"></a>01618 <span class="comment">// --------------------------------------------------------------</span>
<a name="l01619"></a>01619 <span class="comment">// Common function to close a file tab specified by its index</span>
<a name="l01620"></a>01620 <span class="comment">// checking for changes in the file before doing so. If called</span>
<a name="l01621"></a>01621 <span class="comment">// index == -1, the active document will be closed</span>
<a name="l01622"></a><a class="code" href="classQucsApp.html#ab27cc385c98599110890cf1a302c583f">01622</a> <span class="keywordtype">void</span> <a class="code" href="classQucsApp.html#ab27cc385c98599110890cf1a302c583f">QucsApp::closeFile</a>(<span class="keywordtype">int</span> index)
<a name="l01623"></a>01623 {
<a name="l01624"></a>01624     statusBar()-&gt;showMessage(tr(<span class="stringliteral">&quot;Closing file...&quot;</span>));
<a name="l01625"></a>01625 
<a name="l01626"></a>01626     <a class="code" href="classQucsApp.html#acf15a168d7497bc25103174b31019db7">slotHideEdit</a>(); <span class="comment">// disable text edit of component property</span>
<a name="l01627"></a>01627 
<a name="l01628"></a>01628     <a class="code" href="classQucsDoc.html">QucsDoc</a> *Doc = <a class="code" href="classQucsApp.html#a5a91682ea446a8a35c039c5ea233b587">getDoc</a>(index);
<a name="l01629"></a>01629     <span class="keywordflow">if</span>(Doc-&gt;<a class="code" href="classQucsDoc.html#add1f5816d2da623e61ac7cff6397f7af">DocChanged</a>) {
<a name="l01630"></a>01630       <span class="keywordflow">switch</span>(QMessageBox::warning(<span class="keyword">this</span>,tr(<span class="stringliteral">&quot;Closing Qucs document&quot;</span>),
<a name="l01631"></a>01631         tr(<span class="stringliteral">&quot;The document contains unsaved changes!\n&quot;</span>)+
<a name="l01632"></a>01632         tr(<span class="stringliteral">&quot;Do you want to save the changes before closing?&quot;</span>),
<a name="l01633"></a>01633         tr(<span class="stringliteral">&quot;&amp;Save&quot;</span>), tr(<span class="stringliteral">&quot;&amp;Discard&quot;</span>), tr(<span class="stringliteral">&quot;Cancel&quot;</span>), 0, 2)) {
<a name="l01634"></a>01634         <span class="keywordflow">case</span> 0 : <a class="code" href="classQucsApp.html#a5b0458655f1d8ec9a87b63aef560f187">slotFileSave</a>();
<a name="l01635"></a>01635                  <span class="keywordflow">break</span>;
<a name="l01636"></a>01636         <span class="keywordflow">case</span> 2 : <span class="keywordflow">return</span>;
<a name="l01637"></a>01637       }
<a name="l01638"></a>01638     }
<a name="l01639"></a>01639 
<a name="l01640"></a>01640     <a class="code" href="classQucsApp.html#ae7612793599ca4f5106f7e9f488d4225">DocumentTab</a>-&gt;removeTab(index);
<a name="l01641"></a>01641     <span class="keyword">delete</span> Doc;
<a name="l01642"></a>01642 
<a name="l01643"></a>01643     <span class="keywordflow">if</span>(<a class="code" href="classQucsApp.html#ae7612793599ca4f5106f7e9f488d4225">DocumentTab</a>-&gt;count() &lt; 1) { <span class="comment">// if no document left, create an untitled</span>
<a name="l01644"></a>01644       <a class="code" href="classSchematic.html">Schematic</a> *d = <span class="keyword">new</span> <a class="code" href="classSchematic.html">Schematic</a>(<span class="keyword">this</span>, <span class="stringliteral">&quot;&quot;</span>);
<a name="l01645"></a>01645       <a class="code" href="classQucsApp.html#ae7612793599ca4f5106f7e9f488d4225">DocumentTab</a>-&gt;addTab(d, QPixmap(<a class="code" href="qucs_8cpp.html#a098a06ee0c473d9178da66df32798581">empty_xpm</a>), QObject::tr(<span class="stringliteral">&quot;untitled&quot;</span>)); 
<a name="l01646"></a>01646       <a class="code" href="classQucsApp.html#ae7612793599ca4f5106f7e9f488d4225">DocumentTab</a>-&gt;setCurrentIndex(0);
<a name="l01647"></a>01647     }
<a name="l01648"></a>01648 
<a name="l01649"></a>01649     statusBar()-&gt;showMessage(tr(<span class="stringliteral">&quot;Ready.&quot;</span>));
<a name="l01650"></a>01650 }
<a name="l01651"></a>01651 
<a name="l01652"></a>01652 
<a name="l01653"></a>01653 <span class="comment">// --------------------------------------------------------------</span>
<a name="l01654"></a><a class="code" href="classQucsApp.html#ad879e6b32e2ea281a177c409a8c01b5a">01654</a> <span class="keywordtype">bool</span> <a class="code" href="classQucsApp.html#ad879e6b32e2ea281a177c409a8c01b5a">QucsApp::closeAllFiles</a>()
<a name="l01655"></a>01655 {
<a name="l01656"></a>01656   <a class="code" href="classSaveDialog.html">SaveDialog</a> *sd = <span class="keyword">new</span> <a class="code" href="classQucsApp.html#a7e9d74bb7e6556fb16788464ed576f5f">SaveDialog</a>(<span class="keyword">this</span>);
<a name="l01657"></a>01657   sd-&gt;<a class="code" href="classSaveDialog.html#a9049dd04627aa4aa6fe5030a809f22e8">setApp</a>(<span class="keyword">this</span>);
<a name="l01658"></a>01658   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i &lt; <a class="code" href="classQucsApp.html#ae7612793599ca4f5106f7e9f488d4225">DocumentTab</a>-&gt;count(); ++i) {
<a name="l01659"></a>01659     <a class="code" href="classQucsDoc.html">QucsDoc</a> *doc = <a class="code" href="classQucsApp.html#a5a91682ea446a8a35c039c5ea233b587">getDoc</a>(i);
<a name="l01660"></a>01660     <span class="keywordflow">if</span>(doc-&gt;<a class="code" href="classQucsDoc.html#add1f5816d2da623e61ac7cff6397f7af">DocChanged</a>)
<a name="l01661"></a>01661       sd-&gt;<a class="code" href="classSaveDialog.html#a399af520b0491a7322292ab331405f38">addUnsavedDoc</a>(doc);
<a name="l01662"></a>01662   }
<a name="l01663"></a>01663   <span class="keywordtype">int</span> Result = <a class="code" href="classSaveDialog.html#ac2b17bd48e5886b7c6e2431031211354a5b0bc6edbe1d7f889073e0256ddee948">SaveDialog::DontSave</a>;
<a name="l01664"></a>01664   <span class="keywordflow">if</span>(!sd-&gt;<a class="code" href="classSaveDialog.html#a9dc946e03175251661053dfb68172035">isEmpty</a>())
<a name="l01665"></a>01665      Result = sd-&gt;exec();
<a name="l01666"></a>01666   <span class="keyword">delete</span> sd;
<a name="l01667"></a>01667   <span class="keywordflow">if</span>(Result == <a class="code" href="classSaveDialog.html#ac2b17bd48e5886b7c6e2431031211354adf8b599995a93006d5168db070e25b6b">SaveDialog::AbortClosing</a>)
<a name="l01668"></a>01668     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01669"></a>01669   <a class="code" href="classQucsDoc.html">QucsDoc</a> *doc = 0;
<a name="l01670"></a>01670   <span class="keywordflow">while</span>((doc = <a class="code" href="classQucsApp.html#a5a91682ea446a8a35c039c5ea233b587">getDoc</a>()) != 0)
<a name="l01671"></a>01671   <span class="keyword">delete</span> doc;
<a name="l01672"></a>01672 
<a name="l01673"></a>01673 
<a name="l01674"></a>01674   <a class="code" href="classQucsApp.html#a4ec09c549f14f02a761668c245b3f6b1">switchEditMode</a>(<span class="keyword">true</span>);   <span class="comment">// set schematic edit mode</span>
<a name="l01675"></a>01675   <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01676"></a>01676 }
<a name="l01677"></a>01677 
<a name="l01678"></a>01678 
<a name="l01679"></a><a class="code" href="classQucsApp.html#ae2562947eb0ef13d08f8cdd33fbfdc70">01679</a> <span class="keywordtype">void</span> <a class="code" href="classQucsApp.html#ae2562947eb0ef13d08f8cdd33fbfdc70">QucsApp::slotFileExamples</a>()
<a name="l01680"></a>01680 {
<a name="l01681"></a>01681   statusBar()-&gt;showMessage(tr(<span class="stringliteral">&quot;Open examples directory...&quot;</span>));
<a name="l01682"></a>01682   QString path = QDir::toNativeSeparators(<a class="code" href="main_8cpp.html#ac2e3fb7eed4aa9bd981210dc5df2e02e">QucsSettings</a>.<a class="code" href="structtQucsSettings.html#a2d1cb813e10dc15b84c224f52ff61167">ExamplesDir</a>);
<a name="l01683"></a>01683   QDesktopServices::openUrl(QUrl(<span class="stringliteral">&quot;file:///&quot;</span> + path.replace(<span class="stringliteral">&quot;\\&quot;</span>,<span class="stringliteral">&quot;/&quot;</span>)));
<a name="l01684"></a>01684   statusBar()-&gt;showMessage(tr(<span class="stringliteral">&quot;Ready.&quot;</span>));
<a name="l01685"></a>01685 }
<a name="l01686"></a>01686 
<a name="l01687"></a><a class="code" href="classQucsApp.html#afa92ad850b3e7ab6948165c28b84f8aa">01687</a> <span class="keywordtype">void</span> <a class="code" href="classQucsApp.html#afa92ad850b3e7ab6948165c28b84f8aa">QucsApp::slotHelpTutorial</a>()
<a name="l01688"></a>01688 {
<a name="l01689"></a>01689   QString path = QDir::toNativeSeparators(<a class="code" href="main_8cpp.html#ac2e3fb7eed4aa9bd981210dc5df2e02e">QucsSettings</a>.<a class="code" href="structtQucsSettings.html#a7af5c780c02bd677400ffb709b238b25">DocDir</a>);
<a name="l01690"></a>01690   QUrl url = QUrl(<span class="stringliteral">&quot;file:///&quot;</span> + path.replace(<span class="stringliteral">&quot;\\&quot;</span>,<span class="stringliteral">&quot;/&quot;</span>) + <span class="stringliteral">&quot;tutorial/&quot;</span> + QObject::sender()-&gt;objectName());
<a name="l01691"></a>01691   QDesktopServices::openUrl(url);
<a name="l01692"></a>01692 }
<a name="l01693"></a>01693 
<a name="l01694"></a><a class="code" href="classQucsApp.html#af1f313940c79587aab6e4c8c09fd431d">01694</a> <span class="keywordtype">void</span> <a class="code" href="classQucsApp.html#af1f313940c79587aab6e4c8c09fd431d">QucsApp::slotHelpTechnical</a>()
<a name="l01695"></a>01695 {
<a name="l01696"></a>01696   QString path = QDir::toNativeSeparators(<a class="code" href="main_8cpp.html#ac2e3fb7eed4aa9bd981210dc5df2e02e">QucsSettings</a>.<a class="code" href="structtQucsSettings.html#a7af5c780c02bd677400ffb709b238b25">DocDir</a>);
<a name="l01697"></a>01697   QUrl url = QUrl(<span class="stringliteral">&quot;file:///&quot;</span> + path.replace(<span class="stringliteral">&quot;\\&quot;</span>,<span class="stringliteral">&quot;/&quot;</span>) + <span class="stringliteral">&quot;technical/&quot;</span> + QObject::sender()-&gt;objectName());
<a name="l01698"></a>01698   QDesktopServices::openUrl(url);
<a name="l01699"></a>01699 }
<a name="l01700"></a>01700 
<a name="l01701"></a><a class="code" href="classQucsApp.html#a584e076e35f99c716d95a7f4af5b52df">01701</a> <span class="keywordtype">void</span> <a class="code" href="classQucsApp.html#a584e076e35f99c716d95a7f4af5b52df">QucsApp::slotHelpReport</a>()
<a name="l01702"></a>01702 {
<a name="l01703"></a>01703   QString path = QDir::toNativeSeparators(<a class="code" href="main_8cpp.html#ac2e3fb7eed4aa9bd981210dc5df2e02e">QucsSettings</a>.<a class="code" href="structtQucsSettings.html#a7af5c780c02bd677400ffb709b238b25">DocDir</a>);
<a name="l01704"></a>01704   QUrl url = QUrl(<span class="stringliteral">&quot;file:///&quot;</span> + path.replace(<span class="stringliteral">&quot;\\&quot;</span>,<span class="stringliteral">&quot;/&quot;</span>) + <span class="stringliteral">&quot;report/&quot;</span> + QObject::sender()-&gt;objectName());
<a name="l01705"></a>01705   QDesktopServices::openUrl(url);
<a name="l01706"></a>01706 }
<a name="l01707"></a>01707 
<a name="l01708"></a>01708 
<a name="l01709"></a>01709 
<a name="l01710"></a>01710 <span class="comment">// --------------------------------------------------------------</span>
<a name="l01711"></a>01711 <span class="comment">// Is called when another document is selected via the TabBar.</span>
<a name="l01712"></a><a class="code" href="classQucsApp.html#a3924e8c4441d1446641f930d7f407bef">01712</a> <span class="keywordtype">void</span> <a class="code" href="classQucsApp.html#a3924e8c4441d1446641f930d7f407bef">QucsApp::slotChangeView</a>(QWidget *w)
<a name="l01713"></a>01713 {
<a name="l01714"></a>01714 
<a name="l01715"></a>01715   <a class="code" href="classQucsApp.html#ab1126a50f9800423f4810a36c688f4ed">editText</a>-&gt;setHidden (<span class="keyword">true</span>); <span class="comment">// disable text edit of component property</span>
<a name="l01716"></a>01716   <a class="code" href="classQucsDoc.html">QucsDoc</a> * Doc;
<a name="l01717"></a>01717   <span class="keywordflow">if</span>(w==NULL)<span class="keywordflow">return</span>;
<a name="l01718"></a>01718   <span class="comment">// for text documents</span>
<a name="l01719"></a>01719   <span class="keywordflow">if</span> (<a class="code" href="classQucsApp.html#aa699c68344d4bd4f53fe90f0ccd4b6ae">isTextDocument</a> (w)) {
<a name="l01720"></a>01720     <a class="code" href="classTextDoc.html" title="The TextDoc class definition.">TextDoc</a> *d = (<a class="code" href="classTextDoc.html" title="The TextDoc class definition.">TextDoc</a>*)w;
<a name="l01721"></a>01721     Doc = (<a class="code" href="classQucsDoc.html">QucsDoc</a>*)d;
<a name="l01722"></a>01722     <span class="comment">// update menu entries, etc. if neccesary</span>
<a name="l01723"></a>01723     <a class="code" href="classQucsApp.html#a73b08155490498997c752bd7a5b86cba">magAll</a>-&gt;setDisabled(<span class="keyword">true</span>);
<a name="l01724"></a>01724     <span class="keywordflow">if</span>(<a class="code" href="classQucsApp.html#ab7a5f5666fdbacbd8d86f409cd5e6720">cursorLeft</a>-&gt;isEnabled())
<a name="l01725"></a>01725       <a class="code" href="classQucsApp.html#ad6b73decde3208e952ca5d916a125c5a">switchSchematicDoc</a> (<span class="keyword">false</span>);
<a name="l01726"></a>01726   }
<a name="l01727"></a>01727   <span class="comment">// for schematic documents</span>
<a name="l01728"></a>01728   <span class="keywordflow">else</span> {
<a name="l01729"></a>01729     <a class="code" href="classSchematic.html">Schematic</a> *d = (<a class="code" href="classSchematic.html">Schematic</a>*)w;
<a name="l01730"></a>01730     Doc = (<a class="code" href="classQucsDoc.html">QucsDoc</a>*)d;
<a name="l01731"></a>01731     <a class="code" href="classQucsApp.html#a73b08155490498997c752bd7a5b86cba">magAll</a>-&gt;setDisabled(<span class="keyword">false</span>);
<a name="l01732"></a>01732     <span class="comment">// already in schematic?</span>
<a name="l01733"></a>01733     <span class="keywordflow">if</span>(<a class="code" href="classQucsApp.html#ab7a5f5666fdbacbd8d86f409cd5e6720">cursorLeft</a>-&gt;isEnabled()) {
<a name="l01734"></a>01734       <span class="comment">// which mode: schematic or symbol editor ?</span>
<a name="l01735"></a>01735       <span class="keywordflow">if</span>((<a class="code" href="classQucsApp.html#a86a11e3dd62788d233346c18a2db158d">CompChoose</a>-&gt;count() &gt; 1) == d-&gt;<a class="code" href="classSchematic.html#a636bb0d04b436b500367a3000701d989">symbolMode</a>)
<a name="l01736"></a>01736         <a class="code" href="classQucsApp.html#a3276d8bf976ce9cbe96880dcb88bfc33">changeSchematicSymbolMode</a> (d);
<a name="l01737"></a>01737     }
<a name="l01738"></a>01738     <span class="keywordflow">else</span> {
<a name="l01739"></a>01739       <a class="code" href="classQucsApp.html#ad6b73decde3208e952ca5d916a125c5a">switchSchematicDoc</a>(<span class="keyword">true</span>);
<a name="l01740"></a>01740       <a class="code" href="classQucsApp.html#a3276d8bf976ce9cbe96880dcb88bfc33">changeSchematicSymbolMode</a>(d);
<a name="l01741"></a>01741     }
<a name="l01742"></a>01742   }
<a name="l01743"></a>01743 
<a name="l01744"></a>01744   Doc-&gt;<a class="code" href="classQucsDoc.html#a855ac5692d3dceacf88e745cc65002b7">becomeCurrent</a>(<span class="keyword">true</span>);
<a name="l01745"></a>01745   <a class="code" href="classQucsApp.html#a372ee1fa475722ca832511027a34c383">view</a>-&gt;<a class="code" href="classMouseActions.html#ad43ee60feb7239ee9692300605dc9aed">drawn</a> = <span class="keyword">false</span>;
<a name="l01746"></a>01746 
<a name="l01747"></a>01747   <a class="code" href="classQucsApp.html#acddec74d7c004fd713aea865b5541171">HierarchyHistory</a>.clear();
<a name="l01748"></a>01748   <a class="code" href="classQucsApp.html#aa1a25f0fedb060643d42a9944c1da8bd">popH</a>-&gt;setEnabled(<span class="keyword">false</span>);
<a name="l01749"></a>01749 }
<a name="l01750"></a>01750 
<a name="l01751"></a>01751 <span class="comment">// --------------------------------------------------------------</span>
<a name="l01752"></a><a class="code" href="classQucsApp.html#a5a1b6254412cd0725a13a2bc3a6aafb3">01752</a> <span class="keywordtype">void</span> <a class="code" href="classQucsApp.html#a5a1b6254412cd0725a13a2bc3a6aafb3">QucsApp::slotFileSettings</a> ()
<a name="l01753"></a>01753 {
<a name="l01754"></a>01754   <a class="code" href="classQucsApp.html#ab1126a50f9800423f4810a36c688f4ed">editText</a>-&gt;setHidden (<span class="keyword">true</span>); <span class="comment">// disable text edit of component property</span>
<a name="l01755"></a>01755 
<a name="l01756"></a>01756   QWidget * w = <a class="code" href="classQucsApp.html#ae7612793599ca4f5106f7e9f488d4225">DocumentTab</a>-&gt;currentWidget ();
<a name="l01757"></a>01757   <span class="keywordflow">if</span> (<a class="code" href="classQucsApp.html#aa699c68344d4bd4f53fe90f0ccd4b6ae">isTextDocument</a> (w)) {
<a name="l01758"></a>01758     <a class="code" href="classQucsDoc.html">QucsDoc</a> * Doc = (<a class="code" href="classQucsDoc.html">QucsDoc</a> *) ((<a class="code" href="classTextDoc.html" title="The TextDoc class definition.">TextDoc</a> *) w);
<a name="l01759"></a>01759     QString ext = Doc-&gt;<a class="code" href="classQucsDoc.html#ac835da875203c51c60e6fd6a3a885b08">fileSuffix</a> ();
<a name="l01760"></a>01760     <span class="comment">// Octave properties</span>
<a name="l01761"></a>01761     <span class="keywordflow">if</span> (ext == <span class="stringliteral">&quot;m&quot;</span> || ext == <span class="stringliteral">&quot;oct&quot;</span>) {
<a name="l01762"></a>01762     }
<a name="l01763"></a>01763     <span class="comment">// Verilog-A properties</span>
<a name="l01764"></a>01764     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ext == <span class="stringliteral">&quot;va&quot;</span>) {
<a name="l01765"></a>01765       <a class="code" href="classVASettingsDialog.html">VASettingsDialog</a> * d = <span class="keyword">new</span> <a class="code" href="classVASettingsDialog.html">VASettingsDialog</a> ((<a class="code" href="classTextDoc.html" title="The TextDoc class definition.">TextDoc</a> *) w);
<a name="l01766"></a>01766       d-&gt;exec ();
<a name="l01767"></a>01767     }
<a name="l01768"></a>01768     <span class="comment">// VHDL and Verilog-HDL properties</span>
<a name="l01769"></a>01769     <span class="keywordflow">else</span> {
<a name="l01770"></a>01770       <a class="code" href="classDigiSettingsDialog.html">DigiSettingsDialog</a> * d = <span class="keyword">new</span> <a class="code" href="classDigiSettingsDialog.html">DigiSettingsDialog</a> ((<a class="code" href="classTextDoc.html" title="The TextDoc class definition.">TextDoc</a> *) w);
<a name="l01771"></a>01771       d-&gt;exec ();
<a name="l01772"></a>01772     }
<a name="l01773"></a>01773   }
<a name="l01774"></a>01774   <span class="comment">// schematic properties</span>
<a name="l01775"></a>01775   <span class="keywordflow">else</span> {
<a name="l01776"></a>01776     <a class="code" href="classSettingsDialog.html">SettingsDialog</a> * d = <span class="keyword">new</span> <a class="code" href="classSettingsDialog.html">SettingsDialog</a> ((<a class="code" href="classSchematic.html">Schematic</a> *) w);
<a name="l01777"></a>01777     d-&gt;exec ();
<a name="l01778"></a>01778   }
<a name="l01779"></a>01779   <a class="code" href="classQucsApp.html#a372ee1fa475722ca832511027a34c383">view</a>-&gt;<a class="code" href="classMouseActions.html#ad43ee60feb7239ee9692300605dc9aed">drawn</a> = <span class="keyword">false</span>;
<a name="l01780"></a>01780 }
<a name="l01781"></a>01781 
<a name="l01782"></a>01782 <span class="comment">// --------------------------------------------------------------</span>
<a name="l01783"></a><a class="code" href="classQucsApp.html#a08ee7b2807735af204f1aa8733619c45">01783</a> <span class="keywordtype">void</span> <a class="code" href="classQucsApp.html#a08ee7b2807735af204f1aa8733619c45">QucsApp::slotApplSettings</a>()
<a name="l01784"></a>01784 {
<a name="l01785"></a>01785   <a class="code" href="classQucsApp.html#acf15a168d7497bc25103174b31019db7">slotHideEdit</a>(); <span class="comment">// disable text edit of component property</span>
<a name="l01786"></a>01786 
<a name="l01787"></a>01787   <a class="code" href="classQucsSettingsDialog.html">QucsSettingsDialog</a> *d = <span class="keyword">new</span> <a class="code" href="classQucsSettingsDialog.html">QucsSettingsDialog</a>(<span class="keyword">this</span>);
<a name="l01788"></a>01788   d-&gt;exec();
<a name="l01789"></a>01789   <a class="code" href="classQucsApp.html#a372ee1fa475722ca832511027a34c383">view</a>-&gt;<a class="code" href="classMouseActions.html#ad43ee60feb7239ee9692300605dc9aed">drawn</a> = <span class="keyword">false</span>;
<a name="l01790"></a>01790 }
<a name="l01791"></a>01791 
<a name="l01792"></a>01792 <span class="comment">// --------------------------------------------------------------</span>
<a name="l01793"></a><a class="code" href="classQucsApp.html#a76573b87bb7d8bb4477e5ff8accfe194">01793</a> <span class="keywordtype">void</span> <a class="code" href="classQucsApp.html#a76573b87bb7d8bb4477e5ff8accfe194">QucsApp::slotRefreshSchPath</a>()
<a name="l01794"></a>01794 {
<a name="l01795"></a>01795   this-&gt;<a class="code" href="classQucsApp.html#ae223813596b54c221cd292adb3b81c0f">updateSchNameHash</a>();
<a name="l01796"></a>01796   this-&gt;<a class="code" href="classQucsApp.html#ad5e4abc792d281a23c167bedbca47a0f">updateSpiceNameHash</a>();
<a name="l01797"></a>01797 
<a name="l01798"></a>01798   statusBar()-&gt;showMessage(tr(<span class="stringliteral">&quot;The schematic search path has been refreshed.&quot;</span>), 2000);
<a name="l01799"></a>01799 }
<a name="l01800"></a>01800 
<a name="l01801"></a>01801 <span class="comment">// --------------------------------------------------------------</span>
<a name="l01802"></a><a class="code" href="classQucsApp.html#a8d660a5a6479c2683e03282a23a42c65">01802</a> <span class="keywordtype">void</span> <a class="code" href="classQucsApp.html#a8d660a5a6479c2683e03282a23a42c65">QucsApp::updatePortNumber</a>(<a class="code" href="classQucsDoc.html">QucsDoc</a> *currDoc, <span class="keywordtype">int</span> No)
<a name="l01803"></a>01803 {
<a name="l01804"></a>01804   <span class="keywordflow">if</span>(No&lt;0) <span class="keywordflow">return</span>;
<a name="l01805"></a>01805 
<a name="l01806"></a>01806   QString <a class="code" href="simmessage_8cpp.html#a8b63824ef8ba3ffe46c56ed6aa56dd3c">pathName</a> = currDoc-&gt;<a class="code" href="classQucsDoc.html#a2d87112c4f75a4770c9311bb6c2d407b">DocName</a>;
<a name="l01807"></a>01807   QString ext = currDoc-&gt;<a class="code" href="classQucsDoc.html#ac835da875203c51c60e6fd6a3a885b08">fileSuffix</a> ();
<a name="l01808"></a>01808   QFileInfo Info (pathName);
<a name="l01809"></a>01809   QString Model, File, Name = Info.fileName();
<a name="l01810"></a>01810 
<a name="l01811"></a>01811   <span class="keywordflow">if</span> (ext == <span class="stringliteral">&quot;sch&quot;</span>) {
<a name="l01812"></a>01812     Model = <span class="stringliteral">&quot;Sub&quot;</span>;
<a name="l01813"></a>01813   }
<a name="l01814"></a>01814   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ext == <span class="stringliteral">&quot;vhdl&quot;</span> || ext == <span class="stringliteral">&quot;vhd&quot;</span>) {
<a name="l01815"></a>01815     Model = <span class="stringliteral">&quot;VHDL&quot;</span>;
<a name="l01816"></a>01816   }
<a name="l01817"></a>01817   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ext == <span class="stringliteral">&quot;v&quot;</span>) {
<a name="l01818"></a>01818     Model = <span class="stringliteral">&quot;Verilog&quot;</span>;
<a name="l01819"></a>01819   }
<a name="l01820"></a>01820 
<a name="l01821"></a>01821   <span class="comment">// update all occurencies of subcircuit in all open documents</span>
<a name="l01822"></a>01822   No = 0;
<a name="l01823"></a>01823   QWidget *w;
<a name="l01824"></a>01824   <a class="code" href="classComponent.html" title="The Component class implements a generic analog component.">Component</a> *pc_tmp;
<a name="l01825"></a>01825   <span class="keywordflow">while</span>((w=<a class="code" href="classQucsApp.html#ae7612793599ca4f5106f7e9f488d4225">DocumentTab</a>-&gt;widget(No++)) != 0) {
<a name="l01826"></a>01826     <span class="keywordflow">if</span>(<a class="code" href="classQucsApp.html#aa699c68344d4bd4f53fe90f0ccd4b6ae">isTextDocument</a> (w))  <span class="keywordflow">continue</span>;
<a name="l01827"></a>01827 
<a name="l01828"></a>01828     <span class="comment">// start from the last to omit re-appended components</span>
<a name="l01829"></a>01829     <a class="code" href="classSchematic.html">Schematic</a> *Doc = (<a class="code" href="classSchematic.html">Schematic</a>*)w;
<a name="l01830"></a>01830     <span class="keywordflow">for</span>(<a class="code" href="classComponent.html" title="The Component class implements a generic analog component.">Component</a> *pc=Doc-&gt;<a class="code" href="classSchematic.html#acd5caf411c6ff28a706286e42ac9a5ae">Components</a>-&gt;last(); pc!=0; ) {
<a name="l01831"></a>01831       <span class="keywordflow">if</span>(pc-&gt;Model == Model) {
<a name="l01832"></a>01832         File = pc-&gt;Props.getFirst()-&gt;Value;
<a name="l01833"></a>01833         <span class="keywordflow">if</span>((File == pathName) || (File == Name)) {
<a name="l01834"></a>01834           pc_tmp = Doc-&gt;<a class="code" href="classSchematic.html#acd5caf411c6ff28a706286e42ac9a5ae">Components</a>-&gt;prev();
<a name="l01835"></a>01835           Doc-&gt;<a class="code" href="classSchematic.html#a377a769183e90c6b813cfe2d27921a48">recreateComponent</a>(pc);  <span class="comment">// delete and re-append component</span>
<a name="l01836"></a>01836           <span class="keywordflow">if</span>(!pc_tmp)  <span class="keywordflow">break</span>;
<a name="l01837"></a>01837           Doc-&gt;<a class="code" href="classSchematic.html#acd5caf411c6ff28a706286e42ac9a5ae">Components</a>-&gt;findRef(pc_tmp);
<a name="l01838"></a>01838           pc = Doc-&gt;<a class="code" href="classSchematic.html#acd5caf411c6ff28a706286e42ac9a5ae">Components</a>-&gt;current();
<a name="l01839"></a>01839           <span class="keywordflow">continue</span>;
<a name="l01840"></a>01840         }
<a name="l01841"></a>01841       }
<a name="l01842"></a>01842       pc = Doc-&gt;<a class="code" href="classSchematic.html#acd5caf411c6ff28a706286e42ac9a5ae">Components</a>-&gt;prev();
<a name="l01843"></a>01843     }
<a name="l01844"></a>01844   }
<a name="l01845"></a>01845 }
<a name="l01846"></a>01846 
<a name="l01847"></a>01847 
<a name="l01848"></a>01848 <span class="comment">// --------------------------------------------------------------</span>
<a name="l01849"></a>01849 <span class="comment">// printCurrentDocument: call printerwriter to print document</span>
<a name="l01850"></a><a class="code" href="classQucsApp.html#a760ead47ff72ea5d9389411ba3392443">01850</a> <span class="keywordtype">void</span> <a class="code" href="classQucsApp.html#a760ead47ff72ea5d9389411ba3392443">QucsApp::printCurrentDocument</a>(<span class="keywordtype">bool</span> fitToPage)
<a name="l01851"></a>01851 {
<a name="l01852"></a>01852   statusBar()-&gt;showMessage(tr(<span class="stringliteral">&quot;Printing...&quot;</span>));
<a name="l01853"></a>01853   <a class="code" href="classQucsApp.html#acf15a168d7497bc25103174b31019db7">slotHideEdit</a>(); <span class="comment">// disable text edit of component property</span>
<a name="l01854"></a>01854 
<a name="l01855"></a>01855   PrinterWriter *writer = <span class="keyword">new</span> PrinterWriter();
<a name="l01856"></a>01856   writer-&gt;setFitToPage(fitToPage);
<a name="l01857"></a>01857   writer-&gt;print(<a class="code" href="classQucsApp.html#ae7612793599ca4f5106f7e9f488d4225">DocumentTab</a>-&gt;currentWidget());
<a name="l01858"></a>01858   <span class="keyword">delete</span> writer;
<a name="l01859"></a>01859 
<a name="l01860"></a>01860   statusBar()-&gt;showMessage(tr(<span class="stringliteral">&quot;Ready.&quot;</span>));
<a name="l01861"></a>01861   <span class="keywordflow">return</span>;
<a name="l01862"></a>01862 }
<a name="l01863"></a>01863 
<a name="l01864"></a>01864 <span class="comment">// --------------------------------------------------------------</span>
<a name="l01865"></a><a class="code" href="classQucsApp.html#a36383815eb53226d188538d202bc6fa1">01865</a> <span class="keywordtype">void</span> <a class="code" href="classQucsApp.html#a36383815eb53226d188538d202bc6fa1">QucsApp::slotFilePrint</a>()
<a name="l01866"></a>01866 {
<a name="l01867"></a>01867   <a class="code" href="classQucsApp.html#a760ead47ff72ea5d9389411ba3392443">printCurrentDocument</a>(<span class="keyword">false</span>);
<a name="l01868"></a>01868 }
<a name="l01869"></a>01869 
<a name="l01870"></a>01870 <span class="comment">// --------------------------------------------------------------</span>
<a name="l01871"></a>01871 <span class="comment">// Fit printed content to page size.</span>
<a name="l01872"></a><a class="code" href="classQucsApp.html#a869d49c05dc9aefa25ff7fdc09863b46">01872</a> <span class="keywordtype">void</span> <a class="code" href="classQucsApp.html#a869d49c05dc9aefa25ff7fdc09863b46">QucsApp::slotFilePrintFit</a>()
<a name="l01873"></a>01873 {
<a name="l01874"></a>01874   <a class="code" href="classQucsApp.html#a760ead47ff72ea5d9389411ba3392443">printCurrentDocument</a>(<span class="keyword">true</span>);
<a name="l01875"></a>01875 }
<a name="l01876"></a>01876 
<a name="l01877"></a>01877 <span class="comment">// --------------------------------------------------------------------</span>
<a name="l01878"></a>01878 <span class="comment">// Exits the application.</span>
<a name="l01879"></a><a class="code" href="classQucsApp.html#aab7583467ac302f3ffe60be9f02b58c7">01879</a> <span class="keywordtype">void</span> <a class="code" href="classQucsApp.html#aab7583467ac302f3ffe60be9f02b58c7">QucsApp::slotFileQuit</a>()
<a name="l01880"></a>01880 {
<a name="l01881"></a>01881   statusBar()-&gt;showMessage(tr(<span class="stringliteral">&quot;Exiting application...&quot;</span>));
<a name="l01882"></a>01882   <a class="code" href="classQucsApp.html#acf15a168d7497bc25103174b31019db7">slotHideEdit</a>(); <span class="comment">// disable text edit of component property</span>
<a name="l01883"></a>01883 
<a name="l01884"></a>01884   <span class="keywordtype">int</span> exit = QMessageBox::information(<span class="keyword">this</span>,
<a name="l01885"></a>01885       tr(<span class="stringliteral">&quot;Quit...&quot;</span>), tr(<span class="stringliteral">&quot;Do you really want to quit?&quot;</span>),
<a name="l01886"></a>01886       tr(<span class="stringliteral">&quot;Yes&quot;</span>), tr(<span class="stringliteral">&quot;No&quot;</span>));
<a name="l01887"></a>01887 
<a name="l01888"></a>01888   <span class="keywordflow">if</span>(exit == 0)
<a name="l01889"></a>01889     <span class="keywordflow">if</span>(<a class="code" href="classQucsApp.html#ad879e6b32e2ea281a177c409a8c01b5a">closeAllFiles</a>()) {
<a name="l01890"></a>01890       emit <a class="code" href="classQucsApp.html#a2be08107300ffb12568bb84584bd5afb">signalKillEmAll</a>();   <span class="comment">// kill all subprocesses</span>
<a name="l01891"></a>01891       qApp-&gt;quit();
<a name="l01892"></a>01892     }
<a name="l01893"></a>01893 
<a name="l01894"></a>01894   statusBar()-&gt;showMessage(tr(<span class="stringliteral">&quot;Ready.&quot;</span>));
<a name="l01895"></a>01895 }
<a name="l01896"></a>01896 
<a name="l01897"></a>01897 <span class="comment">//-----------------------------------------------------------------</span>
<a name="l01898"></a>01898 <span class="comment">// To get all close events.</span>
<a name="l01899"></a><a class="code" href="classQucsApp.html#aff9e366f27d3e20a0c00a24d673659ff">01899</a> <span class="keywordtype">void</span> <a class="code" href="classQucsApp.html#aff9e366f27d3e20a0c00a24d673659ff">QucsApp::closeEvent</a>(QCloseEvent* Event)
<a name="l01900"></a>01900 {
<a name="l01901"></a>01901     qDebug()&lt;&lt;<span class="stringliteral">&quot;x&quot;</span>&lt;&lt;pos().x()&lt;&lt;<span class="stringliteral">&quot; ,y&quot;</span>&lt;&lt;pos().y();
<a name="l01902"></a>01902     qDebug()&lt;&lt;<span class="stringliteral">&quot;dx&quot;</span>&lt;&lt;size().width()&lt;&lt;<span class="stringliteral">&quot; ,dy&quot;</span>&lt;&lt;size().height();
<a name="l01903"></a>01903     <a class="code" href="main_8cpp.html#ac2e3fb7eed4aa9bd981210dc5df2e02e">QucsSettings</a>.<a class="code" href="structtQucsSettings.html#a34b9641cbb3adcaba31bec3507e695e3">x</a>=pos().x();
<a name="l01904"></a>01904     <a class="code" href="main_8cpp.html#ac2e3fb7eed4aa9bd981210dc5df2e02e">QucsSettings</a>.<a class="code" href="structtQucsSettings.html#adc432431bd5891432d2b73d8901ff916">y</a>=pos().y();
<a name="l01905"></a>01905     <a class="code" href="main_8cpp.html#ac2e3fb7eed4aa9bd981210dc5df2e02e">QucsSettings</a>.<a class="code" href="structtQucsSettings.html#a6bff4be70a3e6001e742ec4db039c024">dx</a>=size().width();
<a name="l01906"></a>01906     <a class="code" href="main_8cpp.html#ac2e3fb7eed4aa9bd981210dc5df2e02e">QucsSettings</a>.<a class="code" href="structtQucsSettings.html#a4ad269745402329daddb963783c44157">dy</a>=size().height();
<a name="l01907"></a>01907     <a class="code" href="main_8cpp.html#ac098ff9b0c6f802244401565ee6894e8">saveApplSettings</a>();
<a name="l01908"></a>01908 
<a name="l01909"></a>01909    <span class="keywordflow">if</span>(<a class="code" href="classQucsApp.html#ad879e6b32e2ea281a177c409a8c01b5a">closeAllFiles</a>()) {
<a name="l01910"></a>01910       emit <a class="code" href="classQucsApp.html#a2be08107300ffb12568bb84584bd5afb">signalKillEmAll</a>();   <span class="comment">// kill all subprocesses</span>
<a name="l01911"></a>01911       Event-&gt;accept();
<a name="l01912"></a>01912       qApp-&gt;quit();
<a name="l01913"></a>01913    }
<a name="l01914"></a>01914    <span class="keywordflow">else</span>
<a name="l01915"></a>01915       Event-&gt;ignore();
<a name="l01916"></a>01916 }
<a name="l01917"></a>01917 
<a name="l01918"></a>01918 <span class="comment">// --------------------------------------------------------------------</span>
<a name="l01919"></a>01919 <span class="comment">// Is called when the toolbar button is pressed to go into a subcircuit.</span>
<a name="l01920"></a><a class="code" href="classQucsApp.html#aaa932be969df0dc6f0e60d7e192744fe">01920</a> <span class="keywordtype">void</span> <a class="code" href="classQucsApp.html#aaa932be969df0dc6f0e60d7e192744fe">QucsApp::slotIntoHierarchy</a>()
<a name="l01921"></a>01921 {
<a name="l01922"></a>01922   <a class="code" href="classQucsApp.html#acf15a168d7497bc25103174b31019db7">slotHideEdit</a>(); <span class="comment">// disable text edit of component property</span>
<a name="l01923"></a>01923 
<a name="l01924"></a>01924   <a class="code" href="classSchematic.html">Schematic</a> *Doc = (<a class="code" href="classSchematic.html">Schematic</a>*)<a class="code" href="classQucsApp.html#ae7612793599ca4f5106f7e9f488d4225">DocumentTab</a>-&gt;currentWidget();
<a name="l01925"></a>01925   <a class="code" href="classComponent.html" title="The Component class implements a generic analog component.">Component</a> *pc = Doc-&gt;<a class="code" href="classSchematic.html#af70737f9e8cb3b38415f45cc3a1fa201">searchSelSubcircuit</a>();
<a name="l01926"></a>01926   <span class="keywordflow">if</span>(pc == 0) { <span class="keywordflow">return</span>; }
<a name="l01927"></a>01927 
<a name="l01928"></a>01928   QString s = pc-&gt;<a class="code" href="classComponent.html#ab9215e47cb5acea835a44302fd488c8c">getSubcircuitFile</a>();
<a name="l01929"></a>01929   <span class="keywordflow">if</span>(!<a class="code" href="classQucsApp.html#aaaeffebcd5551096a2c6261d4bfc5636">gotoPage</a>(s)) { <span class="keywordflow">return</span>; }
<a name="l01930"></a>01930 
<a name="l01931"></a>01931   <a class="code" href="classQucsApp.html#acddec74d7c004fd713aea865b5541171">HierarchyHistory</a>.push(Doc-&gt;<a class="code" href="classQucsDoc.html#a2d87112c4f75a4770c9311bb6c2d407b">DocName</a>); <span class="comment">//remember for the way back</span>
<a name="l01932"></a>01932   <a class="code" href="classQucsApp.html#aa1a25f0fedb060643d42a9944c1da8bd">popH</a>-&gt;setEnabled(<span class="keyword">true</span>);
<a name="l01933"></a>01933 }
<a name="l01934"></a>01934 
<a name="l01935"></a>01935 <span class="comment">// --------------------------------------------------------------------</span>
<a name="l01936"></a>01936 <span class="comment">// Is called when the toolbar button is pressed to leave a subcircuit.</span>
<a name="l01937"></a><a class="code" href="classQucsApp.html#a8d67b91c463a0cb89d93d39c90c8efff">01937</a> <span class="keywordtype">void</span> <a class="code" href="classQucsApp.html#a8d67b91c463a0cb89d93d39c90c8efff">QucsApp::slotPopHierarchy</a>()
<a name="l01938"></a>01938 {
<a name="l01939"></a>01939   <a class="code" href="classQucsApp.html#acf15a168d7497bc25103174b31019db7">slotHideEdit</a>(); <span class="comment">// disable text edit of component property</span>
<a name="l01940"></a>01940 
<a name="l01941"></a>01941   <span class="keywordflow">if</span>(<a class="code" href="classQucsApp.html#acddec74d7c004fd713aea865b5541171">HierarchyHistory</a>.size() == 0) <span class="keywordflow">return</span>;
<a name="l01942"></a>01942 
<a name="l01943"></a>01943   QString Doc = <a class="code" href="classQucsApp.html#acddec74d7c004fd713aea865b5541171">HierarchyHistory</a>.pop();
<a name="l01944"></a>01944 
<a name="l01945"></a>01945   <span class="keywordflow">if</span>(!<a class="code" href="classQucsApp.html#aaaeffebcd5551096a2c6261d4bfc5636">gotoPage</a>(Doc)) {
<a name="l01946"></a>01946     <a class="code" href="classQucsApp.html#acddec74d7c004fd713aea865b5541171">HierarchyHistory</a>.push(Doc);
<a name="l01947"></a>01947     <span class="keywordflow">return</span>;
<a name="l01948"></a>01948   }
<a name="l01949"></a>01949 
<a name="l01950"></a>01950   <span class="keywordflow">if</span>(<a class="code" href="classQucsApp.html#acddec74d7c004fd713aea865b5541171">HierarchyHistory</a>.size() == 0) {
<a name="l01951"></a>01951     <a class="code" href="classQucsApp.html#aa1a25f0fedb060643d42a9944c1da8bd">popH</a>-&gt;setEnabled(<span class="keyword">false</span>);
<a name="l01952"></a>01952   }
<a name="l01953"></a>01953 }
<a name="l01954"></a>01954 
<a name="l01955"></a>01955 <span class="comment">// --------------------------------------------------------------</span>
<a name="l01956"></a><a class="code" href="classQucsApp.html#a377ae86d524802b6bdc7e6ce562b5484">01956</a> <span class="keywordtype">void</span> <a class="code" href="classQucsApp.html#a377ae86d524802b6bdc7e6ce562b5484">QucsApp::slotShowAll</a>()
<a name="l01957"></a>01957 {
<a name="l01958"></a>01958   <a class="code" href="classQucsApp.html#acf15a168d7497bc25103174b31019db7">slotHideEdit</a>(); <span class="comment">// disable text edit of component property</span>
<a name="l01959"></a>01959   <a class="code" href="classQucsApp.html#a5a91682ea446a8a35c039c5ea233b587">getDoc</a>()-&gt;<a class="code" href="classQucsDoc.html#adf7a5beb33eacbadc49b61f06c929e2a">showAll</a>();
<a name="l01960"></a>01960 }
<a name="l01961"></a>01961 
<a name="l01962"></a>01962 <span class="comment">// -----------------------------------------------------------</span>
<a name="l01963"></a>01963 <span class="comment">// Sets the scale factor to 1.</span>
<a name="l01964"></a><a class="code" href="classQucsApp.html#ad46c182b68541198eaec59075ef1d0e8">01964</a> <span class="keywordtype">void</span> <a class="code" href="classQucsApp.html#ad46c182b68541198eaec59075ef1d0e8">QucsApp::slotShowOne</a>()
<a name="l01965"></a>01965 {
<a name="l01966"></a>01966   <a class="code" href="classQucsApp.html#acf15a168d7497bc25103174b31019db7">slotHideEdit</a>(); <span class="comment">// disable text edit of component property</span>
<a name="l01967"></a>01967   <a class="code" href="classQucsApp.html#a5a91682ea446a8a35c039c5ea233b587">getDoc</a>()-&gt;<a class="code" href="classQucsDoc.html#a4e2c4895d06d2fd5b93c75ca6bd99365">showNoZoom</a>();
<a name="l01968"></a>01968 }
<a name="l01969"></a>01969 
<a name="l01970"></a>01970 <span class="comment">// -----------------------------------------------------------</span>
<a name="l01971"></a><a class="code" href="classQucsApp.html#a3a9a54c6b0c4768f3fc71dd7fc6530d9">01971</a> <span class="keywordtype">void</span> <a class="code" href="classQucsApp.html#a3a9a54c6b0c4768f3fc71dd7fc6530d9">QucsApp::slotZoomOut</a>()
<a name="l01972"></a>01972 {
<a name="l01973"></a>01973   <a class="code" href="classQucsApp.html#acf15a168d7497bc25103174b31019db7">slotHideEdit</a>(); <span class="comment">// disable text edit of component property</span>
<a name="l01974"></a>01974   <a class="code" href="classQucsApp.html#a5a91682ea446a8a35c039c5ea233b587">getDoc</a>()-&gt;<a class="code" href="classQucsDoc.html#a0db1d0ad534188792cc332d168d77c9f">zoomBy</a>(0.5f);
<a name="l01975"></a>01975 }
<a name="l01976"></a>01976 
<a name="l01977"></a>01977 
<a name="l01982"></a><a class="code" href="classQucsApp.html#a3410fb2573a3801b533f6532183e3f8e">01982</a> <span class="keywordtype">void</span> <a class="code" href="classQucsApp.html#a3410fb2573a3801b533f6532183e3f8e" title="QucsApp::slotSimulate is called when the simulate toolbar button is pressed.">QucsApp::slotSimulate</a>()
<a name="l01983"></a>01983 {
<a name="l01984"></a>01984   <a class="code" href="classQucsApp.html#acf15a168d7497bc25103174b31019db7">slotHideEdit</a>(); <span class="comment">// disable text edit of component property</span>
<a name="l01985"></a>01985 
<a name="l01986"></a>01986   <a class="code" href="classQucsDoc.html">QucsDoc</a> *Doc;
<a name="l01987"></a>01987   QWidget *w = <a class="code" href="classQucsApp.html#ae7612793599ca4f5106f7e9f488d4225">DocumentTab</a>-&gt;currentWidget();
<a name="l01988"></a>01988   <span class="keywordflow">if</span>(<a class="code" href="classQucsApp.html#aa699c68344d4bd4f53fe90f0ccd4b6ae">isTextDocument</a> (w)) {
<a name="l01989"></a>01989     Doc = (<a class="code" href="classQucsDoc.html">QucsDoc</a>*)((<a class="code" href="classTextDoc.html" title="The TextDoc class definition.">TextDoc</a>*)w);
<a name="l01990"></a>01990     <span class="keywordflow">if</span>(Doc-&gt;<a class="code" href="classQucsDoc.html#afb106714ab8031b541f7fbf0a0f4ed29">SimTime</a>.isEmpty() &amp;&amp; ((<a class="code" href="classTextDoc.html" title="The TextDoc class definition.">TextDoc</a>*)Doc)-&gt;simulation) {
<a name="l01991"></a>01991       <a class="code" href="classDigiSettingsDialog.html">DigiSettingsDialog</a> *d = <span class="keyword">new</span> <a class="code" href="classDigiSettingsDialog.html">DigiSettingsDialog</a>((<a class="code" href="classTextDoc.html" title="The TextDoc class definition.">TextDoc</a>*)Doc);
<a name="l01992"></a>01992       <span class="keywordflow">if</span>(d-&gt;exec() == QDialog::Rejected)
<a name="l01993"></a>01993   <span class="keywordflow">return</span>;
<a name="l01994"></a>01994     }
<a name="l01995"></a>01995   }
<a name="l01996"></a>01996   <span class="keywordflow">else</span>
<a name="l01997"></a>01997     Doc = (<a class="code" href="classQucsDoc.html">QucsDoc</a>*)((<a class="code" href="classSchematic.html">Schematic</a>*)w);
<a name="l01998"></a>01998 
<a name="l01999"></a>01999   <span class="keywordflow">if</span>(Doc-&gt;<a class="code" href="classQucsDoc.html#a2d87112c4f75a4770c9311bb6c2d407b">DocName</a>.isEmpty()) <span class="comment">// if document &#39;untitled&#39; ...</span>
<a name="l02000"></a>02000     <span class="keywordflow">if</span>(!<a class="code" href="classQucsApp.html#aceaecb4d84e675e470037afd19135d32">saveAs</a>()) <span class="keywordflow">return</span>;    <span class="comment">// ... save schematic before</span>
<a name="l02001"></a>02001 
<a name="l02002"></a>02002   <span class="comment">// Perhaps the document was modified from another program ?</span>
<a name="l02003"></a>02003   QFileInfo Info(Doc-&gt;<a class="code" href="classQucsDoc.html#a2d87112c4f75a4770c9311bb6c2d407b">DocName</a>);
<a name="l02004"></a>02004   <span class="keywordflow">if</span>(Doc-&gt;<a class="code" href="classQucsDoc.html#a090d0ae3b26c16265635b51cab8daf67">lastSaved</a>.isValid()) {
<a name="l02005"></a>02005     <span class="keywordflow">if</span>(Doc-&gt;<a class="code" href="classQucsDoc.html#a090d0ae3b26c16265635b51cab8daf67">lastSaved</a> &lt; Info.lastModified()) {
<a name="l02006"></a>02006       <span class="keywordtype">int</span> No = QMessageBox::warning(<span class="keyword">this</span>, tr(<span class="stringliteral">&quot;Warning&quot;</span>),
<a name="l02007"></a>02007                tr(<span class="stringliteral">&quot;The document was modified by another program !&quot;</span>) + <span class="charliteral">&#39;\n&#39;</span> +
<a name="l02008"></a>02008                tr(<span class="stringliteral">&quot;Do you want to reload or keep this version ?&quot;</span>),
<a name="l02009"></a>02009                tr(<span class="stringliteral">&quot;Reload&quot;</span>), tr(<span class="stringliteral">&quot;Keep it&quot;</span>));
<a name="l02010"></a>02010       <span class="keywordflow">if</span>(No == 0)
<a name="l02011"></a>02011         Doc-&gt;<a class="code" href="classQucsDoc.html#abaac4e6662cca0c496bf665fd3d893e3">load</a>();
<a name="l02012"></a>02012     }
<a name="l02013"></a>02013   }
<a name="l02014"></a>02014 
<a name="l02015"></a>02015   <a class="code" href="classQucsApp.html#a52975f3e54d3100585a2fd3db0f11f3c">slotResetWarnings</a>();
<a name="l02016"></a>02016 
<a name="l02017"></a>02017   <span class="keywordflow">if</span>(Info.suffix() == <span class="stringliteral">&quot;m&quot;</span> || Info.suffix() == <span class="stringliteral">&quot;oct&quot;</span>) {
<a name="l02018"></a>02018     <span class="comment">// It is an Octave script.</span>
<a name="l02019"></a>02019     <span class="keywordflow">if</span>(Doc-&gt;<a class="code" href="classQucsDoc.html#add1f5816d2da623e61ac7cff6397f7af">DocChanged</a>)
<a name="l02020"></a>02020       Doc-&gt;<a class="code" href="classQucsDoc.html#ac6adc86a294176c8c62e44de65e5f509">save</a>();
<a name="l02021"></a>02021     <a class="code" href="classQucsApp.html#a7abb07ce8bfbdd6bb4299a7bfd8c7aae">slotViewOctaveDock</a>(<span class="keyword">true</span>);
<a name="l02022"></a>02022     <a class="code" href="classQucsApp.html#a2442034cd3aa8a3fef9f1abf70633a0b">octave</a>-&gt;<a class="code" href="classOctaveWindow.html#accdba05ee21aa5fdbaeb2ac9dfaa24eb">runOctaveScript</a>(Doc-&gt;<a class="code" href="classQucsDoc.html#a2d87112c4f75a4770c9311bb6c2d407b">DocName</a>);
<a name="l02023"></a>02023     <span class="keywordflow">return</span>;
<a name="l02024"></a>02024   }
<a name="l02025"></a>02025 
<a name="l02026"></a>02026   <a class="code" href="classSimMessage.html">SimMessage</a> *sim = <span class="keyword">new</span> <a class="code" href="classSimMessage.html">SimMessage</a>(w, <span class="keyword">this</span>);
<a name="l02027"></a>02027   <span class="comment">// disconnect is automatically performed, if one of the involved objects</span>
<a name="l02028"></a>02028   <span class="comment">// is destroyed !</span>
<a name="l02029"></a>02029   connect(sim, SIGNAL(SimulationEnded(<span class="keywordtype">int</span>, <a class="code" href="classSimMessage.html">SimMessage</a>*)), <span class="keyword">this</span>,
<a name="l02030"></a>02030     SLOT(<a class="code" href="classQucsApp.html#a26a185183ba4662fe20541cd76f3dd35">slotAfterSimulation</a>(<span class="keywordtype">int</span>, <a class="code" href="classSimMessage.html">SimMessage</a>*)));
<a name="l02031"></a>02031   connect(sim, SIGNAL(displayDataPage(QString&amp;, QString&amp;)),
<a name="l02032"></a>02032     <span class="keyword">this</span>, SLOT(<a class="code" href="classQucsApp.html#a02a4d768683eb57a7f45d22e57478477">slotChangePage</a>(QString&amp;, QString&amp;)));
<a name="l02033"></a>02033 
<a name="l02034"></a>02034   sim-&gt;show();
<a name="l02035"></a>02035   <span class="keywordflow">if</span>(!sim-&gt;<a class="code" href="classSimMessage.html#ab89cfc80180d3f63df993a5b0efff3e3">startProcess</a>()) <span class="keywordflow">return</span>;
<a name="l02036"></a>02036 
<a name="l02037"></a>02037   <span class="comment">// to kill it before qucs ends</span>
<a name="l02038"></a>02038   connect(<span class="keyword">this</span>, SIGNAL(<a class="code" href="classQucsApp.html#a2be08107300ffb12568bb84584bd5afb">signalKillEmAll</a>()), sim, SLOT(slotClose()));
<a name="l02039"></a>02039 }
<a name="l02040"></a>02040 
<a name="l02041"></a>02041 <span class="comment">// ------------------------------------------------------------------------</span>
<a name="l02042"></a>02042 <span class="comment">// Is called after the simulation process terminates.</span>
<a name="l02043"></a><a class="code" href="classQucsApp.html#a26a185183ba4662fe20541cd76f3dd35">02043</a> <span class="keywordtype">void</span> <a class="code" href="classQucsApp.html#a26a185183ba4662fe20541cd76f3dd35">QucsApp::slotAfterSimulation</a>(<span class="keywordtype">int</span> Status, <a class="code" href="classSimMessage.html">SimMessage</a> *sim)
<a name="l02044"></a>02044 {
<a name="l02045"></a>02045   <span class="keywordflow">if</span>(Status != 0) <span class="keywordflow">return</span>;  <span class="comment">// errors ocurred ?</span>
<a name="l02046"></a>02046 
<a name="l02047"></a>02047   <span class="keywordflow">if</span>(sim-&gt;<a class="code" href="classSimMessage.html#a1e23014b4cfa9fc821bc61f62895fc7e">ErrText</a>-&gt;document()-&gt;lineCount() &gt; 1)   <span class="comment">// were there warnings ?</span>
<a name="l02048"></a>02048     <a class="code" href="classQucsApp.html#a0833a1d89e2b40293e7e077ef3f0b7dd">slotShowWarnings</a>();
<a name="l02049"></a>02049 
<a name="l02050"></a>02050   <span class="keywordtype">int</span> i=0;
<a name="l02051"></a>02051   QWidget *w;  <span class="comment">// search, if page is still open</span>
<a name="l02052"></a>02052   <span class="keywordflow">while</span>((w=<a class="code" href="classQucsApp.html#ae7612793599ca4f5106f7e9f488d4225">DocumentTab</a>-&gt;widget(i++)) != 0)
<a name="l02053"></a>02053     <span class="keywordflow">if</span>(w == sim-&gt;<a class="code" href="classSimMessage.html#a36c5e19a92ce674e5a08f663bcd3791e">DocWidget</a>)
<a name="l02054"></a>02054       <span class="keywordflow">break</span>;
<a name="l02055"></a>02055 
<a name="l02056"></a>02056   <span class="keywordflow">if</span>(sim-&gt;<a class="code" href="classSimMessage.html#a19ee525eb1300b8b1a685716a5eca46e">showBias</a> == 0) {  <span class="comment">// paint dc bias into schematic ?</span>
<a name="l02057"></a>02057     sim-&gt;<a class="code" href="classSimMessage.html#adf4e72c5a1070baf790b48e0d30d0cae" title="Close and delete simulation dialog.">slotClose</a>();   <span class="comment">// close and delete simulation window</span>
<a name="l02058"></a>02058     <span class="keywordflow">if</span>(w) {  <span class="comment">// schematic still open ?</span>
<a name="l02059"></a>02059       <a class="code" href="classSweepDialog.html">SweepDialog</a> *Dia = <span class="keyword">new</span> <a class="code" href="classSweepDialog.html">SweepDialog</a>((<a class="code" href="classSchematic.html">Schematic</a>*)sim-&gt;<a class="code" href="classSimMessage.html#a36c5e19a92ce674e5a08f663bcd3791e">DocWidget</a>);
<a name="l02060"></a>02060 
<a name="l02061"></a>02061       <span class="comment">// silence warning about unused variable.</span>
<a name="l02062"></a>02062       Q_UNUSED(Dia)
<a name="l02063"></a>02063     }
<a name="l02064"></a>02064   }
<a name="l02065"></a>02065   <span class="keywordflow">else</span> {
<a name="l02066"></a>02066     <span class="keywordflow">if</span>(sim-&gt;<a class="code" href="classSimMessage.html#a992860a43ff7feed8c924be11d8c0921">SimRunScript</a>) {
<a name="l02067"></a>02067       <span class="comment">// run script</span>
<a name="l02068"></a>02068       <a class="code" href="classQucsApp.html#a2442034cd3aa8a3fef9f1abf70633a0b">octave</a>-&gt;<a class="code" href="classOctaveWindow.html#ae418d89d318a429319be03ea42cceb07">startOctave</a>();
<a name="l02069"></a>02069       <a class="code" href="classQucsApp.html#a2442034cd3aa8a3fef9f1abf70633a0b">octave</a>-&gt;<a class="code" href="classOctaveWindow.html#accdba05ee21aa5fdbaeb2ac9dfaa24eb">runOctaveScript</a>(sim-&gt;<a class="code" href="classSimMessage.html#a6e730a06ee74b4f3b51a5ecc5d8a3c5f">Script</a>);
<a name="l02070"></a>02070     }
<a name="l02071"></a>02071     <span class="keywordflow">if</span>(sim-&gt;<a class="code" href="classSimMessage.html#aef7a62d1ca52bfa40a3ceeca4790ae80">SimOpenDpl</a>) {
<a name="l02072"></a>02072       <span class="comment">// switch to data display</span>
<a name="l02073"></a>02073       <span class="keywordflow">if</span>(sim-&gt;<a class="code" href="classSimMessage.html#aeb3edab205a4475e9b93a6edb968d339">DataDisplay</a>.right(2) == <span class="stringliteral">&quot;.m&quot;</span> ||
<a name="l02074"></a>02074    sim-&gt;<a class="code" href="classSimMessage.html#aeb3edab205a4475e9b93a6edb968d339">DataDisplay</a>.right(4) == <span class="stringliteral">&quot;.oct&quot;</span>) {  <span class="comment">// Is it an Octave script?</span>
<a name="l02075"></a>02075   <a class="code" href="classQucsApp.html#a2442034cd3aa8a3fef9f1abf70633a0b">octave</a>-&gt;<a class="code" href="classOctaveWindow.html#ae418d89d318a429319be03ea42cceb07">startOctave</a>();
<a name="l02076"></a>02076   <a class="code" href="classQucsApp.html#a2442034cd3aa8a3fef9f1abf70633a0b">octave</a>-&gt;<a class="code" href="classOctaveWindow.html#accdba05ee21aa5fdbaeb2ac9dfaa24eb">runOctaveScript</a>(sim-&gt;<a class="code" href="classSimMessage.html#aeb3edab205a4475e9b93a6edb968d339">DataDisplay</a>);
<a name="l02077"></a>02077       }
<a name="l02078"></a>02078       <span class="keywordflow">else</span>
<a name="l02079"></a>02079   <a class="code" href="classQucsApp.html#a02a4d768683eb57a7f45d22e57478477">slotChangePage</a>(sim-&gt;<a class="code" href="classSimMessage.html#aec017aa352bde80dc01788acc9b405dc">DocName</a>, sim-&gt;<a class="code" href="classSimMessage.html#aeb3edab205a4475e9b93a6edb968d339">DataDisplay</a>);
<a name="l02080"></a>02080       sim-&gt;<a class="code" href="classSimMessage.html#adf4e72c5a1070baf790b48e0d30d0cae" title="Close and delete simulation dialog.">slotClose</a>();   <span class="comment">// close and delete simulation window</span>
<a name="l02081"></a>02081     }
<a name="l02082"></a>02082     <span class="keywordflow">else</span>
<a name="l02083"></a>02083       <span class="keywordflow">if</span>(w) <span class="keywordflow">if</span>(!<a class="code" href="classQucsApp.html#aa699c68344d4bd4f53fe90f0ccd4b6ae">isTextDocument</a> (sim-&gt;<a class="code" href="classSimMessage.html#a36c5e19a92ce674e5a08f663bcd3791e">DocWidget</a>))
<a name="l02084"></a>02084   <span class="comment">// load recent simulation data (if document is still open)</span>
<a name="l02085"></a>02085   ((<a class="code" href="classSchematic.html">Schematic</a>*)sim-&gt;<a class="code" href="classSimMessage.html#a36c5e19a92ce674e5a08f663bcd3791e">DocWidget</a>)-&gt;reloadGraphs();
<a name="l02086"></a>02086   }
<a name="l02087"></a>02087 
<a name="l02088"></a>02088   <span class="keywordflow">if</span>(!<a class="code" href="classQucsApp.html#aa699c68344d4bd4f53fe90f0ccd4b6ae">isTextDocument</a> (sim-&gt;<a class="code" href="classSimMessage.html#a36c5e19a92ce674e5a08f663bcd3791e">DocWidget</a>))
<a name="l02089"></a>02089     ((<a class="code" href="classSchematic.html">Schematic</a>*)sim-&gt;<a class="code" href="classSimMessage.html#a36c5e19a92ce674e5a08f663bcd3791e">DocWidget</a>)-&gt;viewport()-&gt;update();
<a name="l02090"></a>02090 
<a name="l02091"></a>02091 }
<a name="l02092"></a>02092 
<a name="l02093"></a>02093 <span class="comment">// ------------------------------------------------------------------------</span>
<a name="l02094"></a><a class="code" href="classQucsApp.html#a4bd65d00af7f27b778ae0a3595fd96c8">02094</a> <span class="keywordtype">void</span> <a class="code" href="classQucsApp.html#a4bd65d00af7f27b778ae0a3595fd96c8">QucsApp::slotDCbias</a>()
<a name="l02095"></a>02095 {
<a name="l02096"></a>02096   <a class="code" href="classQucsApp.html#a5a91682ea446a8a35c039c5ea233b587">getDoc</a>()-&gt;<a class="code" href="classQucsDoc.html#aa36dd8514ff65a493e5f66de46fa827a">showBias</a> = 0;
<a name="l02097"></a>02097   <a class="code" href="classQucsApp.html#a3410fb2573a3801b533f6532183e3f8e" title="QucsApp::slotSimulate is called when the simulate toolbar button is pressed.">slotSimulate</a>();
<a name="l02098"></a>02098 }
<a name="l02099"></a>02099 
<a name="l02100"></a>02100 <span class="comment">// ------------------------------------------------------------------------</span>
<a name="l02101"></a>02101 <span class="comment">// Changes to the corresponding data display page or vice versa.</span>
<a name="l02102"></a><a class="code" href="classQucsApp.html#a02a4d768683eb57a7f45d22e57478477">02102</a> <span class="keywordtype">void</span> <a class="code" href="classQucsApp.html#a02a4d768683eb57a7f45d22e57478477">QucsApp::slotChangePage</a>(QString&amp; DocName, QString&amp; DataDisplay)
<a name="l02103"></a>02103 {
<a name="l02104"></a>02104   <span class="keywordflow">if</span>(DataDisplay.isEmpty())  <span class="keywordflow">return</span>;
<a name="l02105"></a>02105 
<a name="l02106"></a>02106   QFileInfo Info(DocName);
<a name="l02107"></a>02107   QString Name = Info.path() + QDir::separator() + DataDisplay;
<a name="l02108"></a>02108 
<a name="l02109"></a>02109   QWidget  *w = <a class="code" href="classQucsApp.html#ae7612793599ca4f5106f7e9f488d4225">DocumentTab</a>-&gt;currentWidget();
<a name="l02110"></a>02110 
<a name="l02111"></a>02111   <span class="keywordtype">int</span> z = 0;  <span class="comment">// search, if page is already loaded</span>
<a name="l02112"></a>02112   <a class="code" href="classQucsDoc.html">QucsDoc</a> * d = <a class="code" href="classQucsApp.html#aedb93e909d0b2cff6a8e4ccc82809057">findDoc</a> (Name, &amp;z);
<a name="l02113"></a>02113 
<a name="l02114"></a>02114   <span class="keywordflow">if</span>(d)
<a name="l02115"></a>02115     <a class="code" href="classQucsApp.html#ae7612793599ca4f5106f7e9f488d4225">DocumentTab</a>-&gt;setCurrentIndex(z);
<a name="l02116"></a>02116   <span class="keywordflow">else</span> {   <span class="comment">// no open page found ?</span>
<a name="l02117"></a>02117     QString ext = <a class="code" href="classQucsDoc.html#ae790e44362d2df14fae98b09dbb78899">QucsDoc::fileSuffix</a> (DataDisplay);
<a name="l02118"></a>02118 
<a name="l02119"></a>02119     <span class="keywordtype">int</span> i = 0;
<a name="l02120"></a>02120     <span class="keywordflow">if</span> (ext != <span class="stringliteral">&quot;vhd&quot;</span> &amp;&amp; ext != <span class="stringliteral">&quot;vhdl&quot;</span> &amp;&amp; ext != <span class="stringliteral">&quot;v&quot;</span> &amp;&amp; ext != <span class="stringliteral">&quot;va&quot;</span> &amp;&amp;
<a name="l02121"></a>02121   ext != <span class="stringliteral">&quot;oct&quot;</span> &amp;&amp; ext != <span class="stringliteral">&quot;m&quot;</span>) {
<a name="l02122"></a>02122       d = <span class="keyword">new</span> <a class="code" href="classSchematic.html">Schematic</a>(<span class="keyword">this</span>, Name);
<a name="l02123"></a>02123       i = <a class="code" href="classQucsApp.html#ae7612793599ca4f5106f7e9f488d4225">DocumentTab</a>-&gt;addTab((<a class="code" href="classSchematic.html">Schematic</a> *)d, QPixmap(<a class="code" href="qucs_8cpp.html#a098a06ee0c473d9178da66df32798581">empty_xpm</a>), DataDisplay);
<a name="l02124"></a>02124     }
<a name="l02125"></a>02125     <span class="keywordflow">else</span> {
<a name="l02126"></a>02126       d = <span class="keyword">new</span> <a class="code" href="classTextDoc.html" title="The TextDoc class definition.">TextDoc</a>(<span class="keyword">this</span>, Name);
<a name="l02127"></a>02127       i = <a class="code" href="classQucsApp.html#ae7612793599ca4f5106f7e9f488d4225">DocumentTab</a>-&gt;addTab((<a class="code" href="classTextDoc.html" title="The TextDoc class definition.">TextDoc</a> *)d, QPixmap(<a class="code" href="qucs_8cpp.html#a098a06ee0c473d9178da66df32798581">empty_xpm</a>), DataDisplay);
<a name="l02128"></a>02128     }
<a name="l02129"></a>02129     <a class="code" href="classQucsApp.html#ae7612793599ca4f5106f7e9f488d4225">DocumentTab</a>-&gt;setCurrentIndex(i);
<a name="l02130"></a>02130 
<a name="l02131"></a>02131     QFile file(Name);
<a name="l02132"></a>02132     <span class="keywordflow">if</span>(file.open(QIODevice::ReadOnly)) {      <span class="comment">// try to load document</span>
<a name="l02133"></a>02133       file.close();
<a name="l02134"></a>02134       <span class="keywordflow">if</span>(!d-&gt;<a class="code" href="classQucsDoc.html#abaac4e6662cca0c496bf665fd3d893e3">load</a>()) {
<a name="l02135"></a>02135         <span class="keyword">delete</span> d;
<a name="l02136"></a>02136         <a class="code" href="classQucsApp.html#a372ee1fa475722ca832511027a34c383">view</a>-&gt;<a class="code" href="classMouseActions.html#ad43ee60feb7239ee9692300605dc9aed">drawn</a> = <span class="keyword">false</span>;
<a name="l02137"></a>02137         <span class="keywordflow">return</span>;
<a name="l02138"></a>02138       }
<a name="l02139"></a>02139     }
<a name="l02140"></a>02140     <span class="keywordflow">else</span> {
<a name="l02141"></a>02141       <span class="keywordflow">if</span>(file.open(QIODevice::ReadWrite)) {  <span class="comment">// if document doesn&#39;t exist, create</span>
<a name="l02142"></a>02142         d-&gt;<a class="code" href="classQucsDoc.html#aa478fdc99a03ad789a287aa62c114fd1">DataDisplay</a> = Info.fileName();
<a name="l02143"></a>02143         <a class="code" href="classQucsApp.html#abc9b64e52b905e3a287dc618d8507d2c">slotUpdateTreeview</a>();
<a name="l02144"></a>02144       }
<a name="l02145"></a>02145       <span class="keywordflow">else</span> {
<a name="l02146"></a>02146         QMessageBox::critical(<span class="keyword">this</span>, tr(<span class="stringliteral">&quot;Error&quot;</span>), tr(<span class="stringliteral">&quot;Cannot create &quot;</span>)+Name);
<a name="l02147"></a>02147         <span class="keywordflow">return</span>;
<a name="l02148"></a>02148       }
<a name="l02149"></a>02149       file.close();
<a name="l02150"></a>02150     }
<a name="l02151"></a>02151 
<a name="l02152"></a>02152     d-&gt;<a class="code" href="classQucsDoc.html#a855ac5692d3dceacf88e745cc65002b7">becomeCurrent</a>(<span class="keyword">true</span>);
<a name="l02153"></a>02153   }
<a name="l02154"></a>02154 
<a name="l02155"></a>02155 
<a name="l02156"></a>02156   <span class="keywordflow">if</span>(<a class="code" href="classQucsApp.html#ae7612793599ca4f5106f7e9f488d4225">DocumentTab</a>-&gt;currentWidget() == w)      <span class="comment">// if page not ...</span>
<a name="l02157"></a>02157     <span class="keywordflow">if</span>(!<a class="code" href="classQucsApp.html#aa699c68344d4bd4f53fe90f0ccd4b6ae">isTextDocument</a> (w))
<a name="l02158"></a>02158       ((<a class="code" href="classSchematic.html">Schematic</a>*)w)-&gt;reloadGraphs();  <span class="comment">// ... changes, reload here !</span>
<a name="l02159"></a>02159 
<a name="l02160"></a>02160   <a class="code" href="classQucsApp.html#a7bb309c9a24921c091c005a7fee29644">TabView</a>-&gt;setCurrentIndex(2);   <span class="comment">// switch to &quot;Component&quot;-Tab</span>
<a name="l02161"></a>02161   <span class="keywordflow">if</span> (Name.right(4) == <span class="stringliteral">&quot;.dpl&quot;</span>) {
<a name="l02162"></a>02162     <span class="keywordtype">int</span> i = <a class="code" href="classCategory.html#a924b8aa1ee50ea205233be1b78a386d4">Category::getModulesNr</a> (QObject::tr(<span class="stringliteral">&quot;diagrams&quot;</span>));
<a name="l02163"></a>02163     <a class="code" href="classQucsApp.html#a86a11e3dd62788d233346c18a2db158d">CompChoose</a>-&gt;setCurrentIndex(i);   <span class="comment">// switch to diagrams</span>
<a name="l02164"></a>02164     <a class="code" href="classQucsApp.html#a7ab3e7daff34dea1e5f2b0f9feff1a2d">slotSetCompView</a> (i);
<a name="l02165"></a>02165   }
<a name="l02166"></a>02166 }
<a name="l02167"></a>02167 
<a name="l02168"></a>02168 <span class="comment">// -------------------------------------------------------------------</span>
<a name="l02169"></a>02169 <span class="comment">// Changes to the data display of current page.</span>
<a name="l02170"></a><a class="code" href="classQucsApp.html#a11393a207c8496575dfb181062473c49">02170</a> <span class="keywordtype">void</span> <a class="code" href="classQucsApp.html#a11393a207c8496575dfb181062473c49">QucsApp::slotToPage</a>()
<a name="l02171"></a>02171 {
<a name="l02172"></a>02172   <a class="code" href="classQucsDoc.html">QucsDoc</a> *d = <a class="code" href="classQucsApp.html#a5a91682ea446a8a35c039c5ea233b587">getDoc</a>();
<a name="l02173"></a>02173   <span class="keywordflow">if</span>(d-&gt;<a class="code" href="classQucsDoc.html#aa478fdc99a03ad789a287aa62c114fd1">DataDisplay</a>.isEmpty()) {
<a name="l02174"></a>02174     QMessageBox::critical(<span class="keyword">this</span>, tr(<span class="stringliteral">&quot;Error&quot;</span>), tr(<span class="stringliteral">&quot;No page set !&quot;</span>));
<a name="l02175"></a>02175     <span class="keywordflow">return</span>;
<a name="l02176"></a>02176   }
<a name="l02177"></a>02177 
<a name="l02178"></a>02178   <span class="keywordflow">if</span>(d-&gt;<a class="code" href="classQucsDoc.html#a2d87112c4f75a4770c9311bb6c2d407b">DocName</a>.right(2) == <span class="stringliteral">&quot;.m&quot;</span> ||
<a name="l02179"></a>02179      d-&gt;<a class="code" href="classQucsDoc.html#a2d87112c4f75a4770c9311bb6c2d407b">DocName</a>.right(4) == <span class="stringliteral">&quot;.oct&quot;</span>)
<a name="l02180"></a>02180     <a class="code" href="classQucsApp.html#a7abb07ce8bfbdd6bb4299a7bfd8c7aae">slotViewOctaveDock</a>(<span class="keyword">true</span>);
<a name="l02181"></a>02181   <span class="keywordflow">else</span>
<a name="l02182"></a>02182     <a class="code" href="classQucsApp.html#a02a4d768683eb57a7f45d22e57478477">slotChangePage</a>(d-&gt;<a class="code" href="classQucsDoc.html#a2d87112c4f75a4770c9311bb6c2d407b">DocName</a>, d-&gt;<a class="code" href="classQucsDoc.html#aa478fdc99a03ad789a287aa62c114fd1">DataDisplay</a>);
<a name="l02183"></a>02183 }
<a name="l02184"></a>02184 
<a name="l02185"></a>02185 <span class="comment">// -------------------------------------------------------------------</span>
<a name="l02186"></a>02186 <span class="comment">// Called when file name in Project View is double-clicked</span>
<a name="l02187"></a>02187 <span class="comment">//   or open is selected in the context menu</span>
<a name="l02188"></a><a class="code" href="classQucsApp.html#aeb426abb7ebfe9d361e8c30fd146f080">02188</a> <span class="keywordtype">void</span> <a class="code" href="classQucsApp.html#aeb426abb7ebfe9d361e8c30fd146f080">QucsApp::slotOpenContent</a>(<span class="keyword">const</span> QModelIndex &amp;idx)
<a name="l02189"></a>02189 {
<a name="l02190"></a>02190   <a class="code" href="classQucsApp.html#ab1126a50f9800423f4810a36c688f4ed">editText</a>-&gt;setHidden(<span class="keyword">true</span>); <span class="comment">// disable text edit of component property</span>
<a name="l02191"></a>02191 
<a name="l02192"></a>02192   <span class="comment">//test the item is valid</span>
<a name="l02193"></a>02193   <span class="keywordflow">if</span> (!idx.isValid()) { <span class="keywordflow">return</span>; }
<a name="l02194"></a>02194   <span class="keywordflow">if</span> (!idx.parent().isValid()) { <span class="keywordflow">return</span>; }
<a name="l02195"></a>02195 
<a name="l02196"></a>02196   QString filename = idx.sibling(idx.row(), 0).data().toString();
<a name="l02197"></a>02197   QString note = idx.sibling(idx.row(), 1).data().toString();
<a name="l02198"></a>02198   QFileInfo Info(<a class="code" href="main_8cpp.html#ac2e3fb7eed4aa9bd981210dc5df2e02e">QucsSettings</a>.<a class="code" href="structtQucsSettings.html#ac416ec4c4a8bfc243ea836dbf334ccae">QucsWorkDir</a>.filePath(filename));
<a name="l02199"></a>02199   QString extName = Info.suffix();
<a name="l02200"></a>02200 
<a name="l02201"></a>02201   <span class="keywordflow">if</span> (extName == <span class="stringliteral">&quot;sch&quot;</span> || extName == <span class="stringliteral">&quot;dpl&quot;</span> || extName == <span class="stringliteral">&quot;vhdl&quot;</span> ||
<a name="l02202"></a>02202       extName == <span class="stringliteral">&quot;vhd&quot;</span> || extName == <span class="stringliteral">&quot;v&quot;</span> || extName == <span class="stringliteral">&quot;va&quot;</span> ||
<a name="l02203"></a>02203       extName == <span class="stringliteral">&quot;m&quot;</span> || extName == <span class="stringliteral">&quot;oct&quot;</span>) {
<a name="l02204"></a>02204     <a class="code" href="classQucsApp.html#aaaeffebcd5551096a2c6261d4bfc5636">gotoPage</a>(Info.absoluteFilePath());
<a name="l02205"></a>02205     <a class="code" href="classQucsApp.html#aced5f32507a107d9e5d81c44b281ba71">updateRecentFilesList</a>(Info.absoluteFilePath());
<a name="l02206"></a>02206     <a class="code" href="classQucsApp.html#ae11e60e28902f1e1eb4604c90657459e">slotUpdateRecentFiles</a>();
<a name="l02207"></a>02207 
<a name="l02208"></a>02208     <span class="keywordflow">if</span>(note.isEmpty())     <span class="comment">// is subcircuit ?</span>
<a name="l02209"></a>02209       <span class="keywordflow">if</span>(extName == <span class="stringliteral">&quot;sch&quot;</span>) <span class="keywordflow">return</span>;
<a name="l02210"></a>02210 
<a name="l02211"></a>02211     <a class="code" href="classQucsApp.html#a7169b1bfa43595e0269ce41567a9b0e3">select</a>-&gt;blockSignals(<span class="keyword">true</span>);  <span class="comment">// switch on the &#39;select&#39; action ...</span>
<a name="l02212"></a>02212     <a class="code" href="classQucsApp.html#a7169b1bfa43595e0269ce41567a9b0e3">select</a>-&gt;setChecked(<span class="keyword">true</span>);
<a name="l02213"></a>02213     <a class="code" href="classQucsApp.html#a7169b1bfa43595e0269ce41567a9b0e3">select</a>-&gt;blockSignals(<span class="keyword">false</span>);
<a name="l02214"></a>02214 
<a name="l02215"></a>02215     <a class="code" href="classQucsApp.html#ac4f8f4eb432b8bc69bc5e3d0ff79b9ad">activeAction</a> = <a class="code" href="classQucsApp.html#a7169b1bfa43595e0269ce41567a9b0e3">select</a>;
<a name="l02216"></a>02216     <a class="code" href="classQucsApp.html#a1d5729667911400f757d5de8e1c0e6a9">MouseMoveAction</a> = 0;
<a name="l02217"></a>02217     <a class="code" href="classQucsApp.html#a7d713de7a2ead6d4dcab9c4ec1b32de4">MousePressAction</a> = &amp;<a class="code" href="classMouseActions.html#a821f3b55d821b9fad375c52c623ba18e">MouseActions::MPressSelect</a>;
<a name="l02218"></a>02218     <a class="code" href="classQucsApp.html#a710ae7088df8673e969ffb926157a9d6">MouseReleaseAction</a> = &amp;<a class="code" href="classMouseActions.html#adf4defdce1bdd5ecd1e85c583c2d27e9">MouseActions::MReleaseSelect</a>;
<a name="l02219"></a>02219     <a class="code" href="classQucsApp.html#a1fa601c2f555cb015aee8f828c4ed834">MouseDoubleClickAction</a> = &amp;<a class="code" href="classMouseActions.html#ae248e7625462accddd75a5cdbc1167a7">MouseActions::MDoubleClickSelect</a>;
<a name="l02220"></a>02220     <span class="keywordflow">return</span>;
<a name="l02221"></a>02221   }
<a name="l02222"></a>02222 
<a name="l02223"></a>02223   <span class="keywordflow">if</span>(extName == <span class="stringliteral">&quot;dat&quot;</span>) {
<a name="l02224"></a>02224     <a class="code" href="classQucsApp.html#aaf8acacb416542f58eff9aa1d6f8e398">editFile</a>(Info.absoluteFilePath());  <span class="comment">// open datasets with text editor</span>
<a name="l02225"></a>02225     <span class="keywordflow">return</span>;
<a name="l02226"></a>02226   }
<a name="l02227"></a>02227 
<a name="l02228"></a>02228   <span class="comment">// File is no Qucs file, so go through list and search a user</span>
<a name="l02229"></a>02229   <span class="comment">// defined program to open it.</span>
<a name="l02230"></a>02230   QStringList com;
<a name="l02231"></a>02231   QStringList::const_iterator it = <a class="code" href="main_8cpp.html#ac2e3fb7eed4aa9bd981210dc5df2e02e">QucsSettings</a>.<a class="code" href="structtQucsSettings.html#ad5d33df51e9071b0ae71c49a51d37948">FileTypes</a>.constBegin();
<a name="l02232"></a>02232   <span class="keywordflow">while</span>(it != <a class="code" href="main_8cpp.html#ac2e3fb7eed4aa9bd981210dc5df2e02e">QucsSettings</a>.<a class="code" href="structtQucsSettings.html#ad5d33df51e9071b0ae71c49a51d37948">FileTypes</a>.constEnd()) {
<a name="l02233"></a>02233     <span class="keywordflow">if</span>(extName == (*it).section(<span class="charliteral">&#39;/&#39;</span>,0,0)) {
<a name="l02234"></a>02234       QString progName = (*it).section(<span class="charliteral">&#39;/&#39;</span>,1,1);
<a name="l02235"></a>02235       com = progName.split(<span class="stringliteral">&quot; &quot;</span>);
<a name="l02236"></a>02236       com &lt;&lt; Info.absoluteFilePath();
<a name="l02237"></a>02237 
<a name="l02238"></a>02238       QProcess *Program = <span class="keyword">new</span> QProcess();
<a name="l02239"></a>02239       <span class="comment">//Program-&gt;setCommunication(0);</span>
<a name="l02240"></a>02240       QProcessEnvironment env = QProcessEnvironment::systemEnvironment();
<a name="l02241"></a>02241       env.insert(<span class="stringliteral">&quot;PATH&quot;</span>, env.value(<span class="stringliteral">&quot;PATH&quot;</span>) );
<a name="l02242"></a>02242       Program-&gt;setProcessEnvironment(env);
<a name="l02243"></a>02243       Program-&gt;start(com.join(<span class="stringliteral">&quot; &quot;</span>));
<a name="l02244"></a>02244       <span class="keywordflow">if</span>(Program-&gt;state()!=QProcess::Running&amp;&amp;
<a name="l02245"></a>02245               Program-&gt;state()!=QProcess::Starting) {
<a name="l02246"></a>02246         QMessageBox::critical(<span class="keyword">this</span>, tr(<span class="stringliteral">&quot;Error&quot;</span>),
<a name="l02247"></a>02247                tr(<span class="stringliteral">&quot;Cannot start \&quot;%1\&quot;!&quot;</span>).arg(Info.absoluteFilePath()));
<a name="l02248"></a>02248         <span class="keyword">delete</span> Program;
<a name="l02249"></a>02249       }
<a name="l02250"></a>02250       <span class="keywordflow">return</span>;
<a name="l02251"></a>02251     }
<a name="l02252"></a>02252     it++;
<a name="l02253"></a>02253   }
<a name="l02254"></a>02254 
<a name="l02255"></a>02255   <span class="comment">// If no appropriate program was found, open as text file.</span>
<a name="l02256"></a>02256   <a class="code" href="classQucsApp.html#aaf8acacb416542f58eff9aa1d6f8e398">editFile</a>(Info.absoluteFilePath());  <span class="comment">// open datasets with text editor</span>
<a name="l02257"></a>02257 }
<a name="l02258"></a>02258 
<a name="l02259"></a>02259 <span class="comment">// ---------------------------------------------------------</span>
<a name="l02260"></a>02260 <span class="comment">// Is called when the mouse is clicked within the Content QListView.</span>
<a name="l02261"></a><a class="code" href="classQucsApp.html#ab57330cad63942e3900e7456ae2cb7aa">02261</a> <span class="keywordtype">void</span> <a class="code" href="classQucsApp.html#ab57330cad63942e3900e7456ae2cb7aa">QucsApp::slotSelectSubcircuit</a>(<span class="keyword">const</span> QModelIndex &amp;idx)
<a name="l02262"></a>02262 {
<a name="l02263"></a>02263   <a class="code" href="classQucsApp.html#ab1126a50f9800423f4810a36c688f4ed">editText</a>-&gt;setHidden(<span class="keyword">true</span>); <span class="comment">// disable text edit of component property</span>
<a name="l02264"></a>02264 
<a name="l02265"></a>02265   <span class="keywordflow">if</span>(!idx.isValid()) {   <span class="comment">// mouse button pressed not over an item ?</span>
<a name="l02266"></a>02266     <a class="code" href="classQucsApp.html#a4fb9ed646ac33093c199803e9625823d">Content</a>-&gt;clearSelection();  <span class="comment">// deselect component in ListView</span>
<a name="l02267"></a>02267     <span class="keywordflow">return</span>;
<a name="l02268"></a>02268   }
<a name="l02269"></a>02269 
<a name="l02270"></a>02270   <span class="keywordtype">bool</span> isVHDL = <span class="keyword">false</span>;
<a name="l02271"></a>02271   <span class="keywordtype">bool</span> isVerilog = <span class="keyword">false</span>;
<a name="l02272"></a>02272   QModelIndex parentIdx = idx.parent();
<a name="l02273"></a>02273   <span class="keywordflow">if</span>(!parentIdx.isValid()) { <span class="keywordflow">return</span>; }
<a name="l02274"></a>02274 
<a name="l02275"></a>02275   QString category = parentIdx.data().toString();
<a name="l02276"></a>02276 
<a name="l02277"></a>02277   <span class="keywordflow">if</span>(category == tr(<span class="stringliteral">&quot;Schematics&quot;</span>)) {
<a name="l02278"></a>02278     <span class="keywordflow">if</span>(idx.sibling(idx.row(), 1).data().toString().isEmpty())
<a name="l02279"></a>02279       <span class="keywordflow">return</span>;   <span class="comment">// return, if not a subcircuit</span>
<a name="l02280"></a>02280   }
<a name="l02281"></a>02281   <span class="keywordflow">else</span> <span class="keywordflow">if</span>(category == tr(<span class="stringliteral">&quot;VHDL&quot;</span>))
<a name="l02282"></a>02282     isVHDL = <span class="keyword">true</span>;
<a name="l02283"></a>02283   <span class="keywordflow">else</span> <span class="keywordflow">if</span>(category == tr(<span class="stringliteral">&quot;Verilog&quot;</span>))
<a name="l02284"></a>02284     isVerilog = <span class="keyword">true</span>;
<a name="l02285"></a>02285   <span class="keywordflow">else</span>
<a name="l02286"></a>02286     <span class="keywordflow">return</span>;
<a name="l02287"></a>02287 
<a name="l02288"></a>02288   QString filename = idx.sibling(idx.row(), 0).data().toString();
<a name="l02289"></a>02289   QString note = idx.sibling(idx.row(), 1).data().toString();
<a name="l02290"></a>02290   <span class="keywordtype">int</span> idx_pag = <a class="code" href="classQucsApp.html#ae7612793599ca4f5106f7e9f488d4225">DocumentTab</a>-&gt;currentIndex();
<a name="l02291"></a>02291   QString tab_titl = <span class="stringliteral">&quot;&quot;</span>;
<a name="l02292"></a>02292   <span class="keywordflow">if</span> (idx_pag&gt;=0) tab_titl = <a class="code" href="classQucsApp.html#ae7612793599ca4f5106f7e9f488d4225">DocumentTab</a>-&gt;tabText(idx_pag);
<a name="l02293"></a>02293   <span class="keywordflow">if</span> (filename == tab_titl ) <span class="keywordflow">return</span>; <span class="comment">// Forbid to paste subcircuit into itself.</span>
<a name="l02294"></a>02294 
<a name="l02295"></a>02295   <span class="comment">// delete previously selected elements</span>
<a name="l02296"></a>02296   <span class="keywordflow">if</span>(<a class="code" href="classQucsApp.html#a372ee1fa475722ca832511027a34c383">view</a>-&gt;<a class="code" href="classMouseActions.html#a523750a82a7eb74f51b9a5ed5a073003">selElem</a> != 0)  <span class="keyword">delete</span> <a class="code" href="classQucsApp.html#a372ee1fa475722ca832511027a34c383">view</a>-&gt;<a class="code" href="classMouseActions.html#a523750a82a7eb74f51b9a5ed5a073003">selElem</a>;
<a name="l02297"></a>02297   <a class="code" href="classQucsApp.html#a372ee1fa475722ca832511027a34c383">view</a>-&gt;<a class="code" href="classMouseActions.html#a523750a82a7eb74f51b9a5ed5a073003">selElem</a> = 0;
<a name="l02298"></a>02298 
<a name="l02299"></a>02299   <span class="comment">// toggle last toolbar button off</span>
<a name="l02300"></a>02300   <span class="keywordflow">if</span>(<a class="code" href="classQucsApp.html#ac4f8f4eb432b8bc69bc5e3d0ff79b9ad">activeAction</a>) {
<a name="l02301"></a>02301     <a class="code" href="classQucsApp.html#ac4f8f4eb432b8bc69bc5e3d0ff79b9ad">activeAction</a>-&gt;blockSignals(<span class="keyword">true</span>); <span class="comment">// do not call toggle slot</span>
<a name="l02302"></a>02302     <a class="code" href="classQucsApp.html#ac4f8f4eb432b8bc69bc5e3d0ff79b9ad">activeAction</a>-&gt;setChecked(<span class="keyword">false</span>);       <span class="comment">// set last toolbar button off</span>
<a name="l02303"></a>02303     <a class="code" href="classQucsApp.html#ac4f8f4eb432b8bc69bc5e3d0ff79b9ad">activeAction</a>-&gt;blockSignals(<span class="keyword">false</span>);
<a name="l02304"></a>02304   }
<a name="l02305"></a>02305   <a class="code" href="classQucsApp.html#ac4f8f4eb432b8bc69bc5e3d0ff79b9ad">activeAction</a> = 0;
<a name="l02306"></a>02306 
<a name="l02307"></a>02307   <a class="code" href="classComponent.html" title="The Component class implements a generic analog component.">Component</a> *Comp;
<a name="l02308"></a>02308   <span class="keywordflow">if</span>(isVHDL)
<a name="l02309"></a>02309     Comp = <span class="keyword">new</span> <a class="code" href="classVHDL__File.html">VHDL_File</a>();
<a name="l02310"></a>02310   <span class="keywordflow">else</span> <span class="keywordflow">if</span>(isVerilog)
<a name="l02311"></a>02311     Comp = <span class="keyword">new</span> <a class="code" href="classVerilog__File.html">Verilog_File</a>();
<a name="l02312"></a>02312   <span class="keywordflow">else</span>
<a name="l02313"></a>02313     Comp = <span class="keyword">new</span> <a class="code" href="classSubcircuit.html">Subcircuit</a>();
<a name="l02314"></a>02314   Comp-&gt;<a class="code" href="classComponent.html#ac26b0c8fe8363087bfc9243adc57ef6c">Props</a>.first()-&gt;Value = idx.sibling(idx.row(), 0).data().toString();
<a name="l02315"></a>02315   Comp-&gt;<a class="code" href="classComponent.html#a922de1326d4214d885f5dc05287a75a0">recreate</a>(0);
<a name="l02316"></a>02316   <a class="code" href="classQucsApp.html#a372ee1fa475722ca832511027a34c383">view</a>-&gt;<a class="code" href="classMouseActions.html#a523750a82a7eb74f51b9a5ed5a073003">selElem</a> = Comp;
<a name="l02317"></a>02317 
<a name="l02318"></a>02318   <span class="keywordflow">if</span>(<a class="code" href="classQucsApp.html#a372ee1fa475722ca832511027a34c383">view</a>-&gt;<a class="code" href="classMouseActions.html#ad43ee60feb7239ee9692300605dc9aed">drawn</a>)
<a name="l02319"></a>02319     ((Q3ScrollView*)<a class="code" href="classQucsApp.html#ae7612793599ca4f5106f7e9f488d4225">DocumentTab</a>-&gt;currentWidget())-&gt;viewport()-&gt;update();
<a name="l02320"></a>02320   <a class="code" href="classQucsApp.html#a372ee1fa475722ca832511027a34c383">view</a>-&gt;<a class="code" href="classMouseActions.html#ad43ee60feb7239ee9692300605dc9aed">drawn</a> = <span class="keyword">false</span>;
<a name="l02321"></a>02321   <a class="code" href="classQucsApp.html#a1d5729667911400f757d5de8e1c0e6a9">MouseMoveAction</a> = &amp;<a class="code" href="classMouseActions.html#ada8a7aeace90479d3fe31c58ceea01e1">MouseActions::MMoveElement</a>;
<a name="l02322"></a>02322   <a class="code" href="classQucsApp.html#a7d713de7a2ead6d4dcab9c4ec1b32de4">MousePressAction</a> = &amp;<a class="code" href="classMouseActions.html#a964ac8fd47ffa0885cd512a74eef76e2">MouseActions::MPressElement</a>;
<a name="l02323"></a>02323   <a class="code" href="classQucsApp.html#a710ae7088df8673e969ffb926157a9d6">MouseReleaseAction</a> = 0;
<a name="l02324"></a>02324   <a class="code" href="classQucsApp.html#a1fa601c2f555cb015aee8f828c4ed834">MouseDoubleClickAction</a> = 0;
<a name="l02325"></a>02325 }
<a name="l02326"></a>02326 
<a name="l02327"></a>02327 <span class="comment">// ---------------------------------------------------------</span>
<a name="l02328"></a>02328 <span class="comment">// Is called when the mouse is clicked within the Content QListView.</span>
<a name="l02329"></a><a class="code" href="classQucsApp.html#adca6dc371ca66a9d633d6ff2f6b42b4b">02329</a> <span class="keywordtype">void</span> <a class="code" href="classQucsApp.html#adca6dc371ca66a9d633d6ff2f6b42b4b">QucsApp::slotSelectLibComponent</a>(QTreeWidgetItem *item)
<a name="l02330"></a>02330 {
<a name="l02331"></a>02331     <span class="comment">// get the current document</span>
<a name="l02332"></a>02332     <a class="code" href="classSchematic.html">Schematic</a> *Doc = (<a class="code" href="classSchematic.html">Schematic</a>*)<a class="code" href="classQucsApp.html#ae7612793599ca4f5106f7e9f488d4225">DocumentTab</a>-&gt;currentWidget();
<a name="l02333"></a>02333 
<a name="l02334"></a>02334     <span class="comment">// if the current document is a schematic activate the paste</span>
<a name="l02335"></a>02335     <span class="keywordflow">if</span>(!<a class="code" href="classQucsApp.html#aa699c68344d4bd4f53fe90f0ccd4b6ae">isTextDocument</a>(Doc))
<a name="l02336"></a>02336     {
<a name="l02337"></a>02337         <span class="comment">// if theres not a higher level item, this is a top level item,</span>
<a name="l02338"></a>02338         <span class="comment">// not a component item so return</span>
<a name="l02339"></a>02339         <span class="keywordflow">if</span>(item-&gt;parent() == 0) <span class="keywordflow">return</span>;
<a name="l02340"></a>02340         <span class="keywordflow">if</span>(item-&gt;text(1).isEmpty()) <span class="keywordflow">return</span>;   <span class="comment">// return, if not a subcircuit</span>
<a name="l02341"></a>02341 
<a name="l02342"></a>02342         <span class="comment">// copy the subcircuit schematic to the clipboard</span>
<a name="l02343"></a>02343         QClipboard *cb = QApplication::clipboard();
<a name="l02344"></a>02344         cb-&gt;setText(item-&gt;text(1));
<a name="l02345"></a>02345 
<a name="l02346"></a>02346         <span class="comment">// activate the paste command</span>
<a name="l02347"></a>02347         <a class="code" href="classQucsApp.html#a00d09cbe62124d2bef72e726f3e190da">slotEditPaste</a> (<span class="keyword">true</span>);
<a name="l02348"></a>02348     }
<a name="l02349"></a>02349 
<a name="l02350"></a>02350 }
<a name="l02351"></a>02351 
<a name="l02352"></a>02352 
<a name="l02353"></a>02353 <span class="comment">// ---------------------------------------------------------</span>
<a name="l02354"></a>02354 <span class="comment">// This function is called if the document type changes, i.e.</span>
<a name="l02355"></a>02355 <span class="comment">// from schematic to text document or vice versa.</span>
<a name="l02356"></a><a class="code" href="classQucsApp.html#ad6b73decde3208e952ca5d916a125c5a">02356</a> <span class="keywordtype">void</span> <a class="code" href="classQucsApp.html#ad6b73decde3208e952ca5d916a125c5a">QucsApp::switchSchematicDoc</a> (<span class="keywordtype">bool</span> SchematicMode)
<a name="l02357"></a>02357 {
<a name="l02358"></a>02358   <span class="comment">// switch our scroll key actions on/off according to SchematicMode</span>
<a name="l02359"></a>02359   <a class="code" href="classQucsApp.html#ab7a5f5666fdbacbd8d86f409cd5e6720">cursorLeft</a>-&gt;setEnabled(SchematicMode);
<a name="l02360"></a>02360   <a class="code" href="classQucsApp.html#a2142c2a46adfddb1e975634ac2f3a3ad">cursorRight</a>-&gt;setEnabled(SchematicMode);
<a name="l02361"></a>02361   <a class="code" href="classQucsApp.html#a916fe15792513b645ad3003c07f5ef02">cursorUp</a>-&gt;setEnabled(SchematicMode);
<a name="l02362"></a>02362   <a class="code" href="classQucsApp.html#a43632a59e992d9ce6b4bd3bf10d07e98">cursorDown</a>-&gt;setEnabled(SchematicMode);
<a name="l02363"></a>02363 
<a name="l02364"></a>02364   <span class="comment">// text document</span>
<a name="l02365"></a>02365   <span class="keywordflow">if</span> (!SchematicMode) {
<a name="l02366"></a>02366     <span class="keywordflow">if</span> (<a class="code" href="classQucsApp.html#ac4f8f4eb432b8bc69bc5e3d0ff79b9ad">activeAction</a>) {
<a name="l02367"></a>02367       <a class="code" href="classQucsApp.html#ac4f8f4eb432b8bc69bc5e3d0ff79b9ad">activeAction</a>-&gt;blockSignals (<span class="keyword">true</span>); <span class="comment">// do not call toggle slot</span>
<a name="l02368"></a>02368       <a class="code" href="classQucsApp.html#ac4f8f4eb432b8bc69bc5e3d0ff79b9ad">activeAction</a>-&gt;setChecked(<span class="keyword">false</span>);       <span class="comment">// set last toolbar button off</span>
<a name="l02369"></a>02369       <a class="code" href="classQucsApp.html#ac4f8f4eb432b8bc69bc5e3d0ff79b9ad">activeAction</a>-&gt;blockSignals (<span class="keyword">false</span>);
<a name="l02370"></a>02370     }
<a name="l02371"></a>02371     <a class="code" href="classQucsApp.html#ac4f8f4eb432b8bc69bc5e3d0ff79b9ad">activeAction</a> = <a class="code" href="classQucsApp.html#a7169b1bfa43595e0269ce41567a9b0e3">select</a>;
<a name="l02372"></a>02372     <a class="code" href="classQucsApp.html#a7169b1bfa43595e0269ce41567a9b0e3">select</a>-&gt;blockSignals (<span class="keyword">true</span>);
<a name="l02373"></a>02373     <a class="code" href="classQucsApp.html#a7169b1bfa43595e0269ce41567a9b0e3">select</a>-&gt;setChecked(<span class="keyword">true</span>);
<a name="l02374"></a>02374     <a class="code" href="classQucsApp.html#a7169b1bfa43595e0269ce41567a9b0e3">select</a>-&gt;blockSignals (<span class="keyword">false</span>);
<a name="l02375"></a>02375   }
<a name="l02376"></a>02376   <span class="comment">// schematic document</span>
<a name="l02377"></a>02377   <span class="keywordflow">else</span> {
<a name="l02378"></a>02378     <a class="code" href="classQucsApp.html#a1d5729667911400f757d5de8e1c0e6a9">MouseMoveAction</a> = 0;
<a name="l02379"></a>02379     <a class="code" href="classQucsApp.html#a7d713de7a2ead6d4dcab9c4ec1b32de4">MousePressAction</a> = &amp;<a class="code" href="classMouseActions.html#a821f3b55d821b9fad375c52c623ba18e">MouseActions::MPressSelect</a>;
<a name="l02380"></a>02380     <a class="code" href="classQucsApp.html#a710ae7088df8673e969ffb926157a9d6">MouseReleaseAction</a> = &amp;<a class="code" href="classMouseActions.html#adf4defdce1bdd5ecd1e85c583c2d27e9">MouseActions::MReleaseSelect</a>;
<a name="l02381"></a>02381     <a class="code" href="classQucsApp.html#a1fa601c2f555cb015aee8f828c4ed834">MouseDoubleClickAction</a> = &amp;<a class="code" href="classMouseActions.html#ae248e7625462accddd75a5cdbc1167a7">MouseActions::MDoubleClickSelect</a>;
<a name="l02382"></a>02382   }
<a name="l02383"></a>02383 
<a name="l02384"></a>02384   <a class="code" href="classQucsApp.html#a8a4bf18182eaf0696cea881f8c4bba7a">selectMarker</a>-&gt;setEnabled (SchematicMode);
<a name="l02385"></a>02385   <a class="code" href="classQucsApp.html#aaf8361a5bc435e30817b9919d27b14c0">alignTop</a>-&gt;setEnabled (SchematicMode);
<a name="l02386"></a>02386   <a class="code" href="classQucsApp.html#a1314b1f263fc6572ef507d4034b80efc">alignBottom</a>-&gt;setEnabled (SchematicMode);
<a name="l02387"></a>02387   <a class="code" href="classQucsApp.html#ad9a79b9d7372d51659b618a0a435efe4">alignLeft</a>-&gt;setEnabled (SchematicMode);
<a name="l02388"></a>02388   <a class="code" href="classQucsApp.html#a3a09e210f8963bdf18005666c8e7ffd6">alignRight</a>-&gt;setEnabled (SchematicMode);
<a name="l02389"></a>02389   <a class="code" href="classQucsApp.html#a69c2ab3bfeb692acfa789a12e6fcb527">centerHor</a>-&gt;setEnabled (SchematicMode);
<a name="l02390"></a>02390   <a class="code" href="classQucsApp.html#a6776b90ffc60f5566790105655232c58">centerVert</a>-&gt;setEnabled (SchematicMode);
<a name="l02391"></a>02391   <a class="code" href="classQucsApp.html#a886389efc019f34cc9c108f25a2d7d81">distrHor</a>-&gt;setEnabled (SchematicMode);
<a name="l02392"></a>02392   <a class="code" href="classQucsApp.html#a6b86da9433029036bbc54cdd28829b0d">distrVert</a>-&gt;setEnabled (SchematicMode);
<a name="l02393"></a>02393   <a class="code" href="classQucsApp.html#aed590d4d70925a7a2dec3f8b22a0ca75">onGrid</a>-&gt;setEnabled (SchematicMode);
<a name="l02394"></a>02394   <a class="code" href="classQucsApp.html#a36990c0245bf6b7cb4fad8bc5d54a5fc">moveText</a>-&gt;setEnabled (SchematicMode);
<a name="l02395"></a>02395   <a class="code" href="classQucsApp.html#a224ad7b18eee6a149dfce88a13fe0290">filePrintFit</a>-&gt;setEnabled (SchematicMode);
<a name="l02396"></a>02396   <a class="code" href="classQucsApp.html#ae3cc94f7a02f73a3f204d2c44c36016e">editRotate</a>-&gt;setEnabled (SchematicMode);
<a name="l02397"></a>02397   <a class="code" href="classQucsApp.html#a0b4600ec0f9e8d1ac17643f90b1841bd">editMirror</a>-&gt;setEnabled (SchematicMode);
<a name="l02398"></a>02398   <a class="code" href="classQucsApp.html#a209314f405ada145249d3ce1eff1a45f">editMirrorY</a>-&gt;setEnabled (SchematicMode);
<a name="l02399"></a>02399   <a class="code" href="classQucsApp.html#a57d63af522dfef26b5e111a1a0f8698d">intoH</a>-&gt;setEnabled (SchematicMode);
<a name="l02400"></a>02400   <a class="code" href="classQucsApp.html#aa1a25f0fedb060643d42a9944c1da8bd">popH</a>-&gt;setEnabled (SchematicMode);
<a name="l02401"></a>02401   <a class="code" href="classQucsApp.html#adf5a87732df315cc981591cb9f9fb250">dcbias</a>-&gt;setEnabled (SchematicMode);
<a name="l02402"></a>02402   <a class="code" href="classQucsApp.html#a7f4d0ac469393aafe28681e4002a7e91">insWire</a>-&gt;setEnabled (SchematicMode);
<a name="l02403"></a>02403   <a class="code" href="classQucsApp.html#a0a7bb083b067f8d1b3c117a9cc2c4069">insLabel</a>-&gt;setEnabled (SchematicMode);
<a name="l02404"></a>02404   <a class="code" href="classQucsApp.html#a0da454185017324cc636606b416224fe">insPort</a>-&gt;setEnabled (SchematicMode);
<a name="l02405"></a>02405   <a class="code" href="classQucsApp.html#a728a29024c654ffe10256a611fd9d231">insGround</a>-&gt;setEnabled (SchematicMode);
<a name="l02406"></a>02406   <a class="code" href="classQucsApp.html#a6d8797845f3fd3717a631718fce2624d">insEquation</a>-&gt;setEnabled (SchematicMode);
<a name="l02407"></a>02407   <a class="code" href="classQucsApp.html#a6c82ba810ce40ef09f3f5faca2794bc9">setMarker</a>-&gt;setEnabled (SchematicMode);
<a name="l02408"></a>02408 
<a name="l02409"></a>02409   <a class="code" href="classQucsApp.html#ac46bcb3fd090de847c1596dff63031bd">exportAsImage</a>-&gt;setEnabled (SchematicMode); <span class="comment">// only export schematic, no text</span>
<a name="l02410"></a>02410 
<a name="l02411"></a>02411   <a class="code" href="classQucsApp.html#ade188651399a4c4b0c4fd374f3bf1574">editFind</a>-&gt;setEnabled (!SchematicMode);
<a name="l02412"></a>02412   <a class="code" href="classQucsApp.html#aaba611a8623d6995bc919834be7de400">insEntity</a>-&gt;setEnabled (!SchematicMode);
<a name="l02413"></a>02413 
<a name="l02414"></a>02414   <a class="code" href="classQucsApp.html#a8e73acba61277528937f2060f63b888d">buildModule</a>-&gt;setEnabled(!SchematicMode); <span class="comment">// only build if VA document</span>
<a name="l02415"></a>02415 }
<a name="l02416"></a>02416 
<a name="l02417"></a>02417 <span class="comment">// ---------------------------------------------------------</span>
<a name="l02418"></a><a class="code" href="classQucsApp.html#a4ec09c549f14f02a761668c245b3f6b1">02418</a> <span class="keywordtype">void</span> <a class="code" href="classQucsApp.html#a4ec09c549f14f02a761668c245b3f6b1">QucsApp::switchEditMode</a>(<span class="keywordtype">bool</span> SchematicMode)
<a name="l02419"></a>02419 {
<a name="l02420"></a>02420   <a class="code" href="classQucsApp.html#a1f0d73873a143ac38d74915b6d6dc347">fillComboBox</a>(SchematicMode);
<a name="l02421"></a>02421   <a class="code" href="classQucsApp.html#a7ab3e7daff34dea1e5f2b0f9feff1a2d">slotSetCompView</a>(0);
<a name="l02422"></a>02422 
<a name="l02423"></a>02423   <a class="code" href="classQucsApp.html#a57d63af522dfef26b5e111a1a0f8698d">intoH</a>-&gt;setEnabled(SchematicMode);
<a name="l02424"></a>02424   <a class="code" href="classQucsApp.html#aa1a25f0fedb060643d42a9944c1da8bd">popH</a>-&gt;setEnabled(SchematicMode);
<a name="l02425"></a>02425   <a class="code" href="classQucsApp.html#a760183b32f882380b92afa536d8490ce">editActivate</a>-&gt;setEnabled(SchematicMode);
<a name="l02426"></a>02426   <a class="code" href="classQucsApp.html#a66c44c3fb2bb04ee9f65c9254bcc408f">changeProps</a>-&gt;setEnabled(SchematicMode);
<a name="l02427"></a>02427   <a class="code" href="classQucsApp.html#a6d8797845f3fd3717a631718fce2624d">insEquation</a>-&gt;setEnabled(SchematicMode);
<a name="l02428"></a>02428   <a class="code" href="classQucsApp.html#a728a29024c654ffe10256a611fd9d231">insGround</a>-&gt;setEnabled(SchematicMode);
<a name="l02429"></a>02429   <a class="code" href="classQucsApp.html#a0da454185017324cc636606b416224fe">insPort</a>-&gt;setEnabled(SchematicMode);
<a name="l02430"></a>02430   <a class="code" href="classQucsApp.html#a7f4d0ac469393aafe28681e4002a7e91">insWire</a>-&gt;setEnabled(SchematicMode);
<a name="l02431"></a>02431   <a class="code" href="classQucsApp.html#a0a7bb083b067f8d1b3c117a9cc2c4069">insLabel</a>-&gt;setEnabled(SchematicMode);
<a name="l02432"></a>02432   <a class="code" href="classQucsApp.html#a6c82ba810ce40ef09f3f5faca2794bc9">setMarker</a>-&gt;setEnabled(SchematicMode);
<a name="l02433"></a>02433   <a class="code" href="classQucsApp.html#a8a4bf18182eaf0696cea881f8c4bba7a">selectMarker</a>-&gt;setEnabled(SchematicMode);
<a name="l02434"></a>02434   <a class="code" href="classQucsApp.html#a2297dd0fa22dcb3f12db757f0c9250df">simulate</a>-&gt;setEnabled(SchematicMode);
<a name="l02435"></a>02435 }
<a name="l02436"></a>02436 
<a name="l02437"></a>02437 <span class="comment">// ---------------------------------------------------------</span>
<a name="l02438"></a><a class="code" href="classQucsApp.html#a3276d8bf976ce9cbe96880dcb88bfc33">02438</a> <span class="keywordtype">void</span> <a class="code" href="classQucsApp.html#a3276d8bf976ce9cbe96880dcb88bfc33">QucsApp::changeSchematicSymbolMode</a>(<a class="code" href="classSchematic.html">Schematic</a> *Doc)
<a name="l02439"></a>02439 {
<a name="l02440"></a>02440   <span class="keywordflow">if</span>(Doc-&gt;<a class="code" href="classSchematic.html#a636bb0d04b436b500367a3000701d989">symbolMode</a>) {
<a name="l02441"></a>02441     <span class="comment">// go into select modus to avoid placing a forbidden element</span>
<a name="l02442"></a>02442     <a class="code" href="classQucsApp.html#a7169b1bfa43595e0269ce41567a9b0e3">select</a>-&gt;setChecked(<span class="keyword">true</span>);
<a name="l02443"></a>02443 
<a name="l02444"></a>02444     <a class="code" href="classQucsApp.html#a4ec09c549f14f02a761668c245b3f6b1">switchEditMode</a>(<span class="keyword">false</span>);
<a name="l02445"></a>02445   }
<a name="l02446"></a>02446   <span class="keywordflow">else</span>
<a name="l02447"></a>02447     <a class="code" href="classQucsApp.html#a4ec09c549f14f02a761668c245b3f6b1">switchEditMode</a>(<span class="keyword">true</span>);
<a name="l02448"></a>02448 }
<a name="l02449"></a>02449 
<a name="l02450"></a>02450 <span class="comment">// ---------------------------------------------------------</span>
<a name="l02451"></a><a class="code" href="classQucsApp.html#aa699c68344d4bd4f53fe90f0ccd4b6ae">02451</a> <span class="keywordtype">bool</span> <a class="code" href="classQucsApp.html#aa699c68344d4bd4f53fe90f0ccd4b6ae">QucsApp::isTextDocument</a>(QWidget *w) {
<a name="l02452"></a>02452   <span class="keywordflow">return</span> w-&gt;inherits(<span class="stringliteral">&quot;QPlainTextEdit&quot;</span>);
<a name="l02453"></a>02453 }
<a name="l02454"></a>02454 
<a name="l02455"></a>02455 <span class="comment">// ---------------------------------------------------------</span>
<a name="l02456"></a>02456 <span class="comment">// Is called if the &quot;symEdit&quot; action is activated, i.e. if the user</span>
<a name="l02457"></a>02457 <span class="comment">// switches between the two painting mode: Schematic and (subcircuit)</span>
<a name="l02458"></a>02458 <span class="comment">// symbol.</span>
<a name="l02459"></a><a class="code" href="classQucsApp.html#a1e2e586adf725eb0d8c2723b495811de">02459</a> <span class="keywordtype">void</span> <a class="code" href="classQucsApp.html#a1e2e586adf725eb0d8c2723b495811de">QucsApp::slotSymbolEdit</a>()
<a name="l02460"></a>02460 {
<a name="l02461"></a>02461   QWidget *w = <a class="code" href="classQucsApp.html#ae7612793599ca4f5106f7e9f488d4225">DocumentTab</a>-&gt;currentWidget();
<a name="l02462"></a>02462 
<a name="l02463"></a>02463   <span class="comment">// in a text document (e.g. VHDL)</span>
<a name="l02464"></a>02464   <span class="keywordflow">if</span> (<a class="code" href="classQucsApp.html#aa699c68344d4bd4f53fe90f0ccd4b6ae">isTextDocument</a> (w)) {
<a name="l02465"></a>02465     <a class="code" href="classTextDoc.html" title="The TextDoc class definition.">TextDoc</a> *TDoc = (<a class="code" href="classTextDoc.html" title="The TextDoc class definition.">TextDoc</a>*)w;
<a name="l02466"></a>02466     <span class="comment">// set &#39;DataDisplay&#39; document of text file to symbol file</span>
<a name="l02467"></a>02467     QFileInfo Info(TDoc-&gt;<a class="code" href="classQucsDoc.html#a2d87112c4f75a4770c9311bb6c2d407b">DocName</a>);
<a name="l02468"></a>02468     QString sym = Info.completeBaseName()+<span class="stringliteral">&quot;.sym&quot;</span>;
<a name="l02469"></a>02469     TDoc-&gt;<a class="code" href="classQucsDoc.html#aa478fdc99a03ad789a287aa62c114fd1">DataDisplay</a> = sym;
<a name="l02470"></a>02470 
<a name="l02471"></a>02471     <span class="comment">// symbol file already loaded?</span>
<a name="l02472"></a>02472     <span class="keywordtype">int</span> paint_mode = 0;
<a name="l02473"></a>02473     <span class="keywordflow">if</span> (!<a class="code" href="classQucsApp.html#aedb93e909d0b2cff6a8e4ccc82809057">findDoc</a> (<a class="code" href="main_8cpp.html#ac2e3fb7eed4aa9bd981210dc5df2e02e">QucsSettings</a>.<a class="code" href="structtQucsSettings.html#ac416ec4c4a8bfc243ea836dbf334ccae">QucsWorkDir</a>.filePath(sym)))
<a name="l02474"></a>02474       paint_mode = 1;
<a name="l02475"></a>02475 
<a name="l02476"></a>02476     <span class="comment">// change current page to appropriate symbol file</span>
<a name="l02477"></a>02477     <a class="code" href="classQucsApp.html#a02a4d768683eb57a7f45d22e57478477">slotChangePage</a>(TDoc-&gt;<a class="code" href="classQucsDoc.html#a2d87112c4f75a4770c9311bb6c2d407b">DocName</a>,TDoc-&gt;<a class="code" href="classQucsDoc.html#aa478fdc99a03ad789a287aa62c114fd1">DataDisplay</a>);
<a name="l02478"></a>02478 
<a name="l02479"></a>02479     <span class="comment">// set &#39;DataDisplay&#39; document of symbol file to original text file</span>
<a name="l02480"></a>02480     <a class="code" href="classSchematic.html">Schematic</a> *SDoc = (<a class="code" href="classSchematic.html">Schematic</a>*)<a class="code" href="classQucsApp.html#ae7612793599ca4f5106f7e9f488d4225">DocumentTab</a>-&gt;currentWidget();
<a name="l02481"></a>02481     SDoc-&gt;<a class="code" href="classQucsDoc.html#aa478fdc99a03ad789a287aa62c114fd1">DataDisplay</a> = Info.fileName();
<a name="l02482"></a>02482 
<a name="l02483"></a>02483     <span class="comment">// change into symbol mode</span>
<a name="l02484"></a>02484     <span class="keywordflow">if</span> (paint_mode) <span class="comment">// but only switch coordinates if newly loaded</span>
<a name="l02485"></a>02485       SDoc-&gt;<a class="code" href="classSchematic.html#a8de2cc6dc40a7f5c46422e6c1c7bbc93">switchPaintMode</a>();
<a name="l02486"></a>02486     SDoc-&gt;<a class="code" href="classSchematic.html#a636bb0d04b436b500367a3000701d989">symbolMode</a> = <span class="keyword">true</span>;
<a name="l02487"></a>02487     <a class="code" href="classQucsApp.html#a3276d8bf976ce9cbe96880dcb88bfc33">changeSchematicSymbolMode</a>(SDoc);
<a name="l02488"></a>02488     SDoc-&gt;<a class="code" href="classSchematic.html#a0571a69ffa10a244468a37cab8213c0e">becomeCurrent</a>(<span class="keyword">true</span>);
<a name="l02489"></a>02489     SDoc-&gt;viewport()-&gt;update();
<a name="l02490"></a>02490     <a class="code" href="classQucsApp.html#a372ee1fa475722ca832511027a34c383">view</a>-&gt;<a class="code" href="classMouseActions.html#ad43ee60feb7239ee9692300605dc9aed">drawn</a> = <span class="keyword">false</span>;
<a name="l02491"></a>02491   }
<a name="l02492"></a>02492   <span class="comment">// in a normal schematic, data display or symbol file</span>
<a name="l02493"></a>02493   <span class="keywordflow">else</span> {
<a name="l02494"></a>02494     <a class="code" href="classSchematic.html">Schematic</a> *SDoc = (<a class="code" href="classSchematic.html">Schematic</a>*)w;
<a name="l02495"></a>02495     <span class="comment">// in a symbol file</span>
<a name="l02496"></a>02496     <span class="keywordflow">if</span>(SDoc-&gt;<a class="code" href="classQucsDoc.html#a2d87112c4f75a4770c9311bb6c2d407b">DocName</a>.right(4) == <span class="stringliteral">&quot;.sym&quot;</span>) {
<a name="l02497"></a>02497       <a class="code" href="classQucsApp.html#a02a4d768683eb57a7f45d22e57478477">slotChangePage</a>(SDoc-&gt;<a class="code" href="classQucsDoc.html#a2d87112c4f75a4770c9311bb6c2d407b">DocName</a>, SDoc-&gt;<a class="code" href="classQucsDoc.html#aa478fdc99a03ad789a287aa62c114fd1">DataDisplay</a>);
<a name="l02498"></a>02498     }
<a name="l02499"></a>02499     <span class="comment">// in a normal schematic</span>
<a name="l02500"></a>02500     <span class="keywordflow">else</span> {
<a name="l02501"></a>02501       <a class="code" href="classQucsApp.html#acf15a168d7497bc25103174b31019db7">slotHideEdit</a>(); <span class="comment">// disable text edit of component property</span>
<a name="l02502"></a>02502       SDoc-&gt;<a class="code" href="classSchematic.html#a8de2cc6dc40a7f5c46422e6c1c7bbc93">switchPaintMode</a>();   <span class="comment">// twist the view coordinates</span>
<a name="l02503"></a>02503       <a class="code" href="classQucsApp.html#a3276d8bf976ce9cbe96880dcb88bfc33">changeSchematicSymbolMode</a>(SDoc);
<a name="l02504"></a>02504       SDoc-&gt;<a class="code" href="classSchematic.html#a0571a69ffa10a244468a37cab8213c0e">becomeCurrent</a>(<span class="keyword">true</span>);
<a name="l02505"></a>02505       SDoc-&gt;viewport()-&gt;update();
<a name="l02506"></a>02506       <a class="code" href="classQucsApp.html#a372ee1fa475722ca832511027a34c383">view</a>-&gt;<a class="code" href="classMouseActions.html#ad43ee60feb7239ee9692300605dc9aed">drawn</a> = <span class="keyword">false</span>;
<a name="l02507"></a>02507     }
<a name="l02508"></a>02508   }
<a name="l02509"></a>02509 }
<a name="l02510"></a>02510 
<a name="l02511"></a>02511 <span class="comment">// -----------------------------------------------------------</span>
<a name="l02512"></a><a class="code" href="classQucsApp.html#a4e4db0782f2168e9b6c4a63f7b5d6b67">02512</a> <span class="keywordtype">void</span> <a class="code" href="classQucsApp.html#a4e4db0782f2168e9b6c4a63f7b5d6b67">QucsApp::slotPowerMatching</a>()
<a name="l02513"></a>02513 {
<a name="l02514"></a>02514   <span class="keywordflow">if</span>(!<a class="code" href="classQucsApp.html#a372ee1fa475722ca832511027a34c383">view</a>-&gt;<a class="code" href="classMouseActions.html#ae5f6e9429f9649e28ee9e39d2bbd5250">focusElement</a>) <span class="keywordflow">return</span>;
<a name="l02515"></a>02515   <span class="keywordflow">if</span>(<a class="code" href="classQucsApp.html#a372ee1fa475722ca832511027a34c383">view</a>-&gt;<a class="code" href="classMouseActions.html#ae5f6e9429f9649e28ee9e39d2bbd5250">focusElement</a>-&gt;<a class="code" href="classElement.html#aba683e0a0371d268466c70134363b4b8">Type</a> != <a class="code" href="element_8h.html#a5dfc1acb78f7b82250ef6b0f21b31b97">isMarker</a>) <span class="keywordflow">return</span>;
<a name="l02516"></a>02516   <a class="code" href="classMarker.html" title="The Marker class implements the marker object used for all the diagram.">Marker</a> *pm = (<a class="code" href="classMarker.html" title="The Marker class implements the marker object used for all the diagram.">Marker</a>*)<a class="code" href="classQucsApp.html#a372ee1fa475722ca832511027a34c383">view</a>-&gt;<a class="code" href="classMouseActions.html#ae5f6e9429f9649e28ee9e39d2bbd5250">focusElement</a>;
<a name="l02517"></a>02517 
<a name="l02518"></a>02518 <span class="comment">//  double Z0 = 50.0;</span>
<a name="l02519"></a>02519   QString Var = pm-&gt;<a class="code" href="classMarker.html#a0e96a41f2f6c427a6fd3efc6abeed175">pGraph</a>-&gt;<a class="code" href="classGraph.html#ae8e637ef53e44a2a5b3f04026068ac4d">Var</a>;
<a name="l02520"></a>02520   <span class="keywordtype">double</span> Imag = pm-&gt;<a class="code" href="classMarker.html#a7afbcdee29443013516c148c96ca2913">powImag</a>();
<a name="l02521"></a>02521   <span class="keywordflow">if</span>(Var == <span class="stringliteral">&quot;Sopt&quot;</span>)  <span class="comment">// noise matching ?</span>
<a name="l02522"></a>02522     Imag *= -1.0;
<a name="l02523"></a>02523 
<a name="l02524"></a>02524   <a class="code" href="classMatchDialog.html">MatchDialog</a> *Dia = <span class="keyword">new</span> <a class="code" href="classMatchDialog.html">MatchDialog</a>(<span class="keyword">this</span>);
<a name="l02525"></a>02525   Dia-&gt;<a class="code" href="classMatchDialog.html#ace266fdee1838b86de026de3e0889c84">TwoCheck</a>-&gt;setChecked(<span class="keyword">false</span>);
<a name="l02526"></a>02526   Dia-&gt;<a class="code" href="classMatchDialog.html#ace266fdee1838b86de026de3e0889c84">TwoCheck</a>-&gt;setEnabled(<span class="keyword">false</span>);
<a name="l02527"></a>02527 <span class="comment">//  Dia-&gt;Ref1Edit-&gt;setText(QString::number(Z0));</span>
<a name="l02528"></a>02528   Dia-&gt;<a class="code" href="classMatchDialog.html#a0a3ab93175fecb4250c2bad18662ae99">S11magEdit</a>-&gt;setText(QString::number(pm-&gt;<a class="code" href="classMarker.html#a9bbd3f0bd40a05deca0f542e351d8b68">powReal</a>()));
<a name="l02529"></a>02529   Dia-&gt;<a class="code" href="classMatchDialog.html#a4efab3bd182547e1d6106c99f3d3376b">S11degEdit</a>-&gt;setText(QString::number(Imag));
<a name="l02530"></a>02530   Dia-&gt;<a class="code" href="classMatchDialog.html#a89099445886eea735ec427c3dc051d8d">setFrequency</a>(pm-&gt;<a class="code" href="classMarker.html#a8683011b90f8560ece2526ec42140a58">powFreq</a>());
<a name="l02531"></a>02531 
<a name="l02532"></a>02532   <a class="code" href="classQucsApp.html#a11393a207c8496575dfb181062473c49">slotToPage</a>();
<a name="l02533"></a>02533   <span class="keywordflow">if</span>(Dia-&gt;exec() != QDialog::Accepted)
<a name="l02534"></a>02534     <span class="keywordflow">return</span>;
<a name="l02535"></a>02535 }
<a name="l02536"></a>02536 
<a name="l02537"></a>02537 <span class="comment">// -----------------------------------------------------------</span>
<a name="l02538"></a><a class="code" href="classQucsApp.html#acb4deaa2ad9fd99eb5049199622bbfaf">02538</a> <span class="keywordtype">void</span> <a class="code" href="classQucsApp.html#acb4deaa2ad9fd99eb5049199622bbfaf">QucsApp::slot2PortMatching</a>()
<a name="l02539"></a>02539 {
<a name="l02540"></a>02540   <span class="keywordflow">if</span>(!<a class="code" href="classQucsApp.html#a372ee1fa475722ca832511027a34c383">view</a>-&gt;<a class="code" href="classMouseActions.html#ae5f6e9429f9649e28ee9e39d2bbd5250">focusElement</a>) <span class="keywordflow">return</span>;
<a name="l02541"></a>02541   <span class="keywordflow">if</span>(<a class="code" href="classQucsApp.html#a372ee1fa475722ca832511027a34c383">view</a>-&gt;<a class="code" href="classMouseActions.html#ae5f6e9429f9649e28ee9e39d2bbd5250">focusElement</a>-&gt;<a class="code" href="classElement.html#aba683e0a0371d268466c70134363b4b8">Type</a> != <a class="code" href="element_8h.html#a5dfc1acb78f7b82250ef6b0f21b31b97">isMarker</a>) <span class="keywordflow">return</span>;
<a name="l02542"></a>02542   <a class="code" href="classMarker.html" title="The Marker class implements the marker object used for all the diagram.">Marker</a> *pm = (<a class="code" href="classMarker.html" title="The Marker class implements the marker object used for all the diagram.">Marker</a>*)<a class="code" href="classQucsApp.html#a372ee1fa475722ca832511027a34c383">view</a>-&gt;<a class="code" href="classMouseActions.html#ae5f6e9429f9649e28ee9e39d2bbd5250">focusElement</a>;
<a name="l02543"></a>02543 
<a name="l02544"></a>02544   QString DataSet;
<a name="l02545"></a>02545   <a class="code" href="classSchematic.html">Schematic</a> *Doc = (<a class="code" href="classSchematic.html">Schematic</a>*)<a class="code" href="classQucsApp.html#ae7612793599ca4f5106f7e9f488d4225">DocumentTab</a>-&gt;currentWidget();
<a name="l02546"></a>02546   <span class="keywordtype">int</span> z = pm-&gt;<a class="code" href="classMarker.html#a0e96a41f2f6c427a6fd3efc6abeed175">pGraph</a>-&gt;<a class="code" href="classGraph.html#ae8e637ef53e44a2a5b3f04026068ac4d">Var</a>.indexOf(<span class="charliteral">&#39;:&#39;</span>);
<a name="l02547"></a>02547   <span class="keywordflow">if</span>(z &lt;= 0)  DataSet = Doc-&gt;DataSet;
<a name="l02548"></a>02548   <span class="keywordflow">else</span>  DataSet = pm-&gt;<a class="code" href="classMarker.html#a0e96a41f2f6c427a6fd3efc6abeed175">pGraph</a>-&gt;<a class="code" href="classGraph.html#ae8e637ef53e44a2a5b3f04026068ac4d">Var</a>.mid(z+1);
<a name="l02549"></a>02549   <span class="keywordtype">double</span> Freq = pm-&gt;<a class="code" href="classMarker.html#a8683011b90f8560ece2526ec42140a58">powFreq</a>();
<a name="l02550"></a>02550 
<a name="l02551"></a>02551   QFileInfo Info(Doc-&gt;DocName);
<a name="l02552"></a>02552   DataSet = Info.path()+QDir::separator()+DataSet;
<a name="l02553"></a>02553 
<a name="l02554"></a>02554   <a class="code" href="classDiagram.html" title="The Diagram class is a superclass for diagrams.">Diagram</a> *Diag = <span class="keyword">new</span> <a class="code" href="classDiagram.html" title="The Diagram class is a superclass for diagrams.">Diagram</a>();
<a name="l02555"></a>02555 
<a name="l02556"></a>02556   <span class="comment">// FIXME: use normal Diagrams.</span>
<a name="l02557"></a>02557   <a class="code" href="classGraph.html" title="prepare data for plotting purposes in Diagram.">Graph</a> *pg = <span class="keyword">new</span> <a class="code" href="classGraph.html" title="prepare data for plotting purposes in Diagram.">Graph</a>(Diag, <span class="stringliteral">&quot;S[1,1]&quot;</span>);
<a name="l02558"></a>02558   Diag-&gt;<a class="code" href="classDiagram.html#ad9e7b76d184cc5414e4e779c184698a9">Graphs</a>.append(pg);
<a name="l02559"></a>02559   <span class="keywordflow">if</span>(!pg-&gt;<a class="code" href="classGraph.html#a2e50c119e276593ffb765d793fbd82d6" title="does not (yet) load a dat file.">loadDatFile</a>(DataSet)) {
<a name="l02560"></a>02560     QMessageBox::critical(0, tr(<span class="stringliteral">&quot;Error&quot;</span>), tr(<span class="stringliteral">&quot;Could not load S[1,1].&quot;</span>));
<a name="l02561"></a>02561     <span class="keywordflow">return</span>;
<a name="l02562"></a>02562   }
<a name="l02563"></a>02563 
<a name="l02564"></a>02564   pg = <span class="keyword">new</span> <a class="code" href="classGraph.html" title="prepare data for plotting purposes in Diagram.">Graph</a>(Diag, <span class="stringliteral">&quot;S[1,2]&quot;</span>);
<a name="l02565"></a>02565   Diag-&gt;<a class="code" href="classDiagram.html#ad9e7b76d184cc5414e4e779c184698a9">Graphs</a>.append(pg);
<a name="l02566"></a>02566   <span class="keywordflow">if</span>(!pg-&gt;<a class="code" href="classGraph.html#a2e50c119e276593ffb765d793fbd82d6" title="does not (yet) load a dat file.">loadDatFile</a>(DataSet)) {
<a name="l02567"></a>02567     QMessageBox::critical(0, tr(<span class="stringliteral">&quot;Error&quot;</span>), tr(<span class="stringliteral">&quot;Could not load S[1,2].&quot;</span>));
<a name="l02568"></a>02568     <span class="keywordflow">return</span>;
<a name="l02569"></a>02569   }
<a name="l02570"></a>02570 
<a name="l02571"></a>02571   pg = <span class="keyword">new</span> <a class="code" href="classGraph.html" title="prepare data for plotting purposes in Diagram.">Graph</a>(Diag, <span class="stringliteral">&quot;S[2,1]&quot;</span>);
<a name="l02572"></a>02572   Diag-&gt;<a class="code" href="classDiagram.html#ad9e7b76d184cc5414e4e779c184698a9">Graphs</a>.append(pg);
<a name="l02573"></a>02573   <span class="keywordflow">if</span>(!pg-&gt;<a class="code" href="classGraph.html#a2e50c119e276593ffb765d793fbd82d6" title="does not (yet) load a dat file.">loadDatFile</a>(DataSet)) {
<a name="l02574"></a>02574     QMessageBox::critical(0, tr(<span class="stringliteral">&quot;Error&quot;</span>), tr(<span class="stringliteral">&quot;Could not load S[2,1].&quot;</span>));
<a name="l02575"></a>02575     <span class="keywordflow">return</span>;
<a name="l02576"></a>02576   }
<a name="l02577"></a>02577 
<a name="l02578"></a>02578   pg = <span class="keyword">new</span> <a class="code" href="classGraph.html" title="prepare data for plotting purposes in Diagram.">Graph</a>(Diag, <span class="stringliteral">&quot;S[2,2]&quot;</span>);
<a name="l02579"></a>02579   Diag-&gt;<a class="code" href="classDiagram.html#ad9e7b76d184cc5414e4e779c184698a9">Graphs</a>.append(pg);
<a name="l02580"></a>02580   <span class="keywordflow">if</span>(!pg-&gt;<a class="code" href="classGraph.html#a2e50c119e276593ffb765d793fbd82d6" title="does not (yet) load a dat file.">loadDatFile</a>(DataSet)) {
<a name="l02581"></a>02581     QMessageBox::critical(0, tr(<span class="stringliteral">&quot;Error&quot;</span>), tr(<span class="stringliteral">&quot;Could not load S[2,2].&quot;</span>));
<a name="l02582"></a>02582     <span class="keywordflow">return</span>;
<a name="l02583"></a>02583   }
<a name="l02584"></a>02584 
<a name="l02585"></a>02585   <a class="code" href="structDataX.html">DataX</a> <span class="keyword">const</span> *Data = Diag-&gt;<a class="code" href="classDiagram.html#ad9e7b76d184cc5414e4e779c184698a9">Graphs</a>.first()-&gt;axis(0);
<a name="l02586"></a>02586   <span class="keywordflow">if</span>(Data-&gt;<a class="code" href="structDataX.html#a1690cc50b1d5035ab56295f82081a025">Var</a> != <span class="stringliteral">&quot;frequency&quot;</span>) {
<a name="l02587"></a>02587     QMessageBox::critical(0, tr(<span class="stringliteral">&quot;Error&quot;</span>), tr(<span class="stringliteral">&quot;Wrong dependency!&quot;</span>));
<a name="l02588"></a>02588     <span class="keywordflow">return</span>;
<a name="l02589"></a>02589   }
<a name="l02590"></a>02590 
<a name="l02591"></a>02591   <span class="keywordtype">double</span> *Value = Data-&gt;<a class="code" href="structDataX.html#a13ca25f2ae93add390aa37dc4e6291f4">Points</a>;
<a name="l02592"></a>02592   <span class="comment">// search for values for chosen frequency</span>
<a name="l02593"></a>02593   <span class="keywordflow">for</span>(z=0; z&lt;Data-&gt;<a class="code" href="structDataX.html#a310443779b9890de9b343449db841197">count</a>; z++)
<a name="l02594"></a>02594     <span class="keywordflow">if</span>(*(Value++) == Freq) <span class="keywordflow">break</span>;
<a name="l02595"></a>02595 
<a name="l02596"></a>02596   <span class="comment">// get S-parameters</span>
<a name="l02597"></a>02597   <span class="keywordtype">double</span> S11real = *(Diag-&gt;<a class="code" href="classDiagram.html#ad9e7b76d184cc5414e4e779c184698a9">Graphs</a>.at(0)-&gt;cPointsY + 2*z);
<a name="l02598"></a>02598   <span class="keywordtype">double</span> S11imag = *(Diag-&gt;<a class="code" href="classDiagram.html#ad9e7b76d184cc5414e4e779c184698a9">Graphs</a>.at(0)-&gt;cPointsY + 2*z + 1);
<a name="l02599"></a>02599   <span class="keywordtype">double</span> S12real = *(Diag-&gt;<a class="code" href="classDiagram.html#ad9e7b76d184cc5414e4e779c184698a9">Graphs</a>.at(1)-&gt;cPointsY + 2*z);
<a name="l02600"></a>02600   <span class="keywordtype">double</span> S12imag = *(Diag-&gt;<a class="code" href="classDiagram.html#ad9e7b76d184cc5414e4e779c184698a9">Graphs</a>.at(1)-&gt;cPointsY + 2*z + 1);
<a name="l02601"></a>02601   <span class="keywordtype">double</span> S21real = *(Diag-&gt;<a class="code" href="classDiagram.html#ad9e7b76d184cc5414e4e779c184698a9">Graphs</a>.at(2)-&gt;cPointsY + 2*z);
<a name="l02602"></a>02602   <span class="keywordtype">double</span> S21imag = *(Diag-&gt;<a class="code" href="classDiagram.html#ad9e7b76d184cc5414e4e779c184698a9">Graphs</a>.at(2)-&gt;cPointsY + 2*z + 1);
<a name="l02603"></a>02603   <span class="keywordtype">double</span> S22real = *(Diag-&gt;<a class="code" href="classDiagram.html#ad9e7b76d184cc5414e4e779c184698a9">Graphs</a>.at(3)-&gt;cPointsY + 2*z);
<a name="l02604"></a>02604   <span class="keywordtype">double</span> S22imag = *(Diag-&gt;<a class="code" href="classDiagram.html#ad9e7b76d184cc5414e4e779c184698a9">Graphs</a>.at(3)-&gt;cPointsY + 2*z + 1);
<a name="l02605"></a>02605   <span class="keyword">delete</span> Diag;
<a name="l02606"></a>02606 
<a name="l02607"></a>02607   <a class="code" href="classMatchDialog.html">MatchDialog</a> *Dia = <span class="keyword">new</span> <a class="code" href="classMatchDialog.html">MatchDialog</a>(<span class="keyword">this</span>);
<a name="l02608"></a>02608   Dia-&gt;<a class="code" href="classMatchDialog.html#ace266fdee1838b86de026de3e0889c84">TwoCheck</a>-&gt;setEnabled(<span class="keyword">false</span>);
<a name="l02609"></a>02609   Dia-&gt;<a class="code" href="classMatchDialog.html#a89099445886eea735ec427c3dc051d8d">setFrequency</a>(Freq);
<a name="l02610"></a>02610   Dia-&gt;<a class="code" href="classMatchDialog.html#a0a3ab93175fecb4250c2bad18662ae99">S11magEdit</a>-&gt;setText(QString::number(S11real));
<a name="l02611"></a>02611   Dia-&gt;<a class="code" href="classMatchDialog.html#a4efab3bd182547e1d6106c99f3d3376b">S11degEdit</a>-&gt;setText(QString::number(S11imag));
<a name="l02612"></a>02612   Dia-&gt;<a class="code" href="classMatchDialog.html#a6aa2971f444c40517f0137eaf62c34c5">S12magEdit</a>-&gt;setText(QString::number(S12real));
<a name="l02613"></a>02613   Dia-&gt;<a class="code" href="classMatchDialog.html#a5f6f8803cfc284e6bd4b8ab8d56b375e">S12degEdit</a>-&gt;setText(QString::number(S12imag));
<a name="l02614"></a>02614   Dia-&gt;<a class="code" href="classMatchDialog.html#aa06199c7592f8b43821b4fbb94181e82">S21magEdit</a>-&gt;setText(QString::number(S21real));
<a name="l02615"></a>02615   Dia-&gt;<a class="code" href="classMatchDialog.html#a641522adf3118fdd01eaec24ec86c8e7">S21degEdit</a>-&gt;setText(QString::number(S21imag));
<a name="l02616"></a>02616   Dia-&gt;<a class="code" href="classMatchDialog.html#ad248af8a0e1ddce64b9be99b531f03ac">S22magEdit</a>-&gt;setText(QString::number(S22real));
<a name="l02617"></a>02617   Dia-&gt;<a class="code" href="classMatchDialog.html#ad72a1534f358477ec089644ac6b21d80">S22degEdit</a>-&gt;setText(QString::number(S22imag));
<a name="l02618"></a>02618 
<a name="l02619"></a>02619   <a class="code" href="classQucsApp.html#a11393a207c8496575dfb181062473c49">slotToPage</a>();
<a name="l02620"></a>02620   <span class="keywordflow">if</span>(Dia-&gt;exec() != QDialog::Accepted)
<a name="l02621"></a>02621     <span class="keywordflow">return</span>;
<a name="l02622"></a>02622 }
<a name="l02623"></a>02623 
<a name="l02624"></a>02624 <span class="comment">// -----------------------------------------------------------</span>
<a name="l02625"></a>02625 <span class="comment">// Is called if the &quot;edit&quot; action is clicked on right mouse button menu.</span>
<a name="l02626"></a><a class="code" href="classQucsApp.html#a94fe23ddbca75bca76314088951d8b96">02626</a> <span class="keywordtype">void</span> <a class="code" href="classQucsApp.html#a94fe23ddbca75bca76314088951d8b96">QucsApp::slotEditElement</a>()
<a name="l02627"></a>02627 {
<a name="l02628"></a>02628   <span class="keywordflow">if</span>(<a class="code" href="classQucsApp.html#a372ee1fa475722ca832511027a34c383">view</a>-&gt;<a class="code" href="classMouseActions.html#a08b72068f8a83c4b66c60256c25955ee">focusMEvent</a>)
<a name="l02629"></a>02629     <a class="code" href="classQucsApp.html#a372ee1fa475722ca832511027a34c383">view</a>-&gt;<a class="code" href="classMouseActions.html#a443823ac72fe6537c71ec23fcd53392d">editElement</a>((<a class="code" href="classSchematic.html">Schematic</a>*)<a class="code" href="classQucsApp.html#ae7612793599ca4f5106f7e9f488d4225">DocumentTab</a>-&gt;currentWidget(), <a class="code" href="classQucsApp.html#a372ee1fa475722ca832511027a34c383">view</a>-&gt;<a class="code" href="classMouseActions.html#a08b72068f8a83c4b66c60256c25955ee">focusMEvent</a>);
<a name="l02630"></a>02630 }
<a name="l02631"></a>02631 
<a name="l02632"></a>02632 <span class="comment">// -----------------------------------------------------------</span>
<a name="l02633"></a>02633 <span class="comment">// Hides the edit for component property. Called e.g. if QLineEdit</span>
<a name="l02634"></a>02634 <span class="comment">// looses the focus.</span>
<a name="l02635"></a><a class="code" href="classQucsApp.html#acf15a168d7497bc25103174b31019db7">02635</a> <span class="keywordtype">void</span> <a class="code" href="classQucsApp.html#acf15a168d7497bc25103174b31019db7">QucsApp::slotHideEdit</a>()
<a name="l02636"></a>02636 {
<a name="l02637"></a>02637   <a class="code" href="classQucsApp.html#ab1126a50f9800423f4810a36c688f4ed">editText</a>-&gt;setParent(<span class="keyword">this</span>, 0);
<a name="l02638"></a>02638   <a class="code" href="classQucsApp.html#ab1126a50f9800423f4810a36c688f4ed">editText</a>-&gt;setHidden(<span class="keyword">true</span>);
<a name="l02639"></a>02639 }
<a name="l02640"></a>02640 
<a name="l02641"></a>02641 <span class="comment">// -----------------------------------------------------------</span>
<a name="l02642"></a>02642 <span class="comment">// set document tab icon to smallsave_xpm or empty_xpm</span>
<a name="l02643"></a><a class="code" href="classQucsApp.html#ac2e3651a40cf4d97bf06c58aef46fad4">02643</a> <span class="keywordtype">void</span> <a class="code" href="classQucsApp.html#ac2e3651a40cf4d97bf06c58aef46fad4">QucsApp::slotFileChanged</a>(<span class="keywordtype">bool</span> changed)
<a name="l02644"></a>02644 {
<a name="l02645"></a>02645   <a class="code" href="classQucsApp.html#ae7612793599ca4f5106f7e9f488d4225">DocumentTab</a>-&gt;setTabIcon(<a class="code" href="classQucsApp.html#ae7612793599ca4f5106f7e9f488d4225">DocumentTab</a>-&gt;currentIndex(),
<a name="l02646"></a>02646       QPixmap((changed)? <a class="code" href="qucs_8cpp.html#ab308523b9287d6370177a8b11b417d26">smallsave_xpm</a> : <a class="code" href="qucs_8cpp.html#a098a06ee0c473d9178da66df32798581">empty_xpm</a>));
<a name="l02647"></a>02647 }
<a name="l02648"></a>02648 
<a name="l02649"></a>02649 <span class="comment">// -----------------------------------------------------------</span>
<a name="l02650"></a>02650 <span class="comment">// Update project view by call refresh function</span>
<a name="l02651"></a>02651 <span class="comment">// looses the focus.</span>
<a name="l02652"></a><a class="code" href="classQucsApp.html#abc9b64e52b905e3a287dc618d8507d2c">02652</a> <span class="keywordtype">void</span> <a class="code" href="classQucsApp.html#abc9b64e52b905e3a287dc618d8507d2c">QucsApp::slotUpdateTreeview</a>()
<a name="l02653"></a>02653 {
<a name="l02654"></a>02654   <a class="code" href="classQucsApp.html#a4fb9ed646ac33093c199803e9625823d">Content</a>-&gt;refresh();
<a name="l02655"></a>02655 }
<a name="l02656"></a>02656 
<a name="l02657"></a>02657 <span class="comment">// -----------------------------------------------------------</span>
<a name="l02658"></a>02658 <span class="comment">// Searches the qucs path list for all schematic files and creates</span>
<a name="l02659"></a>02659 <span class="comment">// a hash for lookup later</span>
<a name="l02660"></a><a class="code" href="classQucsApp.html#ae223813596b54c221cd292adb3b81c0f">02660</a> <span class="keywordtype">void</span> <a class="code" href="classQucsApp.html#ae223813596b54c221cd292adb3b81c0f">QucsApp::updateSchNameHash</a>(<span class="keywordtype">void</span>)
<a name="l02661"></a>02661 {
<a name="l02662"></a>02662     <span class="comment">// update the list of paths to search in qucsPathList, this</span>
<a name="l02663"></a>02663     <span class="comment">// removes nonexisting entries</span>
<a name="l02664"></a>02664     <a class="code" href="classQucsApp.html#a55673f055494a3a780b94bc77810eeb7">updatePathList</a>();
<a name="l02665"></a>02665 
<a name="l02666"></a>02666     <span class="comment">// now go through the paths creating a map to all the schematic files</span>
<a name="l02667"></a>02667     <span class="comment">// found in the directories. Note that we go through the list of paths from</span>
<a name="l02668"></a>02668     <span class="comment">// first index to last index. Since keys are unique it means schematic files</span>
<a name="l02669"></a>02669     <span class="comment">// in directories at the end of the list take precendence over those at the</span>
<a name="l02670"></a>02670     <span class="comment">// start of the list, we should warn about shadowing of schematic files in</span>
<a name="l02671"></a>02671     <span class="comment">// this way in the future</span>
<a name="l02672"></a>02672     QStringList nameFilter;
<a name="l02673"></a>02673     nameFilter &lt;&lt; <span class="stringliteral">&quot;*.sch&quot;</span>;
<a name="l02674"></a>02674 
<a name="l02675"></a>02675     <span class="comment">// clear out any existing hash table entriess</span>
<a name="l02676"></a>02676     <a class="code" href="classQucsApp.html#a7b6dcb0e78697bce6f8d7bea762bf859">schNameHash</a>.clear();
<a name="l02677"></a>02677 
<a name="l02678"></a>02678     <span class="keywordflow">foreach</span> (QString qucspath, <a class="code" href="main_8cpp.html#a22af65502ad1b28e5dbc0e2b8a6ce317">qucsPathList</a>) {
<a name="l02679"></a>02679         QDir thispath(qucspath);
<a name="l02680"></a>02680         <span class="comment">// get all the schematic files in the directory</span>
<a name="l02681"></a>02681         QFileInfoList schfilesList = thispath.entryInfoList( nameFilter, QDir::Files );
<a name="l02682"></a>02682         <span class="comment">// put each one in the hash table with the unique key the base name of</span>
<a name="l02683"></a>02683         <span class="comment">// the file, note this will overwrite the value if the key already exists</span>
<a name="l02684"></a>02684         <span class="keywordflow">foreach</span> (QFileInfo schfile, schfilesList) {
<a name="l02685"></a>02685             QString bn = schfile.completeBaseName();
<a name="l02686"></a>02686             <a class="code" href="classQucsApp.html#a7b6dcb0e78697bce6f8d7bea762bf859">schNameHash</a>[schfile.completeBaseName()] = schfile.absoluteFilePath();
<a name="l02687"></a>02687         }
<a name="l02688"></a>02688     }
<a name="l02689"></a>02689 
<a name="l02690"></a>02690     <span class="comment">// finally check the home/working directory</span>
<a name="l02691"></a>02691     QDir thispath(<a class="code" href="main_8cpp.html#ac2e3fb7eed4aa9bd981210dc5df2e02e">QucsSettings</a>.<a class="code" href="structtQucsSettings.html#ac416ec4c4a8bfc243ea836dbf334ccae">QucsWorkDir</a>);
<a name="l02692"></a>02692     QFileInfoList schfilesList = thispath.entryInfoList( nameFilter, QDir::Files );
<a name="l02693"></a>02693     <span class="comment">// put each one in the hash table with the unique key the base name of</span>
<a name="l02694"></a>02694     <span class="comment">// the file, note this will overwrite the value if the key already exists</span>
<a name="l02695"></a>02695     <span class="keywordflow">foreach</span> (QFileInfo schfile, schfilesList) {
<a name="l02696"></a>02696         <a class="code" href="classQucsApp.html#a7b6dcb0e78697bce6f8d7bea762bf859">schNameHash</a>[schfile.completeBaseName()] = schfile.absoluteFilePath();
<a name="l02697"></a>02697     }
<a name="l02698"></a>02698 }
<a name="l02699"></a>02699 
<a name="l02700"></a>02700 <span class="comment">// -----------------------------------------------------------</span>
<a name="l02701"></a>02701 <span class="comment">// Searches the qucs path list for all spice files and creates</span>
<a name="l02702"></a>02702 <span class="comment">// a hash for lookup later</span>
<a name="l02703"></a><a class="code" href="classQucsApp.html#ad5e4abc792d281a23c167bedbca47a0f">02703</a> <span class="keywordtype">void</span> <a class="code" href="classQucsApp.html#ad5e4abc792d281a23c167bedbca47a0f">QucsApp::updateSpiceNameHash</a>(<span class="keywordtype">void</span>)
<a name="l02704"></a>02704 {
<a name="l02705"></a>02705     <span class="comment">// update the list of paths to search in qucsPathList, this</span>
<a name="l02706"></a>02706     <span class="comment">// removes nonexisting entries</span>
<a name="l02707"></a>02707     <a class="code" href="classQucsApp.html#a55673f055494a3a780b94bc77810eeb7">updatePathList</a>();
<a name="l02708"></a>02708 
<a name="l02709"></a>02709     <span class="comment">// now go through the paths creating a map to all the spice files</span>
<a name="l02710"></a>02710     <span class="comment">// found in the directories. Note that we go through the list of paths from</span>
<a name="l02711"></a>02711     <span class="comment">// first index to last index. Since keys are unique it means spice files</span>
<a name="l02712"></a>02712     <span class="comment">// in directories at the end of the list take precendence over those at the</span>
<a name="l02713"></a>02713     <span class="comment">// start of the list, we should warn about shadowing of spice files in</span>
<a name="l02714"></a>02714     <span class="comment">// this way in the future</span>
<a name="l02715"></a>02715 
<a name="l02716"></a>02716     <span class="comment">// clear out any existing hash table entriess</span>
<a name="l02717"></a>02717     <a class="code" href="classQucsApp.html#a9aa72b1c3db5772cfed224fbb3f5158f">spiceNameHash</a>.clear();
<a name="l02718"></a>02718 
<a name="l02719"></a>02719     <span class="keywordflow">foreach</span> (QString qucspath, <a class="code" href="main_8cpp.html#a22af65502ad1b28e5dbc0e2b8a6ce317">qucsPathList</a>) {
<a name="l02720"></a>02720         QDir thispath(qucspath);
<a name="l02721"></a>02721         <span class="comment">// get all the schematic files in the directory</span>
<a name="l02722"></a>02722         QFileInfoList spicefilesList = thispath.entryInfoList( <a class="code" href="classQucsApp.html#aab06a01bf8066d0678a800fc6ea958e1">spiceExtensions</a>, QDir::Files );
<a name="l02723"></a>02723         <span class="comment">// put each one in the hash table with the unique key the base name of</span>
<a name="l02724"></a>02724         <span class="comment">// the file, note this will overwrite the value if the key already exists</span>
<a name="l02725"></a>02725         <span class="keywordflow">foreach</span> (QFileInfo spicefile, spicefilesList) {
<a name="l02726"></a>02726             QString bn = spicefile.completeBaseName();
<a name="l02727"></a>02727             <a class="code" href="classQucsApp.html#a7b6dcb0e78697bce6f8d7bea762bf859">schNameHash</a>[spicefile.completeBaseName()] = spicefile.absoluteFilePath();
<a name="l02728"></a>02728         }
<a name="l02729"></a>02729     }
<a name="l02730"></a>02730 
<a name="l02731"></a>02731     <span class="comment">// finally check the home/working directory</span>
<a name="l02732"></a>02732     QDir thispath(<a class="code" href="main_8cpp.html#ac2e3fb7eed4aa9bd981210dc5df2e02e">QucsSettings</a>.<a class="code" href="structtQucsSettings.html#ac416ec4c4a8bfc243ea836dbf334ccae">QucsWorkDir</a>);
<a name="l02733"></a>02733     QFileInfoList spicefilesList = thispath.entryInfoList( <a class="code" href="classQucsApp.html#aab06a01bf8066d0678a800fc6ea958e1">spiceExtensions</a>, QDir::Files );
<a name="l02734"></a>02734     <span class="comment">// put each one in the hash table with the unique key the base name of</span>
<a name="l02735"></a>02735     <span class="comment">// the file, note this will overwrite the value if the key already exists</span>
<a name="l02736"></a>02736     <span class="keywordflow">foreach</span> (QFileInfo spicefile, spicefilesList) {
<a name="l02737"></a>02737         <a class="code" href="classQucsApp.html#a9aa72b1c3db5772cfed224fbb3f5158f">spiceNameHash</a>[spicefile.completeBaseName()] = spicefile.absoluteFilePath();
<a name="l02738"></a>02738     }
<a name="l02739"></a>02739 }
<a name="l02740"></a>02740 
<a name="l02741"></a>02741 <span class="comment">// -----------------------------------------------------------</span>
<a name="l02742"></a>02742 <span class="comment">// update the list of paths, pruning non-existing paths</span>
<a name="l02743"></a><a class="code" href="classQucsApp.html#a55673f055494a3a780b94bc77810eeb7">02743</a> <span class="keywordtype">void</span> <a class="code" href="classQucsApp.html#a55673f055494a3a780b94bc77810eeb7">QucsApp::updatePathList</a>(<span class="keywordtype">void</span>)
<a name="l02744"></a>02744 {
<a name="l02745"></a>02745     <span class="comment">// check each path actually exists, if not remove it</span>
<a name="l02746"></a>02746     QMutableListIterator&lt;QString&gt; i(<a class="code" href="main_8cpp.html#a22af65502ad1b28e5dbc0e2b8a6ce317">qucsPathList</a>);
<a name="l02747"></a>02747     <span class="keywordflow">while</span> (i.hasNext()) {
<a name="l02748"></a>02748         i.next();
<a name="l02749"></a>02749         QDir thispath(i.value());
<a name="l02750"></a>02750         <span class="keywordflow">if</span> (!thispath.exists())
<a name="l02751"></a>02751         {
<a name="l02752"></a>02752             <span class="comment">// the path does not exist, remove it from the list</span>
<a name="l02753"></a>02753             i.remove();
<a name="l02754"></a>02754         }
<a name="l02755"></a>02755     }
<a name="l02756"></a>02756 }
<a name="l02757"></a>02757 
<a name="l02758"></a>02758 <span class="comment">// replace the old path list with a new one</span>
<a name="l02759"></a><a class="code" href="classQucsApp.html#a47cd890acf248b1a7310dafc5f62b9bf">02759</a> <span class="keywordtype">void</span> <a class="code" href="classQucsApp.html#a55673f055494a3a780b94bc77810eeb7">QucsApp::updatePathList</a>(QStringList newPathList)
<a name="l02760"></a>02760 {
<a name="l02761"></a>02761     <span class="comment">// clear out the old path list</span>
<a name="l02762"></a>02762     <a class="code" href="main_8cpp.html#a22af65502ad1b28e5dbc0e2b8a6ce317">qucsPathList</a>.clear();
<a name="l02763"></a>02763 
<a name="l02764"></a>02764     <span class="comment">// copy the new path into the path list</span>
<a name="l02765"></a>02765     <span class="keywordflow">foreach</span>(QString path, newPathList)
<a name="l02766"></a>02766     {
<a name="l02767"></a>02767         <a class="code" href="main_8cpp.html#a22af65502ad1b28e5dbc0e2b8a6ce317">qucsPathList</a>.append(path);
<a name="l02768"></a>02768     }
<a name="l02769"></a>02769     <span class="comment">// do the normal path update operations</span>
<a name="l02770"></a>02770     <a class="code" href="classQucsApp.html#a55673f055494a3a780b94bc77810eeb7">updatePathList</a>();
<a name="l02771"></a>02771 }
<a name="l02772"></a>02772 
<a name="l02773"></a>02773 
<a name="l02774"></a><a class="code" href="classQucsApp.html#aced5f32507a107d9e5d81c44b281ba71">02774</a> <span class="keywordtype">void</span> <a class="code" href="classQucsApp.html#aced5f32507a107d9e5d81c44b281ba71">QucsApp::updateRecentFilesList</a>(QString s)
<a name="l02775"></a>02775 {
<a name="l02776"></a>02776   QSettings* settings = <span class="keyword">new</span> QSettings(<span class="stringliteral">&quot;qucs&quot;</span>,<span class="stringliteral">&quot;qucs&quot;</span>);
<a name="l02777"></a>02777   <a class="code" href="main_8cpp.html#ac2e3fb7eed4aa9bd981210dc5df2e02e">QucsSettings</a>.<a class="code" href="structtQucsSettings.html#aefa2c7f96cb1375c6c18e6a5937e115c">RecentDocs</a>.removeAll(s);
<a name="l02778"></a>02778   <a class="code" href="main_8cpp.html#ac2e3fb7eed4aa9bd981210dc5df2e02e">QucsSettings</a>.<a class="code" href="structtQucsSettings.html#aefa2c7f96cb1375c6c18e6a5937e115c">RecentDocs</a>.prepend(s);
<a name="l02779"></a>02779   <span class="keywordflow">if</span> (<a class="code" href="main_8cpp.html#ac2e3fb7eed4aa9bd981210dc5df2e02e">QucsSettings</a>.<a class="code" href="structtQucsSettings.html#aefa2c7f96cb1375c6c18e6a5937e115c">RecentDocs</a>.size() &gt; <a class="code" href="classQucsApp.html#ae1a2e3319c738dd5eb3441cabfe5621ead0614ba0aaefe5a5d3bd0654d475c8cc">MaxRecentFiles</a>) {
<a name="l02780"></a>02780     <a class="code" href="main_8cpp.html#ac2e3fb7eed4aa9bd981210dc5df2e02e">QucsSettings</a>.<a class="code" href="structtQucsSettings.html#aefa2c7f96cb1375c6c18e6a5937e115c">RecentDocs</a>.removeLast();
<a name="l02781"></a>02781   }
<a name="l02782"></a>02782   settings-&gt;setValue(<span class="stringliteral">&quot;RecentDocs&quot;</span>,<a class="code" href="main_8cpp.html#ac2e3fb7eed4aa9bd981210dc5df2e02e">QucsSettings</a>.<a class="code" href="structtQucsSettings.html#aefa2c7f96cb1375c6c18e6a5937e115c">RecentDocs</a>.join(<span class="stringliteral">&quot;*&quot;</span>));
<a name="l02783"></a>02783   <span class="keyword">delete</span> settings;
<a name="l02784"></a>02784   <a class="code" href="classQucsApp.html#ae11e60e28902f1e1eb4604c90657459e">slotUpdateRecentFiles</a>();
<a name="l02785"></a>02785 }
<a name="l02786"></a>02786 
<a name="l02787"></a><a class="code" href="classQucsApp.html#a0bf5fdbea5342332cae0f3e8e758a5f7">02787</a> <span class="keywordtype">void</span> <a class="code" href="classQucsApp.html#a0bf5fdbea5342332cae0f3e8e758a5f7">QucsApp::slotSaveDiagramToGraphicsFile</a>()
<a name="l02788"></a>02788 {
<a name="l02789"></a>02789   <a class="code" href="classQucsApp.html#a3e3e5ef281974a93f518e759c7a31518">slotSaveSchematicToGraphicsFile</a>(<span class="keyword">true</span>);
<a name="l02790"></a>02790 }
<a name="l02791"></a>02791 
<a name="l02792"></a><a class="code" href="classQucsApp.html#a3e3e5ef281974a93f518e759c7a31518">02792</a> <span class="keywordtype">void</span> <a class="code" href="classQucsApp.html#a3e3e5ef281974a93f518e759c7a31518">QucsApp::slotSaveSchematicToGraphicsFile</a>(<span class="keywordtype">bool</span> diagram)
<a name="l02793"></a>02793 {
<a name="l02794"></a>02794   ImageWriter *writer = <span class="keyword">new</span> ImageWriter(<a class="code" href="classQucsApp.html#a0b5d68bd5b86c5f3a657d1af5fe6fb0a">lastExportFilename</a>);
<a name="l02795"></a>02795   writer-&gt;setDiagram(diagram);
<a name="l02796"></a>02796   writer-&gt;print(<a class="code" href="classQucsApp.html#ae7612793599ca4f5106f7e9f488d4225">DocumentTab</a>-&gt;currentWidget());
<a name="l02797"></a>02797   <a class="code" href="classQucsApp.html#a0b5d68bd5b86c5f3a657d1af5fe6fb0a">lastExportFilename</a> = writer-&gt;getLastSavedFile();
<a name="l02798"></a>02798   <span class="keyword">delete</span> writer;
<a name="l02799"></a>02799 }
</pre></div></div><!-- contents -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>



<hr class="footer"/><address class="footer"><small>
Generated on Sat Jul 4 2015 16:37:37 for Qucs-GUI by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
